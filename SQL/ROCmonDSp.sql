IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.fColumn') AND type='FN')
DROP FUNCTION dbo.fColumn
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

-- Multidesign function to map ColumnId for WrCloneScreen:
CREATE FUNCTION [dbo].[fColumn] (@cid int, @uClause nvarchar(2000)) RETURNS nvarchar(max)
/* WITH ENCRYPTION */
AS
BEGIN
	DECLARE	 @iClause nvarchar(max)
			,@i01 int, @i02 int, @i03 int, @i04 int, @i05 int, @i06 int, @i07 int, @i08 int, @i09 int, @i10 int
			,@i11 int, @i12 int, @i13 int, @i14 int, @i15 int, @i16 int, @i17 int, @i18 int, @i19 int, @i20 int
			,@i21 int, @i22 int, @i23 int, @i24 int, @i25 int, @i26 int, @i27 int, @i28 int, @i29 int, @i30 int
			,@c01 nvarchar(max), @c02 nvarchar(max), @c03 nvarchar(max), @c04 nvarchar(max), @c05 nvarchar(max), @c06 nvarchar(max), @c07 nvarchar(max), @c08 nvarchar(max), @c09 nvarchar(max), @c10 nvarchar(max)
			,@c11 nvarchar(max), @c12 nvarchar(max), @c13 nvarchar(max), @c14 nvarchar(max), @c15 nvarchar(max), @c16 nvarchar(max), @c17 nvarchar(max), @c18 nvarchar(max), @c19 nvarchar(max), @c20 nvarchar(max)
			,@c21 nvarchar(max), @c22 nvarchar(max), @c23 nvarchar(max), @c24 nvarchar(max), @c25 nvarchar(max), @c26 nvarchar(max), @c27 nvarchar(max), @c28 nvarchar(max), @c29 nvarchar(max), @c30 nvarchar(max)
	SELECT @iClause = ''
	IF @cid IS NOT NULL
	BEGIN
		SELECT @i01=TableId, @i02=ColumnIndex, @c03=ExternalTable, @c04=ColumnName, @c05=ColumnDesc, @i06=DataType, @i07=ColumnLength, @i08=ColumnScale, @c09=DefaultValue, @c10=AllowNulls, @c11=ColumnIdentity, @c12=PrimaryKey, @c13=IsIndexU, @c14=IsIndex, @c15=ColObjective
		FROM dbo.DbColumn WHERE ColumnId=@cid
		SELECT @i20=SystemId, @c21=TableName, @c22=TableDesc, @c23=MultiDesignDb, @c24=VirtualTbl, @c25=VirtualSql, @c26=TblObjective
		FROM dbo.DbTable WHERE TableId=@i01
		SELECT @iClause = @iClause
		+ char(13) + char(10) + 'IF EXISTS (SELECT 1 FROM dbo.DbTable WHERE TableName=' + RODesign.dbo.fNullCha(@c21) + ')'
		+ char(13) + char(10) + 'BEGIN'
		+ char(13) + char(10) + '  SELECT @TableId=TableId FROM dbo.DbTable WHERE TableName=' + RODesign.dbo.fNullCha(@c21)
		+ char(13) + char(10) + '  IF EXISTS (SELECT 1 FROM dbo.DbColumn WHERE TableId=@TableId AND ColumnName=' + RODesign.dbo.fNullCha(@c04) + ')'
		+ char(13) + char(10) + '    SELECT @ColumnId=ColumnId FROM dbo.DbColumn WHERE TableId=@TableId AND ColumnName=' + RODesign.dbo.fNullCha(@c04)
		+ char(13) + char(10) + '  ELSE'
		+ char(13) + char(10) + '  BEGIN'
		+ char(13) + char(10) + '    INSERT dbo.DbColumn (TableId,ColumnIndex,ExternalTable,ColumnName,ColumnDesc,DataType,ColumnLength,ColumnScale,DefaultValue,AllowNulls,ColumnIdentity,PrimaryKey,IsIndexU,IsIndex,ColObjective)'
		+ char(13) + char(10) + '    SELECT @TableId'
		+ ',' + RODesign.dbo.fNullInt(@i02)
		+ ',' + RODesign.dbo.fNullCha(@c03)
		+ ',' + RODesign.dbo.fNullCha(@c04)
		+ ',' + RODesign.dbo.fNullCha(@c05)
		+ ',' + RODesign.dbo.fNullInt(@i06)
		+ ',' + RODesign.dbo.fNullInt(@i07)
		+ ',' + RODesign.dbo.fNullInt(@i08)
		+ ',' + RODesign.dbo.fNullCha(@c09)
		+ ',' + RODesign.dbo.fNullCha(@c10)
		+ ',' + RODesign.dbo.fNullCha(@c11)
		+ ',' + RODesign.dbo.fNullCha(@c12)
		+ ',' + RODesign.dbo.fNullCha(@c13)
		+ ',' + RODesign.dbo.fNullCha(@c14)
		+ ',' + RODesign.dbo.fNullCha(@c15)
		+ char(13) + char(10) + '    SELECT @ColumnId=@@IDENTITY'
		+ char(13) + char(10) + '  END'
		+ char(13) + char(10) + 'END'
		+ char(13) + char(10) + 'ELSE'
		+ char(13) + char(10) + 'BEGIN'
		+ char(13) + char(10) + '  INSERT dbo.DbTable (SystemId,TableName,TableDesc,MultiDesignDb,VirtualTbl,VirtualSql,TblObjective)'
		+ char(13) + char(10) + '  SELECT'
		+ ' ' + RODesign.dbo.fNullInt(@i20)
		+ ',' + RODesign.dbo.fNullCha(@c21)
		+ ',' + RODesign.dbo.fNullCha(@c22)
		+ ',' + RODesign.dbo.fNullCha(@c23)
		+ ',' + RODesign.dbo.fNullCha(@c24)
		+ ',' + RODesign.dbo.fNullCha(@c25)
		+ ',' + RODesign.dbo.fNullCha(@c26)
		+ char(13) + char(10) + '  SELECT @TableId=@@IDENTITY'
		+ char(13) + char(10) + '  INSERT dbo.DbColumn (TableId,ColumnIndex,ExternalTable,ColumnName,ColumnDesc,DataType,ColumnLength,ColumnScale,DefaultValue,AllowNulls,ColumnIdentity,PrimaryKey,IsIndexU,IsIndex,ColObjective)'
		+ char(13) + char(10) + '  SELECT @TableId'
		+ ',' + RODesign.dbo.fNullInt(@i02)
		+ ',' + RODesign.dbo.fNullCha(@c03)
		+ ',' + RODesign.dbo.fNullCha(@c04)
		+ ',' + RODesign.dbo.fNullCha(@c05)
		+ ',' + RODesign.dbo.fNullInt(@i06)
		+ ',' + RODesign.dbo.fNullInt(@i07)
		+ ',' + RODesign.dbo.fNullInt(@i08)
		+ ',' + RODesign.dbo.fNullCha(@c09)
		+ ',' + RODesign.dbo.fNullCha(@c10)
		+ ',' + RODesign.dbo.fNullCha(@c11)
		+ ',' + RODesign.dbo.fNullCha(@c12)
		+ ',' + RODesign.dbo.fNullCha(@c13)
		+ ',' + RODesign.dbo.fNullCha(@c14)
		+ ',' + RODesign.dbo.fNullCha(@c15)
		+ char(13) + char(10) + '  SELECT @ColumnId=@@IDENTITY'
		+ char(13) + char(10) + 'END'
		+ char(13) + char(10) + @uClause
	END
	RETURN @iClause
END

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.fSelRowAuth') AND type='FN')
DROP FUNCTION dbo.fSelRowAuth
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE FUNCTION [dbo].[fSelRowAuth] (@RowAuthId smallint, @ScreenId int, @ReportId int, @key varchar(50)) RETURNS char(1)
/* WITH ENCRYPTION */
AS
BEGIN
	DECLARE	 @rtn		char(1)
			,@PermKeyId	smallint
	IF @key = 'SysAdmin'
		SELECT @rtn = SysAdmin FROM RODesign.dbo.VwRowAuth WHERE RowAuthId = @RowAuthId
	ELSE IF @key = 'AllowSel'
	BEGIN
		IF (@ScreenId is null OR @ScreenId = 0) AND (@ReportId is null OR @ReportId = 0)
			SELECT @rtn = AllowSel FROM RODesign.dbo.VwRowAuth WHERE RowAuthId = @RowAuthId
		ELSE IF @ScreenId is null OR @ScreenId = 0
		BEGIN
			IF EXISTS (SELECT 1 FROM dbo.RowOvrd WHERE RowAuthId = @RowAuthId AND ScreenId = @ScreenId)
				SELECT @rtn = AllowSel FROM dbo.RowOvrd WHERE RowAuthId = @RowAuthId AND ScreenId = @ScreenId
			ELSE
				SELECT @rtn = AllowSel FROM RODesign.dbo.VwRowAuth WHERE RowAuthId = @RowAuthId
		END
		ELSE
		BEGIN
			IF EXISTS (SELECT 1 FROM dbo.RowOvrd WHERE RowAuthId = @RowAuthId AND ReportId = @ReportId)
				SELECT @rtn = AllowSel FROM dbo.RowOvrd WHERE RowAuthId = @RowAuthId AND ReportId = @ReportId
			ELSE
				SELECT @rtn = AllowSel FROM RODesign.dbo.VwRowAuth WHERE RowAuthId = @RowAuthId
		END
	END
	ELSE
	BEGIN
		SELECT @PermKeyId = PermKeyId FROM RODesign.dbo.VwPermKey WHERE PermKeyDesc = @key
		IF @PermKeyId is not null
		BEGIN
			IF (@ScreenId is null OR @ScreenId = 0) AND (@ReportId is null OR @ReportId = 0)
				SELECT @rtn = CASE
						WHEN b.SelLevel is not null THEN b.SelLevel
						WHEN c.SelLevel is not null THEN c.SelLevel ELSE a.AllowSel END
					FROM RODesign.dbo.VwRowAuth a
					LEFT OUTER JOIN RODesign.dbo.CtRowAuthPrm b ON a.RowAuthId = b.RowAuthId AND b.PermKeyId = @PermKeyId
					LEFT OUTER JOIN RODesign.dbo.AtRowAuthPrm c ON a.RowAuthId = c.RowAuthId AND c.PermKeyId = @PermKeyId
					WHERE a.RowAuthId = @RowAuthId
			ELSE IF @ScreenId is not null AND @ScreenId <> 0
			BEGIN
				IF EXISTS (SELECT 1 FROM dbo.RowOvrd WHERE RowAuthId = @RowAuthId AND ScreenId = @ScreenId)
					SELECT @rtn = CASE WHEN b.SelLevel is not null THEN b.SelLevel ELSE a.AllowSel END
						FROM dbo.RowOvrd a
						INNER JOIN RODesign.dbo.VwRowAuth c ON a.RowAuthId = c.RowAuthId
						LEFT OUTER JOIN dbo.RowOvrdPrm b ON a.RowOvrdId = b.RowOvrdId AND b.PermKeyId = @PermKeyId
						WHERE a.RowAuthId = @RowAuthId AND a.ScreenId = @ScreenId
				ELSE
					SELECT @rtn = CASE
							WHEN b.SelLevel is not null THEN b.SelLevel
							WHEN c.SelLevel is not null THEN c.SelLevel ELSE a.AllowSel END
						FROM RODesign.dbo.VwRowAuth a
						LEFT OUTER JOIN RODesign.dbo.CtRowAuthPrm b ON a.RowAuthId = b.RowAuthId AND b.PermKeyId = @PermKeyId
						LEFT OUTER JOIN RODesign.dbo.AtRowAuthPrm c ON a.RowAuthId = c.RowAuthId AND c.PermKeyId = @PermKeyId
						WHERE a.RowAuthId = @RowAuthId
			END
			ELSE	-- @ReportId is not null AND @ReportId <> 0
			BEGIN
				IF EXISTS (SELECT 1 FROM dbo.RowOvrd WHERE RowAuthId = @RowAuthId AND ReportId = @ReportId)
					SELECT @rtn = CASE WHEN b.SelLevel is not null THEN b.SelLevel ELSE a.AllowSel END
						FROM dbo.RowOvrd a
						INNER JOIN RODesign.dbo.VwRowAuth c ON a.RowAuthId = c.RowAuthId
						LEFT OUTER JOIN dbo.RowOvrdPrm b ON a.RowOvrdId = b.RowOvrdId AND b.PermKeyId = @PermKeyId
						WHERE a.RowAuthId = @RowAuthId AND a.ReportId = @ReportId
				ELSE
					SELECT @rtn = CASE
							WHEN b.SelLevel is not null THEN b.SelLevel
							WHEN c.SelLevel is not null THEN c.SelLevel ELSE a.AllowSel END
						FROM RODesign.dbo.VwRowAuth a
						LEFT OUTER JOIN RODesign.dbo.CtRowAuthPrm b ON a.RowAuthId = b.RowAuthId AND b.PermKeyId = @PermKeyId
						LEFT OUTER JOIN RODesign.dbo.AtRowAuthPrm c ON a.RowAuthId = c.RowAuthId AND c.PermKeyId = @PermKeyId
						WHERE a.RowAuthId = @RowAuthId
			END
		END
	END
	RETURN @rtn
END
 
 
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.fTable') AND type='FN')
DROP FUNCTION dbo.fTable
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

-- Multidesign function to map TableId for WrCloneScreen:
CREATE FUNCTION [dbo].[fTable] (@tid int, @uClause nvarchar(2000)) RETURNS nvarchar(max)
/* WITH ENCRYPTION */
AS
BEGIN
	DECLARE	 @iClause nvarchar(max), @i20 int
			,@i21 int, @i22 int, @i23 int, @i24 int, @i25 int, @i26 int, @i27 int, @i28 int, @i29 int, @i30 int
			,@c21 nvarchar(max), @c22 nvarchar(max), @c23 nvarchar(max), @c24 nvarchar(max), @c25 nvarchar(max), @c26 nvarchar(max), @c27 nvarchar(max), @c28 nvarchar(max), @c29 nvarchar(max), @c30 nvarchar(max)
	SELECT @iClause = ''
	IF @tid IS NOT NULL
	BEGIN
		SELECT @i20=SystemId, @c21=TableName, @c22=TableDesc, @c23=MultiDesignDb, @c24=VirtualTbl, @c25=VirtualSql, @c26=TblObjective
		FROM dbo.DbTable WHERE TableId=@tid
		SELECT @iClause = @iClause
		+ char(13) + char(10) + 'IF EXISTS (SELECT 1 FROM dbo.DbTable WHERE TableName=' + RODesign.dbo.fNullCha(@c21) + ')'
		+ char(13) + char(10) + '  SELECT @TableId=TableId FROM dbo.DbTable WHERE TableName=' + RODesign.dbo.fNullCha(@c21)
		+ char(13) + char(10) + 'ELSE'
		+ char(13) + char(10) + 'BEGIN'
		+ char(13) + char(10) + '  INSERT dbo.DbTable (SystemId,TableName,TableDesc,MultiDesignDb,VirtualTbl,VirtualSql,TblObjective)'
		+ char(13) + char(10) + '  SELECT'
		+ ' ' + RODesign.dbo.fNullInt(@i20)
		+ ',' + RODesign.dbo.fNullCha(@c21)
		+ ',' + RODesign.dbo.fNullCha(@c22)
		+ ',' + RODesign.dbo.fNullCha(@c23)
		+ ',' + RODesign.dbo.fNullCha(@c24)
		+ ',' + RODesign.dbo.fNullCha(@c25)
		+ ',' + RODesign.dbo.fNullCha(@c26)
		+ char(13) + char(10) + '  SELECT @TableId=@@IDENTITY'
		+ char(13) + char(10) + 'END'
		+ char(13) + char(10) + @uClause
	END
	RETURN @iClause
END

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.AddAdmRptWiz95Dt') AND type='P')
DROP PROCEDURE dbo.AddAdmRptWiz95Dt
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[AddAdmRptWiz95Dt]
 @RptwizId		int
,@RptwizDtlId	int
,@ColumnId		int
,@ColHeader		nvarchar(100)
,@CriOperName	varchar(50)
,@CriSelect		smallint
,@CriHeader		nvarchar(100)
,@ColSelect		smallint
,@ColGroup		smallint
,@ColSort		smallint
,@AggregateCd	char(1)
,@RptChartCd	char(1)
/* WITH ENCRYPTION */
AS
DECLARE	 @OperatorId	tinyint
SET NOCOUNT ON
SELECT @OperatorId = OperatorId FROM RODesign.dbo.CtOperator WHERE OperatorName = @CriOperName
IF @RptwizDtlId is null
BEGIN
	INSERT dbo.RptwizDtl (RptwizId, ColumnId, ColHeader, CriOperatorId, CriSelect, CriHeader
	, ColSelect, ColGroup, ColSort, AggregateCd, RptChartCd)
	SELECT @RptwizId, @ColumnId, @ColHeader, @OperatorId, @CriSelect, @CriHeader
	, @ColSelect, @ColGroup, @ColSort, @AggregateCd, @RptChartCd
	SELECT @@IDENTITY
END
ELSE
BEGIN
	UPDATE dbo.RptwizDtl SET
		 RptwizId = @RptwizId
		,ColumnId = @ColumnId
		,ColHeader = @ColHeader
		,CriOperatorId = @OperatorId
		,CriSelect = @CriSelect
		,CriHeader = @CriHeader
		,ColSelect = @ColSelect
		,ColGroup = @ColGroup
		,ColSort = @ColSort
		,AggregateCd = @AggregateCd
		,RptChartCd = @RptChartCd
	WHERE RptwizDtlId = @RptwizDtlId
	SELECT @RptwizDtlId
END
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ae_DelServerRule') AND type='P')
DROP PROCEDURE dbo.Ae_DelServerRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[Ae_DelServerRule]
 @ServerRuleId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @ScreenId	int
	,@ProcedureName	varchar(50)
	,@MultiDesignDb	char(1)
	,@AppDb		varchar(50)
	,@DesDb		varchar(50)
	,@dClause	varchar(4000)
SET NOCOUNT ON
SELECT @ScreenId = ScreenId, @ProcedureName = ProcedureName FROM dbo.ServerRule WHERE ServerRuleId = @ServerRuleId
SELECT @MultiDesignDb = b.MultiDesignDb FROM dbo.Screen a INNER JOIN dbo.DbTable b on a.MasterTableId = b.TableId WHERE a.ScreenId = @ScreenId
SELECT @dClause = 'IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(''''' + @ProcedureName + ''''') AND type=''''P'''') DROP PROCEDURE ' + @ProcedureName
IF @MultiDesignDb = 'Y'
BEGIN
	DECLARE curs CURSOR FAST_FORWARD FOR SELECT dbDesDatabase FROM RODesign.dbo.Systems FOR READ ONLY
	OPEN curs FETCH NEXT FROM curs INTO @DesDb
	WHILE @@FETCH_STATUS = 0
	BEGIN
		EXEC (@DesDb + '.dbo.MkStoredProcedure ''' + @dClause + '''')
		FETCH NEXT FROM curs INTO @DesDb
	END
	CLOSE curs
	DEALLOCATE curs
END
ELSE
BEGIN
	EXEC (@AppDb + '.dbo.MkStoredProcedure ''' + @dClause + '''')
END
RETURN 0 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Audit_Add76M') AND type='P')
DROP PROCEDURE dbo.Audit_Add76M
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE dbo.Audit_Add76M
 @ButtonHlpId		Int
,@UserId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @ScrAuditId		bigint
		,@SearchCol		nvarchar(2000)
		,@OScreenId		Int
		,@OCultureId		SmallInt
		,@OButtonTypeId		TinyInt
		,@OButtonName		NVarChar(200)
		,@OButtonToolTip		NVarChar(400)
		,@OButtonVisible		Char(1)
		,@OReportId		Int
		,@OWizardId		Int
		,@OButtonLongNm		NVarChar(400)
		,@ORowVisible		Char(1)
		,@OTopVisible		Char(1)
		,@OBotVisible		Char(1)
SELECT @SearchCol=ButtonHlpId,@OScreenId=ScreenId,@OCultureId=CultureId,@OButtonTypeId=ButtonTypeId,@OButtonName=ButtonName,@OButtonToolTip=ButtonToolTip,@OButtonVisible=ButtonVisible,@OReportId=ReportId,@OWizardId=WizardId,@OButtonLongNm=ButtonLongNm,@ORowVisible=RowVisible,@OTopVisible=TopVisible,@OBotVisible=BotVisible FROM dbo.ButtonHlp WHERE ButtonHlpId=@ButtonHlpId
INSERT RODesign.dbo.ScrAudit (CudAction,ScreenId,MasterTable,TableId,RowId,RowDesc,ChangedBy,ChangedOn)
	SELECT 'A',76,'Y',116,@ButtonHlpId,ISNULL(@SearchCol,''),@UserId,getutcdate()
SELECT @ScrAuditId = @@IDENTITY
IF @OScreenId IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedTo,ChangedFr)
	SELECT @ScrAuditId,1208,'Screen',1021,'ScreenId',CONVERT(varchar(10),@OScreenId),NULL
IF @OCultureId IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedTo,ChangedFr)
	SELECT @ScrAuditId,1209,'Culture',1022,'CultureId',CONVERT(varchar(10),@OCultureId),NULL
IF @OButtonTypeId IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedTo,ChangedFr)
	SELECT @ScrAuditId,1210,'Button Type',1023,'ButtonTypeId',CONVERT(varchar(10),@OButtonTypeId),NULL
IF @OButtonName IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedTo,ChangedFr)
	SELECT @ScrAuditId,1211,'Alternate Name',1024,'ButtonName',@OButtonName,NULL
IF @OButtonToolTip IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedTo,ChangedFr)
	SELECT @ScrAuditId,1212,'Alternate Tool Tip',1025,'ButtonToolTip',@OButtonToolTip,NULL
IF @OButtonVisible IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedTo,ChangedFr)
	SELECT @ScrAuditId,1213,'Visibility',1026,'ButtonVisible',@OButtonVisible,NULL
IF @OReportId IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedTo,ChangedFr)
	SELECT @ScrAuditId,1214,'Report',1041,'ReportId',CONVERT(varchar(10),@OReportId),NULL
IF @OWizardId IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedTo,ChangedFr)
	SELECT @ScrAuditId,1215,'Wizard',1042,'WizardId',CONVERT(varchar(10),@OWizardId),NULL
IF @OButtonLongNm IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedTo,ChangedFr)
	SELECT @ScrAuditId,4159,'Alternative Long Name',7472,'ButtonLongNm',@OButtonLongNm,NULL
IF @ORowVisible IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedTo,ChangedFr)
	SELECT @ScrAuditId,4160,'Row Menu',7475,'RowVisible',@ORowVisible,NULL
IF @OTopVisible IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedTo,ChangedFr)
	SELECT @ScrAuditId,4161,'Top Menu',7473,'TopVisible',@OTopVisible,NULL
IF @OBotVisible IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedTo,ChangedFr)
	SELECT @ScrAuditId,4163,'Bottom Menu',7474,'BotVisible',@OBotVisible,NULL
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Audit_Del76M') AND type='P')
DROP PROCEDURE dbo.Audit_Del76M
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE dbo.Audit_Del76M
 @ButtonHlpId		Int
,@UserId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @ScrAuditId		bigint
		,@SearchCol		nvarchar(2000)
		,@OScreenId		Int
		,@OCultureId		SmallInt
		,@OButtonTypeId		TinyInt
		,@OButtonName		NVarChar(200)
		,@OButtonToolTip		NVarChar(400)
		,@OButtonVisible		Char(1)
		,@OReportId		Int
		,@OWizardId		Int
		,@OButtonLongNm		NVarChar(400)
		,@ORowVisible		Char(1)
		,@OTopVisible		Char(1)
		,@OBotVisible		Char(1)
SELECT @SearchCol=ButtonHlpId,@OScreenId=ScreenId,@OCultureId=CultureId,@OButtonTypeId=ButtonTypeId,@OButtonName=ButtonName,@OButtonToolTip=ButtonToolTip,@OButtonVisible=ButtonVisible,@OReportId=ReportId,@OWizardId=WizardId,@OButtonLongNm=ButtonLongNm,@ORowVisible=RowVisible,@OTopVisible=TopVisible,@OBotVisible=BotVisible FROM dbo.ButtonHlp WHERE ButtonHlpId=@ButtonHlpId
INSERT RODesign.dbo.ScrAudit (CudAction,ScreenId,MasterTable,TableId,RowId,RowDesc,ChangedBy,ChangedOn)
	SELECT 'D',76,'Y',116,@ButtonHlpId,ISNULL(@SearchCol,''),@UserId,getutcdate()
SELECT @ScrAuditId = @@IDENTITY
IF @OScreenId IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,1208,'Screen',1021,'ScreenId',CONVERT(varchar(10),@OScreenId),NULL
IF @OCultureId IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,1209,'Culture',1022,'CultureId',CONVERT(varchar(10),@OCultureId),NULL
IF @OButtonTypeId IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,1210,'Button Type',1023,'ButtonTypeId',CONVERT(varchar(10),@OButtonTypeId),NULL
IF @OButtonName IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,1211,'Alternate Name',1024,'ButtonName',@OButtonName,NULL
IF @OButtonToolTip IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,1212,'Alternate Tool Tip',1025,'ButtonToolTip',@OButtonToolTip,NULL
IF @OButtonVisible IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,1213,'Visibility',1026,'ButtonVisible',@OButtonVisible,NULL
IF @OReportId IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,1214,'Report',1041,'ReportId',CONVERT(varchar(10),@OReportId),NULL
IF @OWizardId IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,1215,'Wizard',1042,'WizardId',CONVERT(varchar(10),@OWizardId),NULL
IF @OButtonLongNm IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,4159,'Alternative Long Name',7472,'ButtonLongNm',@OButtonLongNm,NULL
IF @ORowVisible IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,4160,'Row Menu',7475,'RowVisible',@ORowVisible,NULL
IF @OTopVisible IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,4161,'Top Menu',7473,'TopVisible',@OTopVisible,NULL
IF @OBotVisible IS NOT NULL
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,4163,'Bottom Menu',7474,'BotVisible',@OBotVisible,NULL
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Audit_Upd76M') AND type='P')
DROP PROCEDURE dbo.Audit_Upd76M
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE dbo.Audit_Upd76M
 @ButtonHlpId		Int
,@ScreenId		Int
,@CultureId		SmallInt
,@ButtonTypeId		TinyInt
,@ButtonName		NVarChar(200)
,@ButtonToolTip		NVarChar(400)
,@ButtonVisible		Char(1)
,@ReportId		Int
,@WizardId		Int
,@ButtonLongNm		NVarChar(400)
,@RowVisible		Char(1)
,@TopVisible		Char(1)
,@BotVisible		Char(1)
,@UserId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @ScrAuditId		bigint
		,@SearchCol		nvarchar(2000)
		,@OScreenId		Int
		,@OCultureId		SmallInt
		,@OButtonTypeId		TinyInt
		,@OButtonName		NVarChar(200)
		,@OButtonToolTip		NVarChar(400)
		,@OButtonVisible		Char(1)
		,@OReportId		Int
		,@OWizardId		Int
		,@OButtonLongNm		NVarChar(400)
		,@ORowVisible		Char(1)
		,@OTopVisible		Char(1)
		,@OBotVisible		Char(1)
SELECT @SearchCol=ButtonHlpId,@OScreenId=ScreenId,@OCultureId=CultureId,@OButtonTypeId=ButtonTypeId,@OButtonName=ButtonName,@OButtonToolTip=ButtonToolTip,@OButtonVisible=ButtonVisible,@OReportId=ReportId,@OWizardId=WizardId,@OButtonLongNm=ButtonLongNm,@ORowVisible=RowVisible,@OTopVisible=TopVisible,@OBotVisible=BotVisible FROM dbo.ButtonHlp WHERE ButtonHlpId=@ButtonHlpId
IF ((@OScreenId IS NOT NULL AND @ScreenId IS NULL) OR (@OScreenId IS NULL AND @ScreenId IS NOT NULL) OR (@OScreenId <> @ScreenId)) OR ((@OCultureId IS NOT NULL AND @CultureId IS NULL) OR (@OCultureId IS NULL AND @CultureId IS NOT NULL) OR (@OCultureId <> @CultureId)) OR ((@OButtonTypeId IS NOT NULL AND @ButtonTypeId IS NULL) OR (@OButtonTypeId IS NULL AND @ButtonTypeId IS NOT NULL) OR (@OButtonTypeId <> @ButtonTypeId)) OR ((@OButtonName IS NOT NULL AND @ButtonName IS NULL) OR (@OButtonName IS NULL AND @ButtonName IS NOT NULL) OR (@OButtonName <> @ButtonName)) OR ((@OButtonToolTip IS NOT NULL AND @ButtonToolTip IS NULL) OR (@OButtonToolTip IS NULL AND @ButtonToolTip IS NOT NULL) OR (@OButtonToolTip <> @ButtonToolTip)) OR ((@OButtonVisible IS NOT NULL AND @ButtonVisible IS NULL) OR (@OButtonVisible IS NULL AND @ButtonVisible IS NOT NULL) OR (@OButtonVisible <> @ButtonVisible)) OR ((@OReportId IS NOT NULL AND @ReportId IS NULL) OR (@OReportId IS NULL AND @ReportId IS NOT NULL) OR (@OReportId <> @ReportId)) OR ((@OWizardId IS NOT NULL AND @WizardId IS NULL) OR (@OWizardId IS NULL AND @WizardId IS NOT NULL) OR (@OWizardId <> @WizardId)) OR ((@OButtonLongNm IS NOT NULL AND @ButtonLongNm IS NULL) OR (@OButtonLongNm IS NULL AND @ButtonLongNm IS NOT NULL) OR (@OButtonLongNm <> @ButtonLongNm)) OR ((@ORowVisible IS NOT NULL AND @RowVisible IS NULL) OR (@ORowVisible IS NULL AND @RowVisible IS NOT NULL) OR (@ORowVisible <> @RowVisible)) OR ((@OTopVisible IS NOT NULL AND @TopVisible IS NULL) OR (@OTopVisible IS NULL AND @TopVisible IS NOT NULL) OR (@OTopVisible <> @TopVisible)) OR ((@OBotVisible IS NOT NULL AND @BotVisible IS NULL) OR (@OBotVisible IS NULL AND @BotVisible IS NOT NULL) OR (@OBotVisible <> @BotVisible))
BEGIN
INSERT RODesign.dbo.ScrAudit (CudAction,ScreenId,MasterTable,TableId,RowId,RowDesc,ChangedBy,ChangedOn)
	SELECT 'U',76,'Y',116,@ButtonHlpId,ISNULL(@SearchCol,''),@UserId,getutcdate()
SELECT @ScrAuditId = @@IDENTITY
IF (@OScreenId IS NOT NULL AND @ScreenId IS NULL) OR (@OScreenId IS NULL AND @ScreenId IS NOT NULL) OR (@OScreenId <> @ScreenId)
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,1208,'Screen',1021,'ScreenId',CONVERT(varchar(10),@OScreenId),CONVERT(varchar(10),@ScreenId)
IF (@OCultureId IS NOT NULL AND @CultureId IS NULL) OR (@OCultureId IS NULL AND @CultureId IS NOT NULL) OR (@OCultureId <> @CultureId)
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,1209,'Culture',1022,'CultureId',CONVERT(varchar(10),@OCultureId),CONVERT(varchar(10),@CultureId)
IF (@OButtonTypeId IS NOT NULL AND @ButtonTypeId IS NULL) OR (@OButtonTypeId IS NULL AND @ButtonTypeId IS NOT NULL) OR (@OButtonTypeId <> @ButtonTypeId)
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,1210,'Button Type',1023,'ButtonTypeId',CONVERT(varchar(10),@OButtonTypeId),CONVERT(varchar(10),@ButtonTypeId)
IF (@OButtonName IS NOT NULL AND @ButtonName IS NULL) OR (@OButtonName IS NULL AND @ButtonName IS NOT NULL) OR (@OButtonName <> @ButtonName)
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,1211,'Alternate Name',1024,'ButtonName',@OButtonName,@ButtonName
IF (@OButtonToolTip IS NOT NULL AND @ButtonToolTip IS NULL) OR (@OButtonToolTip IS NULL AND @ButtonToolTip IS NOT NULL) OR (@OButtonToolTip <> @ButtonToolTip)
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,1212,'Alternate Tool Tip',1025,'ButtonToolTip',@OButtonToolTip,@ButtonToolTip
IF (@OButtonVisible IS NOT NULL AND @ButtonVisible IS NULL) OR (@OButtonVisible IS NULL AND @ButtonVisible IS NOT NULL) OR (@OButtonVisible <> @ButtonVisible)
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,1213,'Visibility',1026,'ButtonVisible',@OButtonVisible,@ButtonVisible
IF (@OReportId IS NOT NULL AND @ReportId IS NULL) OR (@OReportId IS NULL AND @ReportId IS NOT NULL) OR (@OReportId <> @ReportId)
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,1214,'Report',1041,'ReportId',CONVERT(varchar(10),@OReportId),CONVERT(varchar(10),@ReportId)
IF (@OWizardId IS NOT NULL AND @WizardId IS NULL) OR (@OWizardId IS NULL AND @WizardId IS NOT NULL) OR (@OWizardId <> @WizardId)
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,1215,'Wizard',1042,'WizardId',CONVERT(varchar(10),@OWizardId),CONVERT(varchar(10),@WizardId)
IF (@OButtonLongNm IS NOT NULL AND @ButtonLongNm IS NULL) OR (@OButtonLongNm IS NULL AND @ButtonLongNm IS NOT NULL) OR (@OButtonLongNm <> @ButtonLongNm)
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,4159,'Alternative Long Name',7472,'ButtonLongNm',@OButtonLongNm,@ButtonLongNm
IF (@ORowVisible IS NOT NULL AND @RowVisible IS NULL) OR (@ORowVisible IS NULL AND @RowVisible IS NOT NULL) OR (@ORowVisible <> @RowVisible)
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,4160,'Row Menu',7475,'RowVisible',@ORowVisible,@RowVisible
IF (@OTopVisible IS NOT NULL AND @TopVisible IS NULL) OR (@OTopVisible IS NULL AND @TopVisible IS NOT NULL) OR (@OTopVisible <> @TopVisible)
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,4161,'Top Menu',7473,'TopVisible',@OTopVisible,@TopVisible
IF (@OBotVisible IS NOT NULL AND @BotVisible IS NULL) OR (@OBotVisible IS NULL AND @BotVisible IS NOT NULL) OR (@OBotVisible <> @BotVisible)
INSERT RODesign.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,ChangedFr,ChangedTo)
	SELECT @ScrAuditId,4163,'Bottom Menu',7474,'BotVisible',@OBotVisible,@BotVisible
END
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.CountRptCri') AND type='P')
DROP PROCEDURE dbo.CountRptCri
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[CountRptCri]
 @ReportCriId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @TableName		varchar(500)
		,@db			varchar(50)
		,@ColumnName	varchar(50)
SET NOCOUNT ON
SELECT @TableName = c.TableName, @ColumnName = a.ColumnName, @db = case when c.MultiDesignDb = 'Y' then d.dbDesDatabase else d.dbAppDatabase end
	FROM dbo.ReportCri a
	INNER JOIN dbo.DbTable c ON a.TableId = c.TableId
	INNER JOIN RODesign.dbo.Systems d ON c.SystemId = d.SystemId
	WHERE a.ReportCriId = @ReportCriId
IF @TableName is not null and @TableName <> '' and exists (SELECT 1 FROM RODesign.dbo.CtPermKey WHERE ColumnName = @ColumnName)
	EXEC ('SELECT COUNT(1) FROM ' + @db + '.dbo.' + @TableName)
ELSE
	SELECT 0
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.CountScrCri') AND type='P')
DROP PROCEDURE dbo.CountScrCri
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[CountScrCri]
 @ScreenCriId		int
,@MultiDesignDb		char(1)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
SELECT @sClause = 'DECLARE @TableName varchar(500), @db varchar(50), @ColumnName	varchar(50)'
+ ' SELECT @TableName = c.TableName, @ColumnName = b.ColumnName, @db = case when c.MultiDesignDb = ''Y'' then d.dbDesDatabase else d.dbAppDatabase end'
+ ' FROM ' + case when @MultiDesignDb = 'Y' then 'RODesign.' else space(0) end + 'dbo.ScreenCri a'
+ ' INNER JOIN ' + case when @MultiDesignDb = 'Y' then 'RODesign.' else space(0) end + 'dbo.DbColumn b ON a.DdlKeyColumnId = b.ColumnId'
+ ' INNER JOIN ' + case when @MultiDesignDb = 'Y' then 'RODesign.' else space(0) end + 'dbo.DbTable c ON b.TableId = c.TableId'
+ ' INNER JOIN RODesign.dbo.Systems d ON c.SystemId = d.SystemId'
+ ' WHERE a.ScreenCriId = ' + convert(varchar(10),@ScreenCriId)
+ ' IF @TableName is not null and @TableName <> '''' and exists (SELECT 1 FROM RODesign.dbo.CtPermKey WHERE ColumnName = @ColumnName)'
+ '		EXEC (''SELECT COUNT(1) FROM ' + case when @MultiDesignDb = 'Y' then space(0) else ''' + @db + ''.' end + 'dbo.'' + @TableName)'
+ ' ELSE'
+ '		SELECT 0'
EXEC (@sClause)
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkAppItem') AND type='P')
DROP PROCEDURE dbo.Cr_ChkAppItem
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkAppItem]
 @AppItemId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @RelativePath	varchar(100)
SET NOCOUNT ON
SELECT @RelativePath = RelativePath FROM dbo.AppItem WHERE AppItemId = @AppItemId
IF @RelativePath is not null AND right(@RelativePath,1) <> '\'
BEGIN
	RAISERROR('Please either empty the Relative Path for current path or make sure it ends with "\" and try again.',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkAuthCol') AND type='P')
DROP PROCEDURE dbo.Cr_ChkAuthCol
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[Cr_ChkAuthCol]
 @ColOvrdId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @ScreenObjId	int
		,@PermKeyId		smallint
		,@PermId		int
		,@Priority		smallint
		,@PermKeyDesc	varchar(50)
		,@PermKeyRowId	int
SET NOCOUNT ON
SELECT @ScreenObjId = a.ScreenObjId, @PermKeyId = a.PermKeyId, @PermId = a.PermId, @Priority = a.Priority, @PermKeyDesc = isnull(b.PermKeyDesc,'Default')
	,@PermKeyRowId = a.PermKeyRowId
	FROM dbo.ColOvrd a LEFT OUTER JOIN RODesign.dbo.VwPermKey b ON a.PermKeyId = b.PermKeyId
	WHERE a.ColOvrdId = @ColOvrdId
IF NOT EXISTS (SELECT 1 FROM dbo.ColOvrd WHERE ScreenObjId = @ScreenObjId AND ColVisible = 'Y' AND ColReadOnly = 'N')
	AND EXISTS (SELECT 1 FROM dbo.ScreenObj WHERE ScreenObjId = @ScreenObjId AND RequiredValid = 'Y')
BEGIN
	RAISERROR('{13}',18,2) WITH SETERROR
	RETURN 1
END
IF @PermKeyId is null OR @PermKeyRowId is null
	SELECT @Priority = isnull(@Priority,100)
ELSE
	SELECT @Priority = isnull(@Priority,10)
UPDATE dbo.ColOvrd SET ScreenId = d.ScreenId, Priority = @Priority
	, ColOvrdDesc = d.ColumnDesc + right(space(6) + convert(varchar,@Priority), 6) + ' [' + @PermKeyDesc + isnull(convert(varchar,@PermId),'') + ']'
	, PermId = ISNULL(p.PermId, a.PermId), PermKeyId = ISNULL(p.PermKeyId, a.PermKeyId)
	FROM dbo.ColOvrd a INNER JOIN dbo.ScreenObj d ON a.ScreenObjId = d.ScreenObjId
	LEFT OUTER JOIN RODesign.dbo.VwPermKeyRow p on p.PermKeyRowId = a.PermKeyRowId
	WHERE a.ColOvrdId = @ColOvrdId
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkClientRule') AND type='P')
DROP PROCEDURE dbo.Cr_ChkClientRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkClientRule]
 @ClientRuleId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @ScreenObjHlpId	int
		,@ScreenCriHlpId	int
		,@ReportCriHlpId	int
		,@ScreenId			int
		,@ReportId			int
		,@RuleMethodId		tinyint
		,@ErrMsg			nvarchar(1000)
		,@RuleCntTypeId		tinyint
		,@ClientScript		smallint
		,@UserScriptEvent	varchar(50)
		,@UserScriptName	nvarchar(1000)
SET NOCOUNT ON
SELECT @ScreenObjHlpId = ScreenObjHlpId, @ScreenCriHlpId = ScreenCriHlpId, @ReportCriHlpId = ReportCriHlpId
	, @RuleCntTypeId = RuleCntTypeId
	, @ScreenId = ScreenId, @ReportId = ReportId
	, @RuleMethodId = RuleMethodId
	, @ClientScript = ClientScript
	FROM dbo.ClientRule WHERE ClientRuleId = @ClientRuleId
SELECT @ErrMsg = 
CASE WHEN (@RuleMethodId = 1 AND (@ScreenId IS NULL OR @RuleCntTypeId IS NULL))
	 THEN 'Please select the Screen and content type for this Embedded CSS/JS and try again'
	 WHEN (@RuleMethodId = 2 AND (@ScreenId IS NULL OR @ScreenObjHlpId IS NULL OR @ClientScript IS NULL))
	 THEN 'Please select the Screen, object, and stock script for this method and try again'
	 WHEN (@RuleMethodId = 3 AND (@ScreenId IS NULL OR @ScreenObjHlpId IS NULL OR @UserScriptEvent IS NULL OR @UserScriptName IS NULL))
	 THEN 'Please select the Screen, object, override event and script for this method and try again'
	 WHEN (@RuleMethodId = 4 AND (@ScreenId IS NULL OR @ScreenCriHlpId IS NULL OR @ClientScript IS NULL))
	 THEN 'Please select the Screen, criteria, and stock script for this method and try again'
	 WHEN (@RuleMethodId = 5 AND (@ScreenId IS NULL OR @ScreenCriHlpId IS NULL OR @UserScriptEvent IS NULL OR @UserScriptName IS NULL))
	 THEN 'Please select the Screen, criteria, override event and script for this method and try again'
	 WHEN (@RuleMethodId = 6 AND (@ReportId IS NULL OR @ReportCriHlpId IS NULL OR @ClientScript IS NULL))
	 THEN 'Please select the Report, criteria, and stock script for this method and try again'
	 WHEN (@RuleMethodId = 7 AND (@ReportId IS NULL OR @ReportCriHlpId IS NULL OR @UserScriptEvent IS NULL OR @UserScriptName IS NULL))
	 THEN 'Please select the Report, criteria, override event and script for this method and try again'
ELSE NULL END
IF 	@ErrMsg IS NOT NULL
BEGIN
	RAISERROR(@ErrMsg,18,2) WITH SETERROR
	RETURN 1
END
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkCulture01') AND type='P')
DROP PROCEDURE dbo.Cr_ChkCulture01
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[Cr_ChkCulture01]
 @ScreenId	Int
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId		smallint
SET NOCOUNT ON
/* The following will not be triggered because a default row is being entered in Ir_initScreenObj:
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF NOT EXISTS (SELECT 1 FROM dbo.ScreenHlp WHERE ScreenId = @ScreenId AND CultureId = @DefCultureId)
BEGIN RAISERROR('{65}',18,2) WITH SETERROR RETURN 1 END
*/
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkCulture02') AND type='P')
DROP PROCEDURE dbo.Cr_ChkCulture02
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkCulture02]
 @ScreenObjId	Int
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId		smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF NOT EXISTS (SELECT 1 FROM dbo.ScreenObjHlp WHERE ScreenObjId = @ScreenObjId AND CultureId = @DefCultureId)
BEGIN RAISERROR('{65}',18,2) WITH SETERROR RETURN 1 END
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkCulture03') AND type='P')
DROP PROCEDURE dbo.Cr_ChkCulture03
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkCulture03]
 @ScreenTabId	Int
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId		smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF NOT EXISTS (SELECT 1 FROM dbo.ScreenTabHlp WHERE ScreenTabId = @ScreenTabId AND CultureId = @DefCultureId)
BEGIN RAISERROR('{65}',18,2) WITH SETERROR RETURN 1 END
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkCulture04') AND type='P')
DROP PROCEDURE dbo.Cr_ChkCulture04
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkCulture04]
 @ScreenFilterId	Int
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId		smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF NOT EXISTS (SELECT 1 FROM dbo.ScreenFilterHlp WHERE ScreenFilterId = @ScreenFilterId AND CultureId = @DefCultureId)
BEGIN RAISERROR('{65}',18,2) WITH SETERROR RETURN 1 END
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkCulture05') AND type='P')
DROP PROCEDURE dbo.Cr_ChkCulture05
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkCulture05]
 @ReportId	Int
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId		smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF NOT EXISTS (SELECT 1 FROM dbo.ReportHlp WHERE ReportId = @ReportId AND CultureId = @DefCultureId)
BEGIN RAISERROR('{65}',18,2) WITH SETERROR RETURN 1 END
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkCulture06') AND type='P')
DROP PROCEDURE dbo.Cr_ChkCulture06
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkCulture06]
 @ReportCriId	Int
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId		smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF NOT EXISTS (SELECT 1 FROM dbo.ReportCriHlp WHERE ReportCriId = @ReportCriId AND CultureId = @DefCultureId)
BEGIN RAISERROR('{65}',18,2) WITH SETERROR RETURN 1 END
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkCulture07') AND type='P')
DROP PROCEDURE dbo.Cr_ChkCulture07
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkCulture07]
 @ReportObjId	Int
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId		smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF NOT EXISTS (SELECT 1 FROM dbo.ReportObjHlp WHERE ReportObjId = @ReportObjId AND CultureId = @DefCultureId)
BEGIN RAISERROR('{65}',18,2) WITH SETERROR RETURN 1 END
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkCulture08') AND type='P')
DROP PROCEDURE dbo.Cr_ChkCulture08
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkCulture08]
 @ScreenCriId	Int
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId		smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF NOT EXISTS (SELECT 1 FROM dbo.ScreenCriHlp WHERE ScreenCriId = @ScreenCriId AND CultureId = @DefCultureId)
BEGIN RAISERROR('{65}',18,2) WITH SETERROR RETURN 1 END
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkCulture09') AND type='P')
DROP PROCEDURE dbo.Cr_ChkCulture09
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkCulture09]
 @MsgId	Int
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId		smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF NOT EXISTS (SELECT 1 FROM dbo.MsgCenter WHERE MsgId = @MsgId AND CultureId = @DefCultureId)
BEGIN RAISERROR('{65}',18,2) WITH SETERROR RETURN 1 END
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkCustomDtl') AND type='P')
DROP PROCEDURE dbo.Cr_ChkCustomDtl
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkCustomDtl]
 @CustomDtlId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @RelativePath	varchar(100)
SET NOCOUNT ON
SELECT @RelativePath = RelativePath FROM dbo.CustomDtl WHERE CustomDtlId = @CustomDtlId
IF @RelativePath is not null AND right(@RelativePath,1) <> '\'
BEGIN
	RAISERROR('Please either empty the Relative Path for current path or make sure it ends with "\" and try again.',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkDbColumn') AND type='P')
DROP PROCEDURE dbo.Cr_ChkDbColumn
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkDbColumn]
 @TableId		int
,@ColumnName	varchar(50)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF charindex('exec',@ColumnName) > 0
BEGIN
	RAISERROR('{10}{%s}',18,2,@ColumnName) WITH SETERROR
	RETURN 1
END
IF (select count(1) FROM dbo.DbColumn WHERE TableId = @TableId AND ColumnName = @ColumnName) > 1
BEGIN
	RAISERROR('Column name "%s" cannot be repeated within a table, please rectify and try again.',18,2,@ColumnName) WITH SETERROR
	RETURN 1
END
RETURN 0 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkDupTblByName') AND type='P')
DROP PROCEDURE dbo.Cr_ChkDupTblByName
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkDupTblByName]
 @TableId		int
,@TableName		varchar(500)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF EXISTS (SELECT 'true' FROM dbo.DbTable WHERE (@TableId is null OR TableId <> @TableId) AND TableName = @tableName)
BEGIN
	RAISERROR('Table with the same name "%s" already exist, please choose another name.',18,2,@tableName) WITH SETERROR
	RETURN 1
END
RETURN 0 
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkEveryone') AND type='P')
DROP PROCEDURE dbo.Cr_ChkEveryone
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkEveryone]
 @MenuId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkGlobalCriteria') AND type='P')
DROP PROCEDURE dbo.Cr_ChkGlobalCriteria
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkGlobalCriteria]
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF (SELECT count('true') FROM dbo.Report WHERE ReportTypeCd = 'G') > 1
BEGIN
	RAISERROR('Each system may only have one Global Criteria, please verify and try again.',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0
 
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkMenuLoop') AND type='P')
DROP PROCEDURE dbo.Cr_ChkMenuLoop
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkMenuLoop]
 @MenuId	int
/* WITH ENCRYPTION */
AS
DECLARE	 @ParentId	int
	,@ii		int
	,@Infinite	char(1)
SET NOCOUNT ON
SELECT @ParentId = ParentId FROM dbo.Menu WHERE MenuId = @MenuId
IF @ParentId is not null
BEGIN
	SELECT @ii = 0, @Infinite = 'Y'
	WHILE @ii < 32 AND @Infinite = 'Y'
	BEGIN
		SELECT @ParentId = ParentId FROM dbo.Menu WHERE MenuId = @ParentId
		IF @ParentId is null  SELECT @Infinite = 'N'
		SELECT @ii = @ii + 1
	END
	IF @Infinite = 'Y'
	BEGIN
		RAISERROR('Please make sure the parent for "%s" does not lead to itself and try again.',18,2) WITH SETERROR
		RETURN 1
	END
END
RETURN 0 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkPrimaryKey') AND type='P')
DROP PROCEDURE dbo.Cr_ChkPrimaryKey
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkPrimaryKey]
 @TableId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF (SELECT count(1) FROM dbo.DbColumn WHERE TableId = @TableId AND PrimaryKey = 'Y') <> 1
BEGIN
	RAISERROR('{12}',18,2) WITH SETERROR
	RETURN 1
END
IF (SELECT count(1) FROM dbo.DbColumn WHERE TableId = @TableId AND ColumnIdentity = 'Y') > 1
BEGIN
	RAISERROR('Please make sure there is at most one identity column and try again.',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0 
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkReportColHeader') AND type='P')
DROP PROCEDURE dbo.Cr_ChkReportColHeader
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkReportColHeader]
 @ReportCriId	Int
/* WITH ENCRYPTION */
AS
DECLARE	 @DataTypeSqlName	varchar(30)
		,@DataTypeSize		smallint
		,@DispTypeName		varchar(50)
		,@RequiredValid		char(1)
		,@ReportTypeCd		char(1)
		,@DisplayDesc		varchar(50)
		,@DdlKeyColumnName	varchar(100)
		,@DdlRefColumnName	varchar(100)
SET NOCOUNT ON
IF NOT EXISTS (SELECT 1 FROM dbo.ReportCriHlp a INNER JOIN RODesign.dbo.VwCulture b ON a.CultureId = b.CultureId AND b.CultureDefault = 'Y'
	WHERE a.ReportCriId = @ReportCriId)
BEGIN
	RAISERROR('Criteria column must have a default Column Heading, please rectify and try again.',18,2) WITH SETERROR
	RETURN 1
END
SELECT	 @DataTypeSqlName = b.DataTypeSqlName
	,@DataTypeSize = a.DataTypeSize
	,@DispTypeName = c.TypeName
	,@DisplayDesc = c.TypeDesc
	,@RequiredValid = a.RequiredValid
	,@ReportTypeCd = d.ReportTypeCd
	,@DdlKeyColumnName = a.DdlKeyColumnName, @DdlRefColumnName = a.DdlRefColumnName
	FROM dbo.ReportCri a
	INNER JOIN RODesign.dbo.CtDataType b ON a.DataTypeId = b.DataTypeId
	INNER JOIN RODesign.dbo.CtDisplayType c ON a.DisplayModeId = c.TypeId
	INNER JOIN dbo.Report d ON a.ReportId = d.ReportId
	WHERE a.ReportCriId = @ReportCriId
IF @DataTypeSize is null AND charindex('char',lower(@DataTypeSqlName)) > 0
BEGIN
	RAISERROR('Please specify data type size for character data type and try again.',18,2) WITH SETERROR
	RETURN 1
END
IF @RequiredValid = 'N' AND lower(@DisplayDesc) in ('checkbox','calendar','progressbar','starrating')
BEGIN
	RAISERROR('Please check "Require Validation" for this kind of display and try again.',18,2) WITH SETERROR
	RETURN 1
END
IF CHARINDEX(','+lower(@DispTypeName)+',',',listbox,combobox,dropdownlist,radiobuttonlist,') > 0 AND (@DdlKeyColumnName IS NULL OR @DdlRefColumnName IS NULL)
BEGIN
	RAISERROR('Please provide both the key and ref columns for this criteria.',18,2) WITH SETERROR
	RETURN 1
END
/*
IF (lower(@DisplayDesc) in ('datagridlink','document','placeholder','htmleditor'))
BEGIN
	RAISERROR('This display type is currently unavailable for report criteria, please contact administrator if you have any question.',18,2) WITH SETERROR
	RETURN 1
END
IF (lower(@DisplayDesc) = 'autocomplete' AND @ReportTypeCd = 'C')
BEGIN
	RAISERROR('Autocomplete is currently unavailable for crystal report criteria, please contact administrator if you have any question.',18,2) WITH SETERROR
	RETURN 1
END
*/
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkReportGrp') AND type='P')
DROP PROCEDURE dbo.Cr_ChkReportGrp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[Cr_ChkReportGrp]
 @ReportId	Int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF (SELECT count(distinct a.ReportGrpId)
	FROM dbo.ReportCri a
	INNER JOIN dbo.ReportGrp b ON a.ReportId = @ReportId AND a.ReportGrpId = b.ReportGrpId AND b.ParentGrpId is null) > 1
BEGIN
	RAISERROR('Criteria column may not have more than one default Reporting Group, please correct and try again.',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0





 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkReportGrpLoop') AND type='P')
DROP PROCEDURE dbo.Cr_ChkReportGrpLoop
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkReportGrpLoop]
 @ReportGrpId	int
/* WITH ENCRYPTION */
AS
DECLARE	 @ParentGrpId	int
	,@ii		int
	,@Infinite	char(1)
	,@ReportGrpName	nvarchar(50)
SET NOCOUNT ON
SELECT @ParentGrpId = ParentGrpId FROM dbo.ReportGrp WHERE ReportGrpId = @ReportGrpId
IF @ParentGrpId is not null
BEGIN
	SELECT @ii = 0, @Infinite = 'Y'
	WHILE @ii < 32 AND @Infinite = 'Y'
	BEGIN
		SELECT @ParentGrpId = ParentGrpId FROM dbo.ReportGrp WHERE ReportGrpId = @ParentGrpId
		IF @ParentGrpId is null  SELECT @Infinite = 'N'
		SELECT @ii = @ii + 1
	END
	IF @Infinite = 'Y'
	BEGIN
		SELECT @ReportGrpName = ReportGrpName FROM dbo.ReportGrp WHERE ReportGrpId = @ReportGrpId
		RAISERROR('Please make sure the parent for "%s" does not lead to itself and try again.',18,2,@ReportGrpName) WITH SETERROR
		RETURN 1
	END
END
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkReportMargins') AND type='P')
DROP PROCEDURE dbo.Cr_ChkReportMargins
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[Cr_ChkReportMargins]
 @ReportId	int
/* WITH ENCRYPTION */
AS
DECLARE	 @TopMargin		decimal(8,2)
		,@BottomMargin	decimal(8,2)
		,@LeftMargin	decimal(8,2)
		,@RightMargin	decimal(8,2)
		,@PageWidth		decimal(8,2)
		,@PageHeight	decimal(8,2)
		,@ReportTypeCd	char(1)
		,@AllowSelect	char(1)
SET NOCOUNT ON
SELECT	 @TopMargin = TopMargin
		,@BottomMargin = BottomMargin
		,@LeftMargin = LeftMargin
		,@RightMargin = RightMargin
		,@PageWidth = PageWidth
		,@PageHeight = PageHeight
		,@ReportTypeCd = ReportTypeCd
		,@AllowSelect = AllowSelect
		FROM dbo.Report WHERE ReportId = @ReportId
IF @TopMargin < 0 OR @BottomMargin < 0 OR @LeftMargin < 0 OR @RightMargin < 0
	BEGIN RAISERROR('{14}Please enter positive numbers for margins.',18,2) WITH SETERROR RETURN 1 END
IF @PageWidth < 0 OR @PageHeight < 0
	BEGIN RAISERROR('{15}',18,2) WITH SETERROR RETURN 1 END
IF @PageWidth < (@LeftMargin + @RightMargin)
	BEGIN RAISERROR('{16}',18,2) WITH SETERROR RETURN 1 END
IF @PageHeight < (@TopMargin + @BottomMargin)
	BEGIN RAISERROR('{17}',18,2) WITH SETERROR RETURN 1 END
IF @AllowSelect = 'Y' AND @ReportTypeCd not in ('R','T')
	BEGIN RAISERROR('{43}',18,2) WITH SETERROR RETURN 1 END
RETURN 0 
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkReportParentGrp') AND type='P')
DROP PROCEDURE dbo.Cr_ChkReportParentGrp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkReportParentGrp]
 @ReportId	Int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF (SELECT count('true') FROM dbo.ReportGrp WHERE ReportId = @ReportId) > 0 AND NOT EXISTS 
(SELECT 'true' FROM dbo.ReportGrp a INNER JOIN dbo.ReportGrp b ON a.ReportId = @ReportId AND a.ParentGrpId = b.ReportGrpId AND b.ParentGrpId is null)
BEGIN
	RAISERROR('Parent Group must have one and only one default group, please assign one of four default groups (*) and try again.',18,2) WITH SETERROR
	RETURN 1
END
IF (SELECT count(distinct b.ReportGrpId) FROM dbo.ReportGrp a INNER JOIN dbo.ReportGrp b ON a.ReportId = @ReportId AND a.ParentGrpId = b.ReportGrpId AND b.ParentGrpId is null) > 1
BEGIN
	RAISERROR('Parent Group must have one and only one default group, please only assign one of four default groups (*) and try again.',18,2) WITH SETERROR
	RETURN 1
END
SELECT b.ReportGrpId FROM dbo.ReportGrp a INNER JOIN dbo.ReportGrp b ON a.ReportId = @ReportId AND a.ParentGrpId = b.ReportGrpId AND b.ParentGrpId is null
UNION	-- Remove duplicates
SELECT a.ReportGrpId FROM dbo.ReportGrp a INNER JOIN dbo.ReportCri c ON c.ReportId = @ReportId AND a.ReportGrpId = c.ReportGrpId AND a.ParentGrpId is null
IF @@ROWCOUNT > 1
BEGIN
	RAISERROR('Report Groups must have one and only one default group, please only assign one of four default groups (*) to both Report Groups and Report Columns and try again.',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkRmRptStyle') AND type='P')
DROP PROCEDURE dbo.Cr_ChkRmRptStyle
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





-- Only in ??Design
CREATE PROCEDURE [dbo].[Cr_ChkRmRptStyle]
 @RptStyleId	int
,@DefaultCd		char(2)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF EXISTS (SELECT 'true' FROM dbo.RptElm WHERE RptStyleId = @RptStyleId)
BEGIN
	RAISERROR('{18}',18,2) WITH SETERROR
	RETURN 1
END
IF EXISTS (SELECT 'true' FROM dbo.RptCtr WHERE RptStyleId = @RptStyleId)
BEGIN
	RAISERROR('{19}',18,2) WITH SETERROR
	RETURN 1
END
IF @DefaultCd is not null
BEGIN
	RAISERROR('Default code is needed for easy reporting wizard, please do not delete.  Thank you.',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkRowOvrd') AND type='P')
DROP PROCEDURE dbo.Cr_ChkRowOvrd
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkRowOvrd]
 @RowOvrdId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF EXISTS (SELECT 1 FROM dbo.RowOvrd WHERE RowOvrdId = @RowOvrdId AND ScreenId is null AND ReportId is null)
BEGIN
	RAISERROR('{42}',18,2) WITH SETERROR
	RETURN 1
END
UPDATE dbo.RowOvrd SET RowOvrdDesc = case
		when c.ScreenDesc is not null then 'Screen: ' + c.ScreenDesc + ' - ' + b.RowAuthName
		when d.ReportDesc is not null then 'Report: ' + d.ReportDesc + ' - ' + b.RowAuthName
		else b.RowAuthName end
	FROM dbo.RowOvrd a
	INNER JOIN RODesign.dbo.VwRowAuth b ON a.RowAuthId = b.RowAuthId
	LEFT OUTER JOIN dbo.Screen c ON a.ScreenId = c.ScreenId
	LEFT OUTER JOIN dbo.Report d ON a.ReportId = d.ReportId
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkRptCtr') AND type='P')
DROP PROCEDURE dbo.Cr_ChkRptCtr
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkRptCtr]
 @RptCtrId	int
/* WITH ENCRYPTION */
AS
DECLARE	 @ReportId		int
		,@CtrLeft		decimal(8,2)
		,@CtrWidth		decimal(8,2)
		,@LeftMargin	decimal(8,2)
		,@RightMargin	decimal(8,2)
		,@PageWidth		decimal(8,2)
		,@TestWidth		decimal(8,2)
		,@TestDesc		varchar(50)
SET NOCOUNT ON
SELECT @ReportId = ReportId, @CtrLeft = CtrLeft, @CtrWidth = CtrWidth FROM dbo.RptCtr WHERE RptCtrId = @RptCtrId
SELECT @LeftMargin = LeftMargin, @RightMargin = RightMargin, @PageWidth = PageWidth
	FROM dbo.Report WHERE ReportId = @ReportId
SELECT @TestWidth = @PageWidth - @LeftMargin -  @RightMargin - isnull(@CtrLeft,0)
IF isnull(@CtrWidth,0) > @TestWidth
BEGIN
	SELECT @TestDesc = convert(varchar,@TestWidth)
	RAISERROR('{27}{%s}',18,2,@TestDesc) WITH SETERROR
	RETURN 1
END
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkRptElm') AND type='P')
DROP PROCEDURE dbo.Cr_ChkRptElm
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkRptElm]
 @RptElmId	int
/* WITH ENCRYPTION */
AS
DECLARE	 @ReportId		int
		,@HeadHeight	decimal(8,2)
		,@BodyHeight	decimal(8,2)
		,@FootHeight	decimal(8,2)
		,@TestHeight	decimal(8,2)
		,@TestDesc		varchar(50)
		,@ReportDesc	nvarchar(50)
		,@TopMargin		decimal(8,2)
		,@BottomMargin	decimal(8,2)
		,@PageHeight	decimal(8,2)
SET NOCOUNT ON
SELECT @ReportId = ReportId FROM dbo.RptElm WHERE RptElmId = @RptElmId
SELECT @ReportDesc = ReportDesc, @TopMargin = TopMargin, @BottomMargin = BottomMargin, @PageHeight = PageHeight
	FROM dbo.Report WHERE ReportId = @ReportId
IF (SELECT count(1) FROM dbo.RptElm WHERE ReportId = @ReportId AND RptElmTypeCd = 'B') <> 1
	BEGIN RAISERROR('{22}{%s}',18,2,@ReportDesc) WITH SETERROR RETURN 1 END
IF (SELECT count(1) FROM dbo.RptElm WHERE ReportId = @ReportId AND RptElmTypeCd = 'H') > 1
	BEGIN RAISERROR('{23}{%s}',18,2,@ReportDesc) WITH SETERROR RETURN 1 END
IF (SELECT count(1) FROM dbo.RptElm WHERE ReportId = @ReportId AND RptElmTypeCd = 'F') > 1
	BEGIN RAISERROR('{24}{%s}',18,2,@ReportDesc) WITH SETERROR RETURN 1 END
SELECT @HeadHeight = ElmHeight FROM dbo.RptElm WHERE ReportId = @ReportId AND RptElmTypeCd = 'H'
SELECT @BodyHeight = ElmHeight FROM dbo.RptElm WHERE ReportId = @ReportId AND RptElmTypeCd = 'B'
SELECT @FootHeight = ElmHeight FROM dbo.RptElm WHERE ReportId = @ReportId AND RptElmTypeCd = 'F'
SELECT @TestHeight = @PageHeight - @TopMargin - @BottomMargin - isnull(@HeadHeight,0) - isnull(@FootHeight,0)
IF @BodyHeight <> @TestHeight
BEGIN
	SELECT @TestDesc = convert(varchar,@TestHeight)
	RAISERROR('{25}{%s}{%s}',18,2,@TestDesc,@ReportDesc) WITH SETERROR
	RETURN 1
END
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkRptStyle') AND type='P')
DROP PROCEDURE dbo.Cr_ChkRptStyle
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkRptStyle]
 @RptStyleId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @DefaultCd		char(2)
SELECT @DefaultCd = DefaultCd FROM dbo.RptStyle WHERE RptStyleId = @RptStyleId
IF (SELECT COUNT(1) FROM dbo.RptStyle WHERE DefaultCd = @DefaultCd) > 1
BEGIN
	RAISERROR('Default code "%s" already exists, please empty Default code and try again.',18,2,@DefaultCd) WITH SETERROR
	RETURN 1
END
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkRptwizCri') AND type='P')
DROP PROCEDURE dbo.Cr_ChkRptwizCri
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkRptwizCri]
 @RptwizId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @RptwizName		nvarchar(50)
		,@TemplateName		varchar(50)
		,@RptwizTypeCd		char(1)
SET NOCOUNT ON
IF NOT EXISTS (SELECT 1 FROM dbo.RptwizDtl WHERE RptwizId = @RptwizId AND CriSelect is not null)
BEGIN
	RAISERROR('{28}',18,2) WITH SETERROR	/* Make sure at least one column is selected as criteria. */
	RETURN 1
END
IF NOT EXISTS (SELECT 1 FROM dbo.RptwizDtl WHERE RptwizId = @RptwizId AND ColSelect is not null)
BEGIN
	RAISERROR('{31}',18,2) WITH SETERROR	/* Make sure at least one column is selected as display. */
	RETURN 1
END
SELECT @RptwizName = RptwizName, @RptwizTypeCd = RptwizTypeCd, @TemplateName = TemplateName FROM dbo.Rptwiz WHERE RptwizId = @RptwizId
IF EXISTS (SELECT 1 FROM dbo.Rptwiz WHERE RptwizName = @RptwizName AND RptwizId <> @RptwizId)
BEGIN
	RAISERROR('{35}',18,2) WITH SETERROR	/* Report wizard name should be unique. */
	RETURN 1
END
IF @RptwizTypeCd = 'D' AND charindex('.mht',@TemplateName) <= 0 AND charindex('.rtf',@TemplateName) <= 0 AND charindex('.txt',@TemplateName) <= 0
BEGIN
	RAISERROR('{38}',18,2) WITH SETERROR	/* Default template name should not be empty. */
	RETURN 1
END
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkScreenColHeader') AND type='P')
DROP PROCEDURE dbo.Cr_ChkScreenColHeader
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkScreenColHeader]
 @ScreenCriId	Int
/* WITH ENCRYPTION */
AS
DECLARE	 @DispTypeName		varchar(50)
		,@RequiredValid		char(1)
		,@MasterTableId		int
		,@TableId			int
		,@DisplayDesc		varchar(50)
		,@DdlKeyColumnId	int
		,@DdlRefColumnId	int
		,@OperatorName	varchar(10)
SET NOCOUNT ON
SELECT @DispTypeName = c.TypeName, @OperatorName = d.OperatorName
	FROM dbo.ScreenCri a
	INNER JOIN RODesign.dbo.CtDisplayType c ON a.DisplayModeId = c.TypeId
	INNER JOIN RODesign.dbo.CtOperator d ON a.OperatorId = d.OperatorId
	WHERE a.ScreenCriId = @ScreenCriId
IF lower(@DispTypeName) = 'listbox' AND lower(@OperatorName) <> 'in' AND LOWER(@OperatorName) not in ('have some','have none','only in','have all','same as')
BEGIN
	RAISERROR('Please select operator "in" for ListBox criteria columns and try again.',18,2) WITH SETERROR
	RETURN 1
END
IF NOT EXISTS (SELECT 1 FROM dbo.ScreenCriHlp a INNER JOIN RODesign.dbo.VwCulture b ON a.CultureId = b.CultureId AND b.CultureDefault = 'Y'
	WHERE a.ScreenCriId = @ScreenCriId)
BEGIN
	RAISERROR('Criteria column must have a default Column Heading, please rectify and try again.',18,2) WITH SETERROR
	RETURN 1
END
SELECT	 @DispTypeName = c.TypeName
		,@DisplayDesc = c.TypeDesc
		,@RequiredValid = a.RequiredValid
		,@MasterTableId = e.MasterTableId
		,@TableId = d.TableId
		,@DdlKeyColumnId = a.DdlKeyColumnId, @DdlRefColumnId = a.DdlRefColumnId
	FROM dbo.ScreenCri a
	INNER JOIN RODesign.dbo.CtDisplayType c ON a.DisplayModeId = c.TypeId
	INNER JOIN dbo.DbColumn d ON a.ColumnId = d.ColumnId
	INNER JOIN dbo.Screen e ON a.ScreenId = e.ScreenId
	WHERE a.ScreenCriId = @ScreenCriId
IF @RequiredValid = 'N' AND lower(@DisplayDesc) in ('checkbox','calendar','progressbar','starrating')
BEGIN
	RAISERROR('Please check "Require Validation" for this kind of display and try again.',18,2) WITH SETERROR
	RETURN 1
END
IF @MasterTableId <> @TableId
BEGIN
	RAISERROR('Please make sure criteria column selected belongs to the master table of the selected screen and try again.',18,2) WITH SETERROR
	RETURN 1
END
IF CHARINDEX(','+lower(@DispTypeName)+',',',listbox,combobox,dropdownlist,radiobuttonlist,') > 0 AND (@DdlKeyColumnId IS NULL OR @DdlRefColumnId IS NULL)
BEGIN
	RAISERROR('Please provide the key and ref column for this kind of display and try again.',18,2) WITH SETERROR
	RETURN 1
END
/*
IF lower(@DispTypeName) = 'placeholder' OR lower(@DispTypeName) = 'editor'
BEGIN
	RAISERROR('Please make sure PlaceHolder/ Editor is not selected as a criteria column and try again.',18,2) WITH SETERROR
	RETURN 1
END
IF (lower(@DisplayDesc) in ('datagridlink','document','placeholder','htmleditor'))
BEGIN
	RAISERROR('This display type is currently unavailable for screen criteria, please contact administrator if you have any question.',18,2) WITH SETERROR
	RETURN 1
END
*/
RETURN 0
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkScreenObj') AND type='P')
DROP PROCEDURE dbo.Cr_ChkScreenObj
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[Cr_ChkScreenObj]
 @ScreenObjId	Int
/* WITH ENCRYPTION */
AS
DECLARE
	 @MasterTableId		int
	,@DetailTableId		int
	,@MasterTable		char(1)
	,@DisplayName		varchar(50)
	,@DisplayDesc		varchar(50)
	,@RefreshOnCUD		char(1)
	,@RequiredValid		char(1)
	,@ColumnId			int
	,@TabIndex			smallint
	,@ScreenId			int
	,@ScreenTypeName	char(2)
	,@DdlRefTableId		int
	,@DdlSrtTableId		int
	,@DdlAdnTableId		int
	,@DdlFtrTableId		int
	,@DdlKeyColumnId	int
	,@DdlRefColumnId	int
	,@DdlSrtColumnId	int
	,@DdlAdnColumnId	int
	,@DdlFtrColumnId	int
	,@ColumnName		varchar(50)
	,@DataTypeName		varchar(20)
	,@DefaultValue		nvarchar(200)
	,@HyperLinkUrl		nvarchar(200)
	,@SystemValue		nvarchar(200)
	,@PrevTabIndex		smallint
	,@ColumnSize		smallint
	,@ColumnHeight		smallint
	,@ColumnLink		varchar(100)
	,@MaskValid			varchar(50)
	,@RangeValidType	varchar(50)
	,@RangeValidMax		varchar(50)
	,@RangeValidMin		varchar(50)
	,@AggregateCd		char(1)
SET NOCOUNT ON
/* Do not check columns group to be of the same root as this will be done during screen generation */
SELECT	 @MasterTableId = b.MasterTableId, @DetailTableId = b.DetailTableId, @MasterTable = a.MasterTable
	,@TabIndex = a.TabIndex, @ScreenId = a.ScreenId, @ScreenTypeName = c.ScreenTypeName
	,@DdlRefTableId = x1.TableId, @DdlSrtTableId = x2.TableId, @DdlAdnTableId = x3.TableId, @DdlFtrTableId = x4.TableId
	,@DdlKeyColumnId = a.DdlKeyColumnId, @DdlRefColumnId = a.DdlRefColumnId, @DdlSrtColumnId = a.DdlSrtColumnId, @DdlAdnColumnId = a.DdlAdnColumnId, @DdlFtrColumnId = a.DdlFtrColumnId
	,@DisplayName = d.TypeName, @DisplayDesc = d.TypeDesc, @ColumnLink = a.ColumnLink
	,@RefreshOnCUD = a.RefreshOnCUD, @RequiredValid = a.RequiredValid, @ColumnId = a.ColumnId, @ColumnSize = ColumnSize, @ColumnHeight = a.ColumnHeight
	,@MaskValid = a.MaskValid, @RangeValidType = a.RangeValidType, @RangeValidMax = a.RangeValidMax, @RangeValidMin = a.RangeValidMin, @ColumnName = a.ColumnName
	,@DefaultValue = a.DefaultValue, @HyperLinkUrl = a.HyperLinkUrl, @SystemValue = a.SystemValue
	,@AggregateCd = a.AggregateCd, @DataTypeName = dd.DataTypeName
	FROM dbo.ScreenObj a
	INNER JOIN dbo.Screen b ON a.ScreenId = b.ScreenId
	INNER JOIN RODesign.dbo.CtScreenType c ON b.ScreenTypeId = c.ScreenTypeId
	INNER JOIN RODesign.dbo.CtDisplayType d ON a.DisplayModeId = d.TypeId
	LEFT OUTER JOIN dbo.DbColumn x1 ON a.DdlRefColumnId = x1.ColumnId
	LEFT OUTER JOIN dbo.DbColumn x2 ON a.DdlSrtColumnId = x2.ColumnId
	LEFT OUTER JOIN dbo.DbColumn x3 ON a.DdlAdnColumnId = x3.ColumnId
	LEFT OUTER JOIN dbo.DbColumn x4 ON a.DdlFtrColumnId = x4.ColumnId
	LEFT OUTER JOIN RODesign.dbo.DbColumn cc ON a.ColumnId = cc.ColumnId
	LEFT OUTER JOIN RODesign.dbo.CtDataType dd ON cc.DataType = dd.DataTypeId
	WHERE a.ScreenObjId = @ScreenObjId
IF @DisplayDesc IN ('ComboBox','ComboBoxNoPunc')
BEGIN
	RAISERROR('This display type is obsolete, please choose "AutoComplete" instead and try again.',18,2) WITH SETERROR
	RETURN 1
END
IF LEFT(LTRIM(@DefaultValue),1) = '''' OR RIGHT(RTRIM(@DefaultValue),1) = ''''
BEGIN
	RAISERROR('Please do not start or end with a single quote in default value and try again.',18,2) WITH SETERROR
	RETURN 1
END
IF LTRIM(RTRIM(ISNULL(@AggregateCd,''))) NOT IN ('','N','C')
	AND @DisplayDesc = 'Currency'
	AND @DdlKeyColumnId IS NOT NULL
	AND (@ScreenTypeName = 'I3' OR (@ScreenTypeName='I2' AND @MasterTable <> 'Y'))
BEGIN
	RAISERROR('Please do not aggregate on currency column that refers to column in the row record. use money instead if you want functions like SUM',18,2) WITH SETERROR
	RETURN 1
END
IF CHARINDEX('datetime',lower(@DisplayDesc)) >= 1 AND @DataTypeName = 'Date'
BEGIN
	RAISERROR('Please make sure the underlying data model %s is "DateTime" and try again.',18,2,@ColumnName) WITH SETERROR
	RETURN 1
END
IF @DisplayName = 'HyperLink'
BEGIN
	IF @DdlRefColumnId is not null
	BEGIN
		RAISERROR('Please leave the "Reference Column" empty and try again.',18,2) WITH SETERROR
		RETURN 1
	END
	/* Display */
	IF (@DefaultValue is null AND @ColumnId is null)
	BEGIN
		RAISERROR('Please either select the "Database Column" to use the default icon/label, or enter the "Default Value" as icon/label and try again.',18,2) WITH SETERROR
		RETURN 1
	END
	/* URL */
	IF (@HyperLinkUrl is null AND @DdlKeyColumnId is null) OR (@HyperLinkUrl is not null AND @DdlKeyColumnId is not null)
	BEGIN
		RAISERROR('Please either select the "Key Column" for dynamic URL or enter the "Static Link URL" and try again.',18,2) WITH SETERROR
		RETURN 1
	END
END
IF (@ColumnName = 'ModifiedOn' OR @ColumnName = 'InputOn') AND @SystemValue is null
BEGIN
	RAISERROR('Please enter getutcdate() in System Value and try again.',18,2) WITH SETERROR
	RETURN 1
END
IF (@ColumnName = 'ModifiedBy' OR @ColumnName = 'InputBy') AND @DefaultValue is null
BEGIN
	RAISERROR('Please enter base.LUser.UsrId.ToString() in Default Value and try again.',18,2) WITH SETERROR
	RETURN 1
END
/*
IF @RequiredValid = 'N' AND @DisplayName = 'DataGrid'
BEGIN
	RAISERROR('Please make sure this DataGrid column is checked as mandatory and try again.',18,2) WITH SETERROR
	RETURN 1
END
*/
IF @RequiredValid = 'Y' AND @DisplayName = 'CheckBox'
BEGIN
	RAISERROR('Please make sure this CheckBox column is unchekced as not mandatory and try again.',18,2) WITH SETERROR
	RETURN 1
END
IF @RequiredValid = 'Y' AND EXISTS (SELECT 1 FROM dbo.ColOvrd WHERE ScreenObjId = @ScreenObjId AND (ColVisible = 'N' OR ColReadOnly = 'Y'))
BEGIN
	RAISERROR('Please make sure the column is visible and editable before setting it to manadatory.',18,2) WITH SETERROR
	RETURN 1
END
IF @DisplayDesc IN ('AutoComplete','ComboBox','ComboBoxNoPunc','DropDownList','AutoListBox','ListBox','RadioButtonList','DataGridLink','Document','Currency','WorkflowStatus')
BEGIN
	IF @ColumnId is null AND (@MasterTable <> 'Y' OR @DisplayDesc NOT IN ('AutoComplete','ComboBox','ComboBoxNoPunc','DropDownList','AutoListBox','ListBox','RadioButtonList'))
	BEGIN
		RAISERROR('Please make sure column is available in the database and try again. For Document and DataGridLink, please add a dummy column for now.',18,2) WITH SETERROR
		RETURN 1
	END
	IF @DisplayDesc <> 'Currency' AND (@DdlKeyColumnId is null OR @DdlRefColumnId is null)
	BEGIN
		RAISERROR('Please make sure the Dropdown Key and Reference columns are not empty and try again.',18,2) WITH SETERROR
		RETURN 1
	END
END
ELSE IF @DdlRefColumnId is not null AND (@ColumnId is null OR @DdlKeyColumnId is null OR @ColumnId <> @DdlKeyColumnId)
BEGIN
	RAISERROR('When the Dropdown Reference column is used to pull up this column, please make sure the column is from an external table and is the same as the Dropdown Key Column and try again.',18,2) WITH SETERROR
	RETURN 1
END
IF @ScreenTypeName <> 'I2'	-- I1 or I3.
BEGIN
	IF @MasterTable = 'N'
	BEGIN
		RAISERROR('Please make sure column is checked as master column and try again.',18,2) WITH SETERROR
		RETURN 1
	END
END
IF @DdlSrtColumnId is not null
BEGIN
	IF @DdlRefTableId is null
	BEGIN
		RAISERROR('Please do not select a sort column or select an appropriate display reference column from the same table for the dropdown/combobox.',18,2) WITH SETERROR
		RETURN 1
	END
	ELSE IF @DdlRefTableId <> @DdlSrtTableId
	BEGIN
		RAISERROR('Please select a sort column from the same table of the display reference column and try again.',18,2) WITH SETERROR
		RETURN 1
	END
END
IF @DdlAdnColumnId is not null
BEGIN
	IF @DdlRefTableId is null
	BEGIN
		RAISERROR('Please do not select an additional column or select an appropriate display reference column from the same table for the dropdown/combobox.',18,2) WITH SETERROR
		RETURN 1
	END
	ELSE IF @DdlRefTableId <> @DdlAdnTableId
	BEGIN
		RAISERROR('Please select additional column from the same table of the display reference column and try again.',18,2) WITH SETERROR
		RETURN 1
	END
END
IF @DdlFtrColumnId is not null
BEGIN
	IF @DdlFtrTableId <> @MasterTableId AND (@DetailTableId is null OR @DdlFtrTableId <> @DetailTableId)
	BEGIN
		RAISERROR('Please select filter column only from the the master or detail table and try again.',18,2) WITH SETERROR
		RETURN 1
	END
	IF @DdlAdnColumnId is null
	BEGIN
		RAISERROR('Please select an additional column from the same table of the display reference column and try again.',18,2) WITH SETERROR
		RETURN 1
	END
END
If @DisplayDesc = 'TextBox' AND @ColumnLink is not null AND charindex('UpLoad.aspx',@ColumnLink) > 0 AND charindex('pth=',@ColumnLink) <= 0
BEGIN
	RAISERROR('Please provide web path in the format "UpLoad.aspx?pth=data/adm/version/" and try again.',18,2) WITH SETERROR
	RETURN 1
END
If @DisplayDesc = 'Document'
BEGIN
	IF @ColumnLink is not null
	BEGIN
		RAISERROR('Please leave the Search Link empty for document display and try again.',18,2) WITH SETERROR
		RETURN 1
	END
	IF @ColumnSize is null
	BEGIN
		RAISERROR('Please enter the width for document display and try again.',18,2) WITH SETERROR
		RETURN 1
	END
END
IF (((@ScreenTypeName = 'I2' AND @MasterTable = 'N') OR (@ScreenTypeName = 'I3' AND @MasterTable = 'Y'))
	AND lower(@DisplayDesc) in ('autolistbox','listbox','calendar','datagridlink','document','placeholder','htmleditor'))
BEGIN
	RAISERROR('This display type is currently unavailable for data grid, please contact administrator if you have any question.',18,2) WITH SETERROR
	RETURN 1
END
If (@RangeValidMax is not null or @RangeValidMin is not null) AND @RangeValidType is null
BEGIN
	RAISERROR('Please specify a Range Type for this %s column which has maximum or minimum and try again.',18,2,@DisplayName) WITH SETERROR
	RETURN 1
END
IF @DisplayDesc = 'StarRating' AND @RequiredValid = 'Y' AND @MaskValid is null
BEGIN
	RAISERROR('Please specify a mask e.g. "[1-5]" for this mandatory Star Rating and try again.',18,2,@DisplayName) WITH SETERROR
	RETURN 1
END
/*
ELSE IF @DisplayName in ('TextBox','Editor','Calendar','DropDownList','ComboBox','ListBox','RadioButtonList')
BEGIN
	IF @RequiredValid = 'Y' AND EXISTS (SELECT 'true' FROM dbo.ScreenObjHlp WHERE ScreenObjId = @ScreenObjId AND (ErrMessage is null or ltrim(ErrMessage) = space(0)))
	BEGIN
		RAISERROR('Please specify an error message for this mandatory %s column and try again.',18,2,@DisplayName) WITH SETERROR
		RETURN 1
	END
END
ELSE
BEGIN
	IF EXISTS (SELECT 'true' FROM dbo.ScreenObjHlp WHERE ScreenObjId = @ScreenObjId AND ErrMessage is not null and ltrim(ErrMessage) <> space(0))
	BEGIN
		RAISERROR('Please do not specify any error message for this %s column and try again.',18,2,@DisplayName) WITH SETERROR
		RETURN 1
	END
END
IF (@MaskValid is not null or @RangeValidType is not null) AND EXISTS (SELECT 'true' FROM dbo.ScreenObjHlp WHERE ScreenObjId = @ScreenObjId AND (ErrMessage is null or ltrim(ErrMessage) = space(0)))
BEGIN
	RAISERROR('Please specify an error message for this %s column which has a mask and try again.',18,2,@DisplayName) WITH SETERROR
	RETURN 1
END
*/
IF @RefreshOnCUD = 'Y' AND @DisplayName not in ('DropDownList','ComboBox','ListBox','RadioButtonList')
BEGIN
	RAISERROR('Please uncheck "Refresh on CUD" for this non-dropdown, non-combobox column and try again.',18,2) WITH SETERROR
	RETURN 1
END
IF @ColumnHeight is null AND @DisplayDesc in ('MultiLine','DataGridLink')
BEGIN
	RAISERROR('Please provide the height in px for this Multiline column or in rows for this DataGridLink column and try again.',18,2) WITH SETERROR
	RETURN 1
END
IF @DisplayName = 'PlaceHolder' AND (@ScreenTypeName = 'I3' OR @MasterTable = 'N')
BEGIN
	RAISERROR('Please make sure PlaceHolder is only asisgned to tab folder and try again.',18,2) WITH SETERROR
	RETURN 1
END
IF @DisplayDesc = 'DateUTC'
BEGIN
	RAISERROR('Please select Date instead and try again; UTC is about time, not about date.',18,2) WITH SETERROR
	RETURN 1
END
IF @DisplayName = 'Signature'
BEGIN
	IF @ColumnSize is not null OR @ColumnHeight is not null
	BEGIN
		RAISERROR('Please leave the "width" and "height" empty for signature control and try again.',18,2) WITH SETERROR
		RETURN 1
	END
	IF @ScreenTypeName = 'I3' OR (@ScreenTypeName='I2' AND @MasterTable <> 'Y')
	BEGIN
		RAISERROR('Please do not use Signature control in a grid and try again.',18,2) WITH SETERROR
		RETURN 1
	END
END
IF EXISTS (SELECT 1 FROM ScreenObj o
	INNER JOIN ScreenObj o2 on o.ScreenId = o2.ScreenId AND o.ColumnName = o2.ColumnName AND o.MasterTable = o2.MasterTable AND o.ScreenObjId <> o2.ScreenObjId
	WHERE o.ScreenObjId = @ScreenObjId)
BEGIN
	RAISERROR('Please make sure column Name %s is unique and try again.',18,2,@ColumnName) WITH SETERROR
	RETURN 1
END
RETURN 0



 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkTables') AND type='P')
DROP PROCEDURE dbo.Cr_ChkTables
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[Cr_ChkTables]
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'AgentId' AND t.name = 'Agent')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'ParentId' AND t.name = 'Agent')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'AgentName' AND t.name = 'Agent')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'Active' AND t.name = 'Agent')
BEGIN
	RAISERROR('Please make sure Agent table in Cmon database has columns "AgentId", "ParentId", "AgentName" and "Active" then try again.',18,2) WITH SETERROR
	RETURN 1
END
IF NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'BrokerId' AND t.name = 'Broker')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'ParentId' AND t.name = 'Broker')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'BrokerName' AND t.name = 'Broker')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'Active' AND t.name = 'Broker')
BEGIN
	RAISERROR('Please make sure Broker table in Cmon database has columns "BrokerId", "ParentId", "BrokerName" and "Active" then try again.',18,2) WITH SETERROR
	RETURN 1
END
IF NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'CustomerId' AND t.name = 'Customer')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'ParentId' AND t.name = 'Customer')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'CustomerName' AND t.name = 'Customer')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'Active' AND t.name = 'Customer')
BEGIN
	RAISERROR('Please make sure Customer table in Cmon database has columns "CustomerId", "ParentId", "CustomerName" and "Active" then try again.',18,2) WITH SETERROR
	RETURN 1
END
IF NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'InvestorId' AND t.name = 'Investor')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'ParentId' AND t.name = 'Investor')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'InvestorName' AND t.name = 'Investor')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'Active' AND t.name = 'Investor')
BEGIN
	RAISERROR('Please make sure Investor table in Cmon database has columns "InvestorId", "ParentId", "InvestorName" and "Active" then try again.',18,2) WITH SETERROR
	RETURN 1
END
IF NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'MemberId' AND t.name = 'Member')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'ParentId' AND t.name = 'Member')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'MemberName' AND t.name = 'Member')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'Active' AND t.name = 'Member')
BEGIN
	RAISERROR('Please make sure Member table in Cmon database has columns "MemberId", "ParentId", "MemberName" and "Active" then try again.',18,2) WITH SETERROR
	RETURN 1
END
IF NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'VendorId' AND t.name = 'Vendor')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'ParentId' AND t.name = 'Vendor')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'VendorName' AND t.name = 'Vendor')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'Active' AND t.name = 'Vendor')
BEGIN
	RAISERROR('Please make sure Vendor table in Cmon database has columns "VendorId", "ParentId", "VendorName" and "Active" then try again.',18,2) WITH SETERROR
	RETURN 1
END
IF NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'BorrowerId' AND t.name = 'Borrower')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'ParentId' AND t.name = 'Borrower')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'BorrowerName' AND t.name = 'Borrower')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'Active' AND t.name = 'Borrower')
BEGIN
	RAISERROR('Please make sure Vendor table in Cmon database has columns "BorrowerId", "ParentId", "BorrowerName" and "Active" then try again.',18,2) WITH SETERROR
	RETURN 1
END
IF NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'GuarantorId' AND t.name = 'Guarantor')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'ParentId' AND t.name = 'Guarantor')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'GuarantorName' AND t.name = 'Guarantor')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'Active' AND t.name = 'Guarantor')
BEGIN
	RAISERROR('Please make sure Vendor table in Cmon database has columns "GuarantorId", "ParentId", "GuarantorName" and "Active" then try again.',18,2) WITH SETERROR
	RETURN 1
END
IF NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'LenderId' AND t.name = 'Lender')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'ParentId' AND t.name = 'Lender')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'LenderName' AND t.name = 'Lender')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'Active' AND t.name = 'Lender')
BEGIN
	RAISERROR('Please make sure Vendor table in Cmon database has columns "LenderId", "ParentId", "LenderName" and "Active" then try again.',18,2) WITH SETERROR
	RETURN 1
END




IF NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'CompanyId' AND t.name = 'Company')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'ParentId' AND t.name = 'Company')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'CompanyDesc' AND t.name = 'Company')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'Active' AND t.name = 'Company')
BEGIN
	RAISERROR('Please make sure Company table in Cmon database has columns "CompanyId", "ParentId", "CompanyDesc" and "Active" then try again.',18,2) WITH SETERROR
	RETURN 1
END
IF NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'ProjectId' AND t.name = 'Project')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'ParentId' AND t.name = 'Project')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'ProjectDesc' AND t.name = 'Project')
OR NOT EXISTS (SELECT 1 FROM ROCmon.sys.columns c JOIN ROCmon.sys.tables t ON c.object_id = t.object_id WHERE c.name = 'Active' AND t.name = 'Project')
BEGIN
	RAISERROR('Please make sure Project table in Cmon database has columns "ProjectId", "ParentId", "ProjectDesc" and "Active" then try again.',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ChkWebRule') AND type='P')
DROP PROCEDURE dbo.Cr_ChkWebRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ChkWebRule]
 @WebRuleId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @ScreenObjId		int
		,@ButtonTypeId		tinyint
		,@EventCode			char(6)
SET NOCOUNT ON
SELECT @ScreenObjId = a.ScreenObjId, @ButtonTypeId = a.ButtonTypeId, @EventCode = b.EventCode
	FROM dbo.WebRule a INNER JOIN RODesign.dbo.CtEvent b ON a.EventId = b.EventId WHERE a.WebRuleId = @WebRuleId
IF @EventCode in ('DEFVAL','DELROG','DEFVAG','ITMDTB','ENPGLD','ENLSSE','ITMDTA','DELROR','ITMDTR','FUNPRO','FRPGIN','ENPGIN','CRICHG')
	AND NOT (@ScreenObjId is null AND @ButtonTypeId is null)
BEGIN
	RAISERROR('{2}',18,2) WITH SETERROR
	RETURN 1
END
IF @EventCode in ('BUTCLK','BUTCLA','BUTCLR') AND NOT (@ScreenObjId is null AND @ButtonTypeId is not null)
BEGIN
	RAISERROR('{3}',18,2) WITH SETERROR
	RETURN 1
END
IF @EventCode = 'SELCHG' AND NOT (@ScreenObjId is not null AND @ButtonTypeId is null)
BEGIN
	RAISERROR('{4}',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_DelDbColumn') AND type='P')
DROP PROCEDURE dbo.Cr_DelDbColumn
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[Cr_DelDbColumn]
 @ColumnId	Int
,@CultureId smallint
/* WITH ENCRYPTION */
AS
DECLARE  @ScreenId		Int
		,@ScreenTitle	nvarchar(50)
		,@ColumnDesc	varchar(200)
		,@DefCultureId	smallint
SET NOCOUNT ON
SELECT @ScreenId = ScreenId, @ColumnDesc = ColumnDesc FROM dbo.ScreenObj WHERE ColumnId = @ColumnId
	OR DdlKeyColumnId = @ColumnId OR DdlRefColumnId = @ColumnId OR DdlSrtColumnId = @ColumnId 
	OR DdlAdnColumnId = @ColumnId OR DdlFtrColumnId = @ColumnId
IF @ScreenId is not null
BEGIN
	SELECT @ScreenTitle = ScreenTitle FROM dbo.ScreenHlp WHERE ScreenId = @ScreenId AND CultureId = @CultureId
	IF @ScreenTitle is null
	BEGIN
		SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
		SELECT @ScreenTitle = ScreenTitle FROM dbo.ScreenHlp WHERE ScreenId = @ScreenId AND CultureId = @DefCultureId
	END
	RAISERROR('{11}{%s}{%s}',18,2,@ColumnDesc,@ScreenTitle) WITH SETERROR
	RETURN 1
END
ELSE IF EXISTS (SELECT 1 FROM dbo.Screen WHERE SearchId = @ColumnId)
BEGIN
	SELECT @ColumnDesc = ColumnDesc FROM dbo.DbColumn WHERE ColumnId = @ColumnId
	SELECT @ScreenId = ScreenId FROM dbo.Screen WHERE SearchId = @ColumnId
	SELECT @ScreenTitle = ScreenTitle FROM dbo.ScreenHlp WHERE ScreenId = @ScreenId AND CultureId = @CultureId
	IF @ScreenTitle is null
	BEGIN
		SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
		SELECT @ScreenTitle = ScreenTitle FROM dbo.ScreenHlp WHERE ScreenId = @ScreenId AND CultureId = @DefCultureId
	END
	RAISERROR('{72}{%s}{%s}',18,2,@ColumnDesc,@ScreenTitle) WITH SETERROR
	RETURN 1
END
ELSE IF EXISTS (SELECT 1 FROM dbo.ScreenCri WHERE ColumnId = @ColumnId)
BEGIN
	SELECT @ColumnDesc = ScreenCriDesc, @ScreenId = ScreenId FROM dbo.ScreenCri WHERE ColumnId = @ColumnId
	SELECT @ScreenTitle = ScreenTitle FROM dbo.ScreenHlp WHERE ScreenId = @ScreenId AND CultureId = @CultureId
	IF @ScreenTitle is null
	BEGIN
		SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
		SELECT @ScreenTitle = ScreenTitle FROM dbo.ScreenHlp WHERE ScreenId = @ScreenId AND CultureId = @DefCultureId
	END
	RAISERROR('{73}{%s}{%s}',18,2,@ColumnDesc,@ScreenTitle) WITH SETERROR
	RETURN 1
END
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_DelRptElm') AND type='P')
DROP PROCEDURE dbo.Cr_DelRptElm
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_DelRptElm]
 @RptElmId	int
/* WITH ENCRYPTION */
AS
DECLARE	 @RptElmDesc	nvarchar(200)
SET NOCOUNT ON
IF EXISTS (SELECT 1 FROM dbo.RptCtr WHERE RptElmId = @RptElmId)
BEGIN
	SELECT @RptElmDesc = RptElmDesc FROM dbo.RptElm WHERE RptElmId = @RptElmId
	RAISERROR('{26}{%s}',18,2,@RptElmDesc) WITH SETERROR
	RETURN 1
END
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_DelScreenTab') AND type='P')
DROP PROCEDURE dbo.Cr_DelScreenTab
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_DelScreenTab]
 @ScreenTabId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF EXISTS (SELECT 1 FROM dbo.ScreenObj WHERE TabFolderId = @ScreenTabId)
BEGIN
	RAISERROR('Please remove all screen object reference to this tab folder and try again.',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0
 
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_NoDelCatRef') AND type='P')
DROP PROCEDURE dbo.Cr_NoDelCatRef
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_NoDelCatRef]
 @RptwizCatId	smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF EXISTS (SELECT 'true' FROM dbo.Rptwiz WHERE RptwizCatId = @RptwizCatId)
BEGIN
	RAISERROR('{29}',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_NoReportDelWhenRef') AND type='P')
DROP PROCEDURE dbo.Cr_NoReportDelWhenRef
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_NoReportDelWhenRef]
 @ReportGrpId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	@ReportGrpName	nvarchar(50)
IF EXISTS (SELECT 'true' FROM dbo.ReportCri WHERE ReportGrpId = @ReportGrpId)
BEGIN
	SELECT @ReportGrpName = ReportGrpName FROM dbo.ReportGrp WHERE ReportGrpId = @ReportGrpId
	RAISERROR('Cannot delete Criteria Group: %s. Please delete all criteria referenced and try again.',18,2,@ReportGrpName) WITH SETERROR
	RETURN 1
END
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_OneObjectTypeOnly') AND type='P')
DROP PROCEDURE dbo.Cr_OneObjectTypeOnly
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_OneObjectTypeOnly]
 @ButtonHlpId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @ScreenId	int
	,@ReportId	int
	,@WizardId	int
	,@cnt	int
SET NOCOUNT ON
SELECT @cnt = 0
SELECT @ScreenId = ScreenId, @ReportId = ReportId, @WizardId = WizardId FROM dbo.ButtonHlp WHERE ButtonHlpId = @ButtonHlpId
IF @ScreenId is not null SELECT @cnt = @cnt + 1
IF @ReportId is not null SELECT @cnt = @cnt + 1
IF @WizardId is not null SELECT @cnt = @cnt + 1
IF @cnt <> 1
BEGIN
	RAISERROR('Please select one and only one of Screen, Report or Wizard and try again.',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_OneTemplateDefaultOnly') AND type='P')
DROP PROCEDURE dbo.Cr_OneTemplateDefaultOnly
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO










CREATE PROCEDURE [dbo].[Cr_OneTemplateDefaultOnly]
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF (SELECT count('true') FROM dbo.Template WHERE TmplDefault = 'Y') <> 1
BEGIN
	RAISERROR('Please choose one and only one template default and try again.',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0




 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_RmRptCriCRule') AND type='P')
DROP PROCEDURE dbo.Cr_RmRptCriCRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_RmRptCriCRule]
 @ReportCriHlpId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF EXISTS (SELECT 'true' FROM dbo.ClientRule WHERE ReportCriHlpId = @ReportCriHlpId)
BEGIN
	RAISERROR('{9}',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_RmScrCriCRule') AND type='P')
DROP PROCEDURE dbo.Cr_RmScrCriCRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[Cr_RmScrCriCRule]
 @ScreenCriHlpId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF EXISTS (SELECT 'true' FROM dbo.ClientRule WHERE ScreenCriHlpId = @ScreenCriHlpId)
BEGIN
	RAISERROR('{8}',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_RmScrObjCRule') AND type='P')
DROP PROCEDURE dbo.Cr_RmScrObjCRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[Cr_RmScrObjCRule]
 @ScreenObjId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF EXISTS (SELECT 1 FROM dbo.ClientRule a
	INNER JOIN dbo.ScreenObjHlp b ON a.ScreenObjHlpId = b.ScreenObjHlpId WHERE b.ScreenObjId = @ScreenObjId)
BEGIN
	RAISERROR('{6}',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_RmScrObjHlpCRule') AND type='P')
DROP PROCEDURE dbo.Cr_RmScrObjHlpCRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[Cr_RmScrObjHlpCRule]
 @ScreenObjHlpId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF EXISTS (SELECT 1 FROM dbo.ClientRule WHERE ScreenObjHlpId = @ScreenObjHlpId)
BEGIN
	RAISERROR('{6}',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_RmScrObjWRule') AND type='P')
DROP PROCEDURE dbo.Cr_RmScrObjWRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_RmScrObjWRule]
 @ScreenObjId	int
/* WITH ENCRYPTION */
AS
DECLARE @ColumnName varchar(100)
SET NOCOUNT ON
IF EXISTS (SELECT 'true' FROM dbo.WebRule WHERE ScreenObjId = @ScreenObjId)
BEGIN
	RAISERROR('{5}',18,2) WITH SETERROR
	RETURN 1
END

/* Check column dependency */
SELECT @ColumnName = o1.ColumnName FROM ScreenObj o 
	LEFT OUTER JOIN ScreenObj o1 on o.ScreenId = o1.ScreenId AND o1.ScreenObjId <> @ScreenObjId 
	AND 
	(o1.DdlKeyColumnId = o.ColumnId OR o1.DdlRefColumnId = o.ColumnId OR o1.DdlSrtColumnId = o.ColumnId OR o1.DdlFtrColumnId = o.ColumnId OR o1.DdlAdnColumnId = o.ColumnId)
	AND 
	((EXISTS (SELECT 1 FROM RODesign.dbo.CtDisplayType t WHERE t.TypeId = o1.DisplayModeId AND t.TypeName IN ('Hyperlink','Combobox','DropdownList','ListBox','RadioButtonList')))
	OR
	(ISNULL(o1.AggregateCd,'') NOT IN ('','N') AND (o1.MasterTable = 'N'
	 OR
	 (EXISTS (SELECT 1 FROM Screen s WHERE s.ScreenId = o1.ScreenId AND EXISTS (SELECT 1 FROM RODesign.dbo.CtScreenType WHERE ScreenTypeId = s.ScreenTypeId AND ScreenTypeName = 'I3')))
	)))
WHERE o.ScreenObjId = @ScreenObjId AND o.ColumnId IS NOT NULL
IF @ColumnName IS NOT NULL
BEGIN
	RAISERROR('Column %s is referring to this object, please remove this dependency and try again.',18,2,@ColumnName) WITH SETERROR
	RETURN 1
END

/* Check Primary key */
IF EXISTS (SELECT 1 FROM dbo.DbColumn a
	INNER JOIN dbo.ScreenObj b ON a.ColumnId = b.ColumnId
	INNER JOIN dbo.Screen c ON b.ScreenId = c.ScreenId
	WHERE b.ScreenObjId = @ScreenObjId AND a.PrimaryKey = 'Y' AND ((b.MasterTable = 'Y' AND c.MasterTableId = a.TableId) OR (b.MasterTable <> 'Y' AND c.DetailTableId = a.TableId)))
BEGIN
	RAISERROR('Please do not delete this primary key column, thank you.',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0
 
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Cr_ValidGrpAuth') AND type='P')
DROP PROCEDURE dbo.Cr_ValidGrpAuth
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Cr_ValidGrpAuth]
 @UsrGroupAuthId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF EXISTS (SELECT 1 FROM dbo.UsrGroupAuth WHERE UsrGroupAuthId = @UsrGroupAuthId
	AND CompanyId is null AND ProjectId is null AND SystemId is null)
BEGIN
	RAISERROR('At least one of Company, Project, or System should be selected to override the default, please try again.',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0 



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.DelAdmRptWiz95Dt') AND type='P')
DROP PROCEDURE dbo.DelAdmRptWiz95Dt
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[DelAdmRptWiz95Dt]
 @RptwizDtlId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF EXISTS (SELECT 1 FROM dbo.RptwizDtl WHERE RptwizDtlId = @RptwizDtlId)
	DELETE FROM dbo.RptwizDtl WHERE RptwizDtlId = @RptwizDtlId
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.DelLastCriteria') AND type='P')
DROP PROCEDURE dbo.DelLastCriteria
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[DelLastCriteria]
 @ScreenId		int
,@ReportId		int
,@UsrId			int
/* WITH ENCRYPTION */
AS
DECLARE  @sql		varchar(8000)
	,@dbDesDatabase	varchar(50)
SET NOCOUNT ON
IF @ScreenId is not null AND @ScreenId <> 0
BEGIN
	DELETE FROM dbo.ScreenLstCri WHERE ScreenId = @ScreenId AND ScreenCriId <> 0
		AND NOT EXISTS (SELECT 'true' FROM dbo.ScreenCri a WHERE a.ScreenCriId = dbo.ScreenLstCri.ScreenCriId)
	DELETE FROM dbo.ScreenLstCri WHERE ScreenId = @ScreenId AND ScreenCriId = 0
		AND NOT EXISTS (SELECT 'true' FROM dbo.ScreenLstCri b WHERE b.ScreenId = @ScreenId AND b.ScreenCriId <> 0)
END
ELSE
IF @ReportId is not null AND @ReportId <> 0
BEGIN
	DELETE FROM dbo.ReportLstCri WHERE ReportId = @ReportId
		AND NOT EXISTS (SELECT 'true' FROM dbo.ReportCri a WHERE a.ReportCriId = dbo.ReportLstCri.ReportCriId)
END
ELSE
BEGIN
	DECLARE sysCursor CURSOR FOR SELECT dbDesDatabase FROM RODesign.dbo.Systems FOR READ ONLY
	OPEN sysCursor
	FETCH NEXT FROM sysCursor INTO @dbDesDatabase
	WHILE @@FETCH_STATUS = 0
	BEGIN
		SELECT @sql = 'DELETE FROM ' + @dbDesDatabase + '.dbo.ScreenLstCri WHERE UsrId = ' + convert(varchar,@UsrId)
		+ ' DELETE FROM ' + @dbDesDatabase + '.dbo.ReportLstCri WHERE UsrId = ' + convert(varchar,@UsrId)
		EXEC (@sql)
		FETCH NEXT FROM sysCursor INTO @dbDesDatabase
	END
	CLOSE sysCursor
	DEALLOCATE sysCursor
END
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.DelMemCri') AND type='P')
DROP PROCEDURE dbo.DelMemCri
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[DelMemCri]
 @GenPrefix		varchar(10)
,@ReportId		int
,@MemCriId		int
,@DelHeader		char(1)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF @GenPrefix = 'Ut'
BEGIN
	IF @DelHeader = 'Y'
	BEGIN
		DELETE FROM dbo.UtRptMemCriDtl WHERE RptMemCriId = @MemCriId
		DELETE FROM dbo.UtRptMemCri WHERE RptMemCriId = @MemCriId
	END
	ELSE
	BEGIN
		DELETE FROM dbo.UtRptMemCriDtl WHERE RptMemCriId = @MemCriId
		AND NOT EXISTS (SELECT 1 FROM dbo.UtReportCri a WHERE a.ReportCriId = dbo.UtRptMemCriDtl.ReportCriId)
	END
END
ELSE
BEGIN
	IF @DelHeader = 'Y'
	BEGIN
		DELETE FROM dbo.RptMemCriDtl WHERE RptMemCriId = @MemCriId
		DELETE FROM dbo.RptMemCri WHERE RptMemCriId = @MemCriId
	END
	ELSE
	BEGIN
		DELETE FROM dbo.RptMemCriDtl WHERE RptMemCriId = @MemCriId
		AND NOT EXISTS (SELECT 1 FROM dbo.ReportCri a WHERE a.ReportCriId = dbo.RptMemCriDtl.ReportCriId)
	END
END
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.DelMemFld') AND type='P')
DROP PROCEDURE dbo.DelMemFld
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[DelMemFld]
 @GenPrefix		varchar(10)
,@MemFldId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF @GenPrefix = 'Ut'
BEGIN
	DELETE FROM dbo.UtRptMemCri WHERE RptMemFldId = @MemFldId
	DELETE FROM dbo.UtRptMemFld WHERE RptMemFldId = @MemFldId
END
ELSE
BEGIN
	DELETE FROM dbo.RptMemCri WHERE RptMemFldId = @MemFldId
	DELETE FROM dbo.RptMemFld WHERE RptMemFldId = @MemFldId
END
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.DelReportCriDel') AND type='P')
DROP PROCEDURE dbo.DelReportCriDel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[DelReportCriDel]
 @GenPrefix			varchar(10)
,@appDatabase		varchar(50)
,@reportId			int
,@procedureName		varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
SET NOCOUNT ON
/* Called by GenReportsRules.cs */
SELECT @sClause = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''GetIn' + convert(varchar,@reportId) + @procedureName + ''''') AND xtype = ''''P'''') DROP PROCEDURE GetIn' + convert(varchar,@reportId) + @procedureName
EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @sClause + '''')
/* Do not delete user manually created s.proc:
IF @GenPrefix = 'Ut'
BEGIN
	IF NOT EXISTS (SELECT 1 FROM dbo.UtReportCri WHERE ReportId <> @reportId AND charindex(@procedureName,RegClause) > 0)
	BEGIN
		SELECT @sClause = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''_GetIn' + @procedureName + ''''') AND xtype = ''''P'''') DROP PROCEDURE _GetIn' + @procedureName
		EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @sClause + '''')
	END
END
ELSE
BEGIN
	IF NOT EXISTS (SELECT 1 FROM dbo.ReportCri WHERE ReportId <> @reportId AND charindex(@procedureName,RegClause) > 0)
	BEGIN
		SELECT @sClause = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''_GetIn' + @procedureName + ''''') AND xtype = ''''P'''') DROP PROCEDURE _GetIn' + @procedureName
		EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @sClause + '''')
	END
END
*/
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.DelReportDel') AND type='P')
DROP PROCEDURE dbo.DelReportDel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[DelReportDel]
 @GenPrefix			varchar(10)
,@srcDatabase		varchar(50)
,@appDatabase		varchar(50)
,@programName		varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'DELETE'
SELECT @fClause = 'FROM dbo.' + @GenPrefix + 'ReportDel'
SELECT @wClause = 'WHERE ProgramName = ''' + @programName + ''''
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
SELECT @sClause = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''Get' + @programName + ''''') AND xtype = ''''P'''') DROP PROCEDURE Get' + @programName
EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @sClause + '''')
SELECT @sClause = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''Mem' + @programName + ''''') AND xtype = ''''P'''') DROP PROCEDURE Mem' + @programName
EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @sClause + '''')
SELECT @sClause = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''Upd' + @programName + ''''') AND xtype = ''''P'''') DROP PROCEDURE Upd' + @programName
EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @sClause + '''')
/*	Do not delete custom s.proc.:
SELECT @sClause = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''_Get' + @programName + 'R'''') AND xtype = ''''P'''') DROP PROCEDURE _Get' + @programName + 'R'
EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @sClause + '''')
SELECT @sClause = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''_Get' + @programName + 'V'''') AND xtype = ''''P'''') DROP PROCEDURE _Get' + @programName + 'V'
EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @sClause + '''')
SELECT @sClause = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''_Get' + @programName + 'U'''') AND xtype = ''''P'''') DROP PROCEDURE _Get' + @programName + 'U'
EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @sClause + '''')
SELECT @sClause = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''_Get' + @programName + 'X'''') AND xtype = ''''P'''') DROP PROCEDURE _Get' + @programName + 'X'
EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @sClause + '''')
*/
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.DelRptCriteria') AND type='P')
DROP PROCEDURE dbo.DelRptCriteria
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[DelRptCriteria]
 @GenPrefix		varchar(10)
,@ReportId		int
,@UsrId			int
/* WITH ENCRYPTION */
AS
DECLARE  @sql			varchar(8000)
		,@dbDesDatabase	varchar(50)
SET NOCOUNT ON
IF @ReportId is not null AND @ReportId <> 0
BEGIN
	IF @GenPrefix = 'Ut'
		DELETE FROM dbo.UtReportLstCri WHERE ReportId = @ReportId
			AND NOT EXISTS (SELECT 1 FROM dbo.UtReportCri a WHERE a.ReportCriId = dbo.UtReportLstCri.ReportCriId)
	ELSE
		DELETE FROM dbo.ReportLstCri WHERE ReportId = @ReportId
			AND NOT EXISTS (SELECT 1 FROM dbo.ReportCri a WHERE a.ReportCriId = dbo.ReportLstCri.ReportCriId)
END
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.DelScreenCriDel') AND type='P')
DROP PROCEDURE dbo.DelScreenCriDel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[DelScreenCriDel]
 @appDatabase		varchar(50)
,@procedureName		varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''GetDdl' + @procedureName + ''''') AND xtype = ''''P'''') DROP PROCEDURE GetDdl' + @procedureName
EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @sClause + '''')
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.DelScreenDel') AND type='P')
DROP PROCEDURE dbo.DelScreenDel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[DelScreenDel]
 @srcDatabase		varchar(50)
,@appDatabase		varchar(50)
,@desDatabase		varchar(50)
,@programName		varchar(50)
,@screenId		int
,@multiDesignDb		char(1)
,@sysProgram		char(1)
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@dropProcedure4Sql	varchar(8000)
	,@dropProcedure5Sql	varchar(8000)
	,@dropProcedure6Sql	varchar(8000)
	,@dropProcedure0Sql	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'DELETE'
SELECT @fClause = 'FROM dbo.ScreenDel'
SELECT @wClause = 'WHERE ProgramName = ''' + @programName + ''''
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
SELECT @sClause = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''Upd' + @programName + convert(varchar,@screenId) + 'In'''') AND xtype = ''''P'''') DROP PROCEDURE Upd' + @programName + convert(varchar,@screenId) + 'In'
EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @sClause + '''')
SELECT @dropProcedure4Sql = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''GetLis' + @programName + convert(varchar,@screenId) + ''''') AND xtype = ''''P'''') DROP PROCEDURE GetLis' + @programName + convert(varchar,@screenId)
SELECT @dropProcedure5Sql = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''Get' + @programName + convert(varchar,@screenId) + 'ById'''') AND xtype = ''''P'''') DROP PROCEDURE Get' + @programName + convert(varchar,@screenId) + 'ById'
SELECT @dropProcedure6Sql = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''Get' + @programName + convert(varchar,@screenId) + 'DtlById'''') AND xtype = ''''P'''') DROP PROCEDURE Get' + @programName + convert(varchar,@screenId) + 'DtlById'
SELECT @dropProcedure0Sql = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''GetExp' + @programName + convert(varchar,@screenId) + ''''') AND xtype = ''''P'''') DROP PROCEDURE GetExp' + @programName + convert(varchar,@screenId)
IF @multiDesignDb = 'Y'
BEGIN
	DECLARE sysCursor CURSOR FOR SELECT dbDesDatabase FROM RODesign.dbo.Systems FOR READ ONLY
	OPEN sysCursor
	FETCH NEXT FROM sysCursor INTO @srcDatabase
	WHILE @@FETCH_STATUS = 0
	BEGIN
		EXEC (@srcDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure4Sql + '''')
		EXEC (@srcDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure5Sql + '''')
		EXEC (@srcDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure6Sql + '''')
		EXEC (@srcDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure0Sql + '''')
		FETCH NEXT FROM sysCursor INTO @srcDatabase
	END
	CLOSE sysCursor
	DEALLOCATE sysCursor
END
ELSE IF @sysProgram <> 'Y'
BEGIN
	-- USE Database is not allowed!  Needs to be replaced by Dynamic EXECUTION.
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure4Sql + '''')
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure5Sql + '''')
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure6Sql + '''')
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure0Sql + '''')
END
ELSE
BEGIN
	EXEC (@desDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure4Sql + '''')
	EXEC (@desDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure5Sql + '''')
	EXEC (@desDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure6Sql + '''')
	EXEC (@desDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure0Sql + '''')
END
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.DelWizardDel') AND type='P')
DROP PROCEDURE dbo.DelWizardDel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[DelWizardDel]
 @srcDatabase		varchar(50)
,@appDatabase		varchar(50)
,@programName		varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'DELETE'
SELECT @fClause = 'FROM dbo.WizardDel'
SELECT @wClause = 'WHERE ProgramName = ''' + @programName + ''''
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
SELECT @sClause = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''Wiz' + @programName + ''''') AND xtype = ''''P'''') DROP PROCEDURE Wiz' + @programName
EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @sClause + '''')
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmAppInfo82ById') AND type='P')
DROP PROCEDURE dbo.GetAdmAppInfo82ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmAppInfo82ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.AppInfo b135'
SELECT @sClause = 'SELECT AppInfoId135=b135.AppInfoId'
+ ', VersionMa135=b135.VersionMa'
+ ', VersionMi135=b135.VersionMi'
+ ', VersionDt135=b135.VersionDt'
+ ', CultureTypeName135=b135.CultureTypeName'
+ ', VersionValue135=b135.VersionValue'
+ ', AppZipId135=b135.AppZipId'
+ ', Prerequisite135=b135.Prerequisite'
+ ', Readme135=b135.Readme'
SELECT @wClause = 'WHERE b135.AppInfoId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmAppItem83ById') AND type='P')
DROP PROCEDURE dbo.GetAdmAppItem83ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmAppItem83ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.AppItem b136'
SELECT @sClause = 'SELECT AppItemId136=b136.AppItemId'
+ ', AppInfoId136=b136.AppInfoId'
+ ', LanguageCd136=b136.LanguageCd'
+ ', ItemOrder136=b136.ItemOrder'
+ ', FrameworkCd136=b136.FrameworkCd'
+ ', ObjectTypeCd136=b136.ObjectTypeCd'
+ ', DbProviderCd136=b136.DbProviderCd'
+ ', RelativePath136=b136.RelativePath'
+ ', AppItemName136=b136.AppItemName'
+ ', MultiDesignDb136=b136.MultiDesignDb'
+ ', RemoveItem136=b136.RemoveItem'
+ ', AppItemCode136=b136.AppItemCode'
+ ', ScreenId136=b136.ScreenId'
+ ', ReportId136=b136.ReportId'
+ ', WizardId136=b136.WizardId'
+ ', CustomId136=b136.CustomId'
SELECT @wClause = 'WHERE b136.AppItemId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmAuthCol16ById') AND type='P')
DROP PROCEDURE dbo.GetAdmAuthCol16ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmAuthCol16ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.ScreenObj b14'
SELECT @sClause = 'SELECT ScreenObjId14=b14.ScreenObjId'
SELECT @wClause = 'WHERE b14.ScreenObjId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmAuthCol16DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmAuthCol16DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmAuthCol16DtlById
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause = 'FROM dbo.ColOvrd b241' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT PermKeyId,PermKeyDesc FROM RODesign.dbo.VwPermKey)x1971 ON b241.PermKeyId = x1971.PermKeyId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT PermKeyRowId,PermIdText,PermKeyId FROM RODesign.dbo.VwPermKeyRow)x7414 ON b241.PermKeyRowId = x7414.PermKeyRowId AND x1971.PermKeyId = x7414.PermKeyId'
SELECT @sClause = 'SELECT ColOvrdId241=b241.ColOvrdId'
+ ', ColVisible241=b241.ColVisible'
+ ', ColReadOnly241=b241.ColReadOnly'
+ ', ColExport241=b241.ColExport'
+ ', PermKeyId241=x1971.PermKeyId'
+ ', PermKeyId241Text=x1971.PermKeyDesc'
+ ', PermKeyRowId241=x7414.PermKeyRowId'
+ ', PermKeyRowId241Text=x7414.PermIdText'
+ ', Priority241=b241.Priority'
+ ', ToolTip241=b241.ToolTip'
+ ', ColumnHeader241=b241.ColumnHeader'
+ ', ErrMessage241=b241.ErrMessage'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b241.ScreenObjId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmClientRule79ById') AND type='P')
DROP PROCEDURE dbo.GetAdmClientRule79ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmClientRule79ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.ClientRule b127'
SELECT @sClause = 'SELECT ClientRuleId127=b127.ClientRuleId'
+ ', RuleMethodId127=b127.RuleMethodId'
+ ', RuleName127=b127.RuleName'
+ ', RuleDescription127=b127.RuleDescription'
+ ', RuleTypeId127=b127.RuleTypeId'
+ ', ScreenId127=b127.ScreenId'
+ ', ReportId127=b127.ReportId'
+ ', CultureId127=b127.CultureId'
+ ', ScreenObjHlpId127=b127.ScreenObjHlpId'
+ ', ScreenCriHlpId127=b127.ScreenCriHlpId'
+ ', ReportCriHlpId127=b127.ReportCriHlpId'
+ ', RuleCntTypeId127=b127.RuleCntTypeId'
+ ', ClientRuleProg127=b127.ClientRuleProg'
+ ', ClientScript127=b127.ClientScript'
+ ', UserScriptEvent127=b127.UserScriptEvent'
+ ', UserScriptName127=b127.UserScriptName'
+ ', ScriptParam127=b127.ScriptParam'
SELECT @wClause = 'WHERE b127.ClientRuleId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmColHlp1006ById') AND type='P')
DROP PROCEDURE dbo.GetAdmColHlp1006ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmColHlp1006ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.ScreenObj b14'
SELECT @sClause = 'SELECT ScreenObjId14=b14.ScreenObjId'
SELECT @wClause = 'WHERE b14.ScreenObjId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmColHlp1006DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmColHlp1006DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmColHlp1006DtlById
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause = 'FROM dbo.ScreenObjHlp b21' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture)x163 ON b21.CultureId = x163.CultureId'
SELECT @sClause = 'SELECT ScreenObjHlpId21=b21.ScreenObjHlpId'
+ ', CultureId21=x163.CultureId'
+ ', CultureId21Text=x163.CultureTypeDesc'
+ ', ColumnHeader21=b21.ColumnHeader'
+ ', ToolTip21=b21.ToolTip'
+ ', ErrMessage21=b21.ErrMessage'
+ ', TbHint21=b21.TbHint'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b21.ScreenObjId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b21.','Y','N',null,'N','ScreenObjHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b21.','Y','N',null,'N','ScreenObjHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmCronJob118ById') AND type='P')
DROP PROCEDURE dbo.GetAdmCronJob118ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmCronJob118ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.CronJob b264'
SELECT @sClause = 'SELECT CronJobId264=b264.CronJobId'
+ ', CronJobName264=b264.CronJobName'
+ ', LastRun264=b264.LastRun'
+ ', NextRun264=b264.NextRun'
+ ', JobLink264=b264.JobLink'
+ ', LastStatus264=b264.LastStatus'
+ ', Year264=b264.Year'
+ ', Month264=b264.Month'
+ ', Day264=b264.Day'
+ ', Hour264=b264.Hour'
+ ', Minute264=b264.Minute'
+ ', DayOfWeek264=b264.DayOfWeek'
SELECT @wClause = 'WHERE b264.CronJobId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmDataCat96ById') AND type='P')
DROP PROCEDURE dbo.GetAdmDataCat96ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmDataCat96ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.RptwizCat b181'
SELECT @sClause = 'SELECT RptwizCatId181=b181.RptwizCatId'
+ ', RptwizTypId181=b181.RptwizTypId'
+ ', RptwizCatName181=b181.RptwizCatName'
+ ', CatDescription181=b181.CatDescription'
+ ', TableId181=b181.TableId'
+ ', SampleImage181=b181.SampleImage'
SELECT @wClause = 'WHERE b181.RptwizCatId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmDataCat96DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmDataCat96DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmDataCat96DtlById
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause = 'FROM dbo.RptwizCatDtl b182' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnName FROM dbo.DbColumn)x1579 ON b182.ColumnId = x1579.ColumnId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT TypeId,TypeDesc FROM RODesign.dbo.CtDisplayType)x1865 ON b182.DisplayModeId = x1865.TypeId'
SELECT @sClause = 'SELECT RptwizCatDtlId182=b182.RptwizCatDtlId'
+ ', ColumnId182=x1579.ColumnId'
+ ', ColumnId182Text=x1579.ColumnName'
+ ', DisplayModeId182=x1865.TypeId'
+ ', DisplayModeId182Text=x1865.TypeDesc'
+ ', ColumnSize182=b182.ColumnSize'
+ ', RowSize182=b182.RowSize'
+ ', DdlKeyColNm182=b182.DdlKeyColNm'
+ ', DdlRefColNm182=b182.DdlRefColNm'
+ ', RegClause182=b182.RegClause'
+ ', StoredProc182=b182.StoredProc'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b182.RptwizCatId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmDbKey15ById') AND type='P')
DROP PROCEDURE dbo.GetAdmDbKey15ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmDbKey15ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.DbKey b20'
SELECT @sClause = 'SELECT KeyId20=b20.KeyId'
+ ', KeyName20=b20.KeyName'
+ ', TableId20=b20.TableId'
+ ', ColumnId20=b20.ColumnId'
+ ', RefTableId20=b20.RefTableId'
+ ', RefColumnId20=b20.RefColumnId'
SELECT @wClause = 'WHERE b20.KeyId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmDbTable2ById') AND type='P')
DROP PROCEDURE dbo.GetAdmDbTable2ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmDbTable2ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.DbTable b3'
SELECT @sClause = 'SELECT TableId3=b3.TableId'
+ ', SystemId3=b3.SystemId'
+ ', TableName3=b3.TableName'
+ ', TableDesc3=b3.TableDesc'
+ ', TblObjective3=b3.TblObjective'
+ ', VirtualTbl3=b3.VirtualTbl'
+ ', MultiDesignDb3=b3.MultiDesignDb'
+ ', ModifiedBy3=b3.ModifiedBy'
+ ', ModifiedOn3=b3.ModifiedOn'
+ ', LastSyncDt3=b3.LastSyncDt'
+ ', VirtualSql3=b3.VirtualSql'
SELECT @wClause = 'WHERE b3.TableId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmDbTable2DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmDbTable2DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmDbTable2DtlById
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause = 'FROM dbo.DbColumn b5' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT DataTypeId,DataTypeName FROM RODesign.dbo.CtDataType)x36 ON b5.DataType = x36.DataTypeId'
SELECT @sClause = 'SELECT ColumnId5=b5.ColumnId'
+ ', ColumnIndex5=b5.ColumnIndex'
+ ', ExternalTable5=b5.ExternalTable'
+ ', ColumnName5=b5.ColumnName'
+ ', DataType5=x36.DataTypeId'
+ ', DataType5Text=x36.DataTypeName'
+ ', ColumnLength5=b5.ColumnLength'
+ ', ColumnScale5=b5.ColumnScale'
+ ', DefaultValue5=b5.DefaultValue'
+ ', AllowNulls5=b5.AllowNulls'
+ ', ColumnIdentity5=b5.ColumnIdentity'
+ ', PrimaryKey5=b5.PrimaryKey'
+ ', IsIndexU5=b5.IsIndexU'
+ ', IsIndex5=b5.IsIndex'
+ ', ColObjective5=b5.ColObjective'
SELECT @oClause = 'ORDER BY b5.ColumnIndex'
SELECT @wClause = 'WHERE b5.TableId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmLabel112ById') AND type='P')
DROP PROCEDURE dbo.GetAdmLabel112ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmLabel112ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.Label b215'
SELECT @sClause = 'SELECT LabelId215=b215.LabelId'
+ ', CultureId215=b215.CultureId'
+ ', LabelCat215=b215.LabelCat'
+ ', LabelKey215=b215.LabelKey'
+ ', LabelText215=b215.LabelText'
+ ', CompanyId215=b215.CompanyId'
+ ', SortOrder215=b215.SortOrder'
SELECT @wClause = 'WHERE b215.LabelId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmMenu35ById') AND type='P')
DROP PROCEDURE dbo.GetAdmMenu35ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmMenu35ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.Menu b39'
SELECT @sClause = 'SELECT MenuId39=b39.MenuId'
+ ', Popup39=b39.Popup'
+ ', ParentId39=b39.ParentId'
+ ', MenuIndex39=b39.MenuIndex'
+ ', ScreenId39=b39.ScreenId'
+ ', ReportId39=b39.ReportId'
+ ', WizardId39=b39.WizardId'
+ ', StaticPgId39=b39.StaticPgId'
+ ', Miscellaneous39=b39.Miscellaneous'
+ ', IconUrl39=b39.IconUrl'
SELECT @wClause = 'WHERE b39.MenuId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmMenuDrg121ById') AND type='P')
DROP PROCEDURE dbo.GetAdmMenuDrg121ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmMenuDrg121ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.Menu b39'
SELECT @sClause = 'SELECT MenuId39=b39.MenuId'
+ ', ParentId39=b39.ParentId'
+ ', MenuIndex39=b39.MenuIndex'
SELECT @wClause = 'WHERE b39.MenuId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmMenuHlp36ById') AND type='P')
DROP PROCEDURE dbo.GetAdmMenuHlp36ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmMenuHlp36ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.Menu b39'
SELECT @sClause = 'SELECT MenuId39=b39.MenuId'
SELECT @wClause = 'WHERE b39.MenuId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmMenuHlp36DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmMenuHlp36DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmMenuHlp36DtlById
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause = 'FROM dbo.MenuHlp b40' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture)x1304 ON b40.CultureId = x1304.CultureId'
SELECT @sClause = 'SELECT MenuHlpId40=b40.MenuHlpId'
+ ', CultureId40=x1304.CultureId'
+ ', CultureId40Text=x1304.CultureTypeDesc'
+ ', MenuText40=b40.MenuText'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b40.MenuId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b40.','Y','N',null,'N','MenuHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b40.','Y','N',null,'N','MenuHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmMenuPerm58ById') AND type='P')
DROP PROCEDURE dbo.GetAdmMenuPerm58ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmMenuPerm58ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.Menu b39'
SELECT @sClause = 'SELECT MenuId39=b39.MenuId'
SELECT @wClause = 'WHERE b39.MenuId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmMenuPerm58DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmMenuPerm58DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmMenuPerm58DtlById
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause = 'FROM dbo.MenuPrm b231' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT EveryoneCd,EveryoneName FROM RODesign.dbo.CtEveryone)x1892 ON b231.GrantDeny = x1892.EveryoneCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT PermKeyId,PermKeyDesc FROM RODesign.dbo.VwPermKey)x1887 ON b231.PermKeyId = x1887.PermKeyId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT PermId,PermIdText,PermKeyId FROM RODesign.dbo.VwPermKeyRow)x1888 ON b231.PermId = x1888.PermId AND x1887.PermKeyId = x1888.PermKeyId'
SELECT @sClause = 'SELECT MenuPrmId231=b231.MenuPrmId'
+ ', GrantDeny231=x1892.EveryoneCd'
+ ', GrantDeny231Text=x1892.EveryoneName'
+ ', PermKeyId231=x1887.PermKeyId'
+ ', PermKeyId231Text=x1887.PermKeyDesc'
+ ', PermId231=x1888.PermId'
+ ', PermId231Text=x1888.PermIdText'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b231.MenuId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmMsgCenter86ById') AND type='P')
DROP PROCEDURE dbo.GetAdmMsgCenter86ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmMsgCenter86ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.Msg b146'
SELECT @sClause = 'SELECT MsgId146=b146.MsgId'
+ ', MsgTypeCd146=b146.MsgTypeCd'
+ ', MsgSource146=b146.MsgSource'
SELECT @wClause = 'WHERE b146.MsgId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmMsgCenter86DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmMsgCenter86DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmMsgCenter86DtlById
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause = 'FROM dbo.MsgCenter b147' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture)x1312 ON b147.CultureId = x1312.CultureId'
SELECT @sClause = 'SELECT MsgCenterId147=b147.MsgCenterId'
+ ', CultureId147=x1312.CultureId'
+ ', CultureId147Text=x1312.CultureTypeDesc'
+ ', Msg147=b147.Msg'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b147.MsgId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b147.','Y','N',null,'N','MsgCenterId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b147.','Y','N',null,'N','MsgCenterId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b147.','Y','N',null,'N','MsgCenterId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmOvride78ById') AND type='P')
DROP PROCEDURE dbo.GetAdmOvride78ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetAdmOvride78ById]
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM RODesign.dbo.Ovride b122'
SELECT @sClause = 'SELECT OvrideId122=b122.OvrideId'
+ ', OvrideName122=b122.OvrideName'
+ ', PromptAlways122=b122.PromptAlways'
+ ', PromptModal122=b122.PromptModal'
SELECT @wClause = 'WHERE b122.OvrideId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmOvride78DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmOvride78DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetAdmOvride78DtlById]
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@UsrGroupId		SmallInt
SELECT @fClause = 'FROM RODesign.dbo.OvrideGrp b123' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT UsrGroupId,UsrGroupName FROM RODesign.dbo.UsrGroup)x1090 ON b123.UsrGroupId = x1090.UsrGroupId'
SELECT @sClause = 'SELECT OvrideGrpId123=b123.OvrideGrpId'
+ ', UsrGroupId123=x1090.UsrGroupId'
+ ', UsrGroupId123Text=x1090.UsrGroupName'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b123.OvrideId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@UsrGroups,'UsrGroupId','UsrGroup','b123.','N','N',null,'N','OvrideGrpId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmPuDbTable') AND type='P')
DROP PROCEDURE dbo.GetAdmPuDbTable
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[GetAdmPuDbTable]
 @SystemId	tinyint
,@TableId	int
,@TableName	varchar(500)
/* WITH ENCRYPTION */
AS
DECLARE	 @AppDb		varchar(50)
		,@DesDb		varchar(50)
		,@Oid		varchar(500)
		,@dClause	varchar(8000)
		,@sClause	varchar(8000)
		,@iClause	varchar(8000)
SET NOCOUNT ON
-- SystemId and DbId are the same:
SELECT @AppDb = dbAppDatabase, @DesDb = dbDesDatabase FROM RODesign.dbo.Systems WHERE SystemId = @SystemId
SELECT @Oid = convert(varchar(500),object_id(@AppDb + '.dbo.' + @TableName))
IF @AppDb is null OR @DesDb is null OR @Oid is null
BEGIN
	RAISERROR('Target database not found, please rectify and try again.',18,2) WITH SETERROR
	RETURN 1
END
-- Prepare all temp tables (DataTypeId 21 is Date with no time portion):
SELECT @dClause = 'DECLARE @ColumnIndex smallint, @OpMode char(1), @ColumnName varchar(50), @Des varchar(50)'
+ ' , @PkName varchar(50), @Indid int, @PkCol varchar(50)'
+ ' SELECT @PkName = name FROM dbo.sysobjects where parent_obj = ' + @Oid + ' and xtype = ''''PK'''''
+ ' SELECT @Indid = indid FROM dbo.sysindexes where id = ' + @Oid + ' and name = @PkName'
+ ' SELECT @PkCol = isnull(index_col(''''' + @TableName + ''''', @Indid, 1),'''''''')'
+ ' IF object_id(''''tempdb.dbo.#rst'''') is not null DROP TABLE dbo.#rst'
+ ' CREATE TABLE #rst (ColumnIndex smallint not null, OpMode char(1) not null, ColumnName varchar(50) not null, DataType tinyint not null, DataTypeSqlName varchar(50) null'
+ ' ,ColumnLength smallint not null, ColumnScale tinyint null, AllowNulls char(1) not null, ColumnIdentity char(1) not null, PrimaryKey char(1) not null, DefaultValue nvarchar(50) null'
+ ' ,DbNote varchar(1000) null, SrNote varchar(1000) null, WrNote varchar(1000) null, CuNote varchar(1000) null'
+ ' ,CONSTRAINT PK_#rst PRIMARY KEY CLUSTERED (ColumnIndex,OpMode))'
+ ' IF object_id(''''tempdb.dbo.#sync'''') is not null DROP TABLE dbo.#sync'
+ ' CREATE TABLE #sync (ColumnName varchar(50) not null, DataType tinyint not null, ColumnLength smallint not null, ColumnScale tinyint null'
+ ' ,AllowNulls char(1) not null, ColumnIdentity char(1) not null, PrimaryKey char(1) not null, ColumnIndex smallint null, DefaultValue nvarchar(50) null'
+ ' ,CONSTRAINT PK_#sync PRIMARY KEY CLUSTERED (ColumnName))'
+ ' INSERT dbo.#sync SELECT sc.Name, dt.DataTypeId'
+ ',CASE WHEN dt.DataTypeSqlName = ''''Decimal'''' THEN ColumnProperty(' + @Oid + ',sc.Name,''''Precision'''') WHEN dt.DoubleByte = ''''Y'''' THEN sc.length/2 ELSE sc.length END'
+ ',CASE WHEN dt.DataTypeSqlName = ''''Decimal'''' THEN ColumnProperty(' + @Oid + ',sc.Name,''''Scale'''') ELSE NULL END'
+ ',CASE WHEN ColumnProperty(' + @Oid + ',sc.Name,''''AllowsNull'''') = 1 THEN ''''Y'''' ELSE ''''N'''' END'
+ ',CASE WHEN ColumnProperty(' + @Oid + ',sc.Name,''''IsIdentity'''') = 1 THEN ''''Y'''' ELSE ''''N'''' END'
+ ',CASE WHEN sc.name = @PkCol THEN ''''Y'''' ELSE ''''N'''' END'
+ ',sc.colid * 10, REPLACE(REPLACE(cm.text,''''('''',''''''''),'''')'''','''''''')'
+ ' FROM dbo.syscolumns sc'
+ ' INNER JOIN dbo.systypes st ON sc.xtype = st.xtype '
+ ' INNER JOIN RODesign.dbo.CtDataType dt on dt.DataTypeSqlName = st.name'
+ ' LEFT OUTER JOIN dbo.syscomments cm on sc.cDefault = cm.id'
+ ' WHERE sc.id = ' + @Oid + ' AND dt.DataTypeId <> 21 ORDER BY sc.colid'
-- To be deleted:
SELECT @sClause = ' IF NOT EXISTS (SELECT 1 FROM ' + @DesDb + '.dbo.DbColumn WHERE TableId = ' + convert(varchar,@TableId) + ' AND ColumnIndex is null) BEGIN'
+ ' INSERT INTO #rst (ColumnIndex, OpMode, ColumnName, DataType, DataTypeSqlName, ColumnLength, ColumnScale, AllowNulls, ColumnIdentity, PrimaryKey, DefaultValue)'
+ ' SELECT -a.ColumnIndex, ''''D'''', a.ColumnName, a.DataType, b.DataTypeSqlName, a.ColumnLength, a.ColumnScale, a.AllowNulls, a.ColumnIdentity, a.PrimaryKey, a.DefaultValue'
+ ' FROM dbo.#sync a INNER JOIN RODesign.dbo.CtDataType b ON a.DataType = b.DataTypeId'
+ ' WHERE NOT EXISTS (SELECT 1 FROM ' + @DesDb + '.dbo.DbColumn c'
+ ' WHERE c.TableId = ' + convert(varchar,@TableId) + ' AND ((a.ColumnName = c.ColumnName AND c.PrevColName is null) OR c.PrevColName = a.ColumnName))'
-- To be added (excluding external columns):
SELECT @sClause = @sClause + ' INSERT INTO #rst (ColumnIndex, OpMode, ColumnName, DataType, DataTypeSqlName, ColumnLength, ColumnScale, AllowNulls, ColumnIdentity, PrimaryKey, DefaultValue)'
+ ' SELECT a.ColumnIndex, ''''A'''', a.ColumnName, a.DataType, b.DataTypeSqlName, a.ColumnLength, a.ColumnScale, a.AllowNulls, a.ColumnIdentity, a.PrimaryKey, a.DefaultValue'
+ ' FROM ' + @DesDb + '.dbo.DbColumn a INNER JOIN RODesign.dbo.CtDataType b ON a.DataType = b.DataTypeId'
+ ' WHERE a.TableId = ' + convert(varchar,@TableId) + ' AND (ExternalTable is null OR ExternalTable = '''''''')'
+ ' AND NOT EXISTS (SELECT 1 FROM dbo.#sync c WHERE a.ColumnName = c.ColumnName)'
+ ' AND (a.PrevColName is null OR NOT EXISTS (SELECT 1 FROM dbo.#sync c WHERE a.PrevColName = c.ColumnName))'
-- To be changed from (DataType 21 Date does not exist in physical database):
SELECT @sClause = @sClause + ' INSERT INTO #rst (ColumnIndex, OpMode, ColumnName, DataType, DataTypeSqlName, ColumnLength, ColumnScale, AllowNulls, ColumnIdentity, PrimaryKey, DefaultValue)'
+ ' SELECT c.ColumnIndex, ''''F'''', a.ColumnName, a.DataType, b.DataTypeSqlName, a.ColumnLength, a.ColumnScale, a.AllowNulls, a.ColumnIdentity, a.PrimaryKey, a.DefaultValue'
+ ' FROM dbo.#sync a'
+ ' INNER JOIN RODesign.dbo.CtDataType b ON a.DataType = b.DataTypeId'
+ ' INNER JOIN ' + @DesDb + '.dbo.DbColumn c'
+ ' ON c.TableId = ' + convert(varchar,@TableId) + ' AND ((c.PrevColName is not null AND a.ColumnName = c.PrevColName) OR (a.ColumnName = c.ColumnName))'
+ ' AND NOT (a.DataType = (case when c.DataType = 21 THEN 12 ELSE c.DataType END) AND a.ColumnLength = c.ColumnLength'
+ ' AND a.ColumnScale = isnull(c.ColumnScale,0) AND a.AllowNulls = c.AllowNulls AND a.ColumnIdentity = c.ColumnIdentity'
+ ' AND a.PrimaryKey = c.PrimaryKey AND a.DefaultValue = c.DefaultValue AND a.ColumnName = c.ColumnName)'
-- To be changed to (DataType 21 Date does not exist in physical database):
SELECT @sClause = @sClause + ' INSERT INTO #rst (ColumnIndex, OpMode, ColumnName, DataType, DataTypeSqlName, ColumnLength, ColumnScale, AllowNulls, ColumnIdentity, PrimaryKey, DefaultValue)'
+ ' SELECT a.ColumnIndex, ''''E'''', a.ColumnName, a.DataType, b.DataTypeSqlName, a.ColumnLength, a.ColumnScale, a.AllowNulls, a.ColumnIdentity, a.PrimaryKey, a.DefaultValue'
+ ' FROM ' + @DesDb + '.dbo.DbColumn a'
+ ' INNER JOIN RODesign.dbo.CtDataType b ON a.DataType = b.DataTypeId'
+ ' INNER JOIN #sync c ON ((a.PrevColName is not null AND a.PrevColName = c.ColumnName) OR (a.ColumnName = c.ColumnName))'
+ ' AND NOT (a.ColumnName = c.ColumnName AND (case when a.DataType = 21 THEN 12 ELSE a.DataType END) = c.DataType AND a.ColumnLength = c.ColumnLength'
+ ' AND isnull(a.ColumnScale,0) = c.ColumnScale AND a.AllowNulls = c.AllowNulls AND a.ColumnIdentity = c.ColumnIdentity'
+ ' AND a.PrimaryKey = c.PrimaryKey AND a.DefaultValue = c.DefaultValue)'
+ ' WHERE a.TableId = ' + convert(varchar,@TableId) + ' END'
+ ' ELSE RAISERROR(''''Cannot analyze when column order not filled, please rectify and try again.'''',18,2) WITH SETERROR'
-- Update potential impacts (delete and update only):
SELECT @iClause = ' DECLARE cur1 CURSOR FAST_FORWARD FOR SELECT ColumnIndex, OpMode, ColumnName FROM dbo.#rst'
+ ' WHERE OpMode in (''''D'''',''''F'''') FOR READ ONLY'
+ ' OPEN cur1 FETCH NEXT FROM cur1 INTO @ColumnIndex, @OpMode, @ColumnName'
+ ' WHILE @@FETCH_STATUS = 0 BEGIN'
	+ ' DECLARE cur2 CURSOR FAST_FORWARD FOR SELECT dbDesDatabase FROM RODesign.dbo.Systems FOR READ ONLY'
	+ ' OPEN cur2 FETCH NEXT FROM cur2 INTO @Des'
	+ ' WHILE @@FETCH_STATUS = 0 BEGIN'
		-- Capture impacts on same columns used in DataTable of other systems:
		SELECT @iClause = @iClause + ' EXEC (''''DECLARE @TblName varchar(50) DECLARE cur3 CURSOR FAST_FORWARD FOR'
		+ ' SELECT b.TableName FROM '''' + @Des + ''''.dbo.DbColumn a INNER JOIN '''' + @Des + ''''.dbo.DbTable b ON a.TableId = b.TableId'

		+ ' WHERE b.TableName = ''''''''' + @TableName + ''''''''' AND a.ColumnName = '''''''''''' + @ColumnName + '''''''''''' FOR READ ONLY'
		+ ' OPEN cur3 FETCH NEXT FROM cur3 INTO @TblName'
		+ ' WHILE @@FETCH_STATUS = 0 BEGIN'
		+ ' UPDATE #rst SET DbNote = isnull(DbNote,'''''''''''''''') + '''''''' '''''''' + '''''''''''' + @Des + '''''''''''' + '''''''':'''''''' + @TblName + '''''''';'''''''''
		+ ' WHERE ColumnIndex = '''' + @ColumnIndex + '''' AND OpMode = '''''''''''' + @OpMode + '''''''''''''
		+ ' FETCH NEXT FROM cur3 INTO @TblName END CLOSE cur3 DEALLOCATE cur3'''')'
		-- Capture impacts on same columns used in ServerRule of other systems:
		SELECT @iClause = @iClause + ' EXEC (''''DECLARE @ProcedureName varchar(50) DECLARE cur3 CURSOR FAST_FORWARD FOR'
		+ ' SELECT ProcedureName FROM '''' + @Des + ''''.dbo.ServerRule'
		+ ' WHERE RuleCode like ''''''''%'''' + @ColumnName + ''''%'''''''' FOR READ ONLY'
		+ ' OPEN cur3 FETCH NEXT FROM cur3 INTO @ProcedureName'
		+ ' WHILE @@FETCH_STATUS = 0 BEGIN'
		+ ' UPDATE #rst SET SrNote = isnull(SrNote,'''''''''''''''') + '''''''' '''''''' + '''''''''''' + @Des + '''''''''''' + '''''''':'''''''' + @ProcedureName + '''''''';'''''''''
		+ ' WHERE ColumnIndex = '''' + @ColumnIndex + '''' AND OpMode = '''''''''''' + @OpMode + '''''''''''''
		+ ' FETCH NEXT FROM cur3 INTO @ProcedureName END CLOSE cur3 DEALLOCATE cur3'''')'
		-- Capture impacts on same columns used in WebRule of other systems:
		SELECT @iClause = @iClause + ' EXEC (''''DECLARE @RuleName varchar(50) DECLARE cur3 CURSOR FAST_FORWARD FOR'
		+ ' SELECT RuleName FROM '''' + @Des + ''''.dbo.WebRule'
		+ ' WHERE WebRuleProg like ''''''''%'''' + @ColumnName + ''''%'''''''' FOR READ ONLY'
		+ ' OPEN cur3 FETCH NEXT FROM cur3 INTO @RuleName'
		+ ' WHILE @@FETCH_STATUS = 0 BEGIN'
		+ ' UPDATE #rst SET WrNote = isnull(WrNote,'''''''''''''''') + '''''''' '''''''' + '''''''''''' + @Des + '''''''''''' + '''''''':'''''''' + @RuleName + '''''''';'''''''''
		+ ' WHERE ColumnIndex = '''' + @ColumnIndex + '''' AND OpMode = '''''''''''' + @OpMode + '''''''''''''
		+ ' FETCH NEXT FROM cur3 INTO @RuleName END CLOSE cur3 DEALLOCATE cur3'''')'
		-- Capture impacts on same columns used in Custom Detail of other systems:
		SELECT @iClause = @iClause + ' EXEC (''''DECLARE @ProgramName varchar(50) DECLARE cur3 CURSOR FAST_FORWARD FOR'
		+ ' SELECT ProgramName FROM '''' + @Des + ''''.dbo.CustomDtl'
		+ ' WHERE CustomCode like ''''''''%'''' + @ColumnName + ''''%'''''''' FOR READ ONLY'
		+ ' OPEN cur3 FETCH NEXT FROM cur3 INTO @ProgramName'
		+ ' WHILE @@FETCH_STATUS = 0 BEGIN'
		+ ' UPDATE #rst SET CuNote = isnull(CuNote,'''''''''''''''') + '''''''' '''''''' + '''''''''''' + @Des + '''''''''''' + '''''''':'''''''' + @ProgramName + '''''''';'''''''''
		+ ' WHERE ColumnIndex = '''' + @ColumnIndex + '''' AND OpMode = '''''''''''' + @OpMode + '''''''''''''
		+ ' FETCH NEXT FROM cur3 INTO @ProgramName END CLOSE cur3 DEALLOCATE cur3'''')'
SELECT @iClause = @iClause + ' FETCH NEXT FROM cur2 INTO @Des END CLOSE cur2 DEALLOCATE cur2'
+ ' FETCH NEXT FROM cur1 INTO @ColumnIndex, @OpMode, @ColumnName END CLOSE cur1 DEALLOCATE cur1'
-- Report changes:
EXEC (@AppDb + '.dbo.MkStoredProcedure ''' + @dClause + ''',''' + @sClause + ''',''' + @iClause + ''','' SELECT * FROM #rst DROP TABLE #rst DROP TABLE dbo.#sync''')
RETURN 0 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmReport67ById') AND type='P')
DROP PROCEDURE dbo.GetAdmReport67ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmReport67ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.Report b22'
SELECT @sClause = 'SELECT ReportId22=b22.ReportId'
+ ', ProgramName22=b22.ProgramName'
+ ', ReportTypeCd22=b22.ReportTypeCd'
+ ', OrientationCd22=b22.OrientationCd'
+ ', CopyReportId22=b22.CopyReportId'
+ ', ModifiedBy22=b22.ModifiedBy'
+ ', ModifiedOn22=b22.ModifiedOn'
+ ', TemplateName22=b22.TemplateName'
+ ', RptTemplate22=b22.RptTemplate'
+ ', UnitCd22=b22.UnitCd'
+ ', TopMargin22=b22.TopMargin'
+ ', BottomMargin22=b22.BottomMargin'
+ ', LeftMargin22=b22.LeftMargin'
+ ', RightMargin22=b22.RightMargin'
+ ', PageWidth22=b22.PageWidth'
+ ', PageHeight22=b22.PageHeight'
+ ', AllowSelect22=b22.AllowSelect'
+ ', GenerateRp22=b22.GenerateRp'
+ ', LastGenDt22=b22.LastGenDt'
+ ', AuthRequired22=b22.AuthRequired'
+ ', WhereClause22=b22.WhereClause'
+ ', RegClause22=b22.RegClause'
+ ', RegCode22=b22.RegCode'
+ ', ValClause22=b22.ValClause'
+ ', ValCode22=b22.ValCode'
+ ', UpdClause22=b22.UpdClause'
+ ', UpdCode22=b22.UpdCode'
+ ', XlsClause22=b22.XlsClause'
+ ', XlsCode22=b22.XlsCode'
SELECT @wClause = 'WHERE b22.ReportId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmReport67DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmReport67DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmReport67DtlById
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause = 'FROM dbo.ReportHlp b96' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture)x899 ON b96.CultureId = x899.CultureId'
SELECT @sClause = 'SELECT ReportHlpId96=b96.ReportHlpId'
+ ', CultureId96=x899.CultureId'
+ ', CultureId96Text=x899.CultureTypeDesc'
+ ', DefaultHlpMsg96=b96.DefaultHlpMsg'
+ ', ReportTitle96=b96.ReportTitle'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b96.ReportId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b96.','Y','N',null,'N','ReportHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b96.','Y','N',null,'N','ReportHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b96.','Y','N',null,'N','ReportHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b96.','Y','N',null,'N','ReportHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmReportCri69ById') AND type='P')
DROP PROCEDURE dbo.GetAdmReportCri69ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmReportCri69ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.ReportCri b97'
SELECT @sClause = 'SELECT ReportCriId97=b97.ReportCriId'
+ ', ReportId97=b97.ReportId'
+ ', TabIndex97=b97.TabIndex'
+ ', ColumnName97=b97.ColumnName'
+ ', ReportGrpId97=b97.ReportGrpId'
+ ', LabelCss97=b97.LabelCss'
+ ', ContentCss97=b97.ContentCss'
+ ', DefaultValue97=b97.DefaultValue'
+ ', TableId97=b97.TableId'
+ ', TableAbbr97=b97.TableAbbr'
+ ', RequiredValid97=b97.RequiredValid'
+ ', DataTypeId97=b97.DataTypeId'
+ ', DataTypeSize97=b97.DataTypeSize'
+ ', DisplayModeId97=b97.DisplayModeId'
+ ', ColumnSize97=b97.ColumnSize'
+ ', RowSize97=b97.RowSize'
+ ', DdlKeyColumnName97=b97.DdlKeyColumnName'
+ ', DdlRefColumnName97=b97.DdlRefColumnName'
+ ', DdlSrtColumnName97=b97.DdlSrtColumnName'
+ ', DdlFtrColumnId97=b97.DdlFtrColumnId'
+ ', WhereClause97=b97.WhereClause'
+ ', RegClause97=b97.RegClause'
SELECT @wClause = 'WHERE b97.ReportCriId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmReportCri69DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmReportCri69DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmReportCri69DtlById
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause = 'FROM dbo.ReportCriHlp b98' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture)x923 ON b98.CultureId = x923.CultureId'
SELECT @sClause = 'SELECT ReportCriHlpId98=b98.ReportCriHlpId'
+ ', CultureId98=x923.CultureId'
+ ', CultureId98Text=x923.CultureTypeDesc'
+ ', ColumnHeader98=b98.ColumnHeader'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b98.ReportCriId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b98.','Y','N',null,'N','ReportCriHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b98.','Y','N',null,'N','ReportCriHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b98.','Y','N',null,'N','ReportCriHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmReportGrp65ById') AND type='P')
DROP PROCEDURE dbo.GetAdmReportGrp65ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO









CREATE PROCEDURE [dbo].[GetAdmReportGrp65ById]
 @ReportId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
SELECT @sClause = 'SELECT ReportId22=b22.ReportId'
SELECT @fClause = 'FROM dbo.Report b22'
SELECT @wClause = 'WHERE b22.ReportId = ' + isnull(convert(varchar,@ReportId),'null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0




 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmReportGrp65DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmReportGrp65DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO









CREATE PROCEDURE [dbo].[GetAdmReportGrp65DtlById]
 @ReportId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@oClause		varchar(8000)
	,@wClause		varchar(8000)
SELECT @sClause = 'SELECT ReportGrpId94=b94.ReportGrpId, ReportGrpIndex94=b94.ReportGrpIndex, ParentGrpId94=x885.ReportGrpId, ParentGrpId94Text=x885.ReportGrpName, ReportGrpName94=b94.ReportGrpName, ContentVertical94=b94.ContentVertical, LabelVertical94=b94.LabelVertical, BorderWidth94=b94.BorderWidth'
SELECT @fClause = 'FROM dbo.ReportGrp b94 INNER JOIN (SELECT DISTINCT ReportGrpId,ReportGrpName FROM dbo.ReportGrp)x885 ON b94.ParentGrpId = x885.ReportGrpId'
SELECT @oClause = 'ORDER BY b94.ReportGrpIndex'
SELECT @wClause = 'WHERE b94.ReportId = ' + isnull(convert(varchar,@ReportId),'null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0




 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmReportObj13ById') AND type='P')
DROP PROCEDURE dbo.GetAdmReportObj13ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmReportObj13ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.ReportObj b23'
SELECT @sClause = 'SELECT ReportObjId23=b23.ReportObjId'
+ ', ReportId23=b23.ReportId'
+ ', ColumnName23=b23.ColumnName'
+ ', RptObjTypeCd23=b23.RptObjTypeCd'
+ ', TabIndex23=b23.TabIndex'
+ ', ColumnFormat23=b23.ColumnFormat'
+ ', PaddSize23=b23.PaddSize'
+ ', PaddChar23=b23.PaddChar'
+ ', DataTypeId23=b23.DataTypeId'
+ ', OperatorId23=b23.OperatorId'
+ ', ReportCriId23=b23.ReportCriId'
SELECT @wClause = 'WHERE b23.ReportObjId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmReportObj13DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmReportObj13DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmReportObj13DtlById
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause = 'FROM dbo.ReportObjHlp b99' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture)x930 ON b99.CultureId = x930.CultureId'
SELECT @sClause = 'SELECT ReportObjHlpId99=b99.ReportObjHlpId'
+ ', CultureId99=x930.CultureId'
+ ', CultureId99Text=x930.CultureTypeDesc'
+ ', ColumnHeader99=b99.ColumnHeader'
+ ', HeaderWidth99=b99.HeaderWidth'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b99.ReportObjId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b99.','Y','N',null,'N','ReportObjHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b99.','Y','N',null,'N','ReportObjHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b99.','Y','N',null,'N','ReportObjHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmRowOvrd17ById') AND type='P')
DROP PROCEDURE dbo.GetAdmRowOvrd17ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmRowOvrd17ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.RowOvrd b238'
SELECT @sClause = 'SELECT RowOvrdId238=b238.RowOvrdId'
+ ', ScreenId238=b238.ScreenId'
+ ', ReportId238=b238.ReportId'
+ ', RowAuthId238=b238.RowAuthId'
+ ', AllowSel238=b238.AllowSel'
+ ', AllowAdd238=b238.AllowAdd'
+ ', AllowUpd238=b238.AllowUpd'
+ ', AllowDel238=b238.AllowDel'
SELECT @wClause = 'WHERE b238.RowOvrdId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmRowOvrd17DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmRowOvrd17DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmRowOvrd17DtlById
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause = 'FROM dbo.RowOvrdPrm b239' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT AndOrCd,AndOrName FROM RODesign.dbo.CtAndOr)x2099 ON b239.AndCondition = x2099.AndOrCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT PermKeyId,PermKeyDesc FROM RODesign.dbo.VwPermKey)x1950 ON b239.PermKeyId = x1950.PermKeyId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT SelectTypeCd,SelectTypeName FROM RODesign.dbo.CtSelectType)x1951 ON b239.SelLevel = x1951.SelectTypeCd'
SELECT @sClause = 'SELECT RowOvrdPrmId239=b239.RowOvrdPrmId'
+ ', AndCondition239=x2099.AndOrCd'
+ ', AndCondition239Text=x2099.AndOrName'
+ ', PermKeyId239=x1950.PermKeyId'
+ ', PermKeyId239Text=x1950.PermKeyDesc'
+ ', SelLevel239=x1951.SelectTypeCd'
+ ', SelLevel239Text=x1951.SelectTypeName'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b239.RowOvrdId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmRptCha100ById') AND type='P')
DROP PROCEDURE dbo.GetAdmRptCha100ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmRptCha100ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.RptCha b206'
SELECT @sClause = 'SELECT RptChaId206=b206.RptChaId'
+ ', RptCtrId206=b206.RptCtrId'
+ ', ReportId206=b206.ReportId'
+ ', RptChaTypeCd206=b206.RptChaTypeCd'
+ ', ThreeD206=b206.ThreeD'
+ ', CategoryGrp206=b206.CategoryGrp'
+ ', ChartData206=b206.ChartData'
+ ', SeriesGrp206=b206.SeriesGrp'
SELECT @wClause = 'WHERE b206.RptChaId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmRptCtr90ById') AND type='P')
DROP PROCEDURE dbo.GetAdmRptCtr90ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmRptCtr90ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.RptCtr b161'
SELECT @sClause = 'SELECT RptCtrId161=b161.RptCtrId'
+ ', ReportId161=b161.ReportId'
+ ', RptCtrName161=b161.RptCtrName'
+ ', PRptCtrId161=b161.PRptCtrId'
+ ', RptElmId161=b161.RptElmId'
+ ', RptCelId161=b161.RptCelId'
+ ', RptStyleId161=b161.RptStyleId'
+ ', RptCtrTypeCd161=b161.RptCtrTypeCd'
+ ', CtrTop161=b161.CtrTop'
+ ', CtrLeft161=b161.CtrLeft'
+ ', CtrHeight161=b161.CtrHeight'
+ ', CtrWidth161=b161.CtrWidth'
+ ', CtrZIndex161=b161.CtrZIndex'
+ ', CtrPgBrStart161=b161.CtrPgBrStart'
+ ', CtrPgBrEnd161=b161.CtrPgBrEnd'
+ ', CtrCanGrow161=b161.CtrCanGrow'
+ ', CtrCanShrink161=b161.CtrCanShrink'
+ ', CtrTogether161=b161.CtrTogether'
+ ', CtrValue161=b161.CtrValue'
+ ', CtrAction161=b161.CtrAction'
+ ', CtrVisibility161=b161.CtrVisibility'
+ ', CtrToggle161=b161.CtrToggle'
+ ', CtrGrouping161=b161.CtrGrouping'
+ ', CtrToolTip161=b161.CtrToolTip'
SELECT @wClause = 'WHERE b161.RptCtrId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmRptStyle89ById') AND type='P')
DROP PROCEDURE dbo.GetAdmRptStyle89ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmRptStyle89ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.RptStyle b167'
SELECT @sClause = 'SELECT RptStyleId167=b167.RptStyleId'
+ ', DefaultCd167=b167.DefaultCd'
+ ', RptStyleDesc167=b167.RptStyleDesc'
+ ', BorderColorD167=b167.BorderColorD'
+ ', BorderColorL167=b167.BorderColorL'
+ ', BorderColorR167=b167.BorderColorR'
+ ', BorderColorT167=b167.BorderColorT'
+ ', BorderColorB167=b167.BorderColorB'
+ ', Color167=b167.Color'
+ ', BgColor167=b167.BgColor'
+ ', BgGradType167=b167.BgGradType'
+ ', BgGradColor167=b167.BgGradColor'
+ ', BgImage167=b167.BgImage'
+ ', Direction167=b167.Direction'
+ ', WritingMode167=b167.WritingMode'
+ ', LineHeight167=b167.LineHeight'
+ ', Format167=b167.Format'
+ ', BorderStyleD167=b167.BorderStyleD'
+ ', BorderStyleL167=b167.BorderStyleL'
+ ', BorderStyleR167=b167.BorderStyleR'
+ ', BorderStyleT167=b167.BorderStyleT'
+ ', BorderStyleB167=b167.BorderStyleB'
+ ', FontStyle167=b167.FontStyle'
+ ', FontFamily167=b167.FontFamily'
+ ', FontSize167=b167.FontSize'
+ ', FontWeight167=b167.FontWeight'
+ ', TextDecor167=b167.TextDecor'
+ ', TextAlign167=b167.TextAlign'
+ ', VerticalAlign167=b167.VerticalAlign'
+ ', BorderWidthD167=b167.BorderWidthD'
+ ', BorderWidthL167=b167.BorderWidthL'
+ ', BorderWidthR167=b167.BorderWidthR'
+ ', BorderWidthT167=b167.BorderWidthT'
+ ', BorderWidthB167=b167.BorderWidthB'
+ ', PadLeft167=b167.PadLeft'
+ ', PadRight167=b167.PadRight'
+ ', PadTop167=b167.PadTop'
+ ', PadBottom167=b167.PadBottom'
SELECT @wClause = 'WHERE b167.RptStyleId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmRptTbl92ById') AND type='P')
DROP PROCEDURE dbo.GetAdmRptTbl92ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmRptTbl92ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.RptTbl b162'
SELECT @sClause = 'SELECT RptTblId162=b162.RptTblId'
+ ', RptCtrId162=b162.RptCtrId'
+ ', ParentId162=b162.ParentId'
+ ', ReportId162=b162.ReportId'
+ ', TblToggle162=b162.TblToggle'
+ ', TblGrouping162=b162.TblGrouping'
+ ', RptTblTypeCd162=b162.RptTblTypeCd'
+ ', TblVisibility162=b162.TblVisibility'
+ ', TblRepeatNew162=b162.TblRepeatNew'
+ ', TblOrder162=b162.TblOrder'
+ ', ColWidth162=b162.ColWidth'
SELECT @wClause = 'WHERE b162.RptTblId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmRptTbl92DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmRptTbl92DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmRptTbl92DtlById
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause = 'FROM dbo.RptCel b164' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptTblId,RptTblDesc FROM dbo.RptTbl)x1477 ON b164.CelNum = x1477.RptTblId'
SELECT @sClause = 'SELECT RptCelId164=b164.RptCelId'
+ ', RowNum164=b164.RowNum'
+ ', RowHeight164=b164.RowHeight'
+ ', RowVisibility164=b164.RowVisibility'
+ ', CelNum164=x1477.RptTblId'
+ ', CelNum164Text=x1477.RptTblDesc'
+ ', CelColSpan164=b164.CelColSpan'
SELECT @oClause = 'ORDER BY b164.RowNum, x1477.RptTblDesc'
SELECT @wClause = 'WHERE b164.RptTblId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmRptWiz95ById') AND type='P')
DROP PROCEDURE dbo.GetAdmRptWiz95ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetAdmRptWiz95ById]
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.Rptwiz b183'
SELECT @sClause = 'SELECT RptwizId183=b183.RptwizId, RptwizName183=b183.RptwizName, RptwizDesc183=b183.RptwizDesc'
+ ', ReportId183=b183.ReportId, AccessCd183=b183.AccessCd, UsrId183=b183.UsrId, TemplateName183=b183.TemplateName'
+ ', OrientationCd183=b183.OrientationCd, UnitCd183=b183.UnitCd, TopMargin183=b183.TopMargin, BottomMargin183=b183.BottomMargin'
+ ', LeftMargin183=b183.LeftMargin, RightMargin183=b183.RightMargin, RptwizTypeCd183=b183.RptwizTypeCd, RptwizCatId183=b183.RptwizCatId'
+ ', RptChaTypeCd183=b183.RptChaTypeCd, ThreeD183=b183.ThreeD, GMinValue183=b183.GMinValue, GLowRange183=b183.GLowRange'
+ ', GMidRange183=b183.GMidRange, GMaxValue183=b183.GMaxValue, GNeedle183=b183.GNeedle, GMinValueId183=b183.GMinValueId'
+ ', GLowRangeId183=b183.GLowRangeId, GMidRangeId183=b183.GMidRangeId, GMaxValueId183=b183.GMaxValueId, GNeedleId183=b183.GNeedleId'
+ ', GPositive183=GPositive, GFormat183=b183.GFormat'
SELECT @wClause = 'WHERE b183.RptwizId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmRptWiz95DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmRptWiz95DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetAdmRptWiz95DtlById]
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause = 'FROM dbo.RptwizDtl b184' 
SELECT @fClause = @fClause + ' INNER JOIN (SELECT DISTINCT ColumnId,ColumnDesc,ColObjective FROM dbo.DbColumn)x1594 ON b184.ColumnId = x1594.ColumnId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT OperatorId,OperatorDesc FROM RODesign.dbo.CtOperator)x1595 ON b184.CriOperatorId = x1595.OperatorId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT AggregateCd,AggregateName FROM RODesign.dbo.CtAggregate)x1588 ON b184.AggregateCd = x1588.AggregateCd'
SELECT @sClause = 'SELECT RptwizDtlId184=b184.RptwizDtlId'
+ ', ColumnId184=x1594.ColumnId'
+ ', ColumnId184Text=x1594.ColumnDesc'
+ ', ColObjective5=' + case when charindex('x1594 ',@fClause) > 0 then 'x1594.ColObjective' else 'null' end
+ ', CriOperatorId184=x1595.OperatorId'
+ ', CriOperatorId184Text=x1595.OperatorDesc'
+ ', CriSelect184=b184.CriSelect'
+ ', ColSelect184=b184.ColSelect'
+ ', ColGroup184=b184.ColGroup'
+ ', ColSort184=b184.ColSort'
+ ', AggregateCd184=x1588.AggregateCd'
+ ', AggregateCd184Text=x1588.AggregateName'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b184.RptwizId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmScreen9ById') AND type='P')
DROP PROCEDURE dbo.GetAdmScreen9ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmScreen9ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.Screen b15'
SELECT @sClause = 'SELECT ScreenId15=b15.ScreenId'
+ ', ProgramName15=b15.ProgramName'
+ ', ScreenTypeId15=b15.ScreenTypeId'
+ ', ViewOnly15=b15.ViewOnly'
+ ', SearchAscending15=b15.SearchAscending'
+ ', MasterTableId15=b15.MasterTableId'
+ ', SearchTableId15=b15.SearchTableId'
+ ', SearchId15=b15.SearchId'
+ ', SearchIdR15=b15.SearchIdR'
+ ', SearchDtlId15=b15.SearchDtlId'
+ ', SearchDtlIdR15=b15.SearchDtlIdR'
+ ', SearchUrlId15=b15.SearchUrlId'
+ ', SearchImgId15=b15.SearchImgId'
+ ', DetailTableId15=b15.DetailTableId'
+ ', GridRows15=b15.GridRows'
+ ', HasDeleteAll15=b15.HasDeleteAll'
+ ', ShowGridHead15=b15.ShowGridHead'
+ ', GenerateSc15=b15.GenerateSc'
+ ', GenerateSr15=b15.GenerateSr'
+ ', ValidateReq15=b15.ValidateReq'
+ ', DeferError15=b15.DeferError'
+ ', AuthRequired15=b15.AuthRequired'
+ ', GenAudit15=b15.GenAudit'
+ ', ScreenObj15=b15.ScreenObj'
+ ', ScreenObj15URL=b15.ScreenObj'
+ ', ScreenFilter15URL=b15.ScreenFilter'
SELECT @wClause = 'WHERE b15.ScreenId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmScreen9DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmScreen9DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmScreen9DtlById
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause = 'FROM dbo.ScreenHlp b16' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture)x136 ON b16.CultureId = x136.CultureId'
SELECT @sClause = 'SELECT ScreenHlpId16=b16.ScreenHlpId'
+ ', CultureId16=x136.CultureId'
+ ', CultureId16Text=x136.CultureTypeDesc'
+ ', ScreenTitle16=b16.ScreenTitle'
+ ', DefaultHlpMsg16=b16.DefaultHlpMsg'
+ ', FootNote16=b16.FootNote'
+ ', AddMsg16=b16.AddMsg'
+ ', UpdMsg16=b16.UpdMsg'
+ ', DelMsg16=b16.DelMsg'
+ ', IncrementMsg16=b16.IncrementMsg'
+ ', NoMasterMsg16=b16.NoMasterMsg'
+ ', NoDetailMsg16=b16.NoDetailMsg'
+ ', AddMasterMsg16=b16.AddMasterMsg'
+ ', AddDetailMsg16=b16.AddDetailMsg'
+ ', MasterLstTitle16=b16.MasterLstTitle'
+ ', MasterLstSubtitle16=b16.MasterLstSubtitle'
+ ', MasterRecTitle16=b16.MasterRecTitle'
+ ', MasterRecSubtitle16=b16.MasterRecSubtitle'
+ ', MasterFoundMsg16=b16.MasterFoundMsg'
+ ', DetailLstTitle16=b16.DetailLstTitle'
+ ', DetailLstSubtitle16=b16.DetailLstSubtitle'
+ ', DetailRecTitle16=b16.DetailRecTitle'
+ ', DetailRecSubtitle16=b16.DetailRecSubtitle'
+ ', DetailFoundMsg16=b16.DetailFoundMsg'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b16.ScreenId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b16.','Y','N',null,'N','ScreenHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b16.','Y','N',null,'N','ScreenHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b16.','Y','N',null,'N','ScreenHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmScreenCri73ById') AND type='P')
DROP PROCEDURE dbo.GetAdmScreenCri73ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmScreenCri73ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.ScreenCri b104'
SELECT @sClause = 'SELECT ScreenCriId104=b104.ScreenCriId'
+ ', ScreenId104=b104.ScreenId'
+ ', LabelCss104=b104.LabelCss'
+ ', ContentCss104=b104.ContentCss'
+ ', ColumnId104=b104.ColumnId'
+ ', OperatorId104=b104.OperatorId'
+ ', DisplayModeId104=b104.DisplayModeId'
+ ', TabIndex104=b104.TabIndex'
+ ', RequiredValid104=b104.RequiredValid'
+ ', ColumnJustify104=b104.ColumnJustify'
+ ', ColumnSize104=b104.ColumnSize'
+ ', RowSize104=b104.RowSize'
+ ', DdlKeyColumnId104=b104.DdlKeyColumnId'
+ ', DdlRefColumnId104=b104.DdlRefColumnId'
+ ', DdlSrtColumnId104=b104.DdlSrtColumnId'
+ ', DdlFtrColumnId104=b104.DdlFtrColumnId'
SELECT @wClause = 'WHERE b104.ScreenCriId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmScreenCri73DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmScreenCri73DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmScreenCri73DtlById
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause = 'FROM dbo.ScreenCriHlp b105' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture)x990 ON b105.CultureId = x990.CultureId'
SELECT @sClause = 'SELECT ScreenCriHlpId105=b105.ScreenCriHlpId'
+ ', CultureId105=x990.CultureId'
+ ', CultureId105Text=x990.CultureTypeDesc'
+ ', ColumnHeader105=b105.ColumnHeader'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b105.ScreenCriId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b105.','Y','N',null,'N','ScreenCriHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b105.','Y','N',null,'N','ScreenCriHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b105.','Y','N',null,'N','ScreenCriHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmScreenFilter59ById') AND type='P')
DROP PROCEDURE dbo.GetAdmScreenFilter59ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmScreenFilter59ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.ScreenFilter b86'
SELECT @sClause = 'SELECT ScreenFilterId86=b86.ScreenFilterId'
+ ', ScreenId86=b86.ScreenId'
+ ', ScreenFilterName86=b86.ScreenFilterName'
+ ', FilterClause86=b86.FilterClause'
+ ', FilterOrder86=b86.FilterOrder'
+ ', ApplyToMst86=b86.ApplyToMst'
SELECT @wClause = 'WHERE b86.ScreenFilterId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmScreenFilter59DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmScreenFilter59DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmScreenFilter59DtlById
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause = 'FROM dbo.ScreenFilterHlp b87' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture)x730 ON b87.CultureId = x730.CultureId'
SELECT @sClause = 'SELECT ScreenFilterHlpId87=b87.ScreenFilterHlpId'
+ ', CultureId87=x730.CultureId'
+ ', CultureId87Text=x730.CultureTypeDesc'
+ ', FilterName87=b87.FilterName'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b87.ScreenFilterId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b87.','Y','N',null,'N','ScreenFilterHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b87.','Y','N',null,'N','ScreenFilterHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b87.','Y','N',null,'N','ScreenFilterHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmScreenObj10ById') AND type='P')
DROP PROCEDURE dbo.GetAdmScreenObj10ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmScreenObj10ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.ScreenObj b14'
SELECT @sClause = 'SELECT ScreenObjId14=b14.ScreenObjId'
+ ', MasterTable14=b14.MasterTable'
+ ', RequiredValid14=b14.RequiredValid'
+ ', ColumnWrap14=b14.ColumnWrap'
+ ', GridGrpCd14=b14.GridGrpCd'
+ ', HideOnTablet14=b14.HideOnTablet'
+ ', HideOnMobile14=b14.HideOnMobile'
+ ', RefreshOnCUD14=b14.RefreshOnCUD'
+ ', TrimOnEntry14=b14.TrimOnEntry'
+ ', IgnoreConfirm14=b14.IgnoreConfirm'
+ ', ColumnJustify14=b14.ColumnJustify'
+ ', ColumnSize14=b14.ColumnSize'
+ ', ColumnHeight14=b14.ColumnHeight'
+ ', ResizeWidth14=b14.ResizeWidth'
+ ', ResizeHeight14=b14.ResizeHeight'
+ ', SortOrder14=b14.SortOrder'
+ ', ScreenId14=b14.ScreenId'
+ ', GroupRowId14=b14.GroupRowId'
+ ', GroupColId14=b14.GroupColId'
+ ', ColumnId14=b14.ColumnId'
+ ', ColumnName14=b14.ColumnName'
+ ', DisplayModeId14=b14.DisplayModeId'
+ ', DdlKeyColumnId14=b14.DdlKeyColumnId'
+ ', DdlRefColumnId14=b14.DdlRefColumnId'
+ ', DdlSrtColumnId14=b14.DdlSrtColumnId'
+ ', DdlAdnColumnId14=b14.DdlAdnColumnId'
+ ', DdlFtrColumnId14=b14.DdlFtrColumnId'
+ ', ColumnLink14=b14.ColumnLink'
+ ', DtlLstPosId14=b14.DtlLstPosId'
+ ', LabelVertical14=b14.LabelVertical'
+ ', LabelCss14=b14.LabelCss'
+ ', ContentCss14=b14.ContentCss'
+ ', DefaultValue14=b14.DefaultValue'
+ ', HyperLinkUrl14=b14.HyperLinkUrl'
+ ', DefAfter14=b14.DefAfter'
+ ', SystemValue14=b14.SystemValue'
+ ', DefAlways14=b14.DefAlways'
+ ', AggregateCd14=b14.AggregateCd'
+ ', GenerateSp14=b14.GenerateSp'
+ ', MaskValid14=b14.MaskValid'
+ ', RangeValidType14=b14.RangeValidType'
+ ', RangeValidMax14=b14.RangeValidMax'
+ ', RangeValidMin14=b14.RangeValidMin'
+ ', MatchCd14=b14.MatchCd'
SELECT @wClause = 'WHERE b14.ScreenObjId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmScreenTab54ById') AND type='P')
DROP PROCEDURE dbo.GetAdmScreenTab54ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmScreenTab54ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.ScreenTab b19'
SELECT @sClause = 'SELECT ScreenTabId19=b19.ScreenTabId'
+ ', ScreenId19=b19.ScreenId'
+ ', TabFolderName19=b19.TabFolderName'
+ ', TabFolderOrder19=b19.TabFolderOrder'
SELECT @wClause = 'WHERE b19.ScreenTabId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmScreenTab54DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmScreenTab54DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmScreenTab54DtlById
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause = 'FROM dbo.ScreenTabHlp b80' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture)x621 ON b80.CultureId = x621.CultureId'
SELECT @sClause = 'SELECT ScreenTabHlpId80=b80.ScreenTabHlpId'
+ ', CultureId80=x621.CultureId'
+ ', CultureId80Text=x621.CultureTypeDesc'
+ ', TabFolderName80=b80.TabFolderName'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b80.ScreenTabId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b80.','Y','N',null,'N','ScreenTabHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b80.','Y','N',null,'N','ScreenTabHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmServerRule14ById') AND type='P')
DROP PROCEDURE dbo.GetAdmServerRule14ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmServerRule14ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.ServerRule b24'
SELECT @sClause = 'SELECT ServerRuleId24=b24.ServerRuleId'
+ ', RuleName24=b24.RuleName'
+ ', RuleDescription24=b24.RuleDescription'
+ ', RuleTypeId24=b24.RuleTypeId'
+ ', ScreenId24=b24.ScreenId'
+ ', RuleOrder24=b24.RuleOrder'
+ ', ProcedureName24=b24.ProcedureName'
+ ', ParameterNames24=b24.ParameterNames'
+ ', ParameterTypes24=b24.ParameterTypes'
+ ', CallingParams24=b24.CallingParams'
+ ', MasterTable24=b24.MasterTable'
+ ', OnAdd24=b24.OnAdd'
+ ', OnUpd24=b24.OnUpd'
+ ', OnDel24=b24.OnDel'
+ ', BeforeCRUD24=b24.BeforeCRUD'
+ ', RuleCode24=b24.RuleCode'
+ ', ModifiedBy24=b24.ModifiedBy'
+ ', ModifiedOn24=b24.ModifiedOn'
+ ', LastGenDt24=b24.LastGenDt'
SELECT @wClause = 'WHERE b24.ServerRuleId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmServerRule14DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmServerRule14DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetAdmServerRule14DtlById]
 @ScreenId		Int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@oClause		varchar(8000)
	,@wClause		varchar(8000)
SELECT @sClause = 'SELECT ServerRuleId24=b24.ServerRuleId, RuleTypeId24=x188.RuleTypeId, RuleTypeId24Text=x188.RuleDesc, MasterTable24=b24.MasterTable, RuleName24=b24.RuleName, RuleDescription24=b24.RuleDescription, ExecOrder24=b24.ExecOrder, ProcedureName24=b24.ProcedureName, ParameterNames24=b24.ParameterNames, ParameterTypes24=b24.ParameterTypes, CallingParams24=b24.CallingParams, OnAdd24=b24.OnAdd, OnUpd24=b24.OnUpd, OnDel24=b24.OnDel, BeforeCRUD24=b24.BeforeCRUD'
SELECT @fClause = 'FROM dbo.ServerRule b24 INNER JOIN (SELECT DISTINCT RuleTypeId,RuleDesc FROM RODesign.dbo.CtRuleType)x188 ON b24.RuleTypeId = x188.RuleTypeId'
SELECT @oClause = 'ORDER BY b24.ExecOrder'
SELECT @wClause = 'WHERE b24.ScreenId = ' + isnull(convert(varchar,@ScreenId),'null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmStaticCs115ById') AND type='P')
DROP PROCEDURE dbo.GetAdmStaticCs115ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmStaticCs115ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.StaticCs b260'
SELECT @sClause = 'SELECT StaticCsId260=b260.StaticCsId'
+ ', StaticCsNm260=b260.StaticCsNm'
+ ', StyleDef260=b260.StyleDef'
SELECT @wClause = 'WHERE b260.StaticCsId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmStaticJs116ById') AND type='P')
DROP PROCEDURE dbo.GetAdmStaticJs116ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmStaticJs116ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.StaticJs b261'
SELECT @sClause = 'SELECT StaticJsId261=b261.StaticJsId'
+ ', StaticJsNm261=b261.StaticJsNm'
+ ', ScriptDef261=b261.ScriptDef'
SELECT @wClause = 'WHERE b261.StaticJsId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmStaticPg114ById') AND type='P')
DROP PROCEDURE dbo.GetAdmStaticPg114ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmStaticPg114ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.StaticPg b259'
SELECT @sClause = 'SELECT StaticPgId259=b259.StaticPgId'
+ ', StaticPgNm259=b259.StaticPgNm'
+ ', StaticPgTitle259=b259.StaticPgTitle'
+ ', MasterPgFile259=b259.MasterPgFile'
+ ', StaticCsId259=b259.StaticCsId'
+ ', StaticJsId259=b259.StaticJsId'
+ ', StaticPgUrl259=b259.StaticPgUrl'
+ ', StaticPgUrl259URL=b259.StaticPgUrl'
+ ', StaticMeta259=b259.StaticMeta'
+ ', StaticPgHtm259=b259.StaticPgHtm'
+ ', StaticPgCss259=b259.StaticPgCss'
+ ', StaticPgJs259=b259.StaticPgJs'
SELECT @wClause = 'WHERE b259.StaticPgId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmTbdRule113ById') AND type='P')
DROP PROCEDURE dbo.GetAdmTbdRule113ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmTbdRule113ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.TbdRule b254'
SELECT @sClause = 'SELECT TbdRuleId254=b254.TbdRuleId'
+ ', ScreenId254=b254.ScreenId'
+ ', TbdRuleName254=b254.TbdRuleName'
+ ', TbdRuleDesc254=b254.TbdRuleDesc'
SELECT @wClause = 'WHERE b254.TbdRuleId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmWebRule80ById') AND type='P')
DROP PROCEDURE dbo.GetAdmWebRule80ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmWebRule80ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.WebRule b128'
SELECT @sClause = 'SELECT WebRuleId128=b128.WebRuleId'
+ ', RuleName128=b128.RuleName'
+ ', RuleDescription128=b128.RuleDescription'
+ ', RuleTypeId128=b128.RuleTypeId'
+ ', ScreenId128=b128.ScreenId'
+ ', ScreenObjId128=b128.ScreenObjId'
+ ', ButtonTypeId128=b128.ButtonTypeId'
+ ', EventId128=b128.EventId'
+ ', WebRuleProg128=b128.WebRuleProg'
+ ', ReactEventId128=b128.ReactEventId'
+ ', ReactRuleProg128=b128.ReactRuleProg'
+ ', ReduxEventId128=b128.ReduxEventId'
+ ', ReduxRuleProg128=b128.ReduxRuleProg'
+ ', ServiceEventId128=b128.ServiceEventId'
+ ', ServiceRuleProg128=b128.ServiceRuleProg'
+ ', AsmxEventId128=b128.AsmxEventId'
+ ', AsmxRuleProg128=b128.AsmxRuleProg'
SELECT @wClause = 'WHERE b128.WebRuleId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmWizardObj49ById') AND type='P')
DROP PROCEDURE dbo.GetAdmWizardObj49ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmWizardObj49ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.Wizard b71'
SELECT @sClause = 'SELECT WizardId71=b71.WizardId'
+ ', WizardTypeId71=b71.WizardTypeId'
+ ', MasterTableId71=b71.MasterTableId'
+ ', WizardTitle71=b71.WizardTitle'
+ ', ProgramName71=b71.ProgramName'
+ ', DefWorkSheet71=b71.DefWorkSheet'
+ ', DefStartRow71=b71.DefStartRow'
+ ', DefOverwrite71=b71.DefOverwrite'
+ ', OvwrReadonly71=b71.OvwrReadonly'
+ ', AuthRequired71=b71.AuthRequired'
SELECT @wClause = 'WHERE b71.WizardId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmWizardObj49DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmWizardObj49DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmWizardObj49DtlById
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause = 'FROM dbo.WizardObj b72' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc FROM dbo.DbColumn)x551 ON b72.ColumnId = x551.ColumnId'
SELECT @sClause = 'SELECT WizardObjId72=b72.WizardObjId'
+ ', ColumnId72=x551.ColumnId'
+ ', ColumnId72Text=x551.ColumnDesc'
+ ', TabIndex72=b72.TabIndex'
SELECT @oClause = 'ORDER BY b72.TabIndex'
SELECT @wClause = 'WHERE b72.WizardId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmWizardRule50ById') AND type='P')
DROP PROCEDURE dbo.GetAdmWizardRule50ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetAdmWizardRule50ById
 @KeyId1		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
SELECT @fClause = 'FROM dbo.WizardRule b73'
SELECT @sClause = 'SELECT WizardRuleId73=b73.WizardRuleId'
+ ', RuleName73=b73.RuleName'
+ ', RuleDescription73=b73.RuleDescription'
+ ', RuleTypeId73=b73.RuleTypeId'
+ ', WizardId73=b73.WizardId'
+ ', RuleOrder73=b73.RuleOrder'
+ ', ProcedureName73=b73.ProcedureName'
+ ', BeforeCRUD73=b73.BeforeCRUD'
SELECT @wClause = 'WHERE b73.WizardRuleId' + isnull('='+@KeyId1,' is null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdmWizardRule50DtlById') AND type='P')
DROP PROCEDURE dbo.GetAdmWizardRule50DtlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetAdmWizardRule50DtlById]
 @WizardId		Int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@oClause		varchar(8000)
	,@wClause		varchar(8000)
SELECT @sClause = 'SELECT WizardRuleId73=b73.WizardRuleId, RuleTypeId73=x556.RuleTypeId, RuleTypeId73Text=x556.RuleDesc, RuleName73=b73.RuleName, RuleDescription73=b73.RuleDescription, ExecOrder73=b73.ExecOrder, ProcedureName73=b73.ProcedureName, BeforeCRUD73=b73.BeforeCRUD'
SELECT @fClause = 'FROM dbo.WizardRule b73 INNER JOIN (SELECT DISTINCT RuleTypeId,RuleDesc FROM RODesign.dbo.CtRuleType)x556 ON b73.RuleTypeId = x556.RuleTypeId'
SELECT @oClause = 'ORDER BY b73.ExecOrder'
SELECT @wClause = 'WHERE b73.WizardId = ' + isnull(convert(varchar,@WizardId),'null')
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAdvRule') AND type='P')
DROP PROCEDURE dbo.GetAdvRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[GetAdvRule]
 @screenId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
		,@fClause	varchar(8000)
		,@wClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.RuleLayerCd, a.RuleName, a.RmFuncProc, a.AdvRuleProg'
SELECT @fClause = 'FROM dbo.AdvRule a'
SELECT @wClause = 'WHERE a.ScreenId = ' + CONVERT(varchar,@screenId)
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAllowSelect') AND type='P')
DROP PROCEDURE dbo.GetAllowSelect
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetAllowSelect]
 @ReportId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
SELECT AllowSelect, AuthRequired FROM dbo.Report WHERE ReportId = @ReportId
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAppVersion') AND type='P')
DROP PROCEDURE dbo.GetAppVersion
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetAppVersion]
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
SELECT replace(max(AppInfoDesc),space(1),space(0)) FROM dbo.AppInfo WHERE VersionDt is not null
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAuthCol') AND type='P')
DROP PROCEDURE dbo.GetAuthCol
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[GetAuthCol]
 @ScreenId		int
,@Usrs			varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors	varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId	int
,@currProjectId	int
,@rowAuthoritys varchar(1000)
/* WITH ENCRYPTION */
AS
DECLARE	 @ScreenObjId	int
		,@PermKeyDesc	varchar(50)
		,@PermId		int
		,@ColVisible	char(1)
		,@ColReadOnly	char(1)
		,@upd			char(1)
SET NOCOUNT ON
DECLARE @rowAuth table (AllowAdd char(1) NULL, AllowUpd char(1) NULL, AllowDel char(1) NULL, ViewOnly char(1) NULL)
INSERT INTO @rowAuth EXEC dbo.GetAuthRow @screenId,@rowAuthoritys 
DECLARE @DfltColReadOnly char(1)
SELECT @DfltColReadOnly = CASE WHEN AllowUpd='Y' OR AllowAdd = 'Y' THEN 'N' ELSE 'Y' END FROM @rowAuth 
IF object_id('tempdb.dbo.#tbl') is not null DROP TABLE dbo.#tbl
CREATE TABLE #tbl (tid smallint IDENTITY(1,1) not null, ScreenObjId int not null, MasterTable char(1) not null, DisplayName varchar(50) not null
	, DisplayMode varchar(50) not null, ColVisible char(1) not null, ColReadOnly char(1) not null, ColName varchar(100) not null)
INSERT #tbl (ScreenObjId, MasterTable, DisplayName, DisplayMode, ColVisible, ColReadOnly, ColName)
	SELECT b.ScreenObjId, b.MasterTable, DisplayName = c.TypeName, DisplayMode = c.TypeDesc, 'Y'
	, ColReadOnly = CASE 
		WHEN c.TypeName IN ('HyperLink','Button','ImageButton') THEN 'N' 
		WHEN s.ViewOnly = 'Y' OR (s.ViewOnly IN ('G','T') AND c.TypeName IN ('I1','I3')) OR (s.ViewOnly = 'G' AND b.MasterTable='N') OR (s.ViewOnly='T' AND b.MasterTable='Y') THEN 'Y' 
		WHEN c.TypeDesc = 'Label' THEN 'Y' 
		ELSE ISNULL(@DfltColReadOnly,'N') END
	, ColName = CASE WHEN c.TypeName NOT IN ('DropDownList','ComboBox','ListBox','RadioButtonList')
		THEN b.ColumnName + isnull(convert(varchar,d.TableId),'')
		ELSE b.ColumnName + isnull(convert(varchar,d.TableId),'') + 'Text' END
	FROM dbo.ScreenObj b
	INNER JOIN dbo.Screen s ON b.ScreenId = s.ScreenId
	INNER JOIN RODesign.dbo.CtDisplayType c ON b.DisplayModeId = c.TypeId
	LEFT OUTER JOIN dbo.DbColumn d ON b.ColumnId = d.ColumnId
	WHERE b.ScreenId = @ScreenId
	ORDER BY b.TabIndex
DECLARE cur1 CURSOR FAST_FORWARD FOR
	SELECT a.ScreenObjId, b.PermKeyDesc, a.PermId, a.ColVisible, a.ColReadOnly
	FROM dbo.ColOvrd a LEFT OUTER JOIN RODesign.dbo.VwPermKey b ON a.PermKeyId = b.PermKeyId
	WHERE a.ScreenId = @ScreenId
	ORDER BY a.ScreenObjId, a.Priority DESC
FOR READ ONLY
OPEN cur1 FETCH NEXT FROM cur1 INTO @ScreenObjId, @PermKeyDesc, @PermId, @ColVisible, @ColReadOnly
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @upd = 'N'
	IF @PermKeyDesc is null SELECT @upd = 'Y'
	ELSE IF @PermKeyDesc = 'UsrGroup'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@UsrGroups+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Company'
		BEGIN  IF @PermId = @currCompanyId OR charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Companys+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Project'
		BEGIN  IF @PermId = @currProjectId OR charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Projects+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Culture'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Cultures+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Usr'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Usrs+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Customer'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Customers+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Vendor'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Vendors+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Member'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Members+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Investor'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Investors+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Agent'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Agents+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Broker'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Brokers+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Borrower'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Borrowers+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Guarantor'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Guarantors+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Lender'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Lenders+nchar(191)) > 0 SELECT @upd = 'Y' END
	IF @upd = 'Y' UPDATE #tbl SET ColVisible = @ColVisible, ColReadOnly = @ColReadOnly WHERE ScreenObjId = @ScreenObjId
	FETCH NEXT FROM cur1 INTO @ScreenObjId, @PermKeyDesc, @PermId, @ColVisible, @ColReadOnly
END
CLOSE cur1 DEALLOCATE cur1
SELECT MasterTable, DisplayName, DisplayMode, ColVisible, ColReadOnly, ColName FROM #tbl ORDER BY tid
DROP TABLE dbo.#tbl
RETURN 0

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAuthExp') AND type='P')
DROP PROCEDURE dbo.GetAuthExp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[GetAuthExp]
 @ScreenId		int
,@CultureId		smallint
,@Usrs			varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors	varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId	int
,@currProjectId	int
/* WITH ENCRYPTION */
AS
DECLARE	 @ScreenObjId	int
		,@PermKeyDesc	varchar(50)
		,@PermId		int
		,@ColExport		char(1)
		,@upd			char(1)
		,@DefCultureId	smallint
		,@ColumnHeader	nvarchar(max)
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF object_id('tempdb.dbo.#exp') is not null DROP TABLE dbo.#exp
CREATE TABLE #exp (tid smallint IDENTITY(1,1) not null, ScreenObjId int not null, ColExport char(1) not null, ColumnHeader nvarchar(max) null)
INSERT #exp (ScreenObjId, ColExport, ColumnHeader)
	SELECT b.ScreenObjId, 'Y', isnull(h2.ColumnHeader,h1.ColumnHeader)
	FROM dbo.ScreenObj b
	INNER JOIN dbo.ScreenObjHlp h1 ON b.ScreenObjId = h1.ScreenObjId AND h1.CultureId = @DefCultureId
	LEFT OUTER JOIN dbo.ScreenObjHlp h2 ON b.ScreenObjId = h2.ScreenObjId AND h2.CultureId = @CultureId
	WHERE b.ScreenId = @ScreenId
	ORDER BY b.TabIndex
DECLARE cur1 CURSOR FAST_FORWARD FOR
	SELECT a.ScreenObjId, b.PermKeyDesc, a.PermId, a.ColExport, a.ColumnHeader
	FROM dbo.ColOvrd a LEFT OUTER JOIN RODesign.dbo.VwPermKey b ON a.PermKeyId = b.PermKeyId
	WHERE a.ScreenId = @ScreenId
	ORDER BY a.ScreenObjId, a.Priority DESC
FOR READ ONLY
OPEN cur1 FETCH NEXT FROM cur1 INTO @ScreenObjId, @PermKeyDesc, @PermId, @ColExport, @ColumnHeader
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @upd = 'N'
	IF @PermKeyDesc is null SELECT @upd = 'Y'
	ELSE IF @PermKeyDesc = 'UsrGroup'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@UsrGroups+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Company'
		BEGIN  IF @PermId = @currCompanyId OR charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Companys+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Project'
		BEGIN  IF @PermId = @currProjectId OR charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Projects+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Culture'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Cultures+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Usr'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Usrs+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Customer'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Customers+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Vendor'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Vendors+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Member'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Members+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Investor'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Investors+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Agent'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Agents+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Broker'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Brokers+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Borrower'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Borrowers+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Guarantor'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Guarantors+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Lender'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Lenders+nchar(191)) > 0 SELECT @upd = 'Y' END
	IF @upd = 'Y' UPDATE #exp SET ColExport = @ColExport, ColumnHeader = isnull(@ColumnHeader,ColumnHeader)
		WHERE ScreenObjId = @ScreenObjId
	FETCH NEXT FROM cur1 INTO @ScreenObjId, @PermKeyDesc, @PermId, @ColExport, @ColumnHeader
END
CLOSE cur1 DEALLOCATE cur1
SELECT ScreenObjId, ColExport, ColumnHeader FROM #exp ORDER BY tid
DROP TABLE dbo.#exp
RETURN 0



 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetAuthRow') AND type='P')
DROP PROCEDURE dbo.GetAuthRow
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





-- AllowSel not selected here for security reasons.
CREATE PROCEDURE [dbo].[GetAuthRow]
 @ScreenId		int
,@RowAuthoritys	varchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @RowAuthorityId	smallint
	,@AllowAdd		char(1)
	,@AllowUpd		char(1)
	,@AllowDel		char(1)
	,@Add			char(1)
	,@Upd			char(1)
	,@Del			char(1)
SELECT @AllowAdd = 'N', @AllowUpd = 'N', @AllowDel = 'N'
IF EXISTS (SELECT 1 FROM dbo.Screen s INNER JOIN RODesign.dbo.CtScreenType c ON c.ScreenTypeId = s.ScreenTypeId
	WHERE s.ScreenId = @ScreenId AND (s.ViewOnly = 'N' OR (s.ViewOnly IN ('G','T') AND c.ScreenTypeName='I2')))
BEGIN
	WHILE @RowAuthoritys <> '' AND datalength(@RowAuthoritys) > 0
	BEGIN
		EXEC RODesign.dbo.Pop1SmallInt @RowAuthoritys OUTPUT, @RowAuthorityId OUTPUT
		IF NOT EXISTS (SELECT 1 FROM dbo.RowOvrd WHERE ScreenId = @screenId and RowAuthId = @RowAuthorityId)
			SELECT @Add = AllowAdd, @Upd = AllowUpd, @Del = AllowDel FROM RODesign.dbo.VwRowAuth WHERE RowAuthId = @RowAuthorityId
		ELSE
			SELECT @Add = AllowAdd, @Upd = AllowUpd, @Del = AllowDel FROM dbo.RowOvrd WHERE ScreenId = @ScreenId and RowAuthId = @RowAuthorityId
		IF @Add = 'Y' AND @AllowAdd = 'N' SELECT @AllowAdd = 'Y'
		IF @Upd = 'Y' AND @AllowUpd = 'N' SELECT @AllowUpd = 'Y'
		IF @Del = 'Y' AND @AllowDel = 'N' SELECT @AllowDel = 'Y'
	END
END
SELECT AllowAdd = @AllowAdd, AllowUpd = @AllowUpd, AllowDel = @AllowDel, ViewOnly FROM Screen s WHERE ScreenId = @ScreenId
RETURN 0  

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetButtonHlp') AND type='P')
DROP PROCEDURE dbo.GetButtonHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[GetButtonHlp]
 @ScreenId	int
,@ReportId	int
,@WizardId	int
,@CultureId	smallint
/* WITH ENCRYPTION */
AS
DECLARE	 @i1Clause		varchar(4000)
		,@i2Clause		varchar(4000)
		,@u0Clause		varchar(4000)
		,@u1Clause		varchar(4000)
		,@u2Clause		varchar(4000)
		,@DefCultureId	smallint
		,@Visible		varchar(50)
SET NOCOUNT ON
-- Default button visibility:
IF @ScreenId <> 0 SELECT @Visible = CASE WHEN ViewOnly = 'Y' THEN 'ViewOnlyVisible' ELSE 'ButtonVisible' END FROM dbo.Screen WHERE ScreenId = @ScreenId
IF object_id('tempdb.dbo.#bh') is not null DROP TABLE dbo.#bh
CREATE TABLE #bh (tid smallint IDENTITY(1,1) not null, ButtonTypeId tinyint not null, ButtonTypeName varchar(50) not null
	, ButtonName nvarchar(200) null, ButtonLongNm nvarchar(400) null
	, ButtonToolTip nvarchar(400) null, ButtonVisible char(1) not null, TopVisible char(1) not null, RowVisible char(1) not null, BotVisible char(1) not null)
SELECT @i1Clause = ' INSERT INTO #bh (ButtonTypeId,ButtonTypeName,ButtonName,ButtonLongNm,ButtonToolTip,ButtonVisible,TopVisible,RowVisible,BotVisible)'
+ ' SELECT a.ButtonTypeId,b.ButtonTypeName,a.ButtonName,a.ButtonLongNm,a.ButtonToolTip,b.' + isnull(@Visible,'ButtonVisible')
+ ',CASE WHEN b.' + isnull(@Visible,'TopVisible') + ' = ''N'' THEN ''N'' ELSE b.TopVisible END'
+ ',CASE WHEN b.' + isnull(@Visible,'RowVisible') + ' = ''N'' THEN ''N'' ELSE b.RowVisible END'
+ ',CASE WHEN b.' + isnull(@Visible,'BotVisible') + ' = ''N'' THEN ''N'' ELSE b.BotVisible END'
+ ' FROM RODesign.dbo.CtButtonHlp a INNER JOIN RODesign.dbo.CtButtonType b ON a.ButtonTypeId = b.ButtonTypeId WHERE b.ObjectType='
IF @ScreenId <> 0 SELECT @i1Clause = @i1Clause + '''S'''
	ELSE IF @ReportId <> 0 SELECT @i1Clause = @i1Clause + '''R'''
	ELSE SELECT @i1Clause = @i1Clause + '''W'''
SELECT @i1Clause = @i1Clause + ' AND a.CultureId=', @i2Clause = convert(varchar,@CultureId)

-- Audit button visibility:
IF EXISTS (SELECT 1 FROM dbo.Screen WHERE ScreenId = @ScreenId AND GenAudit = 'Y')
	SELECT @u0Clause = ' UPDATE #bh SET ButtonVisible = ''Y'', TopVisible = ''L'' WHERE ButtonTypeName = ''Audit'''
ELSE
	SELECT @u0Clause = ''

-- Button override:
SELECT @u1Clause = ' UPDATE #bh SET'
+ ' ButtonName = case when b.ButtonName is not null and b.ButtonName <> '''' then b.ButtonName else #bh.ButtonName end'
+ ',ButtonLongNm = case when b.ButtonLongNm is not null and b.ButtonLongNm <> '''' then b.ButtonLongNm else #bh.ButtonLongNm end'
+ ',ButtonToolTip = case when b.ButtonToolTip is not null and b.ButtonToolTip <> '''' then b.ButtonToolTip else #bh.ButtonToolTip end'
+ ',ButtonVisible = b.ButtonVisible,TopVisible = b.TopVisible,RowVisible = b.RowVisible,BotVisible = b.BotVisible'
+ ' FROM dbo.ButtonHlp b WHERE b.'
IF @ScreenId <> 0 SELECT @u1Clause = @u1Clause + 'ScreenId=' + convert(varchar,@ScreenId)
	ELSE IF @ReportId <> 0 SELECT @u1Clause = @u1Clause + 'ReportId=' + convert(varchar,@ReportId)
	ELSE SELECT @u1Clause = @u1Clause + 'WizardId=' + convert(varchar,@WizardId)
SELECT @u1Clause = @u1Clause + ' AND #bh.ButtonTypeId=b.ButtonTypeId AND b.CultureId=', @u2Clause = convert(varchar,@CultureId)
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF @CultureId <> @DefCultureId
BEGIN
	SELECT @i2Clause = @i2Clause + @i1Clause + convert(varchar,@DefCultureId)
	+ ' AND NOT EXISTS (SELECT ''true'' FROM RODesign.dbo.CtButtonHlp c WHERE c.ButtonTypeId=a.ButtonTypeId AND c.CultureId=' + convert(varchar,@CultureId) + ')'
	SELECT @u2Clause = @u2Clause + @u1Clause + convert(varchar,@DefCultureId)
	+ ' AND NOT EXISTS (SELECT ''true'' FROM dbo.ButtonHlp c WHERE c.'
	IF @ScreenId <> 0 SELECT @u2Clause = @u2Clause + 'ScreenId=' + convert(varchar,@ScreenId)
		ELSE IF @ReportId <> 0 SELECT @u2Clause = @u2Clause + 'ReportId=' + convert(varchar,@ReportId)
		ELSE SELECT @u2Clause = @u2Clause + 'WizardId=' + convert(varchar,@WizardId)
	SELECT @u2Clause = @u2Clause + ' AND c.ButtonTypeId=b.ButtonTypeId AND c.CultureId=' + convert(varchar,@CultureId) + ')'
END
EXEC (@i1Clause + @i2Clause + @u0Clause + @u1Clause + @u2Clause)
/* Assuming ViewItem button is visible to all screens, hide it when screen type is TabFolder Only */
UPDATE bh SET bh.ButtonVisible = CASE WHEN s.ScreenTypeId = 5 THEN 'N' ELSE ButtonVisible END
	FROM #bh bh
	INNER JOIN Screen s ON s.ScreenId = @ScreenId
	WHERE bh.ButtonTypeName = 'DrillDown'
SELECT * FROM #bh ORDER BY tid
DROP table dbo.#bh
RETURN 0

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetClientRule') AND type='P')
DROP PROCEDURE dbo.GetClientRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetClientRule]
 @ScreenId	int
,@ReportId	int
,@CultureId	smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @DefCultureId		smallint
	,@SrpEvent		varchar(50)
	,@SrpName		varchar(500)
	,@SrpParam		varchar(300)
	,@MasterTable		char(1)
	,@ScrObjColName		varchar(50)
	,@ScrCriColName		varchar(50)
	,@RptCriColName		varchar(50)
	,@ScrObjTableId		int
	,@ScreenCriId		int
	,@ScriptName		varchar(500)
	,@ParamCall		varchar(500)
	,@ParamName		varchar(500)
	,@ParamType		varchar(500)
	,@ParamInGrid	varchar(500)
	,@prm			varchar(500)
	,@ii			int
	,@pos			int
	,@len			int
	,@ColName		varchar(30)
	,@ClientRuleProg nvarchar(max)
IF object_id('tempdb.dbo.#rul') is not null DROP TABLE dbo.#rul
CREATE TABLE #rul (tid smallint IDENTITY(1,1) not null, ScreenObjHlpId int null,ScreenCriHlpId int null,ReportCriHlpId int null,ClientScript smallint null,UserScriptEvent varchar(50) null,UserScriptName varchar(500) null,ScriptParam varchar(300) null,ClientRuleProg nvarchar(max),RuleMthodId int,RuleCntTypeId int)
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF @ScreenId IS NOT NULL AND @ScreenId <> 0
BEGIN
	INSERT #rul (ScreenObjHlpId,ScreenCriHlpId,ReportCriHlpId,ClientScript,UserScriptEvent,UserScriptName,ScriptParam,ClientRuleProg,RuleMthodId,RuleCntTypeId)
		SELECT ScreenObjHlpId,ScreenCriHlpId,ReportCriHlpId,ClientScript,UserScriptEvent,UserScriptName,ScriptParam,ClientRuleProg,RuleMethodId,RuleCntTypeId
		FROM dbo.ClientRule WHERE ScreenId = @ScreenId AND CultureId = @CultureId
	IF @CultureId <> @DefCultureId
		INSERT #rul (ScreenObjHlpId,ScreenCriHlpId,ReportCriHlpId,ClientScript,UserScriptEvent,UserScriptName,ScriptParam,ClientRuleProg,RuleMthodId,RuleCntTypeId)
			SELECT a.ScreenObjHlpId,ScreenCriHlpId,ReportCriHlpId,a.ClientScript,a.UserScriptEvent,a.UserScriptName,a.ScriptParam,a.ClientRuleProg,RuleMethodId,RuleCntTypeId
			FROM dbo.ClientRule a WHERE a.ScreenId = @ScreenId AND a.CultureId = @DefCultureId
			AND ((NOT EXISTS (SELECT 'true' FROM #rul b WHERE a.ScreenObjHlpId = b.ScreenObjHlpId OR a.ScreenCriHlpId = b.ScreenCriHlpId) AND RuleMethodId NOT IN (1))
				 OR
				 (RuleMethodId = 1))
END
ELSE
BEGIN
	INSERT #rul (ScreenObjHlpId,ScreenCriHlpId,ReportCriHlpId,ClientScript,UserScriptEvent,UserScriptName,ScriptParam,ClientRuleProg)
		SELECT ScreenObjHlpId,ScreenCriHlpId,ReportCriHlpId,ClientScript,UserScriptEvent,UserScriptName,ScriptParam,ClientRuleProg
		FROM dbo.ClientRule WHERE ReportId = @ReportId AND CultureId = @CultureId
	IF @CultureId <> @DefCultureId
		INSERT #rul (ScreenObjHlpId,ScreenCriHlpId,ReportCriHlpId,ClientScript,UserScriptEvent,UserScriptName,ScriptParam,ClientRuleProg)
			SELECT a.ScreenObjHlpId,ScreenCriHlpId,ReportCriHlpId,a.ClientScript,a.UserScriptEvent,a.UserScriptName,a.ScriptParam,a.ClientRuleProg
			FROM dbo.ClientRule a WHERE a.ReportId = @ReportId AND a.CultureId = @DefCultureId
			AND NOT EXISTS (SELECT 'true' FROM #rul b WHERE a.ReportCriHlpId = b.ReportCriHlpId)
END
IF object_id('tempdb.dbo.#rst') is not null DROP TABLE dbo.#rst
CREATE TABLE #rst (tid smallint IDENTITY(1,1) not null, MasterTable char(1) null,ColName varchar(30) null,ScriptEvent varchar(50) not null,ScriptName varchar(500) not null,ParamName varchar(500) not null,ParamType varchar(500) not null, ClientRuleProg nvarchar(max), ParamInGrid varchar(500) not null)
DECLARE cur CURSOR FOR SELECT isnull(d1.MasterTable,'C'),d1.ColumnName,e2.ColumnName,d3.ColumnName,e1.TableId,d2.ScreenCriId,a.ScriptParam
		,CASE WHEN rct.RuleCntTypeId IS NOT NULL THEN rct.RuleCntTypeEvent WHEN a.UserScriptEvent IS NOT NULL AND ltrim(a.UserScriptEvent) <> '' THEN a.UserScriptEvent ELSE ISNULL(c.ClientScriptEvent,'') END
		,CASE WHEN a.UserScriptName IS NOT NULL AND ltrim(a.UserScriptName) <> '' THEN a.UserScriptName ELSE ISNULL(c.ClientScriptName,'') END
		,a.ClientRuleProg
	FROM #rul a
	LEFT OUTER JOIN dbo.ScreenObjHlp b1 ON a.ScreenObjHlpId = b1.ScreenObjHlpId
	LEFT OUTER JOIN dbo.ScreenObj d1 ON b1.ScreenObjId = d1.ScreenObjId
	LEFT OUTER JOIN dbo.DbColumn e1 ON d1.ColumnId = e1.ColumnId
	LEFT OUTER JOIN dbo.ScreenCriHlp b2 ON a.ScreenCriHlpId = b2.ScreenCriHlpId
	LEFT OUTER JOIN dbo.ScreenCri d2 ON b2.ScreenCriId = d2.ScreenCriId
	LEFT OUTER JOIN dbo.DbColumn e2 ON d2.ColumnId = e2.ColumnId
	LEFT OUTER JOIN dbo.ReportCriHlp b3 ON a.ReportCriHlpId = b3.ReportCriHlpId
	LEFT OUTER JOIN dbo.ReportCri d3 ON b3.ReportCriId = d3.ReportCriId
	LEFT OUTER JOIN RODesign.dbo.CtClientScript c ON a.ClientScript = c.ClientScriptId
	LEFT OUTER JOIN RODesign.dbo.CtRuleCntType rct ON rct.RuleCntTypeId = a.RuleCntTypeId AND a.RuleMthodId = 1 AND a.RuleCntTypeId IS NOT NULL
	ORDER BY d1.MasterTable,d1.ColumnName,e2.ColumnName,d3.ColumnName,e1.TableId,e2.TableId,CASE WHEN a.UserScriptEvent IS NOT NULL THEN a.UserScriptEvent ELSE c.ClientScriptEvent END
FOR READ ONLY
OPEN cur
FETCH NEXT FROM cur INTO @MasterTable,@ScrObjColName,@ScrCriColName,@RptCriColName,@ScrObjTableId,@ScreenCriId,@SrpParam,@SrpEvent,@SrpName,@ClientRuleProg
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @ii = 0, @ParamCall = '', @ParamName = '', @ParamType = '',@ParamInGrid=''

	IF @ScrObjColName IS NOT NULL SELECT @ColName = 'c' + @ScrObjColName + isnull(convert(varchar,@ScrObjTableId),'')
	ELSE IF @ScrCriColName IS NOT NULL SELECT @ColName = 'c' + @ScrCriColName + isnull(convert(varchar,@ScreenCriId),'') + 'In'
	ELSE SELECT @ColName = 'c' + @RptCriColName
	WHILE @SrpParam IS NOT NULL AND @SrpParam <> ''
	BEGIN
		SELECT @pos = CHARINDEX(',',@SrpParam)
		SELECT @len = DATALENGTH(@SrpParam)
		IF @pos = 0 SELECT @prm = RTRIM(@SrpParam), @SrpParam = ''
		ELSE SELECT @prm = RTRIM(SUBSTRING(@SrpParam,1,@pos-1)), @SrpParam = SUBSTRING(@SrpParam,@pos + 1,@len-@pos)
		IF @ParamCall <> '' SELECT @ParamCall = @ParamCall + ','
		IF lower(substring(@prm,1,1)) = '@'
		BEGIN
			IF @ii > 0 SELECT @ParamName = @ParamName + ',', @ParamType = @ParamType + ',', @ParamInGrid = @ParamInGrid + ','
			SELECT @ParamCall = @ParamCall + '@' + convert(varchar,@ii) + '@'
			IF @ScrObjColName IS NOT NULL
				SELECT @ParamName = @ParamName + 'c' + aa.ColumnName + isnull(convert(varchar,bb.TableId),''), @ParamType = @ParamType + cc.TypeName
						,@ParamInGrid = @ParamInGrid + CASE WHEN st.ScreenTypeName = 'I2' AND aa.MasterTable = 'N' THEN 'Y' ELSE 'N' END
				FROM dbo.ScreenObj aa
				INNER JOIN Screen s on s.ScreenId = aa.ScreenId
				INNER JOIN RODesign.dbo.CtScreenType st on st.ScreenTypeId = s.ScreenTypeId
				INNER JOIN RODesign.dbo.CtDisplayType cc ON aa.DisplayModeId = cc.TypeId
				LEFT OUTER JOIN dbo.DbColumn bb ON aa.ColumnId = bb.ColumnId
				WHERE (
					  aa.ScreenObjId = convert(int,CASE WHEN ISNUMERIC(substring(@prm,2,len(@prm)-1)) > 0 THEN substring(@prm,2,len(@prm)-1) ELSE -1 END)
					  OR
					  (aa.ColumnName + ISNULL(CONVERT(varchar,bb.TableId),'') = substring(@prm,3,len(@prm)-1) AND aa.ScreenId = @ScreenId)
					  )
			ELSE IF @ScrCriColName IS NOT NULL
				SELECT @ParamName = @ParamName + 'c' + bb.ColumnName + isnull(convert(varchar,bb.TableId),'') + 'In', @ParamType = @ParamType + cc.TypeName
						,@ParamInGrid = @ParamInGrid + 'N'
				FROM dbo.ScreenCri aa
				INNER JOIN RODesign.dbo.CtDisplayType cc ON aa.DisplayModeId = cc.TypeId
				LEFT OUTER JOIN dbo.DbColumn bb ON aa.ColumnId = bb.ColumnId
				WHERE aa.ScreenCriId = convert(int,substring(@prm,2,len(@prm)-1))
			ELSE
				SELECT @ParamName = @ParamName + 'c' + aa.ColumnName, @ParamType = @ParamType + cc.TypeName
						,@ParamInGrid = @ParamInGrid + 'N'
				FROM dbo.ReportCri aa
				INNER JOIN RODesign.dbo.CtDisplayType cc ON aa.DisplayModeId = cc.TypeId
				WHERE aa.ReportCriId = convert(int,substring(@prm,2,len(@prm)-1))
			SELECT @ii = @ii + 1
		END
		ELSE SELECT @ParamCall = @ParamCall + @prm
	END
	SELECT @ScriptName = CASE WHEN @ParamCall <> '' THEN replace(@SrpName,'()','('+@ParamCall+')') ELSE @SrpName END
	IF EXISTS (SELECT 'true' FROM #rst WHERE ColName = @ColName AND ScriptEvent = @SrpEvent)
		UPDATE #rst SET ScriptName = ScriptName + @ScriptName WHERE ColName = @ColName AND ScriptEvent = @SrpEvent
	ELSE
		INSERT #rst (MasterTable,ColName,ScriptEvent,ScriptName,ParamName,ParamType,ClientRuleProg, ParamInGrid)
			SELECT @MasterTable,@ColName,@SrpEvent,@ScriptName,@ParamName,@ParamType,@ClientRuleProg, @ParamInGrid
	FETCH NEXT FROM cur INTO @MasterTable,@ScrObjColName,@ScrCriColName,@RptCriColName,@ScrObjTableId,@ScreenCriId,@SrpParam,@SrpEvent,@SrpName,@ClientRuleProg
END
CLOSE cur
DEALLOCATE cur
SELECT MasterTable,ColName,ScriptEvent,ScriptName,ParamName,ParamType,ClientRuleProg,ParamInGrid FROM #rst ORDER BY tid
DROP TABLE dbo.#rul
DROP TABLE dbo.#rst
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetCriReportGrp') AND type='P')
DROP PROCEDURE dbo.GetCriReportGrp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetCriReportGrp]
 @GenPrefix		varchar(10)
,@reportId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @dClause		varchar(8000)
	,@xClause		varchar(8000)
	,@sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
SET NOCOUNT ON
SELECT @dClause = 'IF object_id(''tempdb.dbo.#tbl'') is not null DROP TABLE dbo.#tbl'
+ ' CREATE TABLE #tbl (tid smallint IDENTITY(1,1) not null, ReportGrpIndex varchar(50) not null, ParentGrpId int null, ReportGrpId int not null'
+ ', ContentVertical char(1) not null, LabelVertical char(1) not null, BorderWidth tinyint not null, GrpStyle varchar(200) not null)'
SELECT @xClause = 'INSERT #tbl (ReportGrpIndex, ParentGrpId, ReportGrpId, ContentVertical, LabelVertical, BorderWidth, GrpStyle)'
+ ' SELECT a.ReportGrpIndex, a.ParentGrpId, a.ReportGrpId, a.ContentVertical, a.LabelVertical, a.BorderWidth, isnull(a.GrpStyle,'''')'
+ ' FROM dbo.ReportGrp a'
+ ' WHERE a.ReportId is null'
+ ' AND (EXISTS (SELECT ''true'' FROM dbo.ReportGrp b'
+ ' WHERE b.ReportId = ' + CONVERT(varchar,@reportId) + ' AND a.ReportGrpId = b.ParentGrpId' + ')'
+ ' OR EXISTS (SELECT ''true'' FROM dbo.' +  @GenPrefix + 'ReportCri b'
+ ' WHERE b.ReportId = ' + CONVERT(varchar,@reportId) + ' AND a.ReportGrpId = b.ReportGrpId' + '))'
SELECT @sClause = 'INSERT #tbl (ReportGrpIndex, ParentGrpId, ReportGrpId, ContentVertical, LabelVertical, BorderWidth, GrpStyle)'
	+ ' SELECT ReportGrpIndex, ParentGrpId, ReportGrpId, ContentVertical, LabelVertical, BorderWidth, isnull(GrpStyle,'''')'
SELECT @fClause = 'FROM dbo.ReportGrp'
SELECT @wClause = 'WHERE ReportId = ' + CONVERT(varchar,@reportId)
SELECT @oClause = 'ORDER BY ReportGrpIndex'
SELECT @tClause = 'SELECT ParentGrpId, ReportGrpId, ContentVertical, LabelVertical, BorderWidth, GrpStyle FROM #tbl ORDER BY tid'
EXEC (@dClause + ' ' + @xClause + ' ' + @sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause + ' ' + @tClause + ' DROP TABLE dbo.#tbl')
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetCronJob') AND type='P')
DROP PROCEDURE dbo.GetCronJob
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetCronJob]
 @cronJobId	int=null
,@joblink	varchar(200)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
SELECT * FROM CronJob
WHERE 
(@cronJobId IS NULL OR CronJobId = @cronJobId) AND (@joblink IS NULL OR JobLink = @joblink)
ORDER BY NextRun
RETURN 0 



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetCurrFilter') AND type='P')
DROP PROCEDURE dbo.GetCurrFilter
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





/* DECLARE @wClause nvarchar(4000) EXEC RODesign.dbo.GetCurrFilter 1,'CompanyLs','Company','b1.','Y','Y',null,'UsrId',@wClause OUTPUT SELECT @wClause */
CREATE PROCEDURE [dbo].[GetCurrFilter]
 @CurrKey			int
,@PermKeyName		varchar(50)
,@TableName			varchar(500)
,@TableAbbr			varchar(50)
,@MultiValue		char(1)
,@ExternalTable		varchar(50)
,@PKeyColName		varchar(50)  
,@wClause			varchar(8000) OUTPUT
/* WITH ENCRYPTION */
AS
DECLARE	 @kk			varchar(1000)
		,@kkid			int
		,@wFilter		varchar(4000)
SET NOCOUNT ON
IF @CurrKey is not null AND @CurrKey <> 0
BEGIN
	SELECT @wFilter = ''
	IF @ExternalTable is not null AND @ExternalTable <> ''
		SELECT @wFilter = @wFilter + ' AND EXISTS (SELECT 1 FROM ' + @ExternalTable + ' x WHERE ' + @TableAbbr + @PKeyColName + ' = x.' + @PKeyColName + ' AND ('
	IF @MultiValue = 'N'
		SELECT @wFilter = @wFilter + case when @ExternalTable is not null AND @ExternalTable <> '' then 'x.' else ' AND (' + @tableAbbr + @PermKeyName + ' is null OR ' + @TableAbbr end
			+ @PermKeyName + ' IN ' + RODesign.dbo.fKeyHier(@TableName,@CurrKey)
	ELSE
	BEGIN
		IF @ExternalTable is null OR @ExternalTable = '' SELECT @wFilter = @wFilter +  ' AND (' + @tableAbbr + @PermKeyName + ' is null'
		SELECT @kk = RODesign.dbo.fKeyHier(@TableName,@CurrKey)
		SELECT @kk = replace(replace(replace(@kk,'(',space(0)),')',space(0)),',',nchar(191))
		WHILE @kk <> '' AND datalength(@kk) > 0
		BEGIN
			EXEC RODesign.dbo.Pop1Int @kk OUTPUT, @kkid OUTPUT
			SELECT @wFilter = @wFilter + ' OR charindex('',' + convert(varchar,@kkid)
				+ ','',replace(replace(' + case when @ExternalTable is not null AND @ExternalTable <> '' then 'x.' else @TableAbbr end
				+ @PermKeyName + ',''('','',''),'')'','','')) > 0'
		END
	END
	IF @ExternalTable is not null AND @ExternalTable <> '' SELECT @wFilter = @wFilter + '))' ELSE SELECT @wFilter = @wFilter + ')'
	SELECT @wClause = isnull(@wClause,space(0)) + @wFilter
END
RETURN 0 
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetCustomById') AND type='P')
DROP PROCEDURE dbo.GetCustomById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetCustomById]
 @customId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.CustomId,a.GenerateCm'
SELECT @fClause = 'FROM dbo.Custom a'
SELECT @wClause = 'WHERE a.CustomId = ' + CONVERT(varchar,@customId)
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetCustomList') AND type='P')
DROP PROCEDURE dbo.GetCustomList
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetCustomList]
 @searchTxt		nvarchar(25)
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
	,@oClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.CustomId, a.GenerateCm, CustomDesc = a.CustomDesc + CASE WHEN a.GenerateCm = ''N'' THEN '' (no gen)'' ELSE space(0) END'
SELECT @fClause = 'FROM dbo.Custom a'
IF (@searchTxt IS NULL OR @searchTxt = '')
	SELECT @wClause = ''
ELSE
	SELECT @wClause = 'WHERE a.CustomDesc + CASE WHEN a.GenerateCm = ''N'' THEN '' (no gen)'' ELSE space(0) END LIKE ''%' + LOWER(@searchTxt) + '%'''
SELECT @oClause = 'ORDER BY a.CustomDesc'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlAccessCd') AND type='P')
DROP PROCEDURE dbo.GetDdlAccessCd
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlAccessCd]
 @bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
	,@cc		varchar(8000)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @sClause = 'SELECT AccessCd = AccessCd, AccessCdText=AccessName, AccessSort'
SELECT @fClause = 'FROM RODesign.dbo.CtAccess'
SELECT @oClause = 'ORDER BY AccessSort'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'AccessCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlAccessCd3S1673') AND type='P')
DROP PROCEDURE dbo.GetDdlAccessCd3S1673
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





-- Do not delete. Used by AdmRptWiz:
CREATE PROCEDURE [dbo].[GetDdlAccessCd3S1673]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' AccessCd183=a228.AccessCd, AccessCd183Text=a228.AccessName'
SELECT @fClause = 'FROM RODesign.dbo.CtAccess a228'
SELECT @oClause = 'ORDER BY a228.AccessName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a228.AccessName LIKE N''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a228.AccessCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT AccessCd183=null, AccessCd183Text=null WHERE 1<>1
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlAggregateCd3S1238') AND type='P')
DROP PROCEDURE dbo.GetDdlAggregateCd3S1238
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlAggregateCd3S1238
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' AggregateCd14=a121.AggregateCd, AggregateCd14Text=a121.AggregateName, a121.AggregateSort'
SELECT @fClause = 'FROM RODesign.dbo.CtAggregate a121'
SELECT @oClause = 'ORDER BY a121.AggregateSort'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a121.AggregateName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a121.AggregateCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT AggregateCd14=null, AggregateCd14Text=null, AggregateSort=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlAggregateCd3S1652') AND type='P')
DROP PROCEDURE dbo.GetDdlAggregateCd3S1652
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlAggregateCd3S1652]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' AggregateCd184=a121.AggregateCd, AggregateCd184Text=a121.AggregateName'
SELECT @fClause = 'FROM RODesign.dbo.CtAggregate a121'
SELECT @oClause = 'ORDER BY a121.AggregateName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a121.AggregateName LIKE N''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a121.AggregateCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT AggregateCd184=null, AggregateCd184Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlAggregateCd3S1684') AND type='P')
DROP PROCEDURE dbo.GetDdlAggregateCd3S1684
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlAggregateCd3S1684]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' AggregateCd184=a121.AggregateCd, AggregateCd184Text=a121.AggregateName'
SELECT @fClause = 'FROM RODesign.dbo.CtAggregate a121'
SELECT @oClause = 'ORDER BY a121.AggregateName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a121.AggregateName LIKE N''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a121.AggregateCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT AggregateCd184=null, AggregateCd184Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlAlignment3S1235') AND type='P')
DROP PROCEDURE dbo.GetDdlAlignment3S1235
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlAlignment3S1235]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
	,@cc		varchar(8000)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @sClause = 'SELECT distinct Alignment117=a119.AlignmentCd, Alignment117Text=a119.AlignmentName'
SELECT @fClause = 'FROM RODesign.dbo.CtAlignment a119'
SELECT @oClause = 'ORDER BY a119.AlignmentName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a119.AlignmentCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlAllowSel3S201') AND type='P')
DROP PROCEDURE dbo.GetDdlAllowSel3S201
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlAllowSel3S201
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' AllowSel238=a124.SelectTypeCd, AllowSel238Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a124.SelectTypeName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT AllowSel238=null, AllowSel238Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlAndCondition3S1981') AND type='P')
DROP PROCEDURE dbo.GetDdlAndCondition3S1981
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlAndCondition3S1981
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' AndCondition239=a256.AndOrCd, AndCondition239Text=a256.AndOrName'
SELECT @fClause = 'FROM RODesign.dbo.CtAndOr a256'
SELECT @oClause = 'ORDER BY a256.AndOrName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a256.AndOrName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a256.AndOrCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT AndCondition239=null, AndCondition239Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlAppInfoId3S1352') AND type='P')
DROP PROCEDURE dbo.GetDdlAppInfoId3S1352
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlAppInfoId3S1352
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' AppInfoId136=a135.AppInfoId, AppInfoId136Text=a135.AppInfoDesc, a135.AppInfoDesc'
SELECT @fClause = 'FROM dbo.AppInfo a135'
SELECT @oClause = 'ORDER BY a135.AppInfoDesc desc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a135.AppInfoDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a135.AppInfoId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT AppInfoId136=null, AppInfoId136Text=null, AppInfoDesc=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlAppItemLink3S1349') AND type='P')
DROP PROCEDURE dbo.GetDdlAppItemLink3S1349
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlAppItemLink3S1349
 @screenId		int
,@bAll		char(1)
,@keyId		VarChar(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' AppItemLink135=a136.AppItemLink, AppItemLink135Text=a136.AppItemDesc, a136.AppInfoId'
SELECT @fClause = 'FROM dbo.AppItem a136'
SELECT @oClause = 'ORDER BY a136.AppItemDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a136.AppItemDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a136.AppItemLink = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT AppItemLink135=null, AppItemLink135Text=null, AppInfoId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlAppZipId3S1416') AND type='P')
DROP PROCEDURE dbo.GetDdlAppZipId3S1416
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlAppZipId3S1416
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT a253.DocId, DocLink=''~/DnLoad.aspx?tbl=RODesign.dbo.AppZipId&key='' + convert(varchar,a253.DocId), a253.DocName, DocSize=convert(varchar,a253.DocSize/1024) + ''KB'', a253.InputOn, LoginName=b.UsrName, AppInfoId=a253.MasterId'
SELECT @fClause = 'FROM RODesign.dbo.AppZipId a253 INNER JOIN RODesign.dbo.Usr b ON a253.InputBy = b.UsrId'
SELECT @oClause = 'ORDER BY a253.InputOn desc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((a253.Active = ''Y'') ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a253.MasterId LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + '(a253.MasterId is null OR a253.MasterId = ' + convert(varchar,@keyId) + '))' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'InputBy','Usr','a253.','N','N',null,'Y','DocId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DocId=null, DocLink=null, DocName=null, DocSize=null, InputOn=null, LoginName=null, AppInfoId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlAsmxEventId3S4214') AND type='P')
DROP PROCEDURE dbo.GetDdlAsmxEventId3S4214
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlAsmxEventId3S4214
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' AsmxEventId128=a1310.RuleAsmxTypeId, AsmxEventId128Text=a1310.RuleAsmxTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtRuleAsmxType a1310'
SELECT @oClause = 'ORDER BY a1310.RuleAsmxTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1310.RuleAsmxTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1310.RuleAsmxTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT AsmxEventId128=null, AsmxEventId128Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlBeforeCRUD3S163') AND type='P')
DROP PROCEDURE dbo.GetDdlBeforeCRUD3S163
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlBeforeCRUD3S163
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' BeforeCRUD24=a1289.CrudTypeCd, BeforeCRUD24Text=a1289.CrudTypeName, a1289.CrudTypeSort, CrudTypeDesc1289=a1289.CrudTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtCrudType a1289'
SELECT @oClause = 'ORDER BY a1289.CrudTypeSort'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1289.CrudTypeName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1289.CrudTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT BeforeCRUD24=null, BeforeCRUD24Text=null, CrudTypeSort=null, CrudTypeDesc1289=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlBgGradType3S1551') AND type='P')
DROP PROCEDURE dbo.GetDdlBgGradType3S1551
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlBgGradType3S1551
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' BgGradType167=a170.BgGradTypeId, BgGradType167Text=a170.BgGradTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtBgGradType a170'
SELECT @oClause = 'ORDER BY a170.BgGradTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a170.BgGradTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a170.BgGradTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT BgGradType167=null, BgGradType167Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlBorderStyleB3S1544') AND type='P')
DROP PROCEDURE dbo.GetDdlBorderStyleB3S1544
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlBorderStyleB3S1544
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' BorderStyleB167=a168.BorderStyleId, BorderStyleB167Text=a168.BorderStyleName'
SELECT @fClause = 'FROM RODesign.dbo.CtBorderStyle a168'
SELECT @oClause = 'ORDER BY a168.BorderStyleName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a168.BorderStyleName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a168.BorderStyleId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT BorderStyleB167=null, BorderStyleB167Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlBorderStyleD3S1540') AND type='P')
DROP PROCEDURE dbo.GetDdlBorderStyleD3S1540
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlBorderStyleD3S1540
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' BorderStyleD167=a168.BorderStyleId, BorderStyleD167Text=a168.BorderStyleName'
SELECT @fClause = 'FROM RODesign.dbo.CtBorderStyle a168'
SELECT @oClause = 'ORDER BY a168.BorderStyleName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a168.BorderStyleName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a168.BorderStyleId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT BorderStyleD167=null, BorderStyleD167Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlBorderStyleL3S1541') AND type='P')
DROP PROCEDURE dbo.GetDdlBorderStyleL3S1541
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlBorderStyleL3S1541
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' BorderStyleL167=a168.BorderStyleId, BorderStyleL167Text=a168.BorderStyleName'
SELECT @fClause = 'FROM RODesign.dbo.CtBorderStyle a168'
SELECT @oClause = 'ORDER BY a168.BorderStyleName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a168.BorderStyleName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a168.BorderStyleId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT BorderStyleL167=null, BorderStyleL167Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlBorderStyleR3S1542') AND type='P')
DROP PROCEDURE dbo.GetDdlBorderStyleR3S1542
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlBorderStyleR3S1542
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' BorderStyleR167=a168.BorderStyleId, BorderStyleR167Text=a168.BorderStyleName'
SELECT @fClause = 'FROM RODesign.dbo.CtBorderStyle a168'
SELECT @oClause = 'ORDER BY a168.BorderStyleName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a168.BorderStyleName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a168.BorderStyleId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT BorderStyleR167=null, BorderStyleR167Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlBorderStyleT3S1543') AND type='P')
DROP PROCEDURE dbo.GetDdlBorderStyleT3S1543
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlBorderStyleT3S1543
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' BorderStyleT167=a168.BorderStyleId, BorderStyleT167Text=a168.BorderStyleName'
SELECT @fClause = 'FROM RODesign.dbo.CtBorderStyle a168'
SELECT @oClause = 'ORDER BY a168.BorderStyleName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a168.BorderStyleName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a168.BorderStyleId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT BorderStyleT167=null, BorderStyleT167Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlBotVisible3S4163') AND type='P')
DROP PROCEDURE dbo.GetDdlBotVisible3S4163
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlBotVisible3S4163
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' BotVisible116=a1306.ButtonStyleCd, BotVisible116Text=a1306.ButtonStyleDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtButtonStyle a1306'
SELECT @oClause = 'ORDER BY a1306.ButtonStyleDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1306.ButtonStyleDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1306.ButtonStyleCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT BotVisible116=null, BotVisible116Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlButtonTypeId3S1210') AND type='P')
DROP PROCEDURE dbo.GetDdlButtonTypeId3S1210
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlButtonTypeId3S1210
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ButtonTypeId116=a115.ButtonTypeId, ButtonTypeId116Text=a115.ButtonTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtButtonType a115'
SELECT @oClause = 'ORDER BY a115.ButtonTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a115.ButtonTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a115.ButtonTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ButtonTypeId116=null, ButtonTypeId116Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlButtonTypeId3S1288') AND type='P')
DROP PROCEDURE dbo.GetDdlButtonTypeId3S1288
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlButtonTypeId3S1288
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ButtonTypeId128=a130.ButtonTypeId, ButtonTypeId128Text=a130.ButtonTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwScrButton a130'
SELECT @oClause = 'ORDER BY a130.ButtonTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a130.ButtonTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a130.ButtonTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ButtonTypeId128=null, ButtonTypeId128Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCategoryGrp3S1736') AND type='P')
DROP PROCEDURE dbo.GetDdlCategoryGrp3S1736
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCategoryGrp3S1736
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CategoryGrp206=a23.ReportObjId, CategoryGrp206Text=a23.ColumnDesc, a23.ReportId'
SELECT @fClause = 'FROM dbo.ReportObj a23'
SELECT @oClause = 'ORDER BY a23.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a23.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a23.ReportObjId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CategoryGrp206=null, CategoryGrp206Text=null, ReportId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCelNum3S1624') AND type='P')
DROP PROCEDURE dbo.GetDdlCelNum3S1624
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCelNum3S1624
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CelNum164=a162.RptTblId, CelNum164Text=a162.RptTblDesc'
SELECT @fClause = 'FROM dbo.RptTbl a162'
SELECT @oClause = 'ORDER BY a162.RptTblDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a162.RptTblDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a162.RptTblId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CelNum164=null, CelNum164Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlChangedBy3S4112') AND type='P')
DROP PROCEDURE dbo.GetDdlChangedBy3S4112
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlChangedBy3S4112
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ChangedBy1300=a270.UsrId, ChangedBy1300Text=a270.UsrName, a270.Active'
SELECT @fClause = 'FROM RODesign.dbo.VwUsr a270'
SELECT @oClause = 'ORDER BY a270.UsrName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((a270.Active = ''Y'') ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a270.UsrName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a270.UsrId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'UsrId','Usr','a270.','N','N',null,'N','UsrId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ChangedBy1300=null, ChangedBy1300Text=null, Active=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlClientScript3S1261') AND type='P')
DROP PROCEDURE dbo.GetDdlClientScript3S1261
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlClientScript3S1261
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ClientScript127=a126.ClientScriptId, ClientScript127Text=a126.ClientScriptDesc, ClientScriptHelp126=a126.ClientScriptHelp'
SELECT @fClause = 'FROM RODesign.dbo.CtClientScript a126'
SELECT @oClause = 'ORDER BY a126.ClientScriptDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a126.ClientScriptDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a126.ClientScriptId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ClientScript127=null, ClientScript127Text=null, ClientScriptHelp126=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlColumnId3S1181') AND type='P')
DROP PROCEDURE dbo.GetDdlColumnId3S1181
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlColumnId3S1181
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ColumnId104=a5.ColumnId, ColumnId104Text=a5.ColumnDesc'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ColumnId104=null, ColumnId104Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlColumnId3S1195') AND type='P')
DROP PROCEDURE dbo.GetDdlColumnId3S1195
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlColumnId3S1195]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ColumnId107=a5.ColumnId, ColumnId107Text=a5.ColumnDesc'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ColumnId107=null, ColumnId107Text=null WHERE 1<>1
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlColumnId3S1644') AND type='P')
DROP PROCEDURE dbo.GetDdlColumnId3S1644
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlColumnId3S1644]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ColumnId184=a5.ColumnId, ColumnId184Text=a5.ColumnDesc, ColObjective5=a5.ColObjective'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ColumnId184=null, ColumnId184Text=null, ColObjective5=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlColumnId3S1667') AND type='P')
DROP PROCEDURE dbo.GetDdlColumnId3S1667
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlColumnId3S1667
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ColumnId182=a5.ColumnId, ColumnId182Text=a5.ColumnName, a5.TableId'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ColumnId182=null, ColumnId182Text=null, TableId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlColumnId3S167') AND type='P')
DROP PROCEDURE dbo.GetDdlColumnId3S167
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlColumnId3S167
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ColumnId20=a5.ColumnId, ColumnId20Text=a5.ColumnDesc, a5.TableId'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ColumnId20=null, ColumnId20Text=null, TableId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlColumnId3S642') AND type='P')
DROP PROCEDURE dbo.GetDdlColumnId3S642
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlColumnId3S642
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ColumnId72=a5.ColumnId, ColumnId72Text=a5.ColumnDesc'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ColumnId72=null, ColumnId72Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlColumnId3S74') AND type='P')
DROP PROCEDURE dbo.GetDdlColumnId3S74
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlColumnId3S74
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ColumnId14=a5.ColumnId, ColumnId14Text=a5.ColumnDesc'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ColumnId14=null, ColumnId14Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlColumnJustify3S1422') AND type='P')
DROP PROCEDURE dbo.GetDdlColumnJustify3S1422
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlColumnJustify3S1422
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ColumnJustify14=a152.JustifyCd, ColumnJustify14Text=a152.JustifyName'
SELECT @fClause = 'FROM RODesign.dbo.CtJustify a152'
SELECT @oClause = 'ORDER BY a152.JustifyName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a152.JustifyName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a152.JustifyCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ColumnJustify14=null, ColumnJustify14Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlColumnJustify3S1425') AND type='P')
DROP PROCEDURE dbo.GetDdlColumnJustify3S1425
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlColumnJustify3S1425
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ColumnJustify104=a152.JustifyCd, ColumnJustify104Text=a152.JustifyName'
SELECT @fClause = 'FROM RODesign.dbo.CtJustify a152'
SELECT @oClause = 'ORDER BY a152.JustifyName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a152.JustifyName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a152.JustifyCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ColumnJustify104=null, ColumnJustify104Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCompanyId3S1971') AND type='P')
DROP PROCEDURE dbo.GetDdlCompanyId3S1971
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCompanyId3S1971
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='ROCmon')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CompanyId215=a132.CompanyId, CompanyId215Text=a132.CompanyDesc, a132.Active'
SELECT @fClause = 'FROM ROCmon.dbo.Company a132'
SELECT @oClause = 'ORDER BY a132.CompanyDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((a132.Active = ''Y'') ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a132.CompanyDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a132.CompanyId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyId','Company','a132.','Y','N',null,'N','CompanyId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyId','Company','a132.','N',null,'CompanyId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CompanyId215=null, CompanyId215Text=null, Active=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCopyReportId3S1012') AND type='P')
DROP PROCEDURE dbo.GetDdlCopyReportId3S1012
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCopyReportId3S1012
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CopyReportId22=a22.ReportId, CopyReportId22Text=a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a22.ReportId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CopyReportId22=null, CopyReportId22Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCriOperatorId3S1645') AND type='P')
DROP PROCEDURE dbo.GetDdlCriOperatorId3S1645
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlCriOperatorId3S1645]
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CriOperatorId184=a100.OperatorId, CriOperatorId184Text=a100.OperatorDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtOperator a100'
SELECT @oClause = 'ORDER BY a100.OperatorDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a100.OperatorDesc LIKE N''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a100.OperatorId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CriOperatorId184=null, CriOperatorId184Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCtrGrouping3S1595') AND type='P')
DROP PROCEDURE dbo.GetDdlCtrGrouping3S1595
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCtrGrouping3S1595
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CtrGrouping161=a23.ReportObjId, CtrGrouping161Text=a23.ColumnDesc, a23.ReportId'
SELECT @fClause = 'FROM dbo.ReportObj a23'
SELECT @oClause = 'ORDER BY a23.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a23.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a23.ReportObjId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CtrGrouping161=null, CtrGrouping161Text=null, ReportId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCtrToggle3S1697') AND type='P')
DROP PROCEDURE dbo.GetDdlCtrToggle3S1697
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCtrToggle3S1697
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CtrToggle161=a161.RptCtrId, CtrToggle161Text=a161.RptCtrDesc, a161.ReportId'
SELECT @fClause = 'FROM dbo.RptCtr a161'
SELECT @oClause = 'ORDER BY a161.RptCtrDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a161.RptCtrDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a161.RptCtrId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CtrToggle161=null, CtrToggle161Text=null, ReportId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCtrVisibility3S1587') AND type='P')
DROP PROCEDURE dbo.GetDdlCtrVisibility3S1587
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCtrVisibility3S1587
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CtrVisibility161=a125.CheckBoxCd, CtrVisibility161Text=a125.CheckBoxName'
SELECT @fClause = 'FROM RODesign.dbo.CtCheckBox a125'
SELECT @oClause = 'ORDER BY a125.CheckBoxName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a125.CheckBoxName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a125.CheckBoxCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CtrVisibility161=null, CtrVisibility161Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCudAction3S4106') AND type='P')
DROP PROCEDURE dbo.GetDdlCudAction3S4106
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCudAction3S4106
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CudAction1300=a1302.CudAction, CudAction1300Text=a1302.CudActionDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtCudAction a1302'
SELECT @oClause = 'ORDER BY a1302.CudActionDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1302.CudActionDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1302.CudAction = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CudAction1300=null, CudAction1300Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCultureId3S1022') AND type='P')
DROP PROCEDURE dbo.GetDdlCultureId3S1022
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCultureId3S1022
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CultureId96=a245.CultureId, CultureId96Text=a245.CultureTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwCulture a245'
SELECT @oClause = 'ORDER BY a245.CultureTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a245.CultureTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a245.CultureId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CultureId96=null, CultureId96Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCultureId3S1097') AND type='P')
DROP PROCEDURE dbo.GetDdlCultureId3S1097
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCultureId3S1097
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CultureId98=a245.CultureId, CultureId98Text=a245.CultureTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwCulture a245'
SELECT @oClause = 'ORDER BY a245.CultureTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a245.CultureTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a245.CultureId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CultureId98=null, CultureId98Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCultureId3S1191') AND type='P')
DROP PROCEDURE dbo.GetDdlCultureId3S1191
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCultureId3S1191
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CultureId105=a245.CultureId, CultureId105Text=a245.CultureTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwCulture a245'
SELECT @oClause = 'ORDER BY a245.CultureTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a245.CultureTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a245.CultureId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CultureId105=null, CultureId105Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCultureId3S1209') AND type='P')
DROP PROCEDURE dbo.GetDdlCultureId3S1209
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCultureId3S1209
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CultureId116=a245.CultureId, CultureId116Text=a245.CultureTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwCulture a245'
SELECT @oClause = 'ORDER BY a245.CultureTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a245.CultureTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a245.CultureId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CultureId116=null, CultureId116Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCultureId3S1259') AND type='P')
DROP PROCEDURE dbo.GetDdlCultureId3S1259
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCultureId3S1259
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CultureId127=a245.CultureId, CultureId127Text=a245.CultureTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwCulture a245'
SELECT @oClause = 'ORDER BY a245.CultureTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a245.CultureTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a245.CultureId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CultureId127=null, CultureId127Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCultureId3S1271') AND type='P')
DROP PROCEDURE dbo.GetDdlCultureId3S1271
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlCultureId3S1271]
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CultureId21=a245.CultureId, CultureId21Text=a245.CultureTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwCulture a245'
SELECT @oClause = 'ORDER BY a245.CultureTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a245.CultureTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a245.CultureId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CultureId21=null, CultureId21Text=null WHERE 1<>1
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCultureId3S1276') AND type='P')
DROP PROCEDURE dbo.GetDdlCultureId3S1276
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCultureId3S1276
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CultureId99=a245.CultureId, CultureId99Text=a245.CultureTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwCulture a245'
SELECT @oClause = 'ORDER BY a245.CultureTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a245.CultureTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a245.CultureId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CultureId99=null, CultureId99Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCultureId3S1414') AND type='P')
DROP PROCEDURE dbo.GetDdlCultureId3S1414
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCultureId3S1414
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CultureId147=a245.CultureId, CultureId147Text=a245.CultureTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwCulture a245'
SELECT @oClause = 'ORDER BY a245.CultureTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a245.CultureTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a245.CultureId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CultureId147=null, CultureId147Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCultureId3S1967') AND type='P')
DROP PROCEDURE dbo.GetDdlCultureId3S1967
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCultureId3S1967
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CultureId215=a8.CultureTypeId, CultureId215Text=a8.CultureTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtCulture a8'
SELECT @oClause = 'ORDER BY a8.CultureTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a8.CultureTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a8.CultureTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CultureId215=null, CultureId215Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCultureId3S3255') AND type='P')
DROP PROCEDURE dbo.GetDdlCultureId3S3255
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCultureId3S3255
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CultureId21=a245.CultureId, CultureId21Text=a245.CultureTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwCulture a245'
SELECT @oClause = 'ORDER BY a245.CultureTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a245.CultureTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a245.CultureId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CultureId21=null, CultureId21Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCultureId3S448') AND type='P')
DROP PROCEDURE dbo.GetDdlCultureId3S448
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCultureId3S448
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CultureId40=a245.CultureId, CultureId40Text=a245.CultureTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwCulture a245'
SELECT @oClause = 'ORDER BY a245.CultureTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a245.CultureTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a245.CultureId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CultureId40=null, CultureId40Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCultureId3S53') AND type='P')
DROP PROCEDURE dbo.GetDdlCultureId3S53
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCultureId3S53
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CultureId16=a245.CultureId, CultureId16Text=a245.CultureTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwCulture a245'
SELECT @oClause = 'ORDER BY a245.CultureTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a245.CultureTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a245.CultureId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CultureId16=null, CultureId16Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCultureId3S721') AND type='P')
DROP PROCEDURE dbo.GetDdlCultureId3S721
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCultureId3S721
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CultureId80=a245.CultureId, CultureId80Text=a245.CultureTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwCulture a245'
SELECT @oClause = 'ORDER BY a245.CultureTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a245.CultureTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a245.CultureId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CultureId80=null, CultureId80Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCultureId3S848') AND type='P')
DROP PROCEDURE dbo.GetDdlCultureId3S848
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCultureId3S848
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CultureId87=a245.CultureId, CultureId87Text=a245.CultureTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwCulture a245'
SELECT @oClause = 'ORDER BY a245.CultureTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a245.CultureTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a245.CultureId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a245.','Y','N',null,'N','CultureId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CultureId87=null, CultureId87Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCultureTypeId3S3073') AND type='P')
DROP PROCEDURE dbo.GetDdlCultureTypeId3S3073
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlCultureTypeId3S3073]
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CultureTypeId135=a8.CultureTypeId, CultureTypeId135Text=a8.CultureTypeDesc, CurrencyCd8=a8.CurrencyCd'
SELECT @fClause = 'FROM RODesign.dbo.CtCulture a8'
SELECT @oClause = 'ORDER BY a8.CultureTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a8.CultureTypeDesc LIKE N''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a8.CultureTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CultureTypeId135=null, CultureTypeId135Text=null, CurrencyCd8=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCultureTypeName3S3073') AND type='P')
DROP PROCEDURE dbo.GetDdlCultureTypeName3S3073
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlCultureTypeName3S3073
 @screenId		int
,@bAll		char(1)
,@keyId		VarChar(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CultureTypeName135=a8.CultureTypeName, CultureTypeName135Text=a8.CultureTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtCulture a8'
SELECT @oClause = 'ORDER BY a8.CultureTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a8.CultureTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a8.CultureTypeName = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CultureTypeName135=null, CultureTypeName135Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCustomDtlLink3S1379') AND type='P')
DROP PROCEDURE dbo.GetDdlCustomDtlLink3S1379
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlCustomDtlLink3S1379]
 @screenId		int
,@bAll		char(1)
,@keyId		VarChar(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CustomDtlLink133=a134.CustomDtlLink, CustomDtlLink133Text=a134.CustomDtlDesc, a134.CustomId'
SELECT @fClause = 'FROM dbo.CustomDtl a134'
SELECT @oClause = 'ORDER BY a134.CustomDtlDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a134.CustomDtlDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a134.CustomDtlLink = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a134.','N','N',null,'Y','CustomDtlId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CustomDtlLink133=null, CustomDtlLink133Text=null, CustomId=null WHERE 1<>1
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlCustomId3S1381') AND type='P')
DROP PROCEDURE dbo.GetDdlCustomId3S1381
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlCustomId3S1381]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CustomId134=a133.CustomId, CustomId134Text=a133.CustomDesc'
SELECT @fClause = 'FROM dbo.Custom a133'
SELECT @oClause = 'ORDER BY a133.CustomDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a133.CustomDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a133.CustomId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT CustomId134=null, CustomId134Text=null WHERE 1<>1
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDataType3S17') AND type='P')
DROP PROCEDURE dbo.GetDdlDataType3S17
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDataType3S17
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DataType5=a6.DataTypeId, DataType5Text=a6.DataTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtDataType a6'
SELECT @oClause = 'ORDER BY a6.DataTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a6.DataTypeName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a6.DataTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DataType5=null, DataType5Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDataTypeId3S1081') AND type='P')
DROP PROCEDURE dbo.GetDdlDataTypeId3S1081
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDataTypeId3S1081
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DataTypeId97=a6.DataTypeId, DataTypeId97Text=a6.DataTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtDataType a6'
SELECT @oClause = 'ORDER BY a6.DataTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a6.DataTypeName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a6.DataTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DataTypeId97=null, DataTypeId97Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDataTypeId3S133') AND type='P')
DROP PROCEDURE dbo.GetDdlDataTypeId3S133
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDataTypeId3S133
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DataTypeId23=a6.DataTypeId, DataTypeId23Text=a6.DataTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtDataType a6'
SELECT @oClause = 'ORDER BY a6.DataTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a6.DataTypeName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a6.DataTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DataTypeId23=null, DataTypeId23Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDbProviderCd3S1357') AND type='P')
DROP PROCEDURE dbo.GetDdlDbProviderCd3S1357
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDbProviderCd3S1357
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DbProviderCd136=a138.DbProviderCd, DbProviderCd136Text=a138.DbProviderName'
SELECT @fClause = 'FROM RODesign.dbo.CtDbProvider a138'
SELECT @oClause = 'ORDER BY a138.DbProviderName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a138.DbProviderName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a138.DbProviderCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DbProviderCd136=null, DbProviderCd136Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDbProviderCd3S1390') AND type='P')
DROP PROCEDURE dbo.GetDdlDbProviderCd3S1390
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlDbProviderCd3S1390]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DbProviderCd134=a138.DbProviderCd, DbProviderCd134Text=a138.DbProviderName'
SELECT @fClause = 'FROM RODesign.dbo.CtDbProvider a138'
SELECT @oClause = 'ORDER BY a138.DbProviderName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a138.DbProviderName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a138.DbProviderCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DbProviderCd134=null, DbProviderCd134Text=null WHERE 1<>1
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDdlAdnColumnId3S1281') AND type='P')
DROP PROCEDURE dbo.GetDdlDdlAdnColumnId3S1281
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDdlAdnColumnId3S1281
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DdlAdnColumnId14=a5.ColumnId, DdlAdnColumnId14Text=a5.ColumnDesc'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DdlAdnColumnId14=null, DdlAdnColumnId14Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDdlFtrColumnId3S1282') AND type='P')
DROP PROCEDURE dbo.GetDdlDdlFtrColumnId3S1282
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDdlFtrColumnId3S1282
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DdlFtrColumnId14=a5.ColumnId, DdlFtrColumnId14Text=a5.ColumnDesc'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DdlFtrColumnId14=null, DdlFtrColumnId14Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDdlFtrColumnId3S3365') AND type='P')
DROP PROCEDURE dbo.GetDdlDdlFtrColumnId3S3365
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDdlFtrColumnId3S3365
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DdlFtrColumnId104=a104.ScreenCriId, DdlFtrColumnId104Text=a104.ScreenCriDesc, a104.ScreenId'
SELECT @fClause = 'FROM dbo.ScreenCri a104'
SELECT @oClause = 'ORDER BY a104.ScreenCriDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a104.ScreenCriDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a104.ScreenCriId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DdlFtrColumnId104=null, DdlFtrColumnId104Text=null, ScreenId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDdlFtrColumnId3S3367') AND type='P')
DROP PROCEDURE dbo.GetDdlDdlFtrColumnId3S3367
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDdlFtrColumnId3S3367
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DdlFtrColumnId97=a97.ReportCriId, DdlFtrColumnId97Text=a97.ReportCriDesc, a97.ReportId'
SELECT @fClause = 'FROM dbo.ReportCri a97'
SELECT @oClause = 'ORDER BY a97.ReportCriDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a97.ReportCriDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a97.ReportCriId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DdlFtrColumnId97=null, DdlFtrColumnId97Text=null, ReportId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDdlKeyColumnId3S1185') AND type='P')
DROP PROCEDURE dbo.GetDdlDdlKeyColumnId3S1185
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDdlKeyColumnId3S1185
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DdlKeyColumnId104=a5.ColumnId, DdlKeyColumnId104Text=a5.ColumnDesc'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DdlKeyColumnId104=null, DdlKeyColumnId104Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDdlKeyColumnId3S82') AND type='P')
DROP PROCEDURE dbo.GetDdlDdlKeyColumnId3S82
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDdlKeyColumnId3S82
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DdlKeyColumnId14=a5.ColumnId, DdlKeyColumnId14Text=a5.ColumnDesc'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DdlKeyColumnId14=null, DdlKeyColumnId14Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDdlRefColumnId3S1186') AND type='P')
DROP PROCEDURE dbo.GetDdlDdlRefColumnId3S1186
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDdlRefColumnId3S1186
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DdlRefColumnId104=a5.ColumnId, DdlRefColumnId104Text=a5.ColumnDesc'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DdlRefColumnId104=null, DdlRefColumnId104Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDdlRefColumnId3S83') AND type='P')
DROP PROCEDURE dbo.GetDdlDdlRefColumnId3S83
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDdlRefColumnId3S83
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DdlRefColumnId14=a5.ColumnId, DdlRefColumnId14Text=a5.ColumnDesc'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DdlRefColumnId14=null, DdlRefColumnId14Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDdlSrtColumnId3S1269') AND type='P')
DROP PROCEDURE dbo.GetDdlDdlSrtColumnId3S1269
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDdlSrtColumnId3S1269
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DdlSrtColumnId14=a5.ColumnId, DdlSrtColumnId14Text=a5.ColumnDesc'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DdlSrtColumnId14=null, DdlSrtColumnId14Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDdlSrtColumnId3S1278') AND type='P')
DROP PROCEDURE dbo.GetDdlDdlSrtColumnId3S1278
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDdlSrtColumnId3S1278
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DdlSrtColumnId104=a5.ColumnId, DdlSrtColumnId104Text=a5.ColumnDesc'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DdlSrtColumnId104=null, DdlSrtColumnId104Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDefaultCd3S1571') AND type='P')
DROP PROCEDURE dbo.GetDdlDefaultCd3S1571
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDefaultCd3S1571
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DefaultCd167=a178.DefaultCd, DefaultCd167Text=a178.DefaultName'
SELECT @fClause = 'FROM RODesign.dbo.CtRptStyDef a178'
SELECT @oClause = 'ORDER BY a178.DefaultName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a178.DefaultName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a178.DefaultCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DefaultCd167=null, DefaultCd167Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDetailTableId3S60') AND type='P')
DROP PROCEDURE dbo.GetDdlDetailTableId3S60
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDetailTableId3S60
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DetailTableId15=a3.TableId, DetailTableId15Text=a3.TableDesc'
SELECT @fClause = 'FROM dbo.DbTable a3'
SELECT @oClause = 'ORDER BY a3.TableDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a3.TableDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a3.TableId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a3.','N','N',null,'Y','TableId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DetailTableId15=null, DetailTableId15Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDirection3S1568') AND type='P')
DROP PROCEDURE dbo.GetDdlDirection3S1568
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDirection3S1568
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' Direction167=a176.DirectionCd, Direction167Text=a176.DirectionDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtDirection a176'
SELECT @oClause = 'ORDER BY a176.DirectionDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a176.DirectionDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a176.DirectionCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT Direction167=null, Direction167Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDisplayModeId3S1083') AND type='P')
DROP PROCEDURE dbo.GetDdlDisplayModeId3S1083
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDisplayModeId3S1083
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DisplayModeId97=a258.TypeId, DisplayModeId97Text=a258.TypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwDisplayType a258'
SELECT @oClause = 'ORDER BY a258.TypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a258.TypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a258.TypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DisplayModeId97=null, DisplayModeId97Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDisplayModeId3S1183') AND type='P')
DROP PROCEDURE dbo.GetDdlDisplayModeId3S1183
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDisplayModeId3S1183
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DisplayModeId104=a258.TypeId, DisplayModeId104Text=a258.TypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwDisplayType a258'
SELECT @oClause = 'ORDER BY a258.TypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a258.TypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a258.TypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DisplayModeId104=null, DisplayModeId104Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDisplayModeId3S1843') AND type='P')
DROP PROCEDURE dbo.GetDdlDisplayModeId3S1843
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDisplayModeId3S1843
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DisplayModeId182=a18.TypeId, DisplayModeId182Text=a18.TypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtDisplayType a18'
SELECT @oClause = 'ORDER BY a18.TypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a18.TypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a18.TypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DisplayModeId182=null, DisplayModeId182Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDisplayModeId3S81') AND type='P')
DROP PROCEDURE dbo.GetDdlDisplayModeId3S81
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDisplayModeId3S81
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DisplayModeId14=a18.TypeId, DisplayModeId14Text=a18.TypeDesc, DisplayDesc18=a18.DisplayDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtDisplayType a18'
SELECT @oClause = 'ORDER BY a18.TypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a18.TypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a18.TypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DisplayModeId14=null, DisplayModeId14Text=null, DisplayDesc18=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlDtlLstPosId3S4206') AND type='P')
DROP PROCEDURE dbo.GetDdlDtlLstPosId3S4206
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlDtlLstPosId3S4206
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' DtlLstPosId14=a1314.DtlLstPosId, DtlLstPosId14Text=a1314.DtlLstPosNm'
SELECT @fClause = 'FROM RODesign.dbo.CtDtlLstPos a1314'
SELECT @oClause = 'ORDER BY a1314.DtlLstPosNm'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1314.DtlLstPosNm LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1314.DtlLstPosId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DtlLstPosId14=null, DtlLstPosId14Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlEventId3S1289') AND type='P')
DROP PROCEDURE dbo.GetDdlEventId3S1289
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlEventId3S1289
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' EventId128=a129.EventId, EventId128Text=a129.EventDesc, a129.EventCode'
SELECT @fClause = 'FROM RODesign.dbo.CtEvent a129'
SELECT @oClause = 'ORDER BY a129.EventDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a129.EventDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a129.EventId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT EventId128=null, EventId128Text=null, EventCode=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlEveryone3S838') AND type='P')
DROP PROCEDURE dbo.GetDdlEveryone3S838
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlEveryone3S838]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct Everyone85=a229.EveryoneCd, Everyone85Text=a229.EveryoneName, a229.EveryoneSort'
SELECT @fClause = 'FROM RODesign.dbo.CtEveryone a229'
SELECT @oClause = 'ORDER BY a229.EveryoneSort'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a229.EveryoneCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT Everyone85=null, Everyone85Text=null, EveryoneSort=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlFontStyle3S1554') AND type='P')
DROP PROCEDURE dbo.GetDdlFontStyle3S1554
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlFontStyle3S1554
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' FontStyle167=a171.FontStyleCd, FontStyle167Text=a171.FontStyleName'
SELECT @fClause = 'FROM RODesign.dbo.CtFontStyle a171'
SELECT @oClause = 'ORDER BY a171.FontStyleName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a171.FontStyleName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a171.FontStyleCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT FontStyle167=null, FontStyle167Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlFontWeight3S1557') AND type='P')
DROP PROCEDURE dbo.GetDdlFontWeight3S1557
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlFontWeight3S1557
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' FontWeight167=a172.FontWeightCd, FontWeight167Text=a172.FontWeightDesc, a172.FontWeightName'
SELECT @fClause = 'FROM RODesign.dbo.CtFontWeight a172'
SELECT @oClause = 'ORDER BY a172.FontWeightName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a172.FontWeightDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a172.FontWeightCd = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT FontWeight167=null, FontWeight167Text=null, FontWeightName=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlFrameworkCd3S1356') AND type='P')
DROP PROCEDURE dbo.GetDdlFrameworkCd3S1356
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlFrameworkCd3S1356
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' FrameworkCd136=a140.FrameworkCd, FrameworkCd136Text=a140.FrameworkName'
SELECT @fClause = 'FROM RODesign.dbo.CtFramework a140'
SELECT @oClause = 'ORDER BY a140.FrameworkName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a140.FrameworkName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a140.FrameworkCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT FrameworkCd136=null, FrameworkCd136Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlFrameworkCd3S1389') AND type='P')
DROP PROCEDURE dbo.GetDdlFrameworkCd3S1389
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlFrameworkCd3S1389]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' FrameworkCd134=a140.FrameworkCd, FrameworkCd134Text=a140.FrameworkName'
SELECT @fClause = 'FROM RODesign.dbo.CtFramework a140'
SELECT @oClause = 'ORDER BY a140.FrameworkName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a140.FrameworkName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a140.FrameworkCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT FrameworkCd134=null, FrameworkCd134Text=null WHERE 1<>1
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlGFormat3S1794') AND type='P')
DROP PROCEDURE dbo.GetDdlGFormat3S1794
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlGFormat3S1794]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' GFormat183=a221.FormatCd, GFormat183Text=a221.FormatName, a221.FormatSort'
SELECT @fClause = 'FROM RODesign.dbo.CtFormat a221'
SELECT @oClause = 'ORDER BY a221.FormatSort'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a221.FormatName LIKE N''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a221.FormatCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT GFormat183=null, GFormat183Text=null, FormatSort=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlGPositive3S1637') AND type='P')
DROP PROCEDURE dbo.GetDdlGPositive3S1637
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlGPositive3S1637]
 @screenId		int
,@bAll		char(1)
,@keyId		varchar(1000)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
SELECT @sClause = 'SELECT GPositive183 = ''Y'', GPositive183Text = ''+ve'' UNION SELECT GPositive183 = ''N'', GPositive183Text = ''-ve'''
EXEC (@sClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlGrantDeny3S838') AND type='P')
DROP PROCEDURE dbo.GetDdlGrantDeny3S838
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlGrantDeny3S838
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' GrantDeny231=a229.EveryoneCd, GrantDeny231Text=a229.EveryoneName, a229.EveryoneSort'
SELECT @fClause = 'FROM RODesign.dbo.CtEveryone a229'
SELECT @oClause = 'ORDER BY a229.EveryoneSort'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a229.EveryoneName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a229.EveryoneCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT GrantDeny231=null, GrantDeny231Text=null, EveryoneSort=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlGridGrpCd3S2016') AND type='P')
DROP PROCEDURE dbo.GetDdlGridGrpCd3S2016
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlGridGrpCd3S2016
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' GridGrpCd14=a263.GridGrpCd, GridGrpCd14Text=a263.GridGrpName'
SELECT @fClause = 'FROM RODesign.dbo.CtGridGrp a263'
SELECT @oClause = 'ORDER BY a263.GridGrpName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a263.GridGrpName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a263.GridGrpCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT GridGrpCd14=null, GridGrpCd14Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlGroupColId3S1204') AND type='P')
DROP PROCEDURE dbo.GetDdlGroupColId3S1204
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlGroupColId3S1204
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' GroupColId14=a106.GroupColId, GroupColId14Text=a106.GroupColName'
SELECT @fClause = 'FROM RODesign.dbo.GroupCol a106'
SELECT @oClause = 'ORDER BY a106.GroupColName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a106.GroupColName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a106.GroupColId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT GroupColId14=null, GroupColId14Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlGroupColId3S3264') AND type='P')
DROP PROCEDURE dbo.GetDdlGroupColId3S3264
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlGroupColId3S3264
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' GroupColId14=a106.GroupColId, GroupColId14Text=a106.GroupColName'
SELECT @fClause = 'FROM RODesign.dbo.GroupCol a106'
SELECT @oClause = 'ORDER BY a106.GroupColName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a106.GroupColName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a106.GroupColId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT GroupColId14=null, GroupColId14Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlGroupRowId3S3136') AND type='P')
DROP PROCEDURE dbo.GetDdlGroupRowId3S3136
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlGroupRowId3S3136
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' GroupRowId14=a1281.GroupRowId, GroupRowId14Text=a1281.GroupRowName'
SELECT @fClause = 'FROM RODesign.dbo.GroupRow a1281'
SELECT @oClause = 'ORDER BY a1281.GroupRowName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1281.GroupRowName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1281.GroupRowId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT GroupRowId14=null, GroupRowId14Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlGroupRowId3S3263') AND type='P')
DROP PROCEDURE dbo.GetDdlGroupRowId3S3263
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlGroupRowId3S3263
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' GroupRowId14=a1281.GroupRowId, GroupRowId14Text=a1281.GroupRowName'
SELECT @fClause = 'FROM RODesign.dbo.GroupRow a1281'
SELECT @oClause = 'ORDER BY a1281.GroupRowName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1281.GroupRowName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1281.GroupRowId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT GroupRowId14=null, GroupRowId14Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlInputBy3S1768') AND type='P')
DROP PROCEDURE dbo.GetDdlInputBy3S1768
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlInputBy3S1768]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@RowAuthoritys		varchar(1000)
,@Usrs		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
SELECT @sClause = 'SELECT distinct InputBy210=a1.UsrId, InputBy210Text=a1.LoginName, a1.Active'
SELECT @fClause = 'FROM RODesign.dbo.Usr a1'
SELECT @oClause = 'ORDER BY a1.LoginName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (a1.Active = ''Y'' OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1.UsrId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Projects,'ProjectLs','Project','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1.','Y','N',null,'N','UsrId',@wClause OUTPUT
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'UsrId','Usr','a1.','N','N',null,'N','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Customers,'CustomerId','Customer','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Vendors,'VendorId','Vendor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Members,'MemberId','Member','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Investors,'InvestorId','Investor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Agents,'AgentId','Agent','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Brokers,'BrokerId','Broker','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@UsrGroups,'UsrGroupLs','UsrGroup','a1.','N','Y',null,'N','UsrId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetCurrFilter @currProjectId,'ProjectLs','Project','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlInputBy3S1790') AND type='P')
DROP PROCEDURE dbo.GetDdlInputBy3S1790
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlInputBy3S1790]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@RowAuthoritys		varchar(1000)
,@Usrs		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
SELECT @sClause = 'SELECT distinct InputBy220=a1.UsrId, InputBy220Text=a1.LoginName, a1.Active'
SELECT @fClause = 'FROM RODesign.dbo.Usr a1'
SELECT @oClause = 'ORDER BY a1.LoginName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (a1.Active = ''Y'' OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1.UsrId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Projects,'ProjectLs','Project','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1.','Y','N',null,'N','UsrId',@wClause OUTPUT
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'UsrId','Usr','a1.','N','N',null,'N','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Customers,'CustomerId','Customer','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Vendors,'VendorId','Vendor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Members,'MemberId','Member','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Investors,'InvestorId','Investor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Agents,'AgentId','Agent','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Brokers,'BrokerId','Broker','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@UsrGroups,'UsrGroupLs','UsrGroup','a1.','N','Y',null,'N','UsrId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetCurrFilter @currProjectId,'ProjectLs','Project','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlKeyId3S1667') AND type='P')
DROP PROCEDURE dbo.GetDdlKeyId3S1667
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlKeyId3S1667]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct KeyId182=a20.KeyId, KeyId182Text=a20.KeyName, a20.RefTableId'
SELECT @fClause = 'FROM dbo.DbKey a20'
SELECT @oClause = 'ORDER BY a20.KeyName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a20.KeyId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT KeyId182=null, KeyId182Text=null, RefTableId=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlLanguageCd3S1355') AND type='P')
DROP PROCEDURE dbo.GetDdlLanguageCd3S1355
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlLanguageCd3S1355
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' LanguageCd136=a139.LanguageCd, LanguageCd136Text=a139.LanguageName'
SELECT @fClause = 'FROM RODesign.dbo.CtLanguage a139'
SELECT @oClause = 'ORDER BY a139.LanguageName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a139.LanguageName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a139.LanguageCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT LanguageCd136=null, LanguageCd136Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlLanguageCd3S1388') AND type='P')
DROP PROCEDURE dbo.GetDdlLanguageCd3S1388
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlLanguageCd3S1388]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' LanguageCd134=a139.LanguageCd, LanguageCd134Text=a139.LanguageName'
SELECT @fClause = 'FROM RODesign.dbo.CtLanguage a139'
SELECT @oClause = 'ORDER BY a139.LanguageName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a139.LanguageName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a139.LanguageCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT LanguageCd134=null, LanguageCd134Text=null WHERE 1<>1
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlLineBottom3S1237') AND type='P')
DROP PROCEDURE dbo.GetDdlLineBottom3S1237
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlLineBottom3S1237]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
	,@cc		varchar(8000)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @sClause = 'SELECT distinct LineBottom117=a120.LineTypeCd, LineBottom117Text=a120.LineTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtLineType a120'
SELECT @oClause = 'ORDER BY a120.LineTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a120.LineTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlLineTop3S1236') AND type='P')
DROP PROCEDURE dbo.GetDdlLineTop3S1236
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlLineTop3S1236]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
	,@cc		varchar(8000)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @sClause = 'SELECT distinct LineTop117=a120.LineTypeCd, LineTop117Text=a120.LineTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtLineType a120'
SELECT @oClause = 'ORDER BY a120.LineTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a120.LineTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlMasterTableId3S59') AND type='P')
DROP PROCEDURE dbo.GetDdlMasterTableId3S59
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlMasterTableId3S59
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' MasterTableId15=a3.TableId, MasterTableId15Text=a3.TableDesc'
SELECT @fClause = 'FROM dbo.DbTable a3'
SELECT @oClause = 'ORDER BY a3.TableDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a3.TableDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a3.TableId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a3.','N','N',null,'Y','TableId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT MasterTableId15=null, MasterTableId15Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlMasterTableId3S635') AND type='P')
DROP PROCEDURE dbo.GetDdlMasterTableId3S635
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlMasterTableId3S635
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' MasterTableId71=a3.TableId, MasterTableId71Text=a3.TableDesc'
SELECT @fClause = 'FROM dbo.DbTable a3'
SELECT @oClause = 'ORDER BY a3.TableDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a3.TableDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a3.TableId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a3.','N','N',null,'Y','TableId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT MasterTableId71=null, MasterTableId71Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlMatchCd3S1806') AND type='P')
DROP PROCEDURE dbo.GetDdlMatchCd3S1806
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlMatchCd3S1806
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' MatchCd14=a227.MatchCd, MatchCd14Text=a227.MatchName, a227.MatchSort'
SELECT @fClause = 'FROM RODesign.dbo.CtMatch a227'
SELECT @oClause = 'ORDER BY a227.MatchSort'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a227.MatchName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a227.MatchCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT MatchCd14=null, MatchCd14Text=null, MatchSort=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlMenuOption3S944') AND type='P')
DROP PROCEDURE dbo.GetDdlMenuOption3S944
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlMenuOption3S944]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct MenuOption93=a91.MenuOptionCode, MenuOption93Text=a91.MenuOptionDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtMenuOption a91'
SELECT @oClause = 'ORDER BY a91.MenuOptionDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a91.MenuOptionCode = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT MenuOption93=null, MenuOption93Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlModifiedBy3S1394') AND type='P')
DROP PROCEDURE dbo.GetDdlModifiedBy3S1394
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlModifiedBy3S1394]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ModifiedBy134=a1.UsrId, ModifiedBy134Text=a1.UsrName, a1.Active'
SELECT @fClause = 'FROM RODesign.dbo.Usr a1'
SELECT @oClause = 'ORDER BY a1.UsrName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((a1.Active = ''Y'') ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1.UsrName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1.UsrId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Projects,'ProjectLs','Project','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1.','Y','N',null,'N','UsrId',@wClause OUTPUT
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'UsrId','Usr','a1.','N','N',null,'N','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Customers,'CustomerId','Customer','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Vendors,'VendorId','Vendor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Members,'MemberId','Member','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Investors,'InvestorId','Investor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Agents,'AgentId','Agent','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Brokers,'BrokerId','Broker','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@UsrGroups,'UsrGroupLs','UsrGroup','a1.','N','Y',null,'N','UsrId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetCurrFilter @currProjectId,'ProjectLs','Project','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ModifiedBy134=null, ModifiedBy134Text=null, Active=null WHERE 1<>1
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlModifiedBy3S1397') AND type='P')
DROP PROCEDURE dbo.GetDdlModifiedBy3S1397
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlModifiedBy3S1397
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ModifiedBy24=a1.UsrId, ModifiedBy24Text=a1.UsrName, a1.Active'
SELECT @fClause = 'FROM RODesign.dbo.Usr a1'
SELECT @oClause = 'ORDER BY a1.UsrName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((a1.Active = ''Y'') ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1.UsrName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1.UsrId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Projects,'ProjectLs','Project','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1.','Y','N',null,'N','UsrId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'UsrId','Usr','a1.','N','N',null,'N','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Customers,'CustomerId','Customer','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Vendors,'VendorId','Vendor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Members,'MemberId','Member','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Investors,'InvestorId','Investor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Agents,'AgentId','Agent','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Brokers,'BrokerId','Broker','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@UsrGroups,'UsrGroupLs','UsrGroup','a1.','N','Y',null,'N','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Borrowers,'BorrowerId','Borrower','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Guarantors,'GuarantorId','Guarantor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Lenders,'LenderId','Lender','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetCurrFilter @currProjectId,'ProjectLs','Project','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ModifiedBy24=null, ModifiedBy24Text=null, Active=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlModifiedBy3S1451') AND type='P')
DROP PROCEDURE dbo.GetDdlModifiedBy3S1451
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlModifiedBy3S1451
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ModifiedBy3=a1.UsrId, ModifiedBy3Text=a1.UsrName, a1.Active'
SELECT @fClause = 'FROM RODesign.dbo.Usr a1'
SELECT @oClause = 'ORDER BY a1.UsrName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((a1.Active = ''Y'') ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1.UsrName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1.UsrId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Projects,'ProjectLs','Project','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1.','Y','N',null,'N','UsrId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'UsrId','Usr','a1.','N','N',null,'N','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Customers,'CustomerId','Customer','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Vendors,'VendorId','Vendor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Members,'MemberId','Member','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Investors,'InvestorId','Investor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Agents,'AgentId','Agent','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Brokers,'BrokerId','Broker','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@UsrGroups,'UsrGroupLs','UsrGroup','a1.','N','Y',null,'N','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Borrowers,'BorrowerId','Borrower','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Guarantors,'GuarantorId','Guarantor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Lenders,'LenderId','Lender','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetCurrFilter @currProjectId,'ProjectLs','Project','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ModifiedBy3=null, ModifiedBy3Text=null, Active=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlModifiedBy3S1470') AND type='P')
DROP PROCEDURE dbo.GetDdlModifiedBy3S1470
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlModifiedBy3S1470
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ModifiedBy22=a1.UsrId, ModifiedBy22Text=a1.UsrName, a1.Active'
SELECT @fClause = 'FROM RODesign.dbo.Usr a1'
SELECT @oClause = 'ORDER BY a1.UsrName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((a1.Active = ''Y'') ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1.UsrName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1.UsrId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Projects,'ProjectLs','Project','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1.','Y','N',null,'N','UsrId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1.','Y','N',null,'N','UsrId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1.','Y','N',null,'N','UsrId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1.','Y','N',null,'N','UsrId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'UsrId','Usr','a1.','N','N',null,'N','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Customers,'CustomerId','Customer','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Vendors,'VendorId','Vendor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Members,'MemberId','Member','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Investors,'InvestorId','Investor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Agents,'AgentId','Agent','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Brokers,'BrokerId','Broker','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@UsrGroups,'UsrGroupLs','UsrGroup','a1.','N','Y',null,'N','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Borrowers,'BorrowerId','Borrower','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Guarantors,'GuarantorId','Guarantor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Lenders,'LenderId','Lender','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetCurrFilter @currProjectId,'ProjectLs','Project','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ModifiedBy22=null, ModifiedBy22Text=null, Active=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlMsgTypeCd3S1409') AND type='P')
DROP PROCEDURE dbo.GetDdlMsgTypeCd3S1409
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlMsgTypeCd3S1409
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' MsgTypeCd146=a141.MsgTypeCd, MsgTypeCd146Text=a141.MsgTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtMsgType a141'
SELECT @oClause = 'ORDER BY a141.MsgTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a141.MsgTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a141.MsgTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT MsgTypeCd146=null, MsgTypeCd146Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlObjectTypeCd3S1354') AND type='P')
DROP PROCEDURE dbo.GetDdlObjectTypeCd3S1354
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlObjectTypeCd3S1354
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ObjectTypeCd136=a137.ObjectTypeCd, ObjectTypeCd136Text=a137.ObjectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtObjectType a137'
SELECT @oClause = 'ORDER BY a137.ObjectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a137.ObjectTypeName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a137.ObjectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ObjectTypeCd136=null, ObjectTypeCd136Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlObjectTypeCd3S1383') AND type='P')
DROP PROCEDURE dbo.GetDdlObjectTypeCd3S1383
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlObjectTypeCd3S1383]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ObjectTypeCd134=a137.ObjectTypeCd, ObjectTypeCd134Text=a137.ObjectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtObjectType a137'
SELECT @oClause = 'ORDER BY a137.ObjectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a137.ObjectTypeName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a137.ObjectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ObjectTypeCd134=null, ObjectTypeCd134Text=null WHERE 1<>1
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlOperator3S1652') AND type='P')
DROP PROCEDURE dbo.GetDdlOperator3S1652
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetDdlOperator3S1652]
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
		,@fClause		varchar(8000)
		,@oClause		varchar(8000)
SELECT @sClause = 'SELECT Operator184 = a100.OperatorName, Operator184Text = a100.OperatorDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtOperator a100'
SELECT @oClause = 'ORDER BY a100.OperatorId'
EXEC (@sClause + ' ' + @fClause + ' ' + @oClause)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlOperatorId3S1024') AND type='P')
DROP PROCEDURE dbo.GetDdlOperatorId3S1024
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlOperatorId3S1024
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' OperatorId23=a100.OperatorId, OperatorId23Text=a100.OperatorName'
SELECT @fClause = 'FROM RODesign.dbo.CtOperator a100'
SELECT @oClause = 'ORDER BY a100.OperatorName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a100.OperatorName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a100.OperatorId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT OperatorId23=null, OperatorId23Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlOperatorId3S1196') AND type='P')
DROP PROCEDURE dbo.GetDdlOperatorId3S1196
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlOperatorId3S1196]
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' OperatorId107=a100.OperatorId, OperatorId107Text=a100.OperatorDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtOperator a100'
SELECT @oClause = 'ORDER BY a100.OperatorDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a100.OperatorDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a100.OperatorId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT OperatorId107=null, OperatorId107Text=null WHERE 1<>1
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlOperatorId3S3305') AND type='P')
DROP PROCEDURE dbo.GetDdlOperatorId3S3305
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlOperatorId3S3305
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' OperatorId104=a100.OperatorId, OperatorId104Text=a100.OperatorDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtOperator a100'
SELECT @oClause = 'ORDER BY a100.OperatorDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a100.OperatorDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a100.OperatorId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT OperatorId104=null, OperatorId104Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlOriColumnId33S1682') AND type='P')
DROP PROCEDURE dbo.GetDdlOriColumnId33S1682
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlOriColumnId33S1682]
 @rptwizCatId		int
,@bAll				char(1)
,@keyId				varchar(100)
,@RowAuthoritys		varchar(1000)
,@Usrs				varchar(1000)
,@Customers			varchar(1000)
,@Vendors			varchar(1000)
,@Members			varchar(1000)
,@Investors			varchar(1000)
,@Agents			varchar(1000)
,@Brokers			varchar(1000)
,@UsrGroups			varchar(1000)
,@Companys			varchar(1000)
,@Projects			varchar(1000)
,@Cultures			varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
,@currCultureId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @dClause		varchar(8000)
		,@sClause		varchar(8000)
		,@fClause		varchar(8000)
		,@wClause		varchar(8000)
		,@oClause		varchar(8000)
		,@tClause		varchar(8000)
		,@ColFilter		varchar(8000)
SELECT @dClause = ' IF object_id(''tempdb.dbo.#col'') is not null DROP TABLE dbo.#col'
+ ' CREATE TABLE #col (ColumnId int not null, ColumnHeader nvarchar(max) not null, NumericData char(1) null)'
+ ' INSERT INTO #col SELECT a5.ColumnId, ''('' + a5.ColumnName + '')'', a6.NumericData'
SELECT @fClause = 'FROM dbo.RptwizCat a182 INNER JOIN dbo.DbColumn a5 ON a182.TableId = a5.TableId'
+ ' INNER JOIN RODesign.dbo.CtDataType a6 ON a5.DataType = a6.DataTypeId'
SELECT @ColFilter = 'WHERE (NOT EXISTS (SELECT 1 FROM dbo.ColOvrd x INNER JOIN dbo.ScreenObj y ON x.ScreenObjId = y.ScreenObjId WHERE y.ColumnId = a5.ColumnId AND x.ColExport = ''N'')'
+ ' OR EXISTS (SELECT 1 FROM dbo.ColOvrd x INNER JOIN dbo.ScreenObj y ON x.ScreenObjId = y.ScreenObjId INNER JOIN RODesign.dbo.VwPermKey z ON x.PermKeyId = z.PermKeyId'
+ ' WHERE y.ColumnId = a5.ColumnId AND x.ColExport = ''Y'''
+ ' AND ((z.PermKeyDesc = ''UsrGroup'' AND charindex(nchar(191)+convert(varchar,x.PermId)+nchar(191),nchar(191)+'''+@UsrGroups+'''+nchar(191)) > 0)'
+ ' OR (z.PermKeyDesc = ''Company'' AND charindex(nchar(191)+convert(varchar,x.PermId)+nchar(191),nchar(191)+'''+@Companys+'''+nchar(191)) > 0)'
+ ' OR (z.PermKeyDesc = ''Project'' AND charindex(nchar(191)+convert(varchar,x.PermId)+nchar(191),nchar(191)+'''+@Projects+'''+nchar(191)) > 0)'
+ ' OR (z.PermKeyDesc = ''Culture'' AND charindex(nchar(191)+convert(varchar,x.PermId)+nchar(191),nchar(191)+'''+@Cultures+'''+nchar(191)) > 0)'
+ ' OR (z.PermKeyDesc = ''Usr'' AND charindex(nchar(191)+convert(varchar,x.PermId)+nchar(191),nchar(191)+'''+@Usrs+'''+nchar(191)) > 0)'
+ ' OR (z.PermKeyDesc = ''Customer'' AND charindex(nchar(191)+convert(varchar,x.PermId)+nchar(191),nchar(191)+'''+@Customers+'''+nchar(191)) > 0)'
+ ' OR (z.PermKeyDesc = ''Vendor'' AND charindex(nchar(191)+convert(varchar,x.PermId)+nchar(191),nchar(191)+'''+@Vendors+'''+nchar(191)) > 0)'
+ ' OR (z.PermKeyDesc = ''Member'' AND charindex(nchar(191)+convert(varchar,x.PermId)+nchar(191),nchar(191)+'''+@Members+'''+nchar(191)) > 0)'
+ ' OR (z.PermKeyDesc = ''Investor'' AND charindex(nchar(191)+convert(varchar,x.PermId)+nchar(191),nchar(191)+'''+@Investors+'''+nchar(191)) > 0)'
+ ' OR (z.PermKeyDesc = ''Agent'' AND charindex(nchar(191)+convert(varchar,x.PermId)+nchar(191),nchar(191)+'''+@Agents+'''+nchar(191)) > 0)'
+ ' OR (z.PermKeyDesc = ''Broker'' AND charindex(nchar(191)+convert(varchar,x.PermId)+nchar(191),nchar(191)+'''+@Brokers+'''+nchar(191)) > 0)'
+ '))) AND '
IF @rptwizCatId is null
BEGIN
	IF @bAll = 'Y' SELECT @wClause = @ColFilter + '(1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
END
ELSE
BEGIN
	SELECT @wClause = @ColFilter + '(a182.RptwizCatId = ' + convert(varchar,@rptwizCatId)
	IF @bAll = 'Y' SELECT @wClause = @wClause + ' OR ' ELSE SELECT @wClause = @wClause + ' AND '
END
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @sClause = ' DECLARE @CultureId smallint'
+ ' SELECT @CultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = ''Y'''
+ ' IF EXISTS (SELECT 1 FROM dbo.#col x INNER JOIN dbo.ScreenObj y ON x.ColumnId = y.ColumnId'
	+ ' INNER JOIN dbo.ScreenObjHlp z ON y.ScreenObjId = z.ScreenObjId AND z.CultureId = ' + convert(varchar,@currCultureId) + ')'
	+ ' UPDATE #col SET ColumnHeader = z.ColumnHeader'
		+ ' FROM #col x INNER JOIN dbo.ScreenObj y ON x.ColumnId = y.ColumnId'
		+ ' INNER JOIN dbo.ScreenObjHlp z ON y.ScreenObjId = z.ScreenObjId AND z.CultureId = ' + convert(varchar,@currCultureId)
		+ ' WHERE z.ColumnHeader is not null'
+ ' ELSE'
	+ ' UPDATE #col SET ColumnHeader = z.ColumnHeader'
		+ ' FROM #col x INNER JOIN dbo.ScreenObj y ON x.ColumnId = y.ColumnId'
		+ ' INNER JOIN dbo.ScreenObjHlp z ON y.ScreenObjId = z.ScreenObjId AND z.CultureId = @CultureId'
		+ ' WHERE z.ColumnHeader is not null'
+ ' SELECT ColumnId33=ColumnId, ColumnId33Text=ColumnHeader, NumericData FROM #col'
SELECT @oClause = 'ORDER BY ColumnHeader'
EXEC (@dClause + ' ' + @fClause + ' ' + @wClause + ' ' + @sClause + ' ' + @oClause + ' DROP TABLE dbo.#col')
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlOrientationCd3S1010') AND type='P')
DROP PROCEDURE dbo.GetDdlOrientationCd3S1010
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlOrientationCd3S1010
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' OrientationCd22=a187.OrientationCd, OrientationCd22Text=a187.OrientationName'
SELECT @fClause = 'FROM RODesign.dbo.CtOrientation a187'
SELECT @oClause = 'ORDER BY a187.OrientationName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a187.OrientationName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a187.OrientationCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT OrientationCd22=null, OrientationCd22Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlOrientationCd3S1674') AND type='P')
DROP PROCEDURE dbo.GetDdlOrientationCd3S1674
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlOrientationCd3S1674]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' OrientationCd183=a187.OrientationCd, OrientationCd183Text=a187.OrientationName'
SELECT @fClause = 'FROM RODesign.dbo.CtOrientation a187'
SELECT @oClause = 'ORDER BY a187.OrientationName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a187.OrientationName LIKE N''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a187.OrientationCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT OrientationCd183=null, OrientationCd183Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlOvrideId3S1239') AND type='P')
DROP PROCEDURE dbo.GetDdlOvrideId3S1239
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlOvrideId3S1239]
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' OvrideId236=a122.OvrideId, OvrideId236Text=a122.OvrideName'
SELECT @fClause = 'FROM RODesign.dbo.Ovride a122'
SELECT @oClause = 'ORDER BY a122.OvrideName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a122.OvrideName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a122.OvrideId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT OvrideId236=null, OvrideId236Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlParentGrpId3S982') AND type='P')
DROP PROCEDURE dbo.GetDdlParentGrpId3S982
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlParentGrpId3S982
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ParentGrpId94=a94.ReportGrpId, ParentGrpId94Text=a94.ReportGrpName'
SELECT @fClause = 'FROM dbo.ReportGrp a94'
SELECT @oClause = 'ORDER BY a94.ReportGrpName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a94.ReportGrpName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a94.ReportGrpId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ParentGrpId94=null, ParentGrpId94Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlParentId3S1609') AND type='P')
DROP PROCEDURE dbo.GetDdlParentId3S1609
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlParentId3S1609
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ParentId162=a162.RptTblId, ParentId162Text=a162.RptTblDesc'
SELECT @fClause = 'FROM dbo.RptTbl a162'
SELECT @oClause = 'ORDER BY a162.RptTblDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a162.RptTblDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a162.RptTblId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ParentId162=null, ParentId162Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlPermId3S1751') AND type='P')
DROP PROCEDURE dbo.GetDdlPermId3S1751
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlPermId3S1751
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' PermId231=a1299.PermId, PermId231Text=a1299.PermIdText, a1299.Active, a1299.PermKeyId'
SELECT @fClause = 'FROM RODesign.dbo.VwPermKeyRow a1299'
SELECT @oClause = 'ORDER BY a1299.PermIdText'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((a1299.Active = ''Y'') ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1299.PermIdText LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1299.PermId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyId','Company','a1299.','Y','N',null,'Y','PermKeyRowId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a1299.','Y','Y',null,'Y','PermKeyRowId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1299.','Y','N',null,'Y','PermKeyRowId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Projects,'ProjectId','Project','a1299.','Y','N',null,'Y','PermKeyRowId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Projects,'ProjectLs','Project','a1299.','Y','Y',null,'Y','PermKeyRowId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Agents,'AgentId','Agent','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Brokers,'BrokerId','Broker','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Customers,'CustomerId','Customer','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Investors,'InvestorId','Investor','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Members,'MemberId','Member','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@UsrGroups,'UsrGroupId','UsrGroup','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'UsrId','Usr','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Vendors,'VendorId','Vendor','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Lenders,'LenderId','Lender','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Borrowers,'BorrowerId','Borrower','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Guarantors,'GuarantorId','Guarantor','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a1299.','Y',null,'PermKeyRowId',@wClause OUTPUT
EXEC RODesign.dbo.GetCurrFilter @currProjectId,'ProjectLs','Project','a1299.','Y',null,'PermKeyRowId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT PermId231=null, PermId231Text=null, Active=null, PermKeyId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlPermId3S1887') AND type='P')
DROP PROCEDURE dbo.GetDdlPermId3S1887
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlPermId3S1887]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' PermId241=a1299.PermKeyRowId, PermId241Text=a1299.PermIdText, a1299.Active, a1299.PermKeyId'
SELECT @fClause = 'FROM RODesign.dbo.VwPermKeyRow a1299'
SELECT @oClause = 'ORDER BY a1299.PermIdText'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((a1299.Active = ''Y'') ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1299.PermIdText LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1299.PermKeyRowId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyId','Company','a1299.','Y','N',null,'Y','PermKeyRowId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a1299.','Y','Y',null,'Y','PermKeyRowId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1299.','Y','N',null,'Y','PermKeyRowId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Projects,'ProjectId','Project','a1299.','Y','N',null,'Y','PermKeyRowId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Projects,'ProjectLs','Project','a1299.','Y','Y',null,'Y','PermKeyRowId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Agents,'AgentId','Agent','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Brokers,'BrokerId','Broker','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Customers,'CustomerId','Customer','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Investors,'InvestorId','Investor','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Members,'MemberId','Member','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@UsrGroups,'UsrGroupId','UsrGroup','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'UsrId','Usr','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Vendors,'VendorId','Vendor','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a1299.','Y',null,'PermKeyRowId',@wClause OUTPUT
EXEC RODesign.dbo.GetCurrFilter @currProjectId,'ProjectLs','Project','a1299.','Y',null,'PermKeyRowId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT PermId241=null, PermId241Text=null, Active=null, PermKeyId=null WHERE 1<>1
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlPermKeyId3S182') AND type='P')
DROP PROCEDURE dbo.GetDdlPermKeyId3S182
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlPermKeyId3S182
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' PermKeyId241=a230.PermKeyId, PermKeyId241Text=a230.PermKeyDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwPermKey a230'
SELECT @oClause = 'ORDER BY a230.PermKeyDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a230.PermKeyDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a230.PermKeyId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT PermKeyId241=null, PermKeyId241Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlPermKeyId3S1882') AND type='P')
DROP PROCEDURE dbo.GetDdlPermKeyId3S1882
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlPermKeyId3S1882
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' PermKeyId239=a230.PermKeyId, PermKeyId239Text=a230.PermKeyDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwPermKey a230'
SELECT @oClause = 'ORDER BY a230.PermKeyDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a230.PermKeyDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a230.PermKeyId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT PermKeyId239=null, PermKeyId239Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlPermKeyId3S833') AND type='P')
DROP PROCEDURE dbo.GetDdlPermKeyId3S833
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlPermKeyId3S833
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' PermKeyId231=a230.PermKeyId, PermKeyId231Text=a230.PermKeyDesc'
SELECT @fClause = 'FROM RODesign.dbo.VwPermKey a230'
SELECT @oClause = 'ORDER BY a230.PermKeyDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a230.PermKeyDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a230.PermKeyId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT PermKeyId231=null, PermKeyId231Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlPermKeyRowId3S1887') AND type='P')
DROP PROCEDURE dbo.GetDdlPermKeyRowId3S1887
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlPermKeyRowId3S1887
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' PermKeyRowId241=a1299.PermKeyRowId, PermKeyRowId241Text=a1299.PermIdText, a1299.Active, a1299.PermKeyId'
SELECT @fClause = 'FROM RODesign.dbo.VwPermKeyRow a1299'
SELECT @oClause = 'ORDER BY a1299.PermIdText'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((a1299.Active = ''Y'') ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1299.PermIdText LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1299.PermKeyRowId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyId','Company','a1299.','Y','N',null,'Y','PermKeyRowId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a1299.','Y','Y',null,'Y','PermKeyRowId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1299.','Y','N',null,'Y','PermKeyRowId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Projects,'ProjectId','Project','a1299.','Y','N',null,'Y','PermKeyRowId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Projects,'ProjectLs','Project','a1299.','Y','Y',null,'Y','PermKeyRowId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Agents,'AgentId','Agent','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Brokers,'BrokerId','Broker','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Customers,'CustomerId','Customer','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Investors,'InvestorId','Investor','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Members,'MemberId','Member','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@UsrGroups,'UsrGroupId','UsrGroup','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'UsrId','Usr','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Vendors,'VendorId','Vendor','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Lenders,'LenderId','Lender','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Borrowers,'BorrowerId','Borrower','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Guarantors,'GuarantorId','Guarantor','a1299.','N','N',null,'Y','PermKeyRowId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a1299.','Y',null,'PermKeyRowId',@wClause OUTPUT
EXEC RODesign.dbo.GetCurrFilter @currProjectId,'ProjectLs','Project','a1299.','Y',null,'PermKeyRowId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT PermKeyRowId241=null, PermKeyRowId241Text=null, Active=null, PermKeyId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlPopup3S1805') AND type='P')
DROP PROCEDURE dbo.GetDdlPopup3S1805
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlPopup3S1805]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
SELECT @sClause = 'SELECT distinct Popup226=a125.CheckBoxCd, Popup226Text=a125.CheckBoxName'
SELECT @fClause = 'FROM RODesign.dbo.CtCheckBox a125'
SELECT @oClause = 'ORDER BY a125.CheckBoxName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a125.CheckBoxCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlPRptCtrId3S1574') AND type='P')
DROP PROCEDURE dbo.GetDdlPRptCtrId3S1574
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlPRptCtrId3S1574
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' PRptCtrId161=a161.RptCtrId, PRptCtrId161Text=a161.RptCtrDesc'
SELECT @fClause = 'FROM dbo.RptCtr a161'
SELECT @oClause = 'ORDER BY a161.RptCtrDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a161.RptCtrDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a161.RptCtrId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT PRptCtrId161=null, PRptCtrId161Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReactEventId3S4207') AND type='P')
DROP PROCEDURE dbo.GetDdlReactEventId3S4207
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReactEventId3S4207
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReactEventId128=a1311.RuleReactTypeId, ReactEventId128Text=a1311.RuleReactTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtRuleReactType a1311'
SELECT @oClause = 'ORDER BY a1311.RuleReactTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1311.RuleReactTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1311.RuleReactTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReactEventId128=null, ReactEventId128Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReduxEventId3S4210') AND type='P')
DROP PROCEDURE dbo.GetDdlReduxEventId3S4210
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReduxEventId3S4210
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReduxEventId128=a1316.RuleReduxTypeId, ReduxEventId128Text=a1316.RuleReduxTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtRuleReduxType a1316'
SELECT @oClause = 'ORDER BY a1316.RuleReduxTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1316.RuleReduxTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1316.RuleReduxTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReduxEventId128=null, ReduxEventId128Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRefColumnId3S169') AND type='P')
DROP PROCEDURE dbo.GetDdlRefColumnId3S169
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRefColumnId3S169
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RefColumnId20=a5.ColumnId, RefColumnId20Text=a5.ColumnDesc, a5.TableId'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RefColumnId20=null, RefColumnId20Text=null, TableId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRefTableId3S168') AND type='P')
DROP PROCEDURE dbo.GetDdlRefTableId3S168
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRefTableId3S168
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RefTableId20=a3.TableId, RefTableId20Text=a3.TableName'
SELECT @fClause = 'FROM dbo.DbTable a3'
SELECT @oClause = 'ORDER BY a3.TableName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a3.TableName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a3.TableId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a3.','N','N',null,'Y','TableId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RefTableId20=null, RefTableId20Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportCriHlpId3S1267') AND type='P')
DROP PROCEDURE dbo.GetDdlReportCriHlpId3S1267
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportCriHlpId3S1267
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportCriHlpId127=a1298.ReportCriHlpId, ReportCriHlpId127Text=a1298.ReportCriHlpDesc, a1298.ReportId'
SELECT @fClause = 'FROM dbo.VwReportCriHlp a1298'
SELECT @oClause = 'ORDER BY a1298.ReportCriHlpDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1298.ReportCriHlpDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1298.ReportCriHlpId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1298.','Y','N',null,'N','ReportCriHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportCriHlpId127=null, ReportCriHlpId127Text=null, ReportId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportCriId3S1025') AND type='P')
DROP PROCEDURE dbo.GetDdlReportCriId3S1025
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportCriId3S1025
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportCriId23=a97.ReportCriId, ReportCriId23Text=a97.ColumnName, a97.ReportId'
SELECT @fClause = 'FROM dbo.ReportCri a97'
SELECT @oClause = 'ORDER BY a97.ColumnName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a97.ColumnName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a97.ReportCriId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportCriId23=null, ReportCriId23Text=null, ReportId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportGrpId3S1076') AND type='P')
DROP PROCEDURE dbo.GetDdlReportGrpId3S1076
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportGrpId3S1076
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportGrpId97=a94.ReportGrpId, ReportGrpId97Text=a94.ReportGrpName'
SELECT @fClause = 'FROM dbo.ReportGrp a94'
SELECT @oClause = 'ORDER BY a94.ReportGrpName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a94.ReportGrpName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a94.ReportGrpId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportGrpId97=null, ReportGrpId97Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId1003C13') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId1003C13
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlReportId1003C13]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a22.ReportId, a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE ''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ') ' 
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId=null, ReportDesc=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId1003C2') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId1003C2
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetDdlReportId1003C2]
 @screenId		int
,@RowAuthoritys		varchar(1000)
,@Usrs		varchar(1000)
,@UsrGroups		varchar(1000)
,@Cultures		varchar(1000)
,@Companys		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@Customers		varchar(1000)
,@Investors		varchar(1000)
,@Members		varchar(1000)
,@Vendors		varchar(1000)
,@Projects		varchar(1000)
,@currCompanyId		smallint
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a22.ReportId, a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
SELECT @wClause = 'WHERE 1=1'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId=null, ReportDesc=null WHERE 1<>1
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId1003C4') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId1003C4
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlReportId1003C4]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a22.ReportId, a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE ''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ') ' 
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId=null, ReportDesc=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId103C13') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId103C13
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId103C13
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a22.ReportId, a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a22.ReportId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId=null, ReportDesc=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId103C2') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId103C2
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId103C2
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a22.ReportId, a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a22.ReportId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId=null, ReportDesc=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId103C29') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId103C29
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId103C29
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a22.ReportId, a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a22.ReportId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId=null, ReportDesc=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId103C30') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId103C30
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId103C30
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a22.ReportId, a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a22.ReportId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId=null, ReportDesc=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId103C34') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId103C34
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId103C34
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a22.ReportId, a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a22.ReportId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId=null, ReportDesc=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId103C4') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId103C4
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId103C4
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a22.ReportId, a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a22.ReportId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId=null, ReportDesc=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId1503C11') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId1503C11
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlReportId1503C11]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		smallint
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a22.ReportId, a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE ''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ') ' 
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId=null, ReportDesc=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId203C11') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId203C11
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId203C11
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a22.ReportId, a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a22.ReportId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId=null, ReportDesc=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId203C39') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId203C39
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId203C39
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a22.ReportId, a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a22.ReportId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId=null, ReportDesc=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId3S1075') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId3S1075
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId3S1075
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportId97=a22.ReportId, ReportId97Text=a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a22.ReportId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId97=null, ReportId97Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId3S121') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId3S121
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId3S121
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportId23=a22.ReportId, ReportId23Text=a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a22.ReportId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId23=null, ReportId23Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId3S1214') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId3S1214
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId3S1214
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportId116=a22.ReportId, ReportId116Text=a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a22.ReportId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId116=null, ReportId116Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId3S1265') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId3S1265
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId3S1265
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportId127=a22.ReportId, ReportId127Text=a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a22.ReportId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId127=null, ReportId127Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId3S1365') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId3S1365
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId3S1365
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportId136=a22.ReportId, ReportId136Text=a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a22.ReportId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId136=null, ReportId136Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId3S1577') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId3S1577
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId3S1577
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportId161=a22.ReportId, ReportId161Text=a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a22.ReportId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId161=null, ReportId161Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId3S1599') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId3S1599
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId3S1599
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportId160=a22.ReportId, ReportId160Text=a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a22.ReportId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId160=null, ReportId160Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId3S1672') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId3S1672
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlReportId3S1672]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
SELECT @sClause = 'SELECT ReportId183=a.ReportId, ReportId183Text=a.ReportDesc, a.ProgramName, b.ReportTitle'
SELECT @fClause = 'FROM dbo.UtReport a INNER JOIN dbo.UtReportHlp b ON a.ReportId = b.ReportId'
	+ ' INNER JOIN RODesign.dbo.VwCulture d ON b.CultureId = d.CultureId AND d.CultureDefault = ''Y'''
SELECT @oClause = 'ORDER BY a.ReportDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a.ReportId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
/*
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportId183=a22.ReportId, ReportId183Text=a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE N''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a22.ReportId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId183=null, ReportId183Text=null WHERE 1<>1
*/
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId3S1695') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId3S1695
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId3S1695
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportId162=a22.ReportId, ReportId162Text=a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a22.ReportId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId162=null, ReportId162Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId3S1733') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId3S1733
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId3S1733
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportId206=a22.ReportId, ReportId206Text=a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a22.ReportId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId206=null, ReportId206Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId3S1750') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId3S1750
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId3S1750
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportId238=a22.ReportId, ReportId238Text=a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a22.ReportId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId238=null, ReportId238Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId3S1766') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId3S1766
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlReportId3S1766]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@RowAuthoritys		varchar(1000)
,@Usrs		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
SELECT @sClause = 'SELECT distinct ReportId210=a22.ReportId, ReportId210Text=a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a22.ReportId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId3S436') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId3S436
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId3S436
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportId39=a22.ReportId, ReportId39Text=a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a22.ReportId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId39=null, ReportId39Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportId3S967') AND type='P')
DROP PROCEDURE dbo.GetDdlReportId3S967
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportId3S967
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportId94=a22.ReportId, ReportId94Text=a22.ReportDesc'
SELECT @fClause = 'FROM dbo.Report a22'
SELECT @oClause = 'ORDER BY a22.ReportDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a22.ReportDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a22.ReportId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a22.','Y',null,'ReportId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportId94=null, ReportId94Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportSctId3S1223') AND type='P')
DROP PROCEDURE dbo.GetDdlReportSctId3S1223
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlReportSctId3S1223]
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
	,@cc		varchar(8000)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @sClause = 'SELECT distinct ReportSctId117=a118.ReportSctId, ReportSctId117Text=a118.ReportSctDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtReportSct a118'
SELECT @oClause = 'ORDER BY a118.ReportSctDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a118.ReportSctId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlReportTypeCd3S1729') AND type='P')
DROP PROCEDURE dbo.GetDdlReportTypeCd3S1729
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlReportTypeCd3S1729
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportTypeCd22=a203.ReportTypeCd, ReportTypeCd22Text=a203.ReportTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtReportType a203'
SELECT @oClause = 'ORDER BY a203.ReportTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a203.ReportTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a203.ReportTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ReportTypeCd22=null, ReportTypeCd22Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRowAuthId3S200') AND type='P')
DROP PROCEDURE dbo.GetDdlRowAuthId3S200
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRowAuthId3S200
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RowAuthId238=a240.RowAuthId, RowAuthId238Text=a240.RowAuthName, a240.OvrideId, ov.PromptAlways, ov.PromptModal'
SELECT @fClause = 'FROM RODesign.dbo.VwRowAuth a240 LEFT OUTER JOIN RODesign.dbo.Ovride ov ON a240.OvrideId = ov.OvrideId'
SELECT @oClause = 'ORDER BY a240.RowAuthName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a240.RowAuthName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a240.RowAuthId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RowAuthId238=null, RowAuthId238Text=null, OvrideId=null, PromptAlways=null, PromptModal=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRowVisible3S4160') AND type='P')
DROP PROCEDURE dbo.GetDdlRowVisible3S4160
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRowVisible3S4160
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RowVisible116=a1306.ButtonStyleCd, RowVisible116Text=a1306.ButtonStyleDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtButtonStyle a1306'
SELECT @oClause = 'ORDER BY a1306.ButtonStyleDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1306.ButtonStyleDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1306.ButtonStyleCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RowVisible116=null, RowVisible116Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptCelId3S1576') AND type='P')
DROP PROCEDURE dbo.GetDdlRptCelId3S1576
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRptCelId3S1576
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptCelId161=a164.RptCelId, RptCelId161Text=a164.RptCelDesc'
SELECT @fClause = 'FROM dbo.RptCel a164'
SELECT @oClause = 'ORDER BY a164.RptCelDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a164.RptCelDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a164.RptCelId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RptCelId161=null, RptCelId161Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptChart3S1652') AND type='P')
DROP PROCEDURE dbo.GetDdlRptChart3S1652
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetDdlRptChart3S1652]
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
		,@fClause		varchar(8000)
		,@oClause		varchar(8000)
SELECT @sClause = 'SELECT RptChartCd184 = a184.RptChartCd, RptChartCd184Text = a184.RptChartName'
SELECT @fClause = 'FROM RODesign.dbo.CtRptChart a184'
SELECT @oClause = 'ORDER BY a184.RptChartName'
EXEC (@sClause + ' ' + @fClause + ' ' + @oClause)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptChaTypeCd3S1734') AND type='P')
DROP PROCEDURE dbo.GetDdlRptChaTypeCd3S1734
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRptChaTypeCd3S1734
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptChaTypeCd206=a205.RptChaTypeCd, RptChaTypeCd206Text=a205.RptChaTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtRptChaType a205'
SELECT @oClause = 'ORDER BY a205.RptChaTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a205.RptChaTypeName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a205.RptChaTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RptChaTypeCd206=null, RptChaTypeCd206Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptChaTypeCd3S1739') AND type='P')
DROP PROCEDURE dbo.GetDdlRptChaTypeCd3S1739
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlRptChaTypeCd3S1739]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptChaTypeCd183=a205.RptChaTypeCd, RptChaTypeCd183Text=a205.RptChaTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtRptChaType a205'
SELECT @oClause = 'ORDER BY a205.RptChaTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a205.RptChaTypeName LIKE N''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a205.RptChaTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RptChaTypeCd183=null, RptChaTypeCd183Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptCtrId203C31') AND type='P')
DROP PROCEDURE dbo.GetDdlRptCtrId203C31
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRptCtrId203C31
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a161.RptCtrId, a161.RptCtrDesc'
SELECT @fClause = 'FROM dbo.RptCtr a161'
SELECT @oClause = 'ORDER BY a161.RptCtrDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a161.RptCtrDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a161.RptCtrId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RptCtrId=null, RptCtrDesc=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptCtrId3S1610') AND type='P')
DROP PROCEDURE dbo.GetDdlRptCtrId3S1610
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRptCtrId3S1610
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptCtrId162=a161.RptCtrId, RptCtrId162Text=a161.RptCtrDesc'
SELECT @fClause = 'FROM dbo.RptCtr a161'
SELECT @oClause = 'ORDER BY a161.RptCtrDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a161.RptCtrDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a161.RptCtrId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RptCtrId162=null, RptCtrId162Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptCtrId3S1732') AND type='P')
DROP PROCEDURE dbo.GetDdlRptCtrId3S1732
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRptCtrId3S1732
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptCtrId206=a161.RptCtrId, RptCtrId206Text=a161.RptCtrDesc'
SELECT @fClause = 'FROM dbo.RptCtr a161'
SELECT @oClause = 'ORDER BY a161.RptCtrDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a161.RptCtrDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a161.RptCtrId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RptCtrId206=null, RptCtrId206Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptCtrTypeCd3S1578') AND type='P')
DROP PROCEDURE dbo.GetDdlRptCtrTypeCd3S1578
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRptCtrTypeCd3S1578
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptCtrTypeCd161=a157.RptCtrTypeCd, RptCtrTypeCd161Text=a157.RptCtrTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtRptCtrType a157'
SELECT @oClause = 'ORDER BY a157.RptCtrTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a157.RptCtrTypeName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a157.RptCtrTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RptCtrTypeCd161=null, RptCtrTypeCd161Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptElmId3S1575') AND type='P')
DROP PROCEDURE dbo.GetDdlRptElmId3S1575
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRptElmId3S1575
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptElmId161=a160.RptElmId, RptElmId161Text=a160.RptElmDesc'
SELECT @fClause = 'FROM dbo.RptElm a160'
SELECT @oClause = 'ORDER BY a160.RptElmDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a160.RptElmDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a160.RptElmId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RptElmId161=null, RptElmId161Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptElmTypeCd3S1600') AND type='P')
DROP PROCEDURE dbo.GetDdlRptElmTypeCd3S1600
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRptElmTypeCd3S1600
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptElmTypeCd160=a158.RptElmTypeCd, RptElmTypeCd160Text=a158.RptElmTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtRptElmType a158'
SELECT @oClause = 'ORDER BY a158.RptElmTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a158.RptElmTypeName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a158.RptElmTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RptElmTypeCd160=null, RptElmTypeCd160Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptGroupId3S1652') AND type='P')
DROP PROCEDURE dbo.GetDdlRptGroupId3S1652
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetDdlRptGroupId3S1652]
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
		,@fClause		varchar(8000)
		,@oClause		varchar(8000)
SELECT @sClause = 'SELECT RptGroupId184 = a186.RptGroupId, RptGroupId184Text = a186.RptGroupName'
SELECT @fClause = 'FROM RODesign.dbo.CtRptGroup a186'
SELECT @oClause = 'ORDER BY a186.RptGroupId'
EXEC (@sClause + ' ' + @fClause + ' ' + @oClause)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptMemCri') AND type='P')
DROP PROCEDURE dbo.GetDdlRptMemCri
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlRptMemCri]
 @GenPrefix		varchar(10)
,@reportId		int
,@bAll			char(1)
,@keyId			Int
,@RowAuthoritys	varchar(1000)
,@Usrs			varchar(1000)
,@Companys		varchar(1000)
,@currCompanyId	int
,@currProjectId	int
,@FilterTxt		nvarchar(1000) = null
,@TopN			smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
		,@fClause		varchar(8000)
		,@wClause		varchar(8000)
		,@oClause		varchar(8000)
		,@tClause		varchar(8000)
SELECT @sClause = 'SELECT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' a.RptMemCriId, a.RptMemCriName, a.RptMemCriDesc, a.RptMemFldId, a.UsrId, a.InputBy'
SELECT @fClause = 'FROM dbo.' + @GenPrefix + 'RptMemCri a'
SELECT @oClause = 'ORDER BY a.RptMemCriName'
SELECT @wClause = 'WHERE a.ReportId = ' + convert(varchar,@reportId) + ' AND ('
IF @bAll = 'Y' SELECT @wClause = @wClause + '((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a.RptMemCriName LIKE N''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ')  OR ' 
ELSE SELECT @wClause = @wClause + '1=1 OR '
IF @keyId is not null SELECT @wClause = @wClause + 'a.RptMemCriId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter null,0,@RowAuthoritys,@Companys,'CompanyLs','Company','a.','Y','Y',null,'Y','RptMemCriId',@wClause OUTPUT
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter null,0,@RowAuthoritys,@Usrs,'UsrId','Usr','a.','N','N',null,'Y','RptMemCriId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter null,0,@RowAuthoritys,@Usrs,'InputBy','Usr','a.','N','N',null,'N','RptMemCriId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a.','Y',null,'RptMemCriId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptMemFld') AND type='P')
DROP PROCEDURE dbo.GetDdlRptMemFld
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlRptMemFld]
 @GenPrefix		varchar(10)
,@bAll			char(1)
,@keyId			Int
,@RowAuthoritys	varchar(1000)
,@Usrs			varchar(1000)
,@Companys		varchar(1000)
,@currCompanyId	int
,@currProjectId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
SELECT @sClause = 'SELECT a.RptMemFldId, a.RptMemFldName, a.UsrId, a.InputBy'
SELECT @fClause = 'FROM dbo.' + @GenPrefix + 'RptMemFld a'
SELECT @oClause = 'ORDER BY a.RptMemFldName'
SELECT @wClause = 'WHERE ('
IF @bAll = 'Y' SELECT @wClause = @wClause + '1=1 OR '
IF @keyId is not null SELECT @wClause = @wClause + 'a.RptMemFldId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter null,0,@RowAuthoritys,@Companys,'CompanyLs','Company','a.','Y','Y',null,'Y','RptMemFldId',@wClause OUTPUT
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter null,0,@RowAuthoritys,@Usrs,'UsrId','Usr','a.','N','N',null,'Y','RptMemFldId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter null,0,@RowAuthoritys,@Usrs,'InputBy','Usr','a.','N','N',null,'N','RptMemFldId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a.','Y',null,'RptMemFldId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptObjTypeCd3S1469') AND type='P')
DROP PROCEDURE dbo.GetDdlRptObjTypeCd3S1469
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRptObjTypeCd3S1469
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptObjTypeCd23=a156.RptObjTypeCd, RptObjTypeCd23Text=a156.RptObjTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtRptObjType a156'
SELECT @oClause = 'ORDER BY a156.RptObjTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a156.RptObjTypeName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a156.RptObjTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RptObjTypeCd23=null, RptObjTypeCd23Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptStyleId3S1580') AND type='P')
DROP PROCEDURE dbo.GetDdlRptStyleId3S1580
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRptStyleId3S1580
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptStyleId161=a167.RptStyleId, RptStyleId161Text=a167.RptStyleDesc'
SELECT @fClause = 'FROM dbo.RptStyle a167'
SELECT @oClause = 'ORDER BY a167.RptStyleDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a167.RptStyleDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a167.RptStyleId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RptStyleId161=null, RptStyleId161Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptStyleId3S1601') AND type='P')
DROP PROCEDURE dbo.GetDdlRptStyleId3S1601
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRptStyleId3S1601
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptStyleId160=a167.RptStyleId, RptStyleId160Text=a167.RptStyleDesc'
SELECT @fClause = 'FROM dbo.RptStyle a167'
SELECT @oClause = 'ORDER BY a167.RptStyleDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a167.RptStyleDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a167.RptStyleId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RptStyleId160=null, RptStyleId160Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptTblTypeCd3S1611') AND type='P')
DROP PROCEDURE dbo.GetDdlRptTblTypeCd3S1611
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRptTblTypeCd3S1611
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptTblTypeCd162=a159.RptTblTypeCd, RptTblTypeCd162Text=a159.RptTblTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtRptTblType a159'
SELECT @oClause = 'ORDER BY a159.RptTblTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a159.RptTblTypeName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a159.RptTblTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RptTblTypeCd162=null, RptTblTypeCd162Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptTemplate3S1728') AND type='P')
DROP PROCEDURE dbo.GetDdlRptTemplate3S1728
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRptTemplate3S1728
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT a204.DocId, DocLink=''~/DnLoad.aspx?tbl=dbo.RptTemplate&key='' + convert(varchar,a204.DocId), a204.DocName, DocSize=convert(varchar,a204.DocSize/1024) + ''KB'', a204.InputOn, LoginName=b.UsrName, ReportId=a204.MasterId'
SELECT @fClause = 'FROM dbo.RptTemplate a204 INNER JOIN RODesign.dbo.Usr b ON a204.InputBy = b.UsrId'
SELECT @oClause = 'ORDER BY a204.InputOn desc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((a204.Active = ''Y'') ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a204.DocName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + '(a204.MasterId is null OR a204.MasterId = ' + convert(varchar,@keyId) + '))' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'InputBy','Usr','a204.','N','N',null,'Y','DocId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT DocId=null, DocLink=null, DocName=null, DocSize=null, InputOn=null, LoginName=null, ReportId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptwizCatId3S1638') AND type='P')
DROP PROCEDURE dbo.GetDdlRptwizCatId3S1638
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlRptwizCatId3S1638]
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptwizCatId183=a181.RptwizCatId, RptwizCatId183Text=a181.RptwizCatDesc, CatDescription181=a181.CatDescription, RptwizCatImg181=a181.SampleImage'
SELECT @fClause = 'FROM dbo.RptwizCat a181'
SELECT @oClause = 'ORDER BY a181.RptwizCatDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a181.RptwizCatDesc LIKE N''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a181.RptwizCatId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RptwizCatId183=null, RptwizCatId183Text=null, CatDescription181=null, RptwizCatImg181=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptwizTypeCd3S1637') AND type='P')
DROP PROCEDURE dbo.GetDdlRptwizTypeCd3S1637
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlRptwizTypeCd3S1637]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
SELECT @sClause = ' IF object_id(''tempdb.dbo.#type'') is not null DROP TABLE dbo.#type'
+ ' CREATE TABLE #type (RptwizTypeCd183 char(1) not null, RptwizTypeCd183Text nvarchar(50) not null, RptCtrTypeDesc157 nvarchar(400) null)'
+ ' INSERT #type SELECT ''B'', ''Gauge Only'', ''This presents a gauge only, mainly for dashboard use.'''
+ ' INSERT #type SELECT ''C'', ''Chart Only'', ''This presents a chart only, mainly for dashboard use.'''
--+ ' INSERT #type SELECT ''L'', ''List Report'', ''This is the simplest and fastest way to list your data, grouped or ungrouped.'''
+ ' INSERT #type SELECT ''T'', ''Summary Table'', ''This list your data with subtotals and other summary information.'''
--+ ' INSERT #type SELECT ''D'', ''Document Merging'', ''This merges selected fields into your choice of rtf and txt documents.'''
+ ' SELECT * FROM #type'
EXEC (@sClause + ' DROP TABLE dbo.#type')
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRptwizTypId3S1671') AND type='P')
DROP PROCEDURE dbo.GetDdlRptwizTypId3S1671
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRptwizTypId3S1671
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptwizTypId181=a185.RptwizTypId, RptwizTypId181Text=a185.RptwizTypName'
SELECT @fClause = 'FROM dbo.RptwizTyp a185'
SELECT @oClause = 'ORDER BY a185.RptwizTypName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a185.RptwizTypName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a185.RptwizTypId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RptwizTypId181=null, RptwizTypId181Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRuleAsmxTypeId3S4192') AND type='P')
DROP PROCEDURE dbo.GetDdlRuleAsmxTypeId3S4192
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRuleAsmxTypeId3S4192
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RuleAsmxTypeId1313=a1310.RuleAsmxTypeId, RuleAsmxTypeId1313Text=a1310.RuleAsmxTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtRuleAsmxType a1310'
SELECT @oClause = 'ORDER BY a1310.RuleAsmxTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1310.RuleAsmxTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1310.RuleAsmxTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RuleAsmxTypeId1313=null, RuleAsmxTypeId1313Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRuleCntTypeId3S4075') AND type='P')
DROP PROCEDURE dbo.GetDdlRuleCntTypeId3S4075
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRuleCntTypeId3S4075
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RuleCntTypeId127=a1294.RuleCntTypeId, RuleCntTypeId127Text=a1294.RuleCntTypeName, RuleCntTypeDesc1294=a1294.RuleCntTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtRuleCntType a1294'
SELECT @oClause = 'ORDER BY a1294.RuleCntTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1294.RuleCntTypeName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1294.RuleCntTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RuleCntTypeId127=null, RuleCntTypeId127Text=null, RuleCntTypeDesc1294=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRuleLayerCd3S1627') AND type='P')
DROP PROCEDURE dbo.GetDdlRuleLayerCd3S1627
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlRuleLayerCd3S1627]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RuleLayerCd179=a180.RuleLayerCd, RuleLayerCd179Text=a180.RuleLayerDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtRuleLayer a180'
SELECT @oClause = 'ORDER BY a180.RuleLayerDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a180.RuleLayerDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a180.RuleLayerCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RuleLayerCd179=null, RuleLayerCd179Text=null WHERE 1<>1
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRuleMethodId3S4073') AND type='P')
DROP PROCEDURE dbo.GetDdlRuleMethodId3S4073
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRuleMethodId3S4073
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RuleMethodId127=a1295.RuleMethodId, RuleMethodId127Text=a1295.RuleMethodName, a1295.RuleMethodId, RuleMethodDesc1295=a1295.RuleMethodDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtRuleMethod a1295'
SELECT @oClause = 'ORDER BY a1295.RuleMethodId'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1295.RuleMethodName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1295.RuleMethodId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RuleMethodId127=null, RuleMethodId127Text=null, RuleMethodId=null, RuleMethodDesc1295=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRuleReactTypeId3S4199') AND type='P')
DROP PROCEDURE dbo.GetDdlRuleReactTypeId3S4199
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRuleReactTypeId3S4199
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RuleReactTypeId1312=a1311.RuleReactTypeId, RuleReactTypeId1312Text=a1311.RuleReactTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtRuleReactType a1311'
SELECT @oClause = 'ORDER BY a1311.RuleReactTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1311.RuleReactTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1311.RuleReactTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RuleReactTypeId1312=null, RuleReactTypeId1312Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRuleTypeId3S1284') AND type='P')
DROP PROCEDURE dbo.GetDdlRuleTypeId3S1284
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRuleTypeId3S1284
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RuleTypeId128=a25.RuleTypeId, RuleTypeId128Text=a25.RuleTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtRuleType a25'
SELECT @oClause = 'ORDER BY a25.RuleTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a25.RuleTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a25.RuleTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RuleTypeId128=null, RuleTypeId128Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRuleTypeId3S1293') AND type='P')
DROP PROCEDURE dbo.GetDdlRuleTypeId3S1293
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRuleTypeId3S1293
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RuleTypeId127=a25.RuleTypeId, RuleTypeId127Text=a25.RuleTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtRuleType a25'
SELECT @oClause = 'ORDER BY a25.RuleTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a25.RuleTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a25.RuleTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RuleTypeId127=null, RuleTypeId127Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRuleTypeId3S151') AND type='P')
DROP PROCEDURE dbo.GetDdlRuleTypeId3S151
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRuleTypeId3S151
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RuleTypeId24=a25.RuleTypeId, RuleTypeId24Text=a25.RuleTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtRuleType a25'
SELECT @oClause = 'ORDER BY a25.RuleTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a25.RuleTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a25.RuleTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RuleTypeId24=null, RuleTypeId24Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlRuleTypeId3S654') AND type='P')
DROP PROCEDURE dbo.GetDdlRuleTypeId3S654
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlRuleTypeId3S654
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RuleTypeId73=a25.RuleTypeId, RuleTypeId73Text=a25.RuleTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtRuleType a25'
SELECT @oClause = 'ORDER BY a25.RuleTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a25.RuleTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a25.RuleTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT RuleTypeId73=null, RuleTypeId73Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenCriHlpId3S1266') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenCriHlpId3S1266
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenCriHlpId3S1266
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenCriHlpId127=a1297.ScreenCriHlpId, ScreenCriHlpId127Text=a1297.ScreenCriHlpDesc, a1297.ScreenId'
SELECT @fClause = 'FROM dbo.VwScreenCriHlp a1297'
SELECT @oClause = 'ORDER BY a1297.ScreenCriHlpDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1297.ScreenCriHlpDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1297.ScreenCriHlpId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1297.','Y','N',null,'N','ScreenCriHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenCriHlpId127=null, ScreenCriHlpId127Text=null, ScreenId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenCriId3S1197') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenCriId3S1197
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenCriId3S1197]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenCriId107=a104.ScreenCriId, ScreenCriId107Text=a104.ScreenCriDesc'
SELECT @fClause = 'FROM dbo.ScreenCri a104'
SELECT @oClause = 'ORDER BY a104.ScreenCriDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a104.ScreenCriDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a104.ScreenCriId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenCriId107=null, ScreenCriId107Text=null WHERE 1<>1
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenCriId3S1302') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenCriId3S1302
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenCriId3S1302]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenCriId128=a104.ScreenCriId, ScreenCriId128Text=a104.ScreenCriDesc, a104.ScreenId'
SELECT @fClause = 'FROM dbo.ScreenCri a104'
SELECT @oClause = 'ORDER BY a104.ScreenCriDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a104.ScreenCriDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a104.ScreenCriId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenCriId128=null, ScreenCriId128Text=null, ScreenId=null WHERE 1<>1
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenGrpId3003C46') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenGrpId3003C46
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenGrpId3003C46]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		smallint
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a106.ScreenGrpId, a106.ScreenGrpName'
SELECT @fClause = 'FROM dbo.ScreenGrp a106'
SELECT @oClause = 'ORDER BY a106.ScreenGrpName'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a106.ScreenGrpName LIKE ''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ') ' 
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenGrpId=null, ScreenGrpName=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenGrpId3S1180') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenGrpId3S1180
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenGrpId3S1180]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenGrpId104=a106.ScreenGrpId, ScreenGrpId104Text=a106.ScreenGrpName'
SELECT @fClause = 'FROM RODesign.dbo.ScreenGrp a106'
SELECT @oClause = 'ORDER BY a106.ScreenGrpName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a106.ScreenGrpName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a106.ScreenGrpId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenGrpId104=null, ScreenGrpId104Text=null WHERE 1<>1
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId1003C1') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId1003C1
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenId1003C1]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ') ' 
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId1003C12') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId1003C12
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenId1003C12]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		smallint
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ') ' 
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId1003C15') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId1003C15
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenId1003C15]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ') ' 
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId1003C16') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId1003C16
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenId1003C16]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ') ' 
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId1003C3') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId1003C3
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenId1003C3]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		smallint
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ') ' 
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId1003C5') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId1003C5
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenId1003C5]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		smallint
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ') ' 
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId1003C9') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId1003C9
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenId1003C9]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		smallint
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ') ' 
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId1005C16') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId1005C16
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetDdlScreenId1005C16]
 @screenId		int
,@RowAuthoritys		varchar(1000)
,@Usrs		varchar(1000)
,@UsrGroups		varchar(1000)
,@Cultures		varchar(1000)
,@Companys		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@Customers		varchar(1000)
,@Investors		varchar(1000)
,@Members		varchar(1000)
,@Vendors		varchar(1000)
,@Projects		varchar(1000)
,@currCompanyId		smallint
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE 1=1'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId103C1') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId103C1
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenId103C1]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId103C1072') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId103C1072
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId103C1072
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a15.ScreenId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId103C1074') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId103C1074
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId103C1074
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a15.ScreenId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId103C1075') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId103C1075
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[GetDdlScreenId103C1075]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a15.ScreenId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId103C1078') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId103C1078
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenId103C1078]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId103C12') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId103C12
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenId103C12]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId103C15') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId103C15
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
CREATE PROCEDURE GetDdlScreenId103C15 @screenId		int,@Usrs		varchar(4000),@RowAuthoritys		varchar(4000),@Customers		varchar(4000),@Vendors		varchar(4000),@Members		varchar(4000),@Investors		varchar(4000),@Agents		varchar(4000),@Brokers		varchar(4000),@UsrGroups		varchar(4000),@Companys		varchar(4000),@Projects		varchar(4000),@Cultures		varchar(4000),@Borrowers		varchar(1000),@Guarantors		varchar(1000),@Lenders		varchar(1000),@currCompanyId		int,@currProjectId		int,@FilterTxt		nvarchar(1000) = null,@TopN		smallint=null,@bAll		char(1)=null,@keyId		varchar(max)=null/* WITH ENCRYPTION */ASSET NOCOUNT ONDECLARE	 @sClause		nvarchar(max)	,@fClause		nvarchar(max)	,@wClause		nvarchar(max)	,@oClause		nvarchar(max)	,@tClause		nvarchar(max)IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')BEGINSELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'SELECT @fClause = 'FROM dbo.Screen a15'SELECT @oClause = 'ORDER BY a15.ScreenDesc'SELECT @wClause = 'WHERE ( 1=1 '  + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') '  + CASE WHEN @bAll = 'N' THEN ' AND (a15.ScreenId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END SELECT @tClause = ''IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)ENDELSE	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1RETURN 0 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId103C16') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId103C16
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId103C16
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a15.ScreenId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId103C3') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId103C3
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId103C3
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a15.ScreenId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId103C38') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId103C38
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId103C38
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a15.ScreenId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId103C45') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId103C45
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenId103C45]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId103C5') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId103C5
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenId103C5]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId103C52') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId103C52
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId103C52
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a15.ScreenId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId103C60') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId103C60
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId103C60
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ProgramName'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ProgramName'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ProgramName LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a15.ScreenId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ProgramName=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId103C9') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId103C9
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId103C9
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a15.ScreenId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId104C1075') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId104C1075
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[GetDdlScreenId104C1075]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a15.ScreenId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId105C1075') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId105C1075
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[GetDdlScreenId105C1075]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a15.ScreenId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ScreenDesc=null WHERE 1<>1
RETURN 0

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId203C60') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId203C60
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenId203C60]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a15.ScreenId, a15.ProgramName'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ProgramName'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ProgramName LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId=null, ProgramName=null WHERE 1<>1
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S1159') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S1159
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenId3S1159]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId106=a15.ScreenId, ScreenId106Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId106=null, ScreenId106Text=null WHERE 1<>1
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S1179') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S1179
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId3S1179
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId104=a15.ScreenId, ScreenId104Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId104=null, ScreenId104Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S1194') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S1194
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenId3S1194]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId107=a15.ScreenId, ScreenId107Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId107=null, ScreenId107Text=null WHERE 1<>1
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S1208') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S1208
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId3S1208
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId116=a15.ScreenId, ScreenId116Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId116=null, ScreenId116Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S1258') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S1258
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId3S1258
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId127=a15.ScreenId, ScreenId127Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId127=null, ScreenId127Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S1268') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S1268
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId3S1268
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId14=a15.ScreenId, ScreenId14Text=a15.ScreenDesc, a15.ScreenTypeId'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId14=null, ScreenId14Text=null, ScreenTypeId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S1286') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S1286
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId3S1286
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId128=a15.ScreenId, ScreenId128Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId128=null, ScreenId128Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S1364') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S1364
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId3S1364
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId136=a15.ScreenId, ScreenId136Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId136=null, ScreenId136Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S139') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S139
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId3S139
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId24=a15.ScreenId, ScreenId24Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId24=null, ScreenId24Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S1631') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S1631
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenId3S1631]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId179=a15.ScreenId, ScreenId179Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId179=null, ScreenId179Text=null WHERE 1<>1
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S188') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S188
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId3S188
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId238=a15.ScreenId, ScreenId238Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId238=null, ScreenId238Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S1883') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S1883
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenId3S1883]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId241=a15.ScreenId, ScreenId241Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId241=null, ScreenId241Text=null WHERE 1<>1
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S1977') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S1977
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId3S1977
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId254=a15.ScreenId, ScreenId254Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId254=null, ScreenId254Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S3162') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S3162
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId3S3162
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId19=a15.ScreenId, ScreenId19Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId19=null, ScreenId19Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S3261') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S3261
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId3S3261
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId14=a15.ScreenId, ScreenId14Text=a15.ProgramName'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ProgramName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ProgramName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId14=null, ScreenId14Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S4107') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S4107
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId3S4107
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId1300=a15.ScreenId, ScreenId1300Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId1300=null, ScreenId1300Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S4196') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S4196
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId3S4196
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId1313=a15.ScreenId, ScreenId1313Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId1313=null, ScreenId1313Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S4203') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S4203
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId3S4203
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId1312=a15.ScreenId, ScreenId1312Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId1312=null, ScreenId1312Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S435') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S435
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId3S435
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId39=a15.ScreenId, ScreenId39Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId39=null, ScreenId39Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenId3S841') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenId3S841
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenId3S841
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId86=a15.ScreenId, ScreenId86Text=a15.ScreenDesc'
SELECT @fClause = 'FROM dbo.Screen a15'
SELECT @oClause = 'ORDER BY a15.ScreenDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a15.ScreenDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a15.ScreenId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenId86=null, ScreenId86Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenObjHlpId3S1260') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenObjHlpId3S1260
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenObjHlpId3S1260
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenObjHlpId127=a1296.ScreenObjHlpId, ScreenObjHlpId127Text=a1296.ScreenObjHlpDesc, a1296.ScreenId'
SELECT @fClause = 'FROM dbo.VwScreenObjHlp a1296'
SELECT @oClause = 'ORDER BY a1296.ScreenObjHlpDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1296.ScreenObjHlpDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1296.ScreenObjHlpId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1296.','Y','N',null,'N','ScreenObjHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenObjHlpId127=null, ScreenObjHlpId127Text=null, ScreenId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenObjId3S1287') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenObjId3S1287
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenObjId3S1287
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenObjId128=a14.ScreenObjId, ScreenObjId128Text=a14.ColumnDesc, a14.ScreenId'
SELECT @fClause = 'FROM dbo.ScreenObj a14'
SELECT @oClause = 'ORDER BY a14.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a14.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a14.ScreenObjId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenObjId128=null, ScreenObjId128Text=null, ScreenId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenObjId3S181') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenObjId3S181
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlScreenObjId3S181]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenObjId241=a14.ScreenObjId, ScreenObjId241Text=a14.ColumnDesc, a14.ScreenId'
SELECT @fClause = 'FROM dbo.ScreenObj a14'
SELECT @oClause = 'ORDER BY a14.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a14.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a14.ScreenObjId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenObjId241=null, ScreenObjId241Text=null, ScreenId=null WHERE 1<>1
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenObjId3S4204') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenObjId3S4204
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenObjId3S4204
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenObjId1312=a14.ScreenObjId, ScreenObjId1312Text=a14.ColumnName, a14.ScreenId'
SELECT @fClause = 'FROM dbo.ScreenObj a14'
SELECT @oClause = 'ORDER BY a14.ColumnName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a14.ColumnName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a14.ScreenObjId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenObjId1312=null, ScreenObjId1312Text=null, ScreenId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlScreenTypeId3S45') AND type='P')
DROP PROCEDURE dbo.GetDdlScreenTypeId3S45
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlScreenTypeId3S45
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenTypeId15=a17.ScreenTypeId, ScreenTypeId15Text=a17.ScreenTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtScreenType a17'
SELECT @oClause = 'ORDER BY a17.ScreenTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a17.ScreenTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a17.ScreenTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenTypeId15=null, ScreenTypeId15Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSearchDtlId3S4148') AND type='P')
DROP PROCEDURE dbo.GetDdlSearchDtlId3S4148
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlSearchDtlId3S4148
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' SearchDtlId15=a5.ColumnId, SearchDtlId15Text=a5.ColumnDesc, a5.TableId'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SearchDtlId15=null, SearchDtlId15Text=null, TableId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSearchDtlIdR3S4165') AND type='P')
DROP PROCEDURE dbo.GetDdlSearchDtlIdR3S4165
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlSearchDtlIdR3S4165
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' SearchDtlIdR15=a5.ColumnId, SearchDtlIdR15Text=a5.ColumnDesc, a5.TableId'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SearchDtlIdR15=null, SearchDtlIdR15Text=null, TableId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSearchId3S46') AND type='P')
DROP PROCEDURE dbo.GetDdlSearchId3S46
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlSearchId3S46
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' SearchId15=a5.ColumnId, SearchId15Text=a5.ColumnDesc, a5.TableId'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SearchId15=null, SearchId15Text=null, TableId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSearchIdR3S4164') AND type='P')
DROP PROCEDURE dbo.GetDdlSearchIdR3S4164
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlSearchIdR3S4164
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' SearchIdR15=a5.ColumnId, SearchIdR15Text=a5.ColumnDesc, a5.TableId'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SearchIdR15=null, SearchIdR15Text=null, TableId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSearchImgId3S4146') AND type='P')
DROP PROCEDURE dbo.GetDdlSearchImgId3S4146
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlSearchImgId3S4146
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' SearchImgId15=a5.ColumnId, SearchImgId15Text=a5.ColumnDesc, a5.TableId'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SearchImgId15=null, SearchImgId15Text=null, TableId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSearchTableId3S4145') AND type='P')
DROP PROCEDURE dbo.GetDdlSearchTableId3S4145
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlSearchTableId3S4145
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' SearchTableId15=a3.TableId, SearchTableId15Text=a3.TableDesc'
SELECT @fClause = 'FROM dbo.DbTable a3'
SELECT @oClause = 'ORDER BY a3.TableDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a3.TableDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a3.TableId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a3.','N','N',null,'Y','TableId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SearchTableId15=null, SearchTableId15Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSearchUrlId3S4147') AND type='P')
DROP PROCEDURE dbo.GetDdlSearchUrlId3S4147
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlSearchUrlId3S4147
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' SearchUrlId15=a5.ColumnId, SearchUrlId15Text=a5.ColumnDesc, a5.TableId'
SELECT @fClause = 'FROM dbo.DbColumn a5'
SELECT @oClause = 'ORDER BY a5.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a5.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SearchUrlId15=null, SearchUrlId15Text=null, TableId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelAgent3S1312') AND type='P')
DROP PROCEDURE dbo.GetDdlSelAgent3S1312
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelAgent3S1312]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelAgent13=a124.SelectTypeCd, SelAgent13Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelAgent13=null, SelAgent13Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelAgent3S1322') AND type='P')
DROP PROCEDURE dbo.GetDdlSelAgent3S1322
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelAgent3S1322]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelAgent10=a124.SelectTypeCd, SelAgent10Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelAgent10=null, SelAgent10Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelBroker3S1313') AND type='P')
DROP PROCEDURE dbo.GetDdlSelBroker3S1313
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelBroker3S1313]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelBroker13=a124.SelectTypeCd, SelBroker13Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelBroker13=null, SelBroker13Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelBroker3S1323') AND type='P')
DROP PROCEDURE dbo.GetDdlSelBroker3S1323
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelBroker3S1323]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelBroker10=a124.SelectTypeCd, SelBroker10Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelBroker10=null, SelBroker10Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelColumnId33S1682') AND type='P')
DROP PROCEDURE dbo.GetDdlSelColumnId33S1682
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelColumnId33S1682]
 @screenId			int
,@bAll				char(1)
,@keyId				varchar(100)
,@filterId			varchar(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
,@currCultureId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @dClause		varchar(8000)
	,@sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
	,@cc		varchar(8000)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @dClause = ' IF object_id(''tempdb.dbo.#col'') is not null DROP TABLE dbo.#col'
+ ' CREATE TABLE #col (ColumnId int not null, ColumnHeader nvarchar(max) null, AggregateCd char(1) null'
+ ', ColGroup smallint null, RptChartCd char(1) null, NumericData char(1) null, RptwizDtlId int null)'
+ ' INSERT INTO #col SELECT a5.ColumnId'
+ ', case when a184.ColHeader is null then ''('' + a5.ColumnName + '')'' else a184.ColHeader end'
+ ', a184.AggregateCd, a184.ColGroup, a184.RptChartCd, a6.NumericData, a184.RptwizDtlId'
SELECT @fClause = 'FROM dbo.RptwizDtl a184 INNER JOIN dbo.DbColumn a5 ON a184.ColumnId = a5.ColumnId'
+ ' INNER JOIN RODesign.dbo.CtDataType a6 ON a5.DataType = a6.DataTypeId'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
IF @filterId is not null SELECT @tClause = 'AND a184.RptwizId = ' + convert(varchar,@filterId) ELSE SELECT @tClause = 'AND 1<>1'
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @wClause = @wClause + ' AND (a184.ColSelect is not null)'
SELECT @oClause = 'ORDER BY a184.ColSelect'
SELECT @sClause = ' DECLARE @CultureId smallint'
+ ' SELECT @CultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = ''Y'''
+ ' IF EXISTS (SELECT 1 FROM dbo.#col x INNER JOIN dbo.ScreenObj y ON x.ColumnId = y.ColumnId'
	+ ' INNER JOIN dbo.ScreenObjHlp z ON y.ScreenObjId = z.ScreenObjId AND z.CultureId = ' + convert(varchar,@currCultureId)
	+ ' WHERE substring(x.ColumnHeader,1,1) = ''('')'
	+ ' UPDATE #col SET ColumnHeader = z.ColumnHeader'
		+ ' FROM #col x INNER JOIN dbo.ScreenObj y ON x.ColumnId = y.ColumnId'
		+ ' INNER JOIN dbo.ScreenObjHlp z ON y.ScreenObjId = z.ScreenObjId AND z.CultureId = ' + convert(varchar,@currCultureId)
		+ ' WHERE z.ColumnHeader is not null AND substring(x.ColumnHeader,1,1) = ''('''
+ ' ELSE'
	+ ' UPDATE #col SET ColumnHeader = z.ColumnHeader'
		+ ' FROM #col x INNER JOIN dbo.ScreenObj y ON x.ColumnId = y.ColumnId'
		+ ' INNER JOIN dbo.ScreenObjHlp z ON y.ScreenObjId = z.ScreenObjId AND z.CultureId = @CultureId'
		+ ' WHERE z.ColumnHeader is not null AND substring(x.ColumnHeader,1,1) = ''('''
+ ' SELECT ColumnId33 = ColumnId, ColumnId33Text = ColumnHeader'
	+ ', ColumnId55Text = case'
	+ ' when AggregateCd = ''A'' then ''['' + ''AVG] '' + ColumnHeader'
	+ ' when AggregateCd = ''C'' then ''['' + ''CNT] '' + ColumnHeader'
	+ ' when AggregateCd = ''I'' then ''['' + ''MIN] '' + ColumnHeader'
	+ ' when AggregateCd = ''M'' then ''['' + ''MAX] '' + ColumnHeader'
	+ ' when AggregateCd = ''S'' then ''['' + ''SUM] '' + ColumnHeader else ColumnHeader end'
	+ ', ColumnId66Text = case'
	+ ' when ColGroup = 1 then ''[1] '' + ColumnHeader'
	+ ' when ColGroup = 2 then ''[2] '' + ColumnHeader'
	+ ' when ColGroup = 3 then ''[3] '' + ColumnHeader else ColumnHeader end'
	+ ', ColumnId88Text = case when RptChartCd is not null then ''['' + RptChartCd + ''] '' + ColumnHeader else ColumnHeader end'
	+ ', ColumnId99Text = ColumnHeader'
+ ' , NumericData, RptwizDtlId FROM #col'
EXEC (@dClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause + ' ' + @sClause + ' DROP TABLE dbo.#col')
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelColumnId44S1682') AND type='P')
DROP PROCEDURE dbo.GetDdlSelColumnId44S1682
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelColumnId44S1682]
 @screenId			int
,@bAll				char(1)
,@keyId				varchar(100)
,@filterId			varchar(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
,@currCultureId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @dClause		varchar(8000)
	,@sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
	,@cc		varchar(8000)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @dClause = ' IF object_id(''tempdb.dbo.#col'') is not null DROP TABLE dbo.#col'
+ ' CREATE TABLE #col (ColumnId int not null, ColumnHeader nvarchar(max) null'
+ ', ColSort smallint not null, RptwizDtlId int null)'
+ ' INSERT INTO #col SELECT a5.ColumnId, ''('' + a5.ColumnName + '')'', a184.ColSort, a184.RptwizDtlId'
SELECT @fClause = 'FROM dbo.RptwizDtl a184 INNER JOIN dbo.DbColumn a5 ON a184.ColumnId = a5.ColumnId'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
IF @filterId is not null SELECT @tClause = 'AND a184.RptwizId = ' + convert(varchar,@filterId) ELSE SELECT @tClause = 'AND 1<>1'
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @wClause = @wClause + ' AND (a184.ColSort is not null)'
SELECT @oClause = 'ORDER BY abs(a184.ColSort)'
SELECT @sClause = ' DECLARE @CultureId smallint'
+ ' SELECT @CultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = ''Y'''
+ ' IF EXISTS (SELECT 1 FROM dbo.#col x INNER JOIN dbo.ScreenObj y ON x.ColumnId = y.ColumnId'
	+ ' INNER JOIN dbo.ScreenObjHlp z ON y.ScreenObjId = z.ScreenObjId AND z.CultureId = ' + convert(varchar,@currCultureId) + ')'
	+ ' UPDATE #col SET ColumnHeader = z.ColumnHeader'
		+ ' FROM #col x INNER JOIN dbo.ScreenObj y ON x.ColumnId = y.ColumnId'
		+ ' INNER JOIN dbo.ScreenObjHlp z ON y.ScreenObjId = z.ScreenObjId AND z.CultureId = ' + convert(varchar,@currCultureId)
		+ ' WHERE z.ColumnHeader is not null'
+ ' ELSE'
	+ ' UPDATE #col SET ColumnHeader = z.ColumnHeader'
		+ ' FROM #col x INNER JOIN dbo.ScreenObj y ON x.ColumnId = y.ColumnId'
		+ ' INNER JOIN dbo.ScreenObjHlp z ON y.ScreenObjId = z.ScreenObjId AND z.CultureId = @CultureId'
		+ ' WHERE z.ColumnHeader is not null'
+ ' SELECT ColumnId44 = ColumnId, ColumnId44Text ='
+ ' case when ColSort >= 0 then ''['' + ''ASC] '' + ColumnHeader else ''['' + ''DSC] '' + ColumnHeader end'
+ ', ColSort, RptwizDtlId FROM #col'
EXEC (@dClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause + ' ' + @sClause + ' DROP TABLE dbo.#col')
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelColumnId77S1682') AND type='P')
DROP PROCEDURE dbo.GetDdlSelColumnId77S1682
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelColumnId77S1682]
 @screenId			int
,@bAll				char(1)
,@keyId				varchar(100)
,@filterId			varchar(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
,@currCultureId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @dClause		varchar(8000)
	,@sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
	,@cc		varchar(8000)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @dClause = ' IF object_id(''tempdb.dbo.#col'') is not null DROP TABLE dbo.#col'
+ ' CREATE TABLE #col (Cid int not null IDENTITY, ColumnId int not null, ColumnHeader nvarchar(max) null'
+ ', OperatorName varchar(10) not null, NumericData char(1) null, RptwizDtlId int null)'
+ ' INSERT INTO #col (ColumnId, ColumnHeader, OperatorName, NumericData, RptwizDtlId)'
	+ ' SELECT a5.ColumnId'
	+ ', case when a184.CriHeader is null then ''('' + a5.ColumnName + '')'' else a184.CriHeader end'
	+ ', a100.OperatorName, a6.NumericData, a184.RptwizDtlId'
SELECT @fClause = 'FROM dbo.RptwizDtl a184 INNER JOIN dbo.DbColumn a5 ON a184.ColumnId = a5.ColumnId'
	+ ' INNER JOIN RODesign.dbo.CtOperator a100 ON a184.CriOperatorId = a100.OperatorId'
	+ ' INNER JOIN RODesign.dbo.CtDataType a6 ON a5.DataType = a6.DataTypeId'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a5.ColumnId = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
IF @filterId is not null SELECT @tClause = 'AND a184.RptwizId = ' + convert(varchar,@filterId) ELSE SELECT @tClause = 'AND 1<>1'
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @wClause = @wClause + ' AND (a184.CriSelect is not null)'
SELECT @oClause = 'ORDER BY a184.CriSelect'
SELECT @sClause = ' DECLARE @CultureId smallint'
+ ' SELECT @CultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = ''Y'''
+ ' IF EXISTS (SELECT 1 FROM dbo.#col x INNER JOIN dbo.ScreenObj y ON x.ColumnId = y.ColumnId'
	+ ' INNER JOIN dbo.ScreenObjHlp z ON y.ScreenObjId = z.ScreenObjId AND z.CultureId = ' + convert(varchar,@currCultureId)
	+ ' WHERE substring(x.ColumnHeader,1,1) = ''('')'
	+ ' UPDATE #col SET ColumnHeader = z.ColumnHeader'
		+ ' FROM #col x INNER JOIN dbo.ScreenObj y ON x.ColumnId = y.ColumnId'
		+ ' INNER JOIN dbo.ScreenObjHlp z ON y.ScreenObjId = z.ScreenObjId AND z.CultureId = ' + convert(varchar,@currCultureId)
		+ ' WHERE z.ColumnHeader is not null AND substring(x.ColumnHeader,1,1) = ''('''
+ ' ELSE'
	+ ' UPDATE #col SET ColumnHeader = z.ColumnHeader'
		+ ' FROM #col x INNER JOIN dbo.ScreenObj y ON x.ColumnId = y.ColumnId'
		+ ' INNER JOIN dbo.ScreenObjHlp z ON y.ScreenObjId = z.ScreenObjId AND z.CultureId = @CultureId'
		+ ' WHERE z.ColumnHeader is not null AND substring(x.ColumnHeader,1,1) = ''('''
+ ' SELECT ColumnId77 = Cid, ColumnId77Text = ''['' + OperatorName + ''] '' + ColumnHeader, ColumnId'
+ ', OperatorName, NumericData, RptwizDtlId FROM #col'
EXEC (@dClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause + ' ' + @sClause + ' DROP TABLE dbo.#col')
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelCompany3S1311') AND type='P')
DROP PROCEDURE dbo.GetDdlSelCompany3S1311
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelCompany3S1311]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelCompany13=a124.SelectTypeCd, SelCompany13Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelCompany13=null, SelCompany13Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelCompany3S1321') AND type='P')
DROP PROCEDURE dbo.GetDdlSelCompany3S1321
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelCompany3S1321]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelCompany10=a124.SelectTypeCd, SelCompany10Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelCompany10=null, SelCompany10Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelCulture3S1310') AND type='P')
DROP PROCEDURE dbo.GetDdlSelCulture3S1310
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelCulture3S1310]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelCulture13=a124.SelectTypeCd, SelCulture13Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelCulture13=null, SelCulture13Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelCulture3S1320') AND type='P')
DROP PROCEDURE dbo.GetDdlSelCulture3S1320
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelCulture3S1320]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelCulture10=a124.SelectTypeCd, SelCulture10Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelCulture10=null, SelCulture10Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelCustomer3S1314') AND type='P')
DROP PROCEDURE dbo.GetDdlSelCustomer3S1314
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelCustomer3S1314]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelCustomer13=a124.SelectTypeCd, SelCustomer13Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelCustomer13=null, SelCustomer13Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelCustomer3S1324') AND type='P')
DROP PROCEDURE dbo.GetDdlSelCustomer3S1324
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelCustomer3S1324]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelCustomer10=a124.SelectTypeCd, SelCustomer10Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelCustomer10=null, SelCustomer10Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelInvestor3S1315') AND type='P')
DROP PROCEDURE dbo.GetDdlSelInvestor3S1315
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelInvestor3S1315]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelInvestor13=a124.SelectTypeCd, SelInvestor13Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelInvestor13=null, SelInvestor13Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelInvestor3S1325') AND type='P')
DROP PROCEDURE dbo.GetDdlSelInvestor3S1325
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelInvestor3S1325]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelInvestor10=a124.SelectTypeCd, SelInvestor10Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelInvestor10=null, SelInvestor10Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelLevel3S1308') AND type='P')
DROP PROCEDURE dbo.GetDdlSelLevel3S1308
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlSelLevel3S1308
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' SelLevel239=a124.SelectTypeCd, SelLevel239Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a124.SelectTypeName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelLevel239=null, SelLevel239Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelMember3S1316') AND type='P')
DROP PROCEDURE dbo.GetDdlSelMember3S1316
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelMember3S1316]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelMember13=a124.SelectTypeCd, SelMember13Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelMember13=null, SelMember13Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelMember3S1326') AND type='P')
DROP PROCEDURE dbo.GetDdlSelMember3S1326
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelMember3S1326]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelMember10=a124.SelectTypeCd, SelMember10Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelMember10=null, SelMember10Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelProject3S1461') AND type='P')
DROP PROCEDURE dbo.GetDdlSelProject3S1461
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelProject3S1461]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelProject10=a124.SelectTypeCd, SelProject10Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelProject10=null, SelProject10Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelProject3S1462') AND type='P')
DROP PROCEDURE dbo.GetDdlSelProject3S1462
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelProject3S1462]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelProject13=a124.SelectTypeCd, SelProject13Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelProject13=null, SelProject13Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelUsr3S1308') AND type='P')
DROP PROCEDURE dbo.GetDdlSelUsr3S1308
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelUsr3S1308]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelUsr13=a124.SelectTypeCd, SelUsr13Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelUsr13=null, SelUsr13Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelUsr3S1318') AND type='P')
DROP PROCEDURE dbo.GetDdlSelUsr3S1318
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelUsr3S1318]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelUsr10=a124.SelectTypeCd, SelUsr10Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelUsr10=null, SelUsr10Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelUsrGroup3S1309') AND type='P')
DROP PROCEDURE dbo.GetDdlSelUsrGroup3S1309
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelUsrGroup3S1309]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelUsrGroup13=a124.SelectTypeCd, SelUsrGroup13Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelUsrGroup13=null, SelUsrGroup13Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelUsrGroup3S1319') AND type='P')
DROP PROCEDURE dbo.GetDdlSelUsrGroup3S1319
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelUsrGroup3S1319]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelUsrGroup10=a124.SelectTypeCd, SelUsrGroup10Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelUsrGroup10=null, SelUsrGroup10Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelVendor3S1317') AND type='P')
DROP PROCEDURE dbo.GetDdlSelVendor3S1317
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelVendor3S1317]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelVendor13=a124.SelectTypeCd, SelVendor13Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelVendor13=null, SelVendor13Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSelVendor3S1327') AND type='P')
DROP PROCEDURE dbo.GetDdlSelVendor3S1327
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlSelVendor3S1327]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct SelVendor10=a124.SelectTypeCd, SelVendor10Text=a124.SelectTypeName'
SELECT @fClause = 'FROM RODesign.dbo.CtSelectType a124'
SELECT @oClause = 'ORDER BY a124.SelectTypeName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a124.SelectTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SelVendor10=null, SelVendor10Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSeriesGrp3S1738') AND type='P')
DROP PROCEDURE dbo.GetDdlSeriesGrp3S1738
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlSeriesGrp3S1738
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' SeriesGrp206=a23.ReportObjId, SeriesGrp206Text=a23.ColumnDesc, a23.ReportId'
SELECT @fClause = 'FROM dbo.ReportObj a23'
SELECT @oClause = 'ORDER BY a23.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a23.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a23.ReportObjId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SeriesGrp206=null, SeriesGrp206Text=null, ReportId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlServiceEventId3S4212') AND type='P')
DROP PROCEDURE dbo.GetDdlServiceEventId3S4212
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlServiceEventId3S4212
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ServiceEventId128=a1315.RuleServiceTypeId, ServiceEventId128Text=a1315.RuleServiceTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtRuleServiceType a1315'
SELECT @oClause = 'ORDER BY a1315.RuleServiceTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1315.RuleServiceTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1315.RuleServiceTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ServiceEventId128=null, ServiceEventId128Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlStaticCsId3S2011') AND type='P')
DROP PROCEDURE dbo.GetDdlStaticCsId3S2011
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlStaticCsId3S2011
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' StaticCsId259=a260.StaticCsId, StaticCsId259Text=a260.StaticCsNm'
SELECT @fClause = 'FROM dbo.StaticCs a260'
SELECT @oClause = 'ORDER BY a260.StaticCsNm'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a260.StaticCsNm LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a260.StaticCsId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT StaticCsId259=null, StaticCsId259Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlStaticJsId3S2012') AND type='P')
DROP PROCEDURE dbo.GetDdlStaticJsId3S2012
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlStaticJsId3S2012
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' StaticJsId259=a261.StaticJsId, StaticJsId259Text=a261.StaticJsNm'
SELECT @fClause = 'FROM dbo.StaticJs a261'
SELECT @oClause = 'ORDER BY a261.StaticJsNm'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a261.StaticJsNm LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a261.StaticJsId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT StaticJsId259=null, StaticJsId259Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlStaticPgId3S1998') AND type='P')
DROP PROCEDURE dbo.GetDdlStaticPgId3S1998
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlStaticPgId3S1998
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' StaticPgId39=a259.StaticPgId, StaticPgId39Text=a259.StaticPgDesc'
SELECT @fClause = 'FROM dbo.StaticPg a259'
SELECT @oClause = 'ORDER BY a259.StaticPgDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a259.StaticPgDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a259.StaticPgId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT StaticPgId39=null, StaticPgId39Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlSystemId3S430') AND type='P')
DROP PROCEDURE dbo.GetDdlSystemId3S430
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlSystemId3S430
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' SystemId3=a45.SystemId, SystemId3Text=a45.SystemName, a45.Active'
SELECT @fClause = 'FROM RODesign.dbo.Systems a45'
SELECT @oClause = 'ORDER BY a45.SystemName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((a45.Active = ''Y'') ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a45.SystemName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a45.SystemId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT SystemId3=null, SystemId3Text=null, Active=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlTabFolderId2003C47') AND type='P')
DROP PROCEDURE dbo.GetDdlTabFolderId2003C47
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlTabFolderId2003C47]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		smallint
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a19.ScreenTabId, a19.TabFolderName'
SELECT @fClause = 'FROM dbo.ScreenTab a19'
SELECT @oClause = 'ORDER BY a19.TabFolderName'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a19.TabFolderName LIKE ''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ') ' 
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenTabId=null, TabFolderName=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlTabFolderId203C47') AND type='P')
DROP PROCEDURE dbo.GetDdlTabFolderId203C47
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlTabFolderId203C47]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a19.ScreenTabId, a19.TabFolderName'
SELECT @fClause = 'FROM dbo.ScreenTab a19'
SELECT @oClause = 'ORDER BY a19.TabFolderName'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a19.TabFolderName LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ScreenTabId=null, TabFolderName=null WHERE 1<>1
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlTabFolderId3S3291') AND type='P')
DROP PROCEDURE dbo.GetDdlTabFolderId3S3291
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlTabFolderId3S3291
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' TabFolderId14=a19.ScreenTabId, TabFolderId14Text=a19.TabFolderName'
SELECT @fClause = 'FROM dbo.ScreenTab a19'
SELECT @oClause = 'ORDER BY a19.TabFolderName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a19.TabFolderName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a19.ScreenTabId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT TabFolderId14=null, TabFolderId14Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlTabFolderId3S84') AND type='P')
DROP PROCEDURE dbo.GetDdlTabFolderId3S84
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlTabFolderId3S84]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' TabFolderId14=a19.ScreenTabId, TabFolderId14Text=a19.TabFolderName, a19.TabFolderOrder, a19.ScreenId'
SELECT @fClause = 'FROM dbo.ScreenTab a19'
SELECT @oClause = 'ORDER BY a19.TabFolderOrder'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a19.TabFolderName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a19.ScreenTabId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT TabFolderId14=null, TabFolderId14Text=null, TabFolderOrder=null, ScreenId=null WHERE 1<>1
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlTableId3S1077') AND type='P')
DROP PROCEDURE dbo.GetDdlTableId3S1077
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlTableId3S1077
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' TableId97=a3.TableId, TableId97Text=a3.TableName'
SELECT @fClause = 'FROM dbo.DbTable a3'
SELECT @oClause = 'ORDER BY a3.TableName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a3.TableName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a3.TableId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a3.','N','N',null,'Y','TableId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT TableId97=null, TableId97Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlTableId3S166') AND type='P')
DROP PROCEDURE dbo.GetDdlTableId3S166
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlTableId3S166
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' TableId20=a3.TableId, TableId20Text=a3.TableName'
SELECT @fClause = 'FROM dbo.DbTable a3'
SELECT @oClause = 'ORDER BY a3.TableName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a3.TableName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a3.TableId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a3.','N','N',null,'Y','TableId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT TableId20=null, TableId20Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlTableId3S1663') AND type='P')
DROP PROCEDURE dbo.GetDdlTableId3S1663
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlTableId3S1663
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' TableId181=a3.TableId, TableId181Text=a3.TableDesc'
SELECT @fClause = 'FROM dbo.DbTable a3'
SELECT @oClause = 'ORDER BY a3.TableDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a3.TableDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a3.TableId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a3.','N','N',null,'Y','TableId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT TableId181=null, TableId181Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlTableId3S4109') AND type='P')
DROP PROCEDURE dbo.GetDdlTableId3S4109
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlTableId3S4109
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' TableId1300=a3.TableId, TableId1300Text=a3.TableDesc'
SELECT @fClause = 'FROM dbo.DbTable a3'
SELECT @oClause = 'ORDER BY a3.TableDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a3.TableDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a3.TableId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','a3.','N','N',null,'Y','TableId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT TableId1300=null, TableId1300Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlTarClientTierId3S1717') AND type='P')
DROP PROCEDURE dbo.GetDdlTarClientTierId3S1717
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlTarClientTierId3S1717]
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
SELECT @sClause = 'SELECT distinct TarClientTierId192=a194.ClientTierId, TarClientTierId192Text=a194.ClientTierName'
SELECT @fClause = 'FROM RODesign.dbo.ClientTier a194'
SELECT @oClause = 'ORDER BY a194.ClientTierName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a194.ClientTierId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlTarRuleTierId3S1719') AND type='P')
DROP PROCEDURE dbo.GetDdlTarRuleTierId3S1719
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlTarRuleTierId3S1719]
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@RowAuthoritys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
SELECT @sClause = 'SELECT distinct TarRuleTierId192=a196.RuleTierId, TarRuleTierId192Text=a196.RuleTierName'
SELECT @fClause = 'FROM RODesign.dbo.RuleTier a196'
SELECT @oClause = 'ORDER BY a196.RuleTierName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a196.RuleTierId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlTblGrouping3S1615') AND type='P')
DROP PROCEDURE dbo.GetDdlTblGrouping3S1615
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlTblGrouping3S1615
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' TblGrouping162=a23.ReportObjId, TblGrouping162Text=a23.ColumnDesc, a23.ReportId'
SELECT @fClause = 'FROM dbo.ReportObj a23'
SELECT @oClause = 'ORDER BY a23.ColumnDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a23.ColumnDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a23.ReportObjId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT TblGrouping162=null, TblGrouping162Text=null, ReportId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlTblToggle3S1696') AND type='P')
DROP PROCEDURE dbo.GetDdlTblToggle3S1696
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlTblToggle3S1696
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' TblToggle162=a161.RptCtrId, TblToggle162Text=a161.RptCtrDesc, a161.ReportId'
SELECT @fClause = 'FROM dbo.RptCtr a161'
SELECT @oClause = 'ORDER BY a161.RptCtrDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a161.RptCtrDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a161.RptCtrId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT TblToggle162=null, TblToggle162Text=null, ReportId=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlTblVisibility3S1617') AND type='P')
DROP PROCEDURE dbo.GetDdlTblVisibility3S1617
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlTblVisibility3S1617
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' TblVisibility162=a125.CheckBoxCd, TblVisibility162Text=a125.CheckBoxName'
SELECT @fClause = 'FROM RODesign.dbo.CtCheckBox a125'
SELECT @oClause = 'ORDER BY a125.CheckBoxName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a125.CheckBoxName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a125.CheckBoxCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT TblVisibility162=null, TblVisibility162Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlTextAlign3S1560') AND type='P')
DROP PROCEDURE dbo.GetDdlTextAlign3S1560
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlTextAlign3S1560
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' TextAlign167=a174.TextAlignCd, TextAlign167Text=a174.TextAlignName'
SELECT @fClause = 'FROM RODesign.dbo.CtTextAlign a174'
SELECT @oClause = 'ORDER BY a174.TextAlignName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a174.TextAlignName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a174.TextAlignCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT TextAlign167=null, TextAlign167Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlTextDecor3S1559') AND type='P')
DROP PROCEDURE dbo.GetDdlTextDecor3S1559
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlTextDecor3S1559
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' TextDecor167=a173.TextDecorCd, TextDecor167Text=a173.TextDecorDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtTextDecor a173'
SELECT @oClause = 'ORDER BY a173.TextDecorDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a173.TextDecorDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a173.TextDecorCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT TextDecor167=null, TextDecor167Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlTopVisible3S4161') AND type='P')
DROP PROCEDURE dbo.GetDdlTopVisible3S4161
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlTopVisible3S4161
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' TopVisible116=a1306.ButtonStyleCd, TopVisible116Text=a1306.ButtonStyleDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtButtonStyle a1306'
SELECT @oClause = 'ORDER BY a1306.ButtonStyleDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1306.ButtonStyleDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1306.ButtonStyleCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT TopVisible116=null, TopVisible116Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlUnitCd3S1525') AND type='P')
DROP PROCEDURE dbo.GetDdlUnitCd3S1525
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlUnitCd3S1525
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' UnitCd22=a154.UnitCd, UnitCd22Text=a154.UnitDesc, a154.UnitOrder'
SELECT @fClause = 'FROM RODesign.dbo.CtUnit a154'
SELECT @oClause = 'ORDER BY a154.UnitOrder'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a154.UnitDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a154.UnitCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT UnitCd22=null, UnitCd22Text=null, UnitOrder=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlUnitCd3S1679') AND type='P')
DROP PROCEDURE dbo.GetDdlUnitCd3S1679
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlUnitCd3S1679]
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' UnitCd183=a154.UnitCd, UnitCd183Text=a154.UnitDesc, a154.UnitOrder'
SELECT @fClause = 'FROM RODesign.dbo.CtUnit a154'
SELECT @oClause = 'ORDER BY a154.UnitOrder'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a154.UnitDesc LIKE N''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a154.UnitCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT UnitCd183=null, UnitCd183Text=null, UnitOrder=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlUsrGroupId3S1246') AND type='P')
DROP PROCEDURE dbo.GetDdlUsrGroupId3S1246
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlUsrGroupId3S1246]
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' UsrGroupId123=a7.UsrGroupId, UsrGroupId123Text=a7.UsrGroupName'
SELECT @fClause = 'FROM RODesign.dbo.UsrGroup a7'
SELECT @oClause = 'ORDER BY a7.UsrGroupName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a7.UsrGroupName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a7.UsrGroupId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyId','Company','a7.','Y','N',null,'Y','UsrGroupId',@wClause OUTPUT
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@UsrGroups,'UsrGroupId','UsrGroup','a7.','N','N',null,'N','UsrGroupId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyId','Company','a7.','N',null,'UsrGroupId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT UsrGroupId123=null, UsrGroupId123Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlUsrGroupId3S833') AND type='P')
DROP PROCEDURE dbo.GetDdlUsrGroupId3S833
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlUsrGroupId3S833]
 @screenId		int
,@bAll		char(1)
,@keyId		SmallInt
,@RowAuthoritys		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct UsrGroupId85=a7.UsrGroupId, UsrGroupId85Text=a7.UsrGroupName'
SELECT @fClause = 'FROM RODesign.dbo.UsrGroup a7'
SELECT @oClause = 'ORDER BY a7.UsrGroupName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a7.UsrGroupId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyId','Company','a7.','Y','N',null,'Y','UsrGroupId',@wClause OUTPUT
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@UsrGroups,'UsrGroupId','UsrGroup','a7.','N','N',null,'N','UsrGroupId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyId','Company','a7.','N',null,'UsrGroupId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT UsrGroupId85=null, UsrGroupId85Text=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlUsrId3S1641') AND type='P')
DROP PROCEDURE dbo.GetDdlUsrId3S1641
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlUsrId3S1641]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' UsrId183=a1.UsrId, UsrId183Text=a1.LoginName, a1.Active'
SELECT @fClause = 'FROM RODesign.dbo.Usr a1'
SELECT @oClause = 'ORDER BY a1.LoginName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((a1.Active = ''Y'') ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1.LoginName LIKE N''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1.UsrId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Projects,'ProjectLs','Project','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1.','Y','N',null,'N','UsrId',@wClause OUTPUT
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'UsrId','Usr','a1.','N','N',null,'N','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Customers,'CustomerId','Customer','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Vendors,'VendorId','Vendor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Members,'MemberId','Member','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Investors,'InvestorId','Investor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Agents,'AgentId','Agent','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Brokers,'BrokerId','Broker','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@UsrGroups,'UsrGroupLs','UsrGroup','a1.','N','Y',null,'N','UsrId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetCurrFilter @currProjectId,'ProjectLs','Project','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT UsrId183=null, UsrId183Text=null, Active=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlUsrId3S1767') AND type='P')
DROP PROCEDURE dbo.GetDdlUsrId3S1767
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlUsrId3S1767]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@RowAuthoritys		varchar(1000)
,@Usrs		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
SELECT @sClause = 'SELECT distinct UsrId210=a1.UsrId, UsrId210Text=a1.LoginName, a1.Active'
SELECT @fClause = 'FROM RODesign.dbo.Usr a1'
SELECT @oClause = 'ORDER BY a1.LoginName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (a1.Active = ''Y'' OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1.UsrId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Projects,'ProjectLs','Project','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1.','Y','N',null,'N','UsrId',@wClause OUTPUT
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'UsrId','Usr','a1.','N','N',null,'N','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Customers,'CustomerId','Customer','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Vendors,'VendorId','Vendor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Members,'MemberId','Member','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Investors,'InvestorId','Investor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Agents,'AgentId','Agent','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Brokers,'BrokerId','Broker','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@UsrGroups,'UsrGroupLs','UsrGroup','a1.','N','Y',null,'N','UsrId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetCurrFilter @currProjectId,'ProjectLs','Project','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlUsrId3S1789') AND type='P')
DROP PROCEDURE dbo.GetDdlUsrId3S1789
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlUsrId3S1789]
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@RowAuthoritys		varchar(1000)
,@Usrs		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@currCompanyId		int
,@currProjectId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@oClause		varchar(8000)
	,@tClause		varchar(8000)
SELECT @sClause = 'SELECT distinct UsrId220=a1.UsrId, UsrId220Text=a1.LoginName, a1.Active'
SELECT @fClause = 'FROM RODesign.dbo.Usr a1'
SELECT @oClause = 'ORDER BY a1.LoginName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (a1.Active = ''Y'' OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1.UsrId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Projects,'ProjectLs','Project','a1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a1.','Y','N',null,'N','UsrId',@wClause OUTPUT
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'UsrId','Usr','a1.','N','N',null,'N','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Customers,'CustomerId','Customer','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Vendors,'VendorId','Vendor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Members,'MemberId','Member','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Investors,'InvestorId','Investor','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Agents,'AgentId','Agent','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Brokers,'BrokerId','Broker','a1.','N','N',null,'Y','UsrId',@tClause OUTPUT
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@UsrGroups,'UsrGroupLs','UsrGroup','a1.','N','Y',null,'N','UsrId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC RODesign.dbo.GetCurrFilter @currProjectId,'ProjectLs','Project','a1.','Y',null,'UsrId',@wClause OUTPUT
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlVerticalAlign3S1561') AND type='P')
DROP PROCEDURE dbo.GetDdlVerticalAlign3S1561
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlVerticalAlign3S1561
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' VerticalAlign167=a175.VerticalAlignCd, VerticalAlign167Text=a175.VerticalAlignName'
SELECT @fClause = 'FROM RODesign.dbo.CtVerticalAlign a175'
SELECT @oClause = 'ORDER BY a175.VerticalAlignName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a175.VerticalAlignName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a175.VerticalAlignCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT VerticalAlign167=null, VerticalAlign167Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlViewOnly3S3103') AND type='P')
DROP PROCEDURE dbo.GetDdlViewOnly3S3103
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlViewOnly3S3103
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ViewOnly15=a1293.ViewTypeCd, ViewOnly15Text=a1293.ViewTypeName, a1293.ViewTypeSort'
SELECT @fClause = 'FROM RODesign.dbo.CtViewType a1293'
SELECT @oClause = 'ORDER BY a1293.ViewTypeSort'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a1293.ViewTypeName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a1293.ViewTypeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT ViewOnly15=null, ViewOnly15Text=null, ViewTypeSort=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlWizardId1003C17') AND type='P')
DROP PROCEDURE dbo.GetDdlWizardId1003C17
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetDdlWizardId1003C17]
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		smallint
,@currProjectId		smallint
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a71.WizardId, a71.WizardTitle'
SELECT @fClause = 'FROM dbo.Wizard a71'
SELECT @oClause = 'ORDER BY a71.WizardTitle'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a71.WizardTitle LIKE ''%' + REPLACE(REPLACE(@FilterTxt, '''',''''''),' ','%') + '%''' END + ') ' 
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT WizardId=null, WizardTitle=null WHERE 1<>1
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlWizardId103C17') AND type='P')
DROP PROCEDURE dbo.GetDdlWizardId103C17
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlWizardId103C17
 @screenId		int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
,@bAll		char(1)=null
,@keyId		varchar(max)=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct a71.WizardId, a71.WizardTitle'
SELECT @fClause = 'FROM dbo.Wizard a71'
SELECT @oClause = 'ORDER BY a71.WizardTitle'
SELECT @wClause = 'WHERE ( 1=1 ' 
 + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a71.WizardTitle LIKE ''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ') ' 
 + CASE WHEN @bAll = 'N' THEN ' AND (a71.WizardId IN ' + CASE WHEN left(ISNULL(@keyId,'-1'),1) = '(' THEN ISNULL(@keyId,'-1') ELSE '(' + ISNULL(@keyId,'-1') + ')' END + ')' ELSE '' END SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT WizardId=null, WizardTitle=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlWizardId3S1215') AND type='P')
DROP PROCEDURE dbo.GetDdlWizardId3S1215
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlWizardId3S1215
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' WizardId116=a71.WizardId, WizardId116Text=a71.WizardTitle'
SELECT @fClause = 'FROM dbo.Wizard a71'
SELECT @oClause = 'ORDER BY a71.WizardTitle'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a71.WizardTitle LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a71.WizardId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT WizardId116=null, WizardId116Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlWizardId3S1366') AND type='P')
DROP PROCEDURE dbo.GetDdlWizardId3S1366
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlWizardId3S1366
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' WizardId136=a71.WizardId, WizardId136Text=a71.ProgramName'
SELECT @fClause = 'FROM dbo.Wizard a71'
SELECT @oClause = 'ORDER BY a71.ProgramName'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a71.ProgramName LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a71.WizardId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT WizardId136=null, WizardId136Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlWizardId3S645') AND type='P')
DROP PROCEDURE dbo.GetDdlWizardId3S645
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlWizardId3S645
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' WizardId73=a71.WizardId, WizardId73Text=a71.WizardTitle'
SELECT @fClause = 'FROM dbo.Wizard a71'
SELECT @oClause = 'ORDER BY a71.WizardTitle'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a71.WizardTitle LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a71.WizardId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT WizardId73=null, WizardId73Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlWizardId3S839') AND type='P')
DROP PROCEDURE dbo.GetDdlWizardId3S839
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlWizardId3S839
 @screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' WizardId39=a71.WizardId, WizardId39Text=a71.WizardTitle'
SELECT @fClause = 'FROM dbo.Wizard a71'
SELECT @oClause = 'ORDER BY a71.WizardTitle'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a71.WizardTitle LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a71.WizardId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT WizardId39=null, WizardId39Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlWizardTypeId3S634') AND type='P')
DROP PROCEDURE dbo.GetDdlWizardTypeId3S634
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlWizardTypeId3S634
 @screenId		int
,@bAll		char(1)
,@keyId		TinyInt
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' WizardTypeId71=a70.WizardTypeId, WizardTypeId71Text=a70.WizardTypeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtWizardType a70'
SELECT @oClause = 'ORDER BY a70.WizardTypeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a70.WizardTypeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a70.WizardTypeId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT WizardTypeId71=null, WizardTypeId71Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDdlWritingMode3S1569') AND type='P')
DROP PROCEDURE dbo.GetDdlWritingMode3S1569
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetDdlWritingMode3S1569
 @screenId		int
,@bAll		char(1)
,@keyId		Char(100)
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='RODesign')
BEGIN
SELECT @sClause = 'SELECT distinct ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' WritingMode167=a177.WritingModeCd, WritingMode167Text=a177.WritingModeDesc'
SELECT @fClause = 'FROM RODesign.dbo.CtWritingMode a177'
SELECT @oClause = 'ORDER BY a177.WritingModeDesc'
IF @bAll = 'Y' SELECT @wClause = 'WHERE (((1=1) ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '' THEN '' ELSE ' AND a177.WritingModeDesc LIKE N''%' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''',''''''),' ','%') + '%''' END + ')  OR ' ELSE SELECT @wClause = 'WHERE ('
IF @keyId is not null SELECT @wClause = @wClause + 'a177.WritingModeCd = ''' + convert(varchar,@keyId) + ''')' ELSE SELECT @wClause = @wClause + '1<>1)'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
END
ELSE
	SELECT WritingMode167=null, WritingMode167Text=null WHERE 1<>1
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDistinctScreenTab') AND type='P')
DROP PROCEDURE dbo.GetDistinctScreenTab
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




/* Called by GenScreensRules */
CREATE PROCEDURE [dbo].[GetDistinctScreenTab]
 @screenId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
	,@oClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT TabFolderId = ScreenTabId, TabFolderOrder'
SELECT @fClause = 'FROM dbo.ScreenTab'
SELECT @wClause = 'WHERE ScreenId = ' + CONVERT(varchar,@screenId)
SELECT @oClause = 'ORDER BY TabFolderOrder'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetDocImage') AND type='P')
DROP PROCEDURE dbo.GetDocImage
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetDocImage]
 @ReportId		int
,@TemplateId	smallint
/* WITH ENCRYPTION */
AS
DECLARE	 @TemplateName	varchar(100)
		,@TmplPrefix	varchar(10)
		,@DocId			int
SET NOCOUNT ON
IF @TemplateId <= 0
	SELECT @TemplateId = TemplateId, @TmplPrefix = TmplPrefix FROM dbo.Template WHERE TmplDefault = 'Y'	-- Default template required
ELSE
	SELECT @TmplPrefix = TmplPrefix FROM dbo.Template WHERE TemplateId = @TemplateId
IF @TmplPrefix is null
BEGIN
	RAISERROR('TemplateId "%d" does not exist in table dbo.Template, please rectify and try again.',18,2,@TemplateId) WITH SETERROR
	RETURN 1
END
SELECT @TemplateName = case when @TmplPrefix = '' then TemplateName else @TmplPrefix + ' ' + TemplateName end
	FROM dbo.Report WHERE ReportId = @ReportId
/* latest version of the same template */
SELECT TOP 1 @DocId =  DocId FROM dbo.RptTemplate WHERE MasterId = @ReportId AND DocName = @TemplateName ORDER BY InputOn desc
IF @DocId is not null
	SELECT TemplateName=@TemplateName, DocImage FROM dbo.RptTemplate WHERE DocId = @DocId
ELSE
BEGIN
	RAISERROR('Plese load the requested document template "%s" and try again.',18,2,@TemplateName) WITH SETERROR
	RETURN 1
END
RETURN 0
 
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmAppInfo82') AND type='P')
DROP PROCEDURE dbo.GetExpAdmAppInfo82
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmAppInfo82
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@VersionDt53	DateTime
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.AppInfo b135 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureTypeName,CultureTypeDesc FROM RODesign.dbo.CtCulture (NOLOCK))x3191 ON b135.CultureTypeName = x3191.CultureTypeName' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT DocId,MasterId FROM RODesign.dbo.AppZipId (NOLOCK))x1697 ON b135.AppZipId = x1697.DocId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' AppInfoId135Text=b135.AppInfoId'
+ ', AppInfoId135=b135.AppInfoId'
+ ', VersionMa135=b135.VersionMa'
+ ', VersionMi135=b135.VersionMi'
+ ', VersionDt135=b135.VersionDt'
+ ', CultureTypeName135=x3191.CultureTypeName'
+ ', CultureTypeName135Text=x3191.CultureTypeDesc'
+ ', VersionValue135=b135.VersionValue'
+ ', AppZipId135=b135.AppZipId'
+ ', AppItemLink135=b135.AppItemLink'
+ ', Prerequisite135=b135.Prerequisite'
+ ', Readme135=b135.Readme'
SELECT @oClause='ORDER BY b135.AppInfoId DESC'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b135.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b135.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b135.AppInfoId = ' + @key + ')'
ELSE
BEGIN
	IF @VersionDt53 is not null SELECT @wClause = @wClause + ' AND (DATEADD(hour, DATEDIFF(hour, 0, b135.VersionDt), 0) >= ''' + convert(varchar,@VersionDt53,120) + ''')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmAppItem83') AND type='P')
DROP PROCEDURE dbo.GetExpAdmAppItem83
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmAppItem83
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@AppItemCode44	NVarChar(max)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.AppItem b136 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT AppInfoId,AppInfoDesc FROM dbo.AppInfo (NOLOCK))x1222 ON b136.AppInfoId = x1222.AppInfoId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT LanguageCd,LanguageName FROM RODesign.dbo.CtLanguage (NOLOCK))x1225 ON b136.LanguageCd = x1225.LanguageCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT FrameworkCd,FrameworkName FROM RODesign.dbo.CtFramework (NOLOCK))x1226 ON b136.FrameworkCd = x1226.FrameworkCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ObjectTypeCd,ObjectTypeName FROM RODesign.dbo.CtObjectType (NOLOCK))x1224 ON b136.ObjectTypeCd = x1224.ObjectTypeCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT DbProviderCd,DbProviderName FROM RODesign.dbo.CtDbProvider (NOLOCK))x1227 ON b136.DbProviderCd = x1227.DbProviderCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenId,ScreenDesc FROM dbo.Screen (NOLOCK))x1234 ON b136.ScreenId = x1234.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportId,ReportDesc FROM dbo.Report (NOLOCK))x1235 ON b136.ReportId = x1235.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT WizardId,ProgramName FROM dbo.Wizard (NOLOCK))x1236 ON b136.WizardId = x1236.WizardId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' AppItemId136Text=b136.AppItemId'
+ ', AppItemId136=b136.AppItemId'
+ ', AppInfoId136=x1222.AppInfoId'
+ ', AppInfoId136Text=x1222.AppInfoDesc'
+ ', LanguageCd136=x1225.LanguageCd'
+ ', LanguageCd136Text=x1225.LanguageName'
+ ', ItemOrder136=b136.ItemOrder'
+ ', FrameworkCd136=x1226.FrameworkCd'
+ ', FrameworkCd136Text=x1226.FrameworkName'
+ ', ObjectTypeCd136=x1224.ObjectTypeCd'
+ ', ObjectTypeCd136Text=x1224.ObjectTypeName'
+ ', DbProviderCd136=x1227.DbProviderCd'
+ ', DbProviderCd136Text=x1227.DbProviderName'
+ ', RelativePath136=b136.RelativePath'
+ ', AppItemName136=b136.AppItemName'
+ ', MultiDesignDb136=b136.MultiDesignDb'
+ ', RemoveItem136=b136.RemoveItem'
+ ', AppItemCode136=b136.AppItemCode'
+ ', ScreenId136=x1234.ScreenId'
+ ', ScreenId136Text=x1234.ScreenDesc'
+ ', ReportId136=x1235.ReportId'
+ ', ReportId136Text=x1235.ReportDesc'
+ ', WizardId136=x1236.WizardId'
+ ', WizardId136Text=x1236.ProgramName'
+ ', CustomId136=b136.CustomId'
SELECT @oClause='ORDER BY b136.AppItemId DESC'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b136.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b136.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b136.AppItemId = ' + @key + ')'
ELSE
BEGIN
	IF @AppItemCode44 is not null SELECT @wClause = @wClause + ' AND (b136.AppItemCode like N''%' + replace(@AppItemCode44,'''','''''') + '%'')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmAuthCol16') AND type='P')
DROP PROCEDURE dbo.GetExpAdmAuthCol16
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmAuthCol16
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.ScreenObj b14 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN dbo.ColOvrd b241 (NOLOCK) ON b14.ScreenObjId = b241.ScreenObjId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT PermKeyId,PermKeyDesc FROM RODesign.dbo.VwPermKey (NOLOCK))x1971 ON b241.PermKeyId = x1971.PermKeyId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT PermKeyRowId,PermIdText,PermKeyId FROM RODesign.dbo.VwPermKeyRow (NOLOCK))x7414 ON b241.PermKeyRowId = x7414.PermKeyRowId AND x1971.PermKeyId = x7414.PermKeyId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenObjId14Text=b14.ScreenObjId'
+ ', ScreenObjId14=b14.ScreenObjId'
+ ', ColOvrdId241=' + case when charindex('b241 ',@fClause) > 0 then 'b241.ColOvrdId' else 'null' end
+ ', ColVisible241=' + case when charindex('b241 ',@fClause) > 0 then 'b241.ColVisible' else 'null' end
+ ', ColReadOnly241=' + case when charindex('b241 ',@fClause) > 0 then 'b241.ColReadOnly' else 'null' end
+ ', ColExport241=' + case when charindex('b241 ',@fClause) > 0 then 'b241.ColExport' else 'null' end
+ ', PermKeyId241=x1971.PermKeyId'
+ ', PermKeyId241Text=x1971.PermKeyDesc'
+ ', PermKeyRowId241=x7414.PermKeyRowId'
+ ', PermKeyRowId241Text=x7414.PermIdText'
+ ', Priority241=' + case when charindex('b241 ',@fClause) > 0 then 'b241.Priority' else 'null' end
+ ', ToolTip241=' + case when charindex('b241 ',@fClause) > 0 then 'b241.ToolTip' else 'null' end
+ ', ColumnHeader241=' + case when charindex('b241 ',@fClause) > 0 then 'b241.ColumnHeader' else 'null' end
+ ', ErrMessage241=' + case when charindex('b241 ',@fClause) > 0 then 'b241.ErrMessage' else 'null' end + ''
SELECT @oClause='ORDER BY b14.ScreenObjId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b14.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b14.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b14.ScreenObjId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmClientRule79') AND type='P')
DROP PROCEDURE dbo.GetExpAdmClientRule79
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmClientRule79
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId9	Int
,@ReportId11	Int
,@CultureId10	SmallInt
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause='FROM dbo.ClientRule b127 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RuleMethodId,RuleMethodName,RuleMethodDesc FROM RODesign.dbo.CtRuleMethod (NOLOCK))x7378 ON b127.RuleMethodId = x7378.RuleMethodId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RuleTypeId,RuleTypeDesc FROM RODesign.dbo.CtRuleType (NOLOCK))x1139 ON b127.RuleTypeId = x1139.RuleTypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenId,ScreenDesc FROM dbo.Screen (NOLOCK))x1103 ON b127.ScreenId = x1103.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportId,ReportDesc FROM dbo.Report (NOLOCK))x1112 ON b127.ReportId = x1112.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture (NOLOCK))x1104 ON b127.CultureId = x1104.CultureId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenObjHlpId,ScreenObjHlpDesc,ScreenId FROM dbo.VwScreenObjHlp (NOLOCK))x1105 ON b127.ScreenObjHlpId = x1105.ScreenObjHlpId AND x1103.ScreenId = x1105.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenCriHlpId,ScreenCriHlpDesc,ScreenId FROM dbo.VwScreenCriHlp (NOLOCK))x1113 ON b127.ScreenCriHlpId = x1113.ScreenCriHlpId AND x1103.ScreenId = x1113.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportCriHlpId,ReportCriHlpDesc,ReportId FROM dbo.VwReportCriHlp (NOLOCK))x1114 ON b127.ReportCriHlpId = x1114.ReportCriHlpId AND x1112.ReportId = x1114.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RuleCntTypeId,RuleCntTypeName,RuleCntTypeDesc FROM RODesign.dbo.CtRuleCntType (NOLOCK))x7377 ON b127.RuleCntTypeId = x7377.RuleCntTypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ClientScriptId,ClientScriptDesc,ClientScriptHelp FROM RODesign.dbo.CtClientScript (NOLOCK))x1106 ON b127.ClientScript = x1106.ClientScriptId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ClientRuleId127Text=b127.ClientRuleId'
+ ', ClientRuleId127=b127.ClientRuleId'
+ ', RuleMethodId127=x7378.RuleMethodId'
+ ', RuleMethodId127Text=x7378.RuleMethodName'
+ ', RuleMethodDesc1295=x7378.RuleMethodDesc'
+ ', RuleName127=b127.RuleName'
+ ', RuleDescription127=b127.RuleDescription'
+ ', RuleTypeId127=x1139.RuleTypeId'
+ ', RuleTypeId127Text=x1139.RuleTypeDesc'
+ ', ScreenId127=x1103.ScreenId'
+ ', ScreenId127Text=x1103.ScreenDesc'
+ ', ReportId127=x1112.ReportId'
+ ', ReportId127Text=x1112.ReportDesc'
+ ', CultureId127=x1104.CultureId'
+ ', CultureId127Text=x1104.CultureTypeDesc'
+ ', ScreenObjHlpId127=x1105.ScreenObjHlpId'
+ ', ScreenObjHlpId127Text=x1105.ScreenObjHlpDesc'
+ ', ScreenCriHlpId127=x1113.ScreenCriHlpId'
+ ', ScreenCriHlpId127Text=x1113.ScreenCriHlpDesc'
+ ', ReportCriHlpId127=x1114.ReportCriHlpId'
+ ', ReportCriHlpId127Text=x1114.ReportCriHlpDesc'
+ ', RuleCntTypeId127=x7377.RuleCntTypeId'
+ ', RuleCntTypeId127Text=x7377.RuleCntTypeName'
+ ', RuleCntTypeDesc1294=x7377.RuleCntTypeDesc'
+ ', ClientRuleProg127=b127.ClientRuleProg'
+ ', ClientScript127=x1106.ClientScriptId'
+ ', ClientScript127Text=x1106.ClientScriptDesc'
+ ', ClientScriptHelp126=x1106.ClientScriptHelp'
+ ', UserScriptEvent127=b127.UserScriptEvent'
+ ', UserScriptName127=b127.UserScriptName'
+ ', ScriptParam127=b127.ScriptParam'
SELECT @oClause='ORDER BY b127.ClientRuleId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b127.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b127.')
			END
		END
	END
END
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b127.','Y','N',null,'N','ClientRuleId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b127.ClientRuleId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId9 is not null SELECT @wClause = @wClause + ' AND (b127.ScreenId = ' + convert(varchar,@ScreenId9) + ')'
	IF @ReportId11 is not null SELECT @wClause = @wClause + ' AND (b127.ReportId = ' + convert(varchar,@ReportId11) + ')'
	IF @CultureId10 is not null SELECT @wClause = @wClause + ' AND (b127.CultureId = ' + convert(varchar,@CultureId10) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmColHlp1006') AND type='P')
DROP PROCEDURE dbo.GetExpAdmColHlp1006
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmColHlp1006
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause='FROM dbo.ScreenObj b14 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN dbo.ScreenObjHlp b21 (NOLOCK) ON b14.ScreenObjId = b21.ScreenObjId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture (NOLOCK))x163 ON b21.CultureId = x163.CultureId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenObjId14Text=b14.ScreenObjId'
+ ', ScreenObjId14=b14.ScreenObjId'
+ ', ScreenObjHlpId21=' + case when charindex('b21 ',@fClause) > 0 then 'b21.ScreenObjHlpId' else 'null' end
+ ', CultureId21=x163.CultureId'
+ ', CultureId21Text=x163.CultureTypeDesc'
+ ', ColumnHeader21=' + case when charindex('b21 ',@fClause) > 0 then 'b21.ColumnHeader' else 'null' end
+ ', ToolTip21=' + case when charindex('b21 ',@fClause) > 0 then 'b21.ToolTip' else 'null' end
+ ', ErrMessage21=' + case when charindex('b21 ',@fClause) > 0 then 'b21.ErrMessage' else 'null' end
+ ', TbHint21=' + case when charindex('b21 ',@fClause) > 0 then 'b21.TbHint' else 'null' end + ''
SELECT @oClause='ORDER BY b14.ScreenObjId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b14.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b14.')
			END
		END
	END
END
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b21.','Y','N',null,'N','ScreenObjHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b21.','Y','N',null,'N','ScreenObjHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b14.ScreenObjId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmCronJob118') AND type='P')
DROP PROCEDURE dbo.GetExpAdmCronJob118
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmCronJob118
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.CronJob b264 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CronJobId264Text=b264.CronJobId'
+ ', CronJobId264=b264.CronJobId'
+ ', CronJobName264=b264.CronJobName'
+ ', LastRun264=b264.LastRun'
+ ', NextRun264=b264.NextRun'
+ ', JobLink264=b264.JobLink'
+ ', LastStatus264=b264.LastStatus'
+ ', Year264=b264.Year'
+ ', Month264=b264.Month'
+ ', Day264=b264.Day'
+ ', Hour264=b264.Hour'
+ ', Minute264=b264.Minute'
+ ', DayOfWeek264=b264.DayOfWeek'
SELECT @oClause='ORDER BY b264.CronJobId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b264.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b264.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b264.CronJobId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmDataCat96') AND type='P')
DROP PROCEDURE dbo.GetExpAdmDataCat96
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmDataCat96
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.RptwizCat b181 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptwizTypId,RptwizTypName FROM dbo.RptwizTyp (NOLOCK))x1604 ON b181.RptwizTypId = x1604.RptwizTypId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT TableId,TableDesc FROM dbo.DbTable (NOLOCK))x1864 ON b181.TableId = x1864.TableId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN dbo.RptwizCatDtl b182 (NOLOCK) ON b181.RptwizCatId = b182.RptwizCatId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnName FROM dbo.DbColumn (NOLOCK))x1579 ON b182.ColumnId = x1579.ColumnId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT TypeId,TypeDesc FROM RODesign.dbo.CtDisplayType (NOLOCK))x1865 ON b182.DisplayModeId = x1865.TypeId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptwizCatId181Text=b181.RptwizCatId'
+ ', RptwizCatId181=b181.RptwizCatId'
+ ', RptwizTypId181=x1604.RptwizTypId'
+ ', RptwizTypId181Text=x1604.RptwizTypName'
+ ', RptwizCatName181=b181.RptwizCatName'
+ ', CatDescription181=b181.CatDescription'
+ ', TableId181=x1864.TableId'
+ ', TableId181Text=x1864.TableDesc'
+ ', SampleImage181=b181.SampleImage'
+ ', RptwizCatDtlId182=' + case when charindex('b182 ',@fClause) > 0 then 'b182.RptwizCatDtlId' else 'null' end
+ ', ColumnId182=x1579.ColumnId'
+ ', ColumnId182Text=x1579.ColumnName'
+ ', DisplayModeId182=x1865.TypeId'
+ ', DisplayModeId182Text=x1865.TypeDesc'
+ ', ColumnSize182=' + case when charindex('b182 ',@fClause) > 0 then 'b182.ColumnSize' else 'null' end
+ ', RowSize182=' + case when charindex('b182 ',@fClause) > 0 then 'b182.RowSize' else 'null' end
+ ', DdlKeyColNm182=' + case when charindex('b182 ',@fClause) > 0 then 'b182.DdlKeyColNm' else 'null' end
+ ', DdlRefColNm182=' + case when charindex('b182 ',@fClause) > 0 then 'b182.DdlRefColNm' else 'null' end
+ ', RegClause182=' + case when charindex('b182 ',@fClause) > 0 then 'b182.RegClause' else 'null' end
+ ', StoredProc182=' + case when charindex('b182 ',@fClause) > 0 then 'b182.StoredProc' else 'null' end + ''
SELECT @oClause='ORDER BY b181.RptwizCatId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b181.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b181.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b181.RptwizCatId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmDbKey15') AND type='P')
DROP PROCEDURE dbo.GetExpAdmDbKey15
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmDbKey15
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.DbKey b20 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT TableId,TableName FROM dbo.DbTable (NOLOCK))x156 ON b20.TableId = x156.TableId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc,TableId FROM dbo.DbColumn (NOLOCK))x157 ON b20.ColumnId = x157.ColumnId AND x156.TableId = x157.TableId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT TableId,TableName FROM dbo.DbTable (NOLOCK))x158 ON b20.RefTableId = x158.TableId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc,TableId FROM dbo.DbColumn (NOLOCK))x159 ON b20.RefColumnId = x159.ColumnId AND x158.TableId = x159.TableId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' KeyId20Text=b20.KeyId'
+ ', KeyId20=b20.KeyId'
+ ', KeyName20=b20.KeyName'
+ ', TableId20=x156.TableId'
+ ', TableId20Text=x156.TableName'
+ ', ColumnId20=x157.ColumnId'
+ ', ColumnId20Text=x157.ColumnDesc'
+ ', RefTableId20=x158.TableId'
+ ', RefTableId20Text=x158.TableName'
+ ', RefColumnId20=x159.ColumnId'
+ ', RefColumnId20Text=x159.ColumnDesc'
SELECT @oClause='ORDER BY b20.KeyId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b20.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b20.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b20.KeyId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmDbTable2') AND type='P')
DROP PROCEDURE dbo.GetExpAdmDbTable2
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmDbTable2
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@TableName25	VarChar(500)
,@TableDesc42	NVarChar(100)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.DbTable b3 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT SystemId,SystemName FROM RODesign.dbo.Systems (NOLOCK))x321 ON b3.SystemId = x321.SystemId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT UsrId,UsrName FROM RODesign.dbo.Usr (NOLOCK))x1373 ON b3.ModifiedBy = x1373.UsrId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN dbo.DbColumn b5 (NOLOCK) ON b3.TableId = b5.TableId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT DataTypeId,DataTypeName FROM RODesign.dbo.CtDataType (NOLOCK))x36 ON b5.DataType = x36.DataTypeId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' TableId3Text=b3.TableId'
+ ', TableId3=b3.TableId'
+ ', SystemId3=x321.SystemId'
+ ', SystemId3Text=x321.SystemName'
+ ', TableName3=b3.TableName'
+ ', TableDesc3=b3.TableDesc'
+ ', TblObjective3=b3.TblObjective'
+ ', VirtualTbl3=b3.VirtualTbl'
+ ', MultiDesignDb3=b3.MultiDesignDb'
+ ', ModifiedBy3=x1373.UsrId'
+ ', ModifiedBy3Text=x1373.UsrName'
+ ', ModifiedOn3=b3.ModifiedOn'
+ ', LastSyncDt3=b3.LastSyncDt'
+ ', VirtualSql3=b3.VirtualSql'
+ ', ColumnId5=' + case when charindex('b5 ',@fClause) > 0 then 'b5.ColumnId' else 'null' end
+ ', ColumnIndex5=' + case when charindex('b5 ',@fClause) > 0 then 'b5.ColumnIndex' else 'null' end
+ ', ExternalTable5=' + case when charindex('b5 ',@fClause) > 0 then 'b5.ExternalTable' else 'null' end
+ ', ColumnName5=' + case when charindex('b5 ',@fClause) > 0 then 'b5.ColumnName' else 'null' end
+ ', DataType5=x36.DataTypeId'
+ ', DataType5Text=x36.DataTypeName'
+ ', ColumnLength5=' + case when charindex('b5 ',@fClause) > 0 then 'b5.ColumnLength' else 'null' end
+ ', ColumnScale5=' + case when charindex('b5 ',@fClause) > 0 then 'b5.ColumnScale' else 'null' end
+ ', DefaultValue5=' + case when charindex('b5 ',@fClause) > 0 then 'b5.DefaultValue' else 'null' end
+ ', AllowNulls5=' + case when charindex('b5 ',@fClause) > 0 then 'b5.AllowNulls' else 'null' end
+ ', ColumnIdentity5=' + case when charindex('b5 ',@fClause) > 0 then 'b5.ColumnIdentity' else 'null' end
+ ', PrimaryKey5=' + case when charindex('b5 ',@fClause) > 0 then 'b5.PrimaryKey' else 'null' end
+ ', IsIndexU5=' + case when charindex('b5 ',@fClause) > 0 then 'b5.IsIndexU' else 'null' end
+ ', IsIndex5=' + case when charindex('b5 ',@fClause) > 0 then 'b5.IsIndex' else 'null' end
+ ', ColObjective5=' + case when charindex('b5 ',@fClause) > 0 then 'b5.ColObjective' else 'null' end + ''
SELECT @oClause='ORDER BY b3.TableId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b3.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b3.')
			END
		END
	END
END
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','b3.','N','N',null,'Y','TableId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b3.TableId = ' + @key + ')'
ELSE
BEGIN
	IF @TableName25 is not null SELECT @wClause = @wClause + ' AND (b3.TableName like N''%' + replace(@TableName25,'''','''''') + '%'')'
	IF @TableDesc42 is not null SELECT @wClause = @wClause + ' AND (b3.TableDesc like N''%' + replace(@TableDesc42,'''','''''') + '%'')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmLabel112') AND type='P')
DROP PROCEDURE dbo.GetExpAdmLabel112
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmLabel112
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@CultureId48	SmallInt
,@LabelCat49	VarChar(50)
,@LabelKey51	VarChar(50)
,@LabelText50	NVarChar(max)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
	,@CompanyId		Int
SELECT @fClause='FROM dbo.Label b215 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureTypeId,CultureTypeDesc FROM RODesign.dbo.CtCulture (NOLOCK))x1796 ON b215.CultureId = x1796.CultureTypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CompanyId,CompanyDesc FROM ROCmon.dbo.Company (NOLOCK))x1797 ON b215.CompanyId = x1797.CompanyId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' LabelId215Text=b215.LabelId'
+ ', LabelId215=b215.LabelId'
+ ', CultureId215=x1796.CultureTypeId'
+ ', CultureId215Text=x1796.CultureTypeDesc'
+ ', LabelCat215=b215.LabelCat'
+ ', LabelKey215=b215.LabelKey'
+ ', LabelText215=b215.LabelText'
+ ', CompanyId215=x1797.CompanyId'
+ ', CompanyId215Text=x1797.CompanyDesc'
+ ', SortOrder215=b215.SortOrder'
SELECT @oClause='ORDER BY b215.LabelId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b215.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b215.')
			END
		END
	END
END
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b215.','Y','N',null,'N','LabelId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b215.','Y','N',null,'N','LabelId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyId','Company','b215.','Y','N',null,'Y','LabelId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyId','Company','b215.','N',null,'LabelId',@wClause OUTPUT
IF @key is not null SELECT @wClause = @wClause + ' AND (b215.LabelId = ' + @key + ')'
ELSE
BEGIN
	IF @CultureId48 is not null SELECT @wClause = @wClause + ' AND (b215.CultureId = ' + convert(varchar,@CultureId48) + ')'
	IF @LabelCat49 is not null SELECT @wClause = @wClause + ' AND (b215.LabelCat like N''%' + replace(@LabelCat49,'''','''''') + '%'')'
	IF @LabelKey51 is not null SELECT @wClause = @wClause + ' AND (b215.LabelKey like N''%' + replace(@LabelKey51,'''','''''') + '%'')'
	IF @LabelText50 is not null SELECT @wClause = @wClause + ' AND (b215.LabelText like N''%' + replace(@LabelText50,'''','''''') + '%'')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmMenu35') AND type='P')
DROP PROCEDURE dbo.GetExpAdmMenu35
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmMenu35
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.Menu b39 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenId,ScreenDesc FROM dbo.Screen (NOLOCK))x326 ON b39.ScreenId = x326.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportId,ReportDesc FROM dbo.Report (NOLOCK))x327 ON b39.ReportId = x327.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT WizardId,WizardTitle FROM dbo.Wizard (NOLOCK))x538 ON b39.WizardId = x538.WizardId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT StaticPgId,StaticPgDesc FROM dbo.StaticPg (NOLOCK))x2129 ON b39.StaticPgId = x2129.StaticPgId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' MenuId39Text=b39.MenuId'
+ ', MenuId39=b39.MenuId'
+ ', Popup39=b39.Popup'
+ ', ParentId39=b39.ParentId'
+ ', MenuIndex39=b39.MenuIndex'
+ ', ScreenId39=x326.ScreenId'
+ ', ScreenId39Text=x326.ScreenDesc'
+ ', ReportId39=x327.ReportId'
+ ', ReportId39Text=x327.ReportDesc'
+ ', WizardId39=x538.WizardId'
+ ', WizardId39Text=x538.WizardTitle'
+ ', StaticPgId39=x2129.StaticPgId'
+ ', StaticPgId39Text=x2129.StaticPgDesc'
+ ', Miscellaneous39=b39.Miscellaneous'
+ ', IconUrl39=b39.IconUrl'
SELECT @oClause='ORDER BY b39.MenuId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b39.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b39.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b39.MenuId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmMenuDrg121') AND type='P')
DROP PROCEDURE dbo.GetExpAdmMenuDrg121
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmMenuDrg121
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.Menu b39 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' MenuId39Text=b39.MenuId'
+ ', MenuId39=b39.MenuId'
+ ', ParentId39=b39.ParentId'
+ ', MenuIndex39=b39.MenuIndex'
SELECT @oClause='ORDER BY b39.MenuId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b39.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b39.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b39.MenuId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmMenuHlp36') AND type='P')
DROP PROCEDURE dbo.GetExpAdmMenuHlp36
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmMenuHlp36
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause='FROM dbo.Menu b39 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN dbo.MenuHlp b40 (NOLOCK) ON b39.MenuId = b40.MenuId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture (NOLOCK))x1304 ON b40.CultureId = x1304.CultureId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' MenuId39Text=b39.MenuId'
+ ', MenuId39=b39.MenuId'
+ ', MenuHlpId40=' + case when charindex('b40 ',@fClause) > 0 then 'b40.MenuHlpId' else 'null' end
+ ', CultureId40=x1304.CultureId'
+ ', CultureId40Text=x1304.CultureTypeDesc'
+ ', MenuText40=' + case when charindex('b40 ',@fClause) > 0 then 'b40.MenuText' else 'null' end + ''
SELECT @oClause='ORDER BY b39.MenuId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b39.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b39.')
			END
		END
	END
END
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b40.','Y','N',null,'N','MenuHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b40.','Y','N',null,'N','MenuHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b39.MenuId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmMenuPerm58') AND type='P')
DROP PROCEDURE dbo.GetExpAdmMenuPerm58
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmMenuPerm58
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.Menu b39 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN dbo.MenuPrm b231 (NOLOCK) ON b39.MenuId = b231.MenuId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT EveryoneCd,EveryoneName FROM RODesign.dbo.CtEveryone (NOLOCK))x1892 ON b231.GrantDeny = x1892.EveryoneCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT PermKeyId,PermKeyDesc FROM RODesign.dbo.VwPermKey (NOLOCK))x1887 ON b231.PermKeyId = x1887.PermKeyId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT PermId,PermIdText,PermKeyId FROM RODesign.dbo.VwPermKeyRow (NOLOCK))x1888 ON b231.PermId = x1888.PermId AND x1887.PermKeyId = x1888.PermKeyId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' MenuId39Text=b39.MenuId'
+ ', MenuId39=b39.MenuId'
+ ', MenuPrmId231=' + case when charindex('b231 ',@fClause) > 0 then 'b231.MenuPrmId' else 'null' end
+ ', GrantDeny231=x1892.EveryoneCd'
+ ', GrantDeny231Text=x1892.EveryoneName'
+ ', PermKeyId231=x1887.PermKeyId'
+ ', PermKeyId231Text=x1887.PermKeyDesc'
+ ', PermId231=x1888.PermId'
+ ', PermId231Text=x1888.PermIdText'
SELECT @oClause='ORDER BY b39.MenuId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b39.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b39.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b39.MenuId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmMsgCenter86') AND type='P')
DROP PROCEDURE dbo.GetExpAdmMsgCenter86
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmMsgCenter86
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@MsgId28	Int
,@MsgSource27	VarChar(50)
,@MsgName70	NVarChar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause='FROM dbo.Msg b146 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT MsgTypeCd,MsgTypeDesc FROM RODesign.dbo.CtMsgType (NOLOCK))x1311 ON b146.MsgTypeCd = x1311.MsgTypeCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN dbo.MsgCenter b147 (NOLOCK) ON b146.MsgId = b147.MsgId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture (NOLOCK))x1312 ON b147.CultureId = x1312.CultureId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' MsgId146Text=b146.MsgId'
+ ', MsgId146=b146.MsgId'
+ ', MsgTypeCd146=x1311.MsgTypeCd'
+ ', MsgTypeCd146Text=x1311.MsgTypeDesc'
+ ', MsgSource146=b146.MsgSource'
+ ', MsgCenterId147=' + case when charindex('b147 ',@fClause) > 0 then 'b147.MsgCenterId' else 'null' end
+ ', CultureId147=x1312.CultureId'
+ ', CultureId147Text=x1312.CultureTypeDesc'
+ ', Msg147=' + case when charindex('b147 ',@fClause) > 0 then 'b147.Msg' else 'null' end + ''
SELECT @oClause='ORDER BY b146.MsgId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b146.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b146.')
			END
		END
	END
END
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b147.','Y','N',null,'N','MsgCenterId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b147.','Y','N',null,'N','MsgCenterId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b147.','Y','N',null,'N','MsgCenterId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b146.MsgId = ' + @key + ')'
ELSE
BEGIN
	IF @MsgId28 is not null SELECT @wClause = @wClause + ' AND (b146.MsgId = ' + convert(varchar,@MsgId28) + ')'
	IF @MsgSource27 is not null SELECT @wClause = @wClause + ' AND (b146.MsgSource like N''%' + replace(@MsgSource27,'''','''''') + '%'')'
	IF @MsgName70 is not null SELECT @wClause = @wClause + ' AND (b146.MsgName like N''%' + replace(@MsgName70,'''','''''') + '%'')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmOvride78') AND type='P')
DROP PROCEDURE dbo.GetExpAdmOvride78
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetExpAdmOvride78]
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@UsrGroupId		SmallInt
SELECT @fClause='FROM RODesign.dbo.Ovride b122 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN RODesign.dbo.OvrideGrp b123 (NOLOCK) ON b122.OvrideId = b123.OvrideId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT UsrGroupId,UsrGroupName FROM RODesign.dbo.UsrGroup (NOLOCK))x1090 ON b123.UsrGroupId = x1090.UsrGroupId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' OvrideId122Text=b122.OvrideName'
+ ', OvrideId122=b122.OvrideId'
+ ', OvrideName122=b122.OvrideName'
+ ', PromptAlways122=b122.PromptAlways'
+ ', PromptModal122=b122.PromptModal'
+ ', OvrideGrpId123=b123.OvrideGrpId'
+ ', UsrGroupId123=x1090.UsrGroupId'
+ ', UsrGroupId123Text=x1090.UsrGroupName'
SELECT @oClause='ORDER BY b122.OvrideName'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b122.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b122.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@UsrGroups,'UsrGroupId','UsrGroup','b123.','N','N',null,'N','OvrideGrpId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b122.OvrideId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmReport67') AND type='P')
DROP PROCEDURE dbo.GetExpAdmReport67
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmReport67
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CompanyId		VarChar
	,@CultureId		SmallInt
SELECT @fClause='FROM dbo.Report b22 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportTypeCd,ReportTypeDesc FROM RODesign.dbo.CtReportType (NOLOCK))x1718 ON b22.ReportTypeCd = x1718.ReportTypeCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT OrientationCd,OrientationName FROM RODesign.dbo.CtOrientation (NOLOCK))x172 ON b22.OrientationCd = x172.OrientationCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportId,ReportDesc FROM dbo.Report (NOLOCK))x483 ON b22.CopyReportId = x483.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT UsrId,UsrName FROM RODesign.dbo.Usr (NOLOCK))x1410 ON b22.ModifiedBy = x1410.UsrId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT DocId,DocName FROM dbo.RptTemplate (NOLOCK))x1717 ON b22.RptTemplate = x1717.DocId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT UnitCd,UnitDesc FROM RODesign.dbo.CtUnit (NOLOCK))x1487 ON b22.UnitCd = x1487.UnitCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN dbo.ReportHlp b96 (NOLOCK) ON b22.ReportId = b96.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture (NOLOCK))x899 ON b96.CultureId = x899.CultureId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportId22Text=b22.ReportId'
+ ', ReportId22=b22.ReportId'
+ ', ProgramName22=b22.ProgramName'
+ ', ReportTypeCd22=x1718.ReportTypeCd'
+ ', ReportTypeCd22Text=x1718.ReportTypeDesc'
+ ', OrientationCd22=x172.OrientationCd'
+ ', OrientationCd22Text=x172.OrientationName'
+ ', CopyReportId22=x483.ReportId'
+ ', CopyReportId22Text=x483.ReportDesc'
+ ', ModifiedBy22=x1410.UsrId'
+ ', ModifiedBy22Text=x1410.UsrName'
+ ', ModifiedOn22=b22.ModifiedOn'
+ ', TemplateName22=b22.TemplateName'
+ ', RptTemplate22=b22.RptTemplate'
+ ', UnitCd22=x1487.UnitCd'
+ ', UnitCd22Text=x1487.UnitDesc'
+ ', TopMargin22=b22.TopMargin'
+ ', BottomMargin22=b22.BottomMargin'
+ ', LeftMargin22=b22.LeftMargin'
+ ', RightMargin22=b22.RightMargin'
+ ', PageWidth22=b22.PageWidth'
+ ', PageHeight22=b22.PageHeight'
+ ', AllowSelect22=b22.AllowSelect'
+ ', GenerateRp22=b22.GenerateRp'
+ ', LastGenDt22=b22.LastGenDt'
+ ', AuthRequired22=b22.AuthRequired'
+ ', WhereClause22=b22.WhereClause'
+ ', RegClause22=b22.RegClause'
+ ', RegCode22=b22.RegCode'
+ ', ValClause22=b22.ValClause'
+ ', ValCode22=b22.ValCode'
+ ', UpdClause22=b22.UpdClause'
+ ', UpdCode22=b22.UpdCode'
+ ', XlsClause22=b22.XlsClause'
+ ', XlsCode22=b22.XlsCode'
+ ', ReportHlpId96=' + case when charindex('b96 ',@fClause) > 0 then 'b96.ReportHlpId' else 'null' end
+ ', CultureId96=x899.CultureId'
+ ', CultureId96Text=x899.CultureTypeDesc'
+ ', DefaultHlpMsg96=' + case when charindex('b96 ',@fClause) > 0 then 'b96.DefaultHlpMsg' else 'null' end
+ ', ReportTitle96=' + case when charindex('b96 ',@fClause) > 0 then 'b96.ReportTitle' else 'null' end + ''
SELECT @oClause='ORDER BY b22.ReportId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b22.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b22.')
			END
		END
	END
END
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','b22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b96.','Y','N',null,'N','ReportHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b96.','Y','N',null,'N','ReportHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b96.','Y','N',null,'N','ReportHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b96.','Y','N',null,'N','ReportHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','b22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','b22.','Y',null,'ReportId',@wClause OUTPUT
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b22.ReportId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmReportCri69') AND type='P')
DROP PROCEDURE dbo.GetExpAdmReportCri69
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmReportCri69
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ReportId4	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause='FROM dbo.ReportCri b97 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportId,ReportDesc FROM dbo.Report (NOLOCK))x902 ON b97.ReportId = x902.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportGrpId,ReportGrpName FROM dbo.ReportGrp (NOLOCK))x903 ON b97.ReportGrpId = x903.ReportGrpId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT TableId,TableName FROM dbo.DbTable (NOLOCK))x904 ON b97.TableId = x904.TableId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT DataTypeId,DataTypeName FROM RODesign.dbo.CtDataType (NOLOCK))x908 ON b97.DataTypeId = x908.DataTypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT TypeId,TypeDesc FROM RODesign.dbo.VwDisplayType (NOLOCK))x910 ON b97.DisplayModeId = x910.TypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportCriId,ReportCriDesc,ReportId FROM dbo.ReportCri (NOLOCK))x5360 ON b97.DdlFtrColumnId = x5360.ReportCriId AND x902.ReportId = x5360.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN dbo.ReportCriHlp b98 (NOLOCK) ON b97.ReportCriId = b98.ReportCriId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture (NOLOCK))x923 ON b98.CultureId = x923.CultureId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportCriId97Text=b97.ReportCriId'
+ ', ReportCriId97=b97.ReportCriId'
+ ', ReportId97=x902.ReportId'
+ ', ReportId97Text=x902.ReportDesc'
+ ', TabIndex97=b97.TabIndex'
+ ', ColumnName97=b97.ColumnName'
+ ', ReportGrpId97=x903.ReportGrpId'
+ ', ReportGrpId97Text=x903.ReportGrpName'
+ ', LabelCss97=b97.LabelCss'
+ ', ContentCss97=b97.ContentCss'
+ ', DefaultValue97=b97.DefaultValue'
+ ', TableId97=x904.TableId'
+ ', TableId97Text=x904.TableName'
+ ', TableAbbr97=b97.TableAbbr'
+ ', RequiredValid97=b97.RequiredValid'
+ ', DataTypeId97=x908.DataTypeId'
+ ', DataTypeId97Text=x908.DataTypeName'
+ ', DataTypeSize97=b97.DataTypeSize'
+ ', DisplayModeId97=x910.TypeId'
+ ', DisplayModeId97Text=x910.TypeDesc'
+ ', ColumnSize97=b97.ColumnSize'
+ ', RowSize97=b97.RowSize'
+ ', DdlKeyColumnName97=b97.DdlKeyColumnName'
+ ', DdlRefColumnName97=b97.DdlRefColumnName'
+ ', DdlSrtColumnName97=b97.DdlSrtColumnName'
+ ', DdlFtrColumnId97=x5360.ReportCriId'
+ ', DdlFtrColumnId97Text=x5360.ReportCriDesc'
+ ', WhereClause97=b97.WhereClause'
+ ', RegClause97=b97.RegClause'
+ ', ReportCriHlpId98=' + case when charindex('b98 ',@fClause) > 0 then 'b98.ReportCriHlpId' else 'null' end
+ ', CultureId98=x923.CultureId'
+ ', CultureId98Text=x923.CultureTypeDesc'
+ ', ColumnHeader98=' + case when charindex('b98 ',@fClause) > 0 then 'b98.ColumnHeader' else 'null' end + ''
SELECT @oClause='ORDER BY b97.ReportCriId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b97.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b97.')
			END
		END
	END
END
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b98.','Y','N',null,'N','ReportCriHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b98.','Y','N',null,'N','ReportCriHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b98.','Y','N',null,'N','ReportCriHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b97.ReportCriId = ' + @key + ')'
ELSE
BEGIN
	IF @ReportId4 is not null SELECT @wClause = @wClause + ' AND (b97.ReportId = ' + convert(varchar,@ReportId4) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmReportObj13') AND type='P')
DROP PROCEDURE dbo.GetExpAdmReportObj13
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmReportObj13
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ReportId13	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause='FROM dbo.ReportObj b23 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportId,ReportDesc FROM dbo.Report (NOLOCK))x870 ON b23.ReportId = x870.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptObjTypeCd,RptObjTypeName FROM RODesign.dbo.CtRptObjType (NOLOCK))x1403 ON b23.RptObjTypeCd = x1403.RptObjTypeCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT DataTypeId,DataTypeName FROM RODesign.dbo.CtDataType (NOLOCK))x179 ON b23.DataTypeId = x179.DataTypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT OperatorId,OperatorName FROM RODesign.dbo.CtOperator (NOLOCK))x925 ON b23.OperatorId = x925.OperatorId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportCriId,ColumnName,ReportId FROM dbo.ReportCri (NOLOCK))x926 ON b23.ReportCriId = x926.ReportCriId AND x870.ReportId = x926.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN dbo.ReportObjHlp b99 (NOLOCK) ON b23.ReportObjId = b99.ReportObjId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture (NOLOCK))x930 ON b99.CultureId = x930.CultureId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportObjId23Text=b23.ReportObjId'
+ ', ReportObjId23=b23.ReportObjId'
+ ', ReportId23=x870.ReportId'
+ ', ReportId23Text=x870.ReportDesc'
+ ', ColumnName23=b23.ColumnName'
+ ', RptObjTypeCd23=x1403.RptObjTypeCd'
+ ', RptObjTypeCd23Text=x1403.RptObjTypeName'
+ ', TabIndex23=b23.TabIndex'
+ ', ColumnFormat23=b23.ColumnFormat'
+ ', PaddSize23=b23.PaddSize'
+ ', PaddChar23=b23.PaddChar'
+ ', DataTypeId23=x179.DataTypeId'
+ ', DataTypeId23Text=x179.DataTypeName'
+ ', OperatorId23=x925.OperatorId'
+ ', OperatorId23Text=x925.OperatorName'
+ ', ReportCriId23=x926.ReportCriId'
+ ', ReportCriId23Text=x926.ColumnName'
+ ', ReportObjHlpId99=' + case when charindex('b99 ',@fClause) > 0 then 'b99.ReportObjHlpId' else 'null' end
+ ', CultureId99=x930.CultureId'
+ ', CultureId99Text=x930.CultureTypeDesc'
+ ', ColumnHeader99=' + case when charindex('b99 ',@fClause) > 0 then 'b99.ColumnHeader' else 'null' end
+ ', HeaderWidth99=' + case when charindex('b99 ',@fClause) > 0 then 'b99.HeaderWidth' else 'null' end + ''
SELECT @oClause='ORDER BY b23.ReportObjId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b23.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b23.')
			END
		END
	END
END
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b99.','Y','N',null,'N','ReportObjHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b99.','Y','N',null,'N','ReportObjHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b99.','Y','N',null,'N','ReportObjHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b23.ReportObjId = ' + @key + ')'
ELSE
BEGIN
	IF @ReportId13 is not null SELECT @wClause = @wClause + ' AND (b23.ReportId = ' + convert(varchar,@ReportId13) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmRowOvrd17') AND type='P')
DROP PROCEDURE dbo.GetExpAdmRowOvrd17
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmRowOvrd17
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId38	Int
,@ReportId39	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.RowOvrd b238 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenId,ScreenDesc FROM dbo.Screen (NOLOCK))x1940 ON b238.ScreenId = x1940.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportId,ReportDesc FROM dbo.Report (NOLOCK))x1941 ON b238.ReportId = x1941.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RowAuthId,RowAuthName FROM RODesign.dbo.VwRowAuth (NOLOCK))x1942 ON b238.RowAuthId = x1942.RowAuthId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT SelectTypeCd,SelectTypeName FROM RODesign.dbo.CtSelectType (NOLOCK))x1943 ON b238.AllowSel = x1943.SelectTypeCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN dbo.RowOvrdPrm b239 (NOLOCK) ON b238.RowOvrdId = b239.RowOvrdId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT AndOrCd,AndOrName FROM RODesign.dbo.CtAndOr (NOLOCK))x2099 ON b239.AndCondition = x2099.AndOrCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT PermKeyId,PermKeyDesc FROM RODesign.dbo.VwPermKey (NOLOCK))x1950 ON b239.PermKeyId = x1950.PermKeyId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT SelectTypeCd,SelectTypeName FROM RODesign.dbo.CtSelectType (NOLOCK))x1951 ON b239.SelLevel = x1951.SelectTypeCd'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RowOvrdId238Text=b238.RowOvrdId'
+ ', RowOvrdId238=b238.RowOvrdId'
+ ', ScreenId238=x1940.ScreenId'
+ ', ScreenId238Text=x1940.ScreenDesc'
+ ', ReportId238=x1941.ReportId'
+ ', ReportId238Text=x1941.ReportDesc'
+ ', RowAuthId238=x1942.RowAuthId'
+ ', RowAuthId238Text=x1942.RowAuthName'
+ ', AllowSel238=x1943.SelectTypeCd'
+ ', AllowSel238Text=x1943.SelectTypeName'
+ ', AllowAdd238=b238.AllowAdd'
+ ', AllowUpd238=b238.AllowUpd'
+ ', AllowDel238=b238.AllowDel'
+ ', RowOvrdPrmId239=' + case when charindex('b239 ',@fClause) > 0 then 'b239.RowOvrdPrmId' else 'null' end
+ ', AndCondition239=x2099.AndOrCd'
+ ', AndCondition239Text=x2099.AndOrName'
+ ', PermKeyId239=x1950.PermKeyId'
+ ', PermKeyId239Text=x1950.PermKeyDesc'
+ ', SelLevel239=x1951.SelectTypeCd'
+ ', SelLevel239Text=x1951.SelectTypeName'
SELECT @oClause='ORDER BY b238.RowOvrdId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b238.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b238.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b238.RowOvrdId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId38 is not null SELECT @wClause = @wClause + ' AND (b238.ScreenId = ' + convert(varchar,@ScreenId38) + ')'
	IF @ReportId39 is not null SELECT @wClause = @wClause + ' AND (b238.ReportId = ' + convert(varchar,@ReportId39) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmRptCha100') AND type='P')
DROP PROCEDURE dbo.GetExpAdmRptCha100
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmRptCha100
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.RptCha b206 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptCtrId,RptCtrDesc FROM dbo.RptCtr (NOLOCK))x1723 ON b206.RptCtrId = x1723.RptCtrId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportId,ReportDesc FROM dbo.Report (NOLOCK))x1724 ON b206.ReportId = x1724.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptChaTypeCd,RptChaTypeName FROM RODesign.dbo.CtRptChaType (NOLOCK))x1725 ON b206.RptChaTypeCd = x1725.RptChaTypeCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportObjId,ColumnDesc,ReportId FROM dbo.ReportObj (NOLOCK))x1727 ON b206.CategoryGrp = x1727.ReportObjId AND x1724.ReportId = x1727.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportObjId,ColumnDesc,ReportId FROM dbo.ReportObj (NOLOCK))x1729 ON b206.SeriesGrp = x1729.ReportObjId AND x1724.ReportId = x1729.ReportId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptChaId206Text=b206.RptChaId'
+ ', RptChaId206=b206.RptChaId'
+ ', RptCtrId206=x1723.RptCtrId'
+ ', RptCtrId206Text=x1723.RptCtrDesc'
+ ', ReportId206=x1724.ReportId'
+ ', ReportId206Text=x1724.ReportDesc'
+ ', RptChaTypeCd206=x1725.RptChaTypeCd'
+ ', RptChaTypeCd206Text=x1725.RptChaTypeName'
+ ', ThreeD206=b206.ThreeD'
+ ', CategoryGrp206=x1727.ReportObjId'
+ ', CategoryGrp206Text=x1727.ColumnDesc'
+ ', ChartData206=b206.ChartData'
+ ', SeriesGrp206=x1729.ReportObjId'
+ ', SeriesGrp206Text=x1729.ColumnDesc'
SELECT @oClause='ORDER BY b206.RptChaId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b206.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b206.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b206.RptChaId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmRptCtr90') AND type='P')
DROP PROCEDURE dbo.GetExpAdmRptCtr90
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmRptCtr90
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ReportId29	Int
,@CtrValue67	NVarChar(1000)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.RptCtr b161 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportId,ReportDesc FROM dbo.Report (NOLOCK))x1467 ON b161.ReportId = x1467.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptCtrId,RptCtrDesc FROM dbo.RptCtr (NOLOCK))x1430 ON b161.PRptCtrId = x1430.RptCtrId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptElmId,RptElmDesc FROM dbo.RptElm (NOLOCK))x1429 ON b161.RptElmId = x1429.RptElmId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptCelId,RptCelDesc FROM dbo.RptCel (NOLOCK))x1431 ON b161.RptCelId = x1431.RptCelId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptStyleId,RptStyleDesc FROM dbo.RptStyle (NOLOCK))x1447 ON b161.RptStyleId = x1447.RptStyleId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptCtrTypeCd,RptCtrTypeName FROM RODesign.dbo.CtRptCtrType (NOLOCK))x1432 ON b161.RptCtrTypeCd = x1432.RptCtrTypeCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CheckBoxCd,CheckBoxName FROM RODesign.dbo.CtCheckBox (NOLOCK))x1453 ON b161.CtrVisibility = x1453.CheckBoxCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptCtrId,RptCtrDesc,ReportId FROM dbo.RptCtr (NOLOCK))x1623 ON b161.CtrToggle = x1623.RptCtrId AND x1467.ReportId = x1623.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportObjId,ColumnDesc,ReportId FROM dbo.ReportObj (NOLOCK))x1463 ON b161.CtrGrouping = x1463.ReportObjId AND x1467.ReportId = x1463.ReportId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptCtrId161Text=b161.RptCtrId'
+ ', RptCtrId161=b161.RptCtrId'
+ ', ReportId161=x1467.ReportId'
+ ', ReportId161Text=x1467.ReportDesc'
+ ', RptCtrName161=b161.RptCtrName'
+ ', PRptCtrId161=x1430.RptCtrId'
+ ', PRptCtrId161Text=x1430.RptCtrDesc'
+ ', RptElmId161=x1429.RptElmId'
+ ', RptElmId161Text=x1429.RptElmDesc'
+ ', RptCelId161=x1431.RptCelId'
+ ', RptCelId161Text=x1431.RptCelDesc'
+ ', RptStyleId161=x1447.RptStyleId'
+ ', RptStyleId161Text=x1447.RptStyleDesc'
+ ', RptCtrTypeCd161=x1432.RptCtrTypeCd'
+ ', RptCtrTypeCd161Text=x1432.RptCtrTypeName'
+ ', CtrTop161=b161.CtrTop'
+ ', CtrLeft161=b161.CtrLeft'
+ ', CtrHeight161=b161.CtrHeight'
+ ', CtrWidth161=b161.CtrWidth'
+ ', CtrZIndex161=b161.CtrZIndex'
+ ', CtrPgBrStart161=b161.CtrPgBrStart'
+ ', CtrPgBrEnd161=b161.CtrPgBrEnd'
+ ', CtrCanGrow161=b161.CtrCanGrow'
+ ', CtrCanShrink161=b161.CtrCanShrink'
+ ', CtrTogether161=b161.CtrTogether'
+ ', CtrValue161=b161.CtrValue'
+ ', CtrAction161=b161.CtrAction'
+ ', CtrVisibility161=x1453.CheckBoxCd'
+ ', CtrVisibility161Text=x1453.CheckBoxName'
+ ', CtrToggle161=x1623.RptCtrId'
+ ', CtrToggle161Text=x1623.RptCtrDesc'
+ ', CtrGrouping161=x1463.ReportObjId'
+ ', CtrGrouping161Text=x1463.ColumnDesc'
+ ', CtrToolTip161=b161.CtrToolTip'
SELECT @oClause='ORDER BY b161.RptCtrId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b161.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b161.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b161.RptCtrId = ' + @key + ')'
ELSE
BEGIN
	IF @ReportId29 is not null SELECT @wClause = @wClause + ' AND (b161.ReportId = ' + convert(varchar,@ReportId29) + ')'
	IF @CtrValue67 is not null SELECT @wClause = @wClause + ' AND (b161.CtrValue like N''%' + replace(@CtrValue67,'''','''''') + '%'')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmRptStyle89') AND type='P')
DROP PROCEDURE dbo.GetExpAdmRptStyle89
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmRptStyle89
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@DefaultCd32	Char(2)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.RptStyle b167 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT DefaultCd,DefaultName FROM RODesign.dbo.CtRptStyDef (NOLOCK))x1556 ON b167.DefaultCd = x1556.DefaultCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT BgGradTypeId,BgGradTypeDesc FROM RODesign.dbo.CtBgGradType (NOLOCK))x1516 ON b167.BgGradType = x1516.BgGradTypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT DirectionCd,DirectionDesc FROM RODesign.dbo.CtDirection (NOLOCK))x1539 ON b167.Direction = x1539.DirectionCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT WritingModeCd,WritingModeDesc FROM RODesign.dbo.CtWritingMode (NOLOCK))x1540 ON b167.WritingMode = x1540.WritingModeCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT BorderStyleId,BorderStyleName FROM RODesign.dbo.CtBorderStyle (NOLOCK))x1501 ON b167.BorderStyleD = x1501.BorderStyleId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT BorderStyleId,BorderStyleName FROM RODesign.dbo.CtBorderStyle (NOLOCK))x1502 ON b167.BorderStyleL = x1502.BorderStyleId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT BorderStyleId,BorderStyleName FROM RODesign.dbo.CtBorderStyle (NOLOCK))x1503 ON b167.BorderStyleR = x1503.BorderStyleId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT BorderStyleId,BorderStyleName FROM RODesign.dbo.CtBorderStyle (NOLOCK))x1504 ON b167.BorderStyleT = x1504.BorderStyleId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT BorderStyleId,BorderStyleName FROM RODesign.dbo.CtBorderStyle (NOLOCK))x1505 ON b167.BorderStyleB = x1505.BorderStyleId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT FontStyleCd,FontStyleName FROM RODesign.dbo.CtFontStyle (NOLOCK))x1519 ON b167.FontStyle = x1519.FontStyleCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT FontWeightCd,FontWeightDesc FROM RODesign.dbo.CtFontWeight (NOLOCK))x1522 ON b167.FontWeight = x1522.FontWeightCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT TextDecorCd,TextDecorDesc FROM RODesign.dbo.CtTextDecor (NOLOCK))x1530 ON b167.TextDecor = x1530.TextDecorCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT TextAlignCd,TextAlignName FROM RODesign.dbo.CtTextAlign (NOLOCK))x1531 ON b167.TextAlign = x1531.TextAlignCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT VerticalAlignCd,VerticalAlignName FROM RODesign.dbo.CtVerticalAlign (NOLOCK))x1532 ON b167.VerticalAlign = x1532.VerticalAlignCd'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptStyleId167Text=b167.RptStyleId'
+ ', RptStyleId167=b167.RptStyleId'
+ ', DefaultCd167=x1556.DefaultCd'
+ ', DefaultCd167Text=x1556.DefaultName'
+ ', RptStyleDesc167=b167.RptStyleDesc'
+ ', BorderColorD167=b167.BorderColorD'
+ ', BorderColorL167=b167.BorderColorL'
+ ', BorderColorR167=b167.BorderColorR'
+ ', BorderColorT167=b167.BorderColorT'
+ ', BorderColorB167=b167.BorderColorB'
+ ', Color167=b167.Color'
+ ', BgColor167=b167.BgColor'
+ ', BgGradType167=x1516.BgGradTypeId'
+ ', BgGradType167Text=x1516.BgGradTypeDesc'
+ ', BgGradColor167=b167.BgGradColor'
+ ', BgImage167=b167.BgImage'
+ ', Direction167=x1539.DirectionCd'
+ ', Direction167Text=x1539.DirectionDesc'
+ ', WritingMode167=x1540.WritingModeCd'
+ ', WritingMode167Text=x1540.WritingModeDesc'
+ ', LineHeight167=b167.LineHeight'
+ ', Format167=b167.Format'
+ ', BorderStyleD167=x1501.BorderStyleId'
+ ', BorderStyleD167Text=x1501.BorderStyleName'
+ ', BorderStyleL167=x1502.BorderStyleId'
+ ', BorderStyleL167Text=x1502.BorderStyleName'
+ ', BorderStyleR167=x1503.BorderStyleId'
+ ', BorderStyleR167Text=x1503.BorderStyleName'
+ ', BorderStyleT167=x1504.BorderStyleId'
+ ', BorderStyleT167Text=x1504.BorderStyleName'
+ ', BorderStyleB167=x1505.BorderStyleId'
+ ', BorderStyleB167Text=x1505.BorderStyleName'
+ ', FontStyle167=x1519.FontStyleCd'
+ ', FontStyle167Text=x1519.FontStyleName'
+ ', FontFamily167=b167.FontFamily'
+ ', FontSize167=b167.FontSize'
+ ', FontWeight167=x1522.FontWeightCd'
+ ', FontWeight167Text=x1522.FontWeightDesc'
+ ', TextDecor167=x1530.TextDecorCd'
+ ', TextDecor167Text=x1530.TextDecorDesc'
+ ', TextAlign167=x1531.TextAlignCd'
+ ', TextAlign167Text=x1531.TextAlignName'
+ ', VerticalAlign167=x1532.VerticalAlignCd'
+ ', VerticalAlign167Text=x1532.VerticalAlignName'
+ ', BorderWidthD167=b167.BorderWidthD'
+ ', BorderWidthL167=b167.BorderWidthL'
+ ', BorderWidthR167=b167.BorderWidthR'
+ ', BorderWidthT167=b167.BorderWidthT'
+ ', BorderWidthB167=b167.BorderWidthB'
+ ', PadLeft167=b167.PadLeft'
+ ', PadRight167=b167.PadRight'
+ ', PadTop167=b167.PadTop'
+ ', PadBottom167=b167.PadBottom'
SELECT @oClause='ORDER BY b167.RptStyleId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b167.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b167.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b167.RptStyleId = ' + @key + ')'
ELSE
BEGIN
	IF @DefaultCd32 is not null SELECT @wClause = @wClause + ' AND (b167.DefaultCd = N''' + @DefaultCd32 + ''')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmRptTbl92') AND type='P')
DROP PROCEDURE dbo.GetExpAdmRptTbl92
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmRptTbl92
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ReportId34	Int
,@RptCtrId31	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.RptTbl b162 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptCtrId,RptCtrDesc FROM dbo.RptCtr (NOLOCK))x1436 ON b162.RptCtrId = x1436.RptCtrId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptTblId,RptTblDesc FROM dbo.RptTbl (NOLOCK))x1486 ON b162.ParentId = x1486.RptTblId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportId,ReportDesc FROM dbo.Report (NOLOCK))x1621 ON b162.ReportId = x1621.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptCtrId,RptCtrDesc,ReportId FROM dbo.RptCtr (NOLOCK))x1622 ON b162.TblToggle = x1622.RptCtrId AND x1621.ReportId = x1622.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportObjId,ColumnDesc,ReportId FROM dbo.ReportObj (NOLOCK))x1437 ON b162.TblGrouping = x1437.ReportObjId AND x1621.ReportId = x1437.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptTblTypeCd,RptTblTypeName FROM RODesign.dbo.CtRptTblType (NOLOCK))x1434 ON b162.RptTblTypeCd = x1434.RptTblTypeCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CheckBoxCd,CheckBoxName FROM RODesign.dbo.CtCheckBox (NOLOCK))x1440 ON b162.TblVisibility = x1440.CheckBoxCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN dbo.RptCel b164 (NOLOCK) ON b162.RptTblId = b164.RptTblId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptTblId,RptTblDesc FROM dbo.RptTbl (NOLOCK))x1477 ON b164.CelNum = x1477.RptTblId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptTblId162Text=b162.RptTblId'
+ ', RptTblId162=b162.RptTblId'
+ ', RptCtrId162=x1436.RptCtrId'
+ ', RptCtrId162Text=x1436.RptCtrDesc'
+ ', ParentId162=x1486.RptTblId'
+ ', ParentId162Text=x1486.RptTblDesc'
+ ', ReportId162=x1621.ReportId'
+ ', ReportId162Text=x1621.ReportDesc'
+ ', TblToggle162=x1622.RptCtrId'
+ ', TblToggle162Text=x1622.RptCtrDesc'
+ ', TblGrouping162=x1437.ReportObjId'
+ ', TblGrouping162Text=x1437.ColumnDesc'
+ ', RptTblTypeCd162=x1434.RptTblTypeCd'
+ ', RptTblTypeCd162Text=x1434.RptTblTypeName'
+ ', TblVisibility162=x1440.CheckBoxCd'
+ ', TblVisibility162Text=x1440.CheckBoxName'
+ ', TblRepeatNew162=b162.TblRepeatNew'
+ ', TblOrder162=b162.TblOrder'
+ ', ColWidth162=b162.ColWidth'
+ ', RptCelId164=' + case when charindex('b164 ',@fClause) > 0 then 'b164.RptCelId' else 'null' end
+ ', RowNum164=' + case when charindex('b164 ',@fClause) > 0 then 'b164.RowNum' else 'null' end
+ ', RowHeight164=' + case when charindex('b164 ',@fClause) > 0 then 'b164.RowHeight' else 'null' end
+ ', RowVisibility164=' + case when charindex('b164 ',@fClause) > 0 then 'b164.RowVisibility' else 'null' end
+ ', CelNum164=x1477.RptTblId'
+ ', CelNum164Text=x1477.RptTblDesc'
+ ', CelColSpan164=' + case when charindex('b164 ',@fClause) > 0 then 'b164.CelColSpan' else 'null' end + ''
SELECT @oClause='ORDER BY b162.RptTblId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b162.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b162.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b162.RptTblId = ' + @key + ')'
ELSE
BEGIN
	IF @ReportId34 is not null SELECT @wClause = @wClause + ' AND (b162.ReportId = ' + convert(varchar,@ReportId34) + ')'
	IF @RptCtrId31 is not null SELECT @wClause = @wClause + ' AND (b162.RptCtrId = ' + convert(varchar,@RptCtrId31) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmRptWiz95') AND type='P')
DROP PROCEDURE dbo.GetExpAdmRptWiz95
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetExpAdmRptWiz95]
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Key			nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.Rptwiz b183 (NOLOCK)' 
SELECT @fClause = @fClause + ' INNER JOIN (SELECT DISTINCT RptCtrTypeCd,RptCtrTypeName,RptCtrTypeDesc FROM RODesign.dbo.CtRptCtrType (NOLOCK))x1586 ON b183.RptwizTypeCd = x1586.RptCtrTypeCd' 
SELECT @fClause = @fClause + ' INNER JOIN (SELECT DISTINCT RptwizCatId,RptwizCatDesc,CatDescription,SampleImage FROM dbo.RptwizCat (NOLOCK))x1582 ON b183.RptwizCatId = x1582.RptwizCatId' 
SELECT @fClause = @fClause + ' INNER JOIN (SELECT DISTINCT AccessCd,AccessName FROM RODesign.dbo.CtAccess (NOLOCK))x1580 ON b183.AccessCd = x1580.AccessCd' 
SELECT @fClause = @fClause + ' INNER JOIN (SELECT DISTINCT UsrId,LoginName FROM RODesign.dbo.Usr (NOLOCK))x1587 ON b183.UsrId = x1587.UsrId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportId,ReportDesc FROM dbo.Report (NOLOCK))x1581 ON b183.ReportId = x1581.ReportId' 
SELECT @fClause = @fClause + ' INNER JOIN (SELECT DISTINCT OrientationCd,OrientationName FROM RODesign.dbo.CtOrientation (NOLOCK))x1611 ON b183.OrientationCd = x1611.OrientationCd' 
SELECT @fClause = @fClause + ' INNER JOIN (SELECT DISTINCT UnitCd,UnitDesc FROM RODesign.dbo.CtUnit (NOLOCK))x1612 ON b183.UnitCd = x1612.UnitCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptChaTypeCd,RptChaTypeName FROM RODesign.dbo.CtRptChaType (NOLOCK))x1733 ON b183.RptChaTypeCd = x1733.RptChaTypeCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT FormatCd,FormatName FROM RODesign.dbo.CtFormat (NOLOCK))x1827 ON b183.GFormat = x1827.FormatCd'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptwizId183Text=b183.RptwizName'
+ ', RptwizId183=b183.RptwizId'
+ ', RptwizName183=b183.RptwizName'
+ ', RptwizDesc183=b183.RptwizDesc'
+ ', RptwizTypeCd183=x1586.RptCtrTypeCd'
+ ', RptwizTypeCd183Text=x1586.RptCtrTypeName'
+ ', RptCtrTypeDesc157=x1586.RptCtrTypeDesc'
+ ', TemplateName183=b183.TemplateName'
+ ', RptwizCatId183=x1582.RptwizCatId'
+ ', RptwizCatId183Text=x1582.RptwizCatDesc'
+ ', CatDescription181=' + case when charindex('x1582 ',@fClause) > 0 then 'x1582.CatDescription' else 'null' end
+ ', AccessCd183=x1580.AccessCd'
+ ', AccessCd183Text=x1580.AccessName'
+ ', UsrId183=x1587.UsrId'
+ ', UsrId183Text=x1587.LoginName'
+ ', ReportId183=x1581.ReportId'
+ ', ReportId183Text=x1581.ReportDesc'
+ ', RptwizCatImg181=' + case when charindex('x1582 ',@fClause) > 0 then 'x1582.SampleImage' else 'null' end
+ ', OrientationCd183=x1611.OrientationCd'
+ ', OrientationCd183Text=x1611.OrientationName'
+ ', UnitCd183=x1612.UnitCd'
+ ', UnitCd183Text=x1612.UnitDesc'
+ ', TopMargin183=b183.TopMargin'
+ ', BottomMargin183=b183.BottomMargin'
+ ', LeftMargin183=b183.LeftMargin'
+ ', RightMargin183=b183.RightMargin'
+ ', RptChaTypeCd183=x1733.RptChaTypeCd'
+ ', RptChaTypeCd183Text=x1733.RptChaTypeName'
+ ', ThreeD183=b183.ThreeD'
+ ', GMinValue183=b183.GMinValue'
+ ', GLowRange183=b183.GLowRange'
+ ', GMidRange183=b183.GMidRange'
+ ', GMaxValue183=b183.GMaxValue'
+ ', GNeedle183=b183.GNeedle'
+ ', GMinValueId183=b183.GMinValueId'
+ ', GLowRangeId183=b183.GLowRangeId'
+ ', GMidRangeId183=b183.GMidRangeId'
+ ', GMaxValueId183=b183.GMaxValueId'
+ ', GNeedleId183=b183.GNeedleId'
+ ', GPositive183=b183.GPositive'
+ ', GFormat183=x1827.FormatCd'
+ ', GFormat183Text=x1827.FormatName'
SELECT @oClause='ORDER BY b183.RptwizName'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b183.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b183.')
			END
		END
	END
END
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'UsrId','Usr','b183.','N','N',null,'N','RptwizId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b183.RptwizId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmScreen9') AND type='P')
DROP PROCEDURE dbo.GetExpAdmScreen9
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmScreen9
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId60	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause='FROM dbo.Screen b15 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenTypeId,ScreenTypeDesc FROM RODesign.dbo.CtScreenType (NOLOCK))x127 ON b15.ScreenTypeId = x127.ScreenTypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ViewTypeCd,ViewTypeName FROM RODesign.dbo.CtViewType (NOLOCK))x3245 ON b15.ViewOnly = x3245.ViewTypeCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT TableId,TableDesc FROM dbo.DbTable (NOLOCK))x146 ON b15.MasterTableId = x146.TableId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT TableId,TableDesc FROM dbo.DbTable (NOLOCK))x7451 ON b15.SearchTableId = x7451.TableId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc,TableId FROM dbo.DbColumn (NOLOCK))x128 ON b15.SearchId = x128.ColumnId AND x7451.TableId = x128.TableId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc,TableId FROM dbo.DbColumn (NOLOCK))x7478 ON b15.SearchIdR = x7478.ColumnId AND x7451.TableId = x7478.TableId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc,TableId FROM dbo.DbColumn (NOLOCK))x7450 ON b15.SearchDtlId = x7450.ColumnId AND x7451.TableId = x7450.TableId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc,TableId FROM dbo.DbColumn (NOLOCK))x7479 ON b15.SearchDtlIdR = x7479.ColumnId AND x7451.TableId = x7479.TableId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc,TableId FROM dbo.DbColumn (NOLOCK))x7449 ON b15.SearchUrlId = x7449.ColumnId AND x7451.TableId = x7449.TableId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc,TableId FROM dbo.DbColumn (NOLOCK))x7448 ON b15.SearchImgId = x7448.ColumnId AND x7451.TableId = x7448.TableId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT TableId,TableDesc FROM dbo.DbTable (NOLOCK))x147 ON b15.DetailTableId = x147.TableId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN dbo.ScreenHlp b16 (NOLOCK) ON b15.ScreenId = b16.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture (NOLOCK))x136 ON b16.CultureId = x136.CultureId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId15Text=b15.ScreenId'
+ ', ScreenId15=b15.ScreenId'
+ ', ProgramName15=b15.ProgramName'
+ ', ScreenTypeId15=x127.ScreenTypeId'
+ ', ScreenTypeId15Text=x127.ScreenTypeDesc'
+ ', ViewOnly15=x3245.ViewTypeCd'
+ ', ViewOnly15Text=x3245.ViewTypeName'
+ ', SearchAscending15=b15.SearchAscending'
+ ', MasterTableId15=x146.TableId'
+ ', MasterTableId15Text=x146.TableDesc'
+ ', SearchTableId15=x7451.TableId'
+ ', SearchTableId15Text=x7451.TableDesc'
+ ', SearchId15=x128.ColumnId'
+ ', SearchId15Text=x128.ColumnDesc'
+ ', SearchIdR15=x7478.ColumnId'
+ ', SearchIdR15Text=x7478.ColumnDesc'
+ ', SearchDtlId15=x7450.ColumnId'
+ ', SearchDtlId15Text=x7450.ColumnDesc'
+ ', SearchDtlIdR15=x7479.ColumnId'
+ ', SearchDtlIdR15Text=x7479.ColumnDesc'
+ ', SearchUrlId15=x7449.ColumnId'
+ ', SearchUrlId15Text=x7449.ColumnDesc'
+ ', SearchImgId15=x7448.ColumnId'
+ ', SearchImgId15Text=x7448.ColumnDesc'
+ ', DetailTableId15=x147.TableId'
+ ', DetailTableId15Text=x147.TableDesc'
+ ', GridRows15=b15.GridRows'
+ ', HasDeleteAll15=b15.HasDeleteAll'
+ ', ShowGridHead15=b15.ShowGridHead'
+ ', GenerateSc15=b15.GenerateSc'
+ ', GenerateSr15=b15.GenerateSr'
+ ', ValidateReq15=b15.ValidateReq'
+ ', DeferError15=b15.DeferError'
+ ', AuthRequired15=b15.AuthRequired'
+ ', GenAudit15=b15.GenAudit'
+ ', ScreenObj15=b15.ScreenObj'
+ ', ScreenHlpId16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.ScreenHlpId' else 'null' end
+ ', CultureId16=x136.CultureId'
+ ', CultureId16Text=x136.CultureTypeDesc'
+ ', ScreenTitle16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.ScreenTitle' else 'null' end
+ ', DefaultHlpMsg16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.DefaultHlpMsg' else 'null' end
+ ', FootNote16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.FootNote' else 'null' end
+ ', AddMsg16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.AddMsg' else 'null' end
+ ', UpdMsg16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.UpdMsg' else 'null' end
+ ', DelMsg16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.DelMsg' else 'null' end
+ ', IncrementMsg16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.IncrementMsg' else 'null' end
+ ', NoMasterMsg16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.NoMasterMsg' else 'null' end
+ ', NoDetailMsg16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.NoDetailMsg' else 'null' end
+ ', AddMasterMsg16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.AddMasterMsg' else 'null' end
+ ', AddDetailMsg16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.AddDetailMsg' else 'null' end
+ ', MasterLstTitle16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.MasterLstTitle' else 'null' end
+ ', MasterLstSubtitle16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.MasterLstSubtitle' else 'null' end
+ ', MasterRecTitle16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.MasterRecTitle' else 'null' end
+ ', MasterRecSubtitle16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.MasterRecSubtitle' else 'null' end
+ ', MasterFoundMsg16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.MasterFoundMsg' else 'null' end
+ ', DetailLstTitle16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.DetailLstTitle' else 'null' end
+ ', DetailLstSubtitle16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.DetailLstSubtitle' else 'null' end
+ ', DetailRecTitle16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.DetailRecTitle' else 'null' end
+ ', DetailRecSubtitle16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.DetailRecSubtitle' else 'null' end
+ ', DetailFoundMsg16=' + case when charindex('b16 ',@fClause) > 0 then 'b16.DetailFoundMsg' else 'null' end + ''
SELECT @oClause='ORDER BY b15.ScreenId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b15.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b15.')
			END
		END
	END
END
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b16.','Y','N',null,'N','ScreenHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b16.','Y','N',null,'N','ScreenHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b16.','Y','N',null,'N','ScreenHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b15.ScreenId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId60 is not null SELECT @wClause = @wClause + ' AND (b15.ScreenId = ' + convert(varchar,@ScreenId60) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmScreenCri73') AND type='P')
DROP PROCEDURE dbo.GetExpAdmScreenCri73
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmScreenCri73
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId3	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause='FROM dbo.ScreenCri b104 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenId,ScreenDesc FROM dbo.Screen (NOLOCK))x971 ON b104.ScreenId = x971.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc FROM dbo.DbColumn (NOLOCK))x975 ON b104.ColumnId = x975.ColumnId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT OperatorId,OperatorDesc FROM RODesign.dbo.CtOperator (NOLOCK))x5340 ON b104.OperatorId = x5340.OperatorId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT TypeId,TypeDesc FROM RODesign.dbo.VwDisplayType (NOLOCK))x979 ON b104.DisplayModeId = x979.TypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT JustifyCd,JustifyName FROM RODesign.dbo.CtJustify (NOLOCK))x1371 ON b104.ColumnJustify = x1371.JustifyCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc FROM dbo.DbColumn (NOLOCK))x981 ON b104.DdlKeyColumnId = x981.ColumnId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc FROM dbo.DbColumn (NOLOCK))x982 ON b104.DdlRefColumnId = x982.ColumnId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc FROM dbo.DbColumn (NOLOCK))x1120 ON b104.DdlSrtColumnId = x1120.ColumnId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenCriId,ScreenCriDesc,ScreenId FROM dbo.ScreenCri (NOLOCK))x5361 ON b104.DdlFtrColumnId = x5361.ScreenCriId AND x971.ScreenId = x5361.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN dbo.ScreenCriHlp b105 (NOLOCK) ON b104.ScreenCriId = b105.ScreenCriId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture (NOLOCK))x990 ON b105.CultureId = x990.CultureId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenCriId104Text=b104.ScreenCriId'
+ ', ScreenCriId104=b104.ScreenCriId'
+ ', ScreenId104=x971.ScreenId'
+ ', ScreenId104Text=x971.ScreenDesc'
+ ', LabelCss104=b104.LabelCss'
+ ', ContentCss104=b104.ContentCss'
+ ', ColumnId104=x975.ColumnId'
+ ', ColumnId104Text=x975.ColumnDesc'
+ ', OperatorId104=x5340.OperatorId'
+ ', OperatorId104Text=x5340.OperatorDesc'
+ ', DisplayModeId104=x979.TypeId'
+ ', DisplayModeId104Text=x979.TypeDesc'
+ ', TabIndex104=b104.TabIndex'
+ ', RequiredValid104=b104.RequiredValid'
+ ', ColumnJustify104=x1371.JustifyCd'
+ ', ColumnJustify104Text=x1371.JustifyName'
+ ', ColumnSize104=b104.ColumnSize'
+ ', RowSize104=b104.RowSize'
+ ', DdlKeyColumnId104=x981.ColumnId'
+ ', DdlKeyColumnId104Text=x981.ColumnDesc'
+ ', DdlRefColumnId104=x982.ColumnId'
+ ', DdlRefColumnId104Text=x982.ColumnDesc'
+ ', DdlSrtColumnId104=x1120.ColumnId'
+ ', DdlSrtColumnId104Text=x1120.ColumnDesc'
+ ', DdlFtrColumnId104=x5361.ScreenCriId'
+ ', DdlFtrColumnId104Text=x5361.ScreenCriDesc'
+ ', ScreenCriHlpId105=' + case when charindex('b105 ',@fClause) > 0 then 'b105.ScreenCriHlpId' else 'null' end
+ ', CultureId105=x990.CultureId'
+ ', CultureId105Text=x990.CultureTypeDesc'
+ ', ColumnHeader105=' + case when charindex('b105 ',@fClause) > 0 then 'b105.ColumnHeader' else 'null' end + ''
SELECT @oClause='ORDER BY b104.ScreenCriId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b104.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b104.')
			END
		END
	END
END
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b105.','Y','N',null,'N','ScreenCriHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b105.','Y','N',null,'N','ScreenCriHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b105.','Y','N',null,'N','ScreenCriHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b104.ScreenCriId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId3 is not null SELECT @wClause = @wClause + ' AND (b104.ScreenId = ' + convert(varchar,@ScreenId3) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmScreenFilter59') AND type='P')
DROP PROCEDURE dbo.GetExpAdmScreenFilter59
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmScreenFilter59
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId1072	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause='FROM dbo.ScreenFilter b86 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenId,ScreenDesc FROM dbo.Screen (NOLOCK))x723 ON b86.ScreenId = x723.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN dbo.ScreenFilterHlp b87 (NOLOCK) ON b86.ScreenFilterId = b87.ScreenFilterId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture (NOLOCK))x730 ON b87.CultureId = x730.CultureId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenFilterId86Text=b86.ScreenFilterId'
+ ', ScreenFilterId86=b86.ScreenFilterId'
+ ', ScreenId86=x723.ScreenId'
+ ', ScreenId86Text=x723.ScreenDesc'
+ ', ScreenFilterName86=b86.ScreenFilterName'
+ ', FilterClause86=b86.FilterClause'
+ ', FilterOrder86=b86.FilterOrder'
+ ', ApplyToMst86=b86.ApplyToMst'
+ ', ScreenFilterHlpId87=' + case when charindex('b87 ',@fClause) > 0 then 'b87.ScreenFilterHlpId' else 'null' end
+ ', CultureId87=x730.CultureId'
+ ', CultureId87Text=x730.CultureTypeDesc'
+ ', FilterName87=' + case when charindex('b87 ',@fClause) > 0 then 'b87.FilterName' else 'null' end + ''
SELECT @oClause='ORDER BY b86.ScreenFilterId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b86.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b86.')
			END
		END
	END
END
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b87.','Y','N',null,'N','ScreenFilterHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b87.','Y','N',null,'N','ScreenFilterHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b87.','Y','N',null,'N','ScreenFilterHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b86.ScreenFilterId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId1072 is not null SELECT @wClause = @wClause + ' AND (b86.ScreenId = ' + convert(varchar,@ScreenId1072) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmScreenObj10') AND type='P')
DROP PROCEDURE dbo.GetExpAdmScreenObj10
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmScreenObj10
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.ScreenObj b14 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT GridGrpCd,GridGrpName FROM RODesign.dbo.CtGridGrp (NOLOCK))x2145 ON b14.GridGrpCd = x2145.GridGrpCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT JustifyCd,JustifyName FROM RODesign.dbo.CtJustify (NOLOCK))x1365 ON b14.ColumnJustify = x1365.JustifyCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenId,ScreenDesc FROM dbo.Screen (NOLOCK))x934 ON b14.ScreenId = x934.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT GroupRowId,GroupRowName FROM RODesign.dbo.GroupRow (NOLOCK))x5279 ON b14.GroupRowId = x5279.GroupRowId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT GroupColId,GroupColName FROM RODesign.dbo.GroupCol (NOLOCK))x1016 ON b14.GroupColId = x1016.GroupColId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc FROM dbo.DbColumn (NOLOCK))x109 ON b14.ColumnId = x109.ColumnId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT TypeId,TypeDesc,DisplayDesc FROM RODesign.dbo.CtDisplayType (NOLOCK))x116 ON b14.DisplayModeId = x116.TypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc FROM dbo.DbColumn (NOLOCK))x117 ON b14.DdlKeyColumnId = x117.ColumnId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc FROM dbo.DbColumn (NOLOCK))x118 ON b14.DdlRefColumnId = x118.ColumnId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc FROM dbo.DbColumn (NOLOCK))x1119 ON b14.DdlSrtColumnId = x1119.ColumnId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc FROM dbo.DbColumn (NOLOCK))x1123 ON b14.DdlAdnColumnId = x1123.ColumnId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc FROM dbo.DbColumn (NOLOCK))x1124 ON b14.DdlFtrColumnId = x1124.ColumnId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT DtlLstPosId,DtlLstPosNm FROM RODesign.dbo.CtDtlLstPos (NOLOCK))x7542 ON b14.DtlLstPosId = x7542.DtlLstPosId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT AggregateCd,AggregateName FROM RODesign.dbo.CtAggregate (NOLOCK))x1082 ON b14.AggregateCd = x1082.AggregateCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT MatchCd,MatchName FROM RODesign.dbo.CtMatch (NOLOCK))x1849 ON b14.MatchCd = x1849.MatchCd'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenObjId14Text=b14.ScreenObjId'
+ ', ScreenObjId14=b14.ScreenObjId'
+ ', MasterTable14=b14.MasterTable'
+ ', RequiredValid14=b14.RequiredValid'
+ ', ColumnWrap14=b14.ColumnWrap'
+ ', GridGrpCd14=x2145.GridGrpCd'
+ ', GridGrpCd14Text=x2145.GridGrpName'
+ ', HideOnTablet14=b14.HideOnTablet'
+ ', HideOnMobile14=b14.HideOnMobile'
+ ', RefreshOnCUD14=b14.RefreshOnCUD'
+ ', TrimOnEntry14=b14.TrimOnEntry'
+ ', IgnoreConfirm14=b14.IgnoreConfirm'
+ ', ColumnJustify14=x1365.JustifyCd'
+ ', ColumnJustify14Text=x1365.JustifyName'
+ ', ColumnSize14=b14.ColumnSize'
+ ', ColumnHeight14=b14.ColumnHeight'
+ ', ResizeWidth14=b14.ResizeWidth'
+ ', ResizeHeight14=b14.ResizeHeight'
+ ', SortOrder14=b14.SortOrder'
+ ', ScreenId14=x934.ScreenId'
+ ', ScreenId14Text=x934.ScreenDesc'
+ ', GroupRowId14=x5279.GroupRowId'
+ ', GroupRowId14Text=x5279.GroupRowName'
+ ', GroupColId14=x1016.GroupColId'
+ ', GroupColId14Text=x1016.GroupColName'
+ ', ColumnId14=x109.ColumnId'
+ ', ColumnId14Text=x109.ColumnDesc'
+ ', ColumnName14=b14.ColumnName'
+ ', DisplayModeId14=x116.TypeId'
+ ', DisplayModeId14Text=x116.TypeDesc'
+ ', DisplayDesc18=x116.DisplayDesc'
+ ', DdlKeyColumnId14=x117.ColumnId'
+ ', DdlKeyColumnId14Text=x117.ColumnDesc'
+ ', DdlRefColumnId14=x118.ColumnId'
+ ', DdlRefColumnId14Text=x118.ColumnDesc'
+ ', DdlSrtColumnId14=x1119.ColumnId'
+ ', DdlSrtColumnId14Text=x1119.ColumnDesc'
+ ', DdlAdnColumnId14=x1123.ColumnId'
+ ', DdlAdnColumnId14Text=x1123.ColumnDesc'
+ ', DdlFtrColumnId14=x1124.ColumnId'
+ ', DdlFtrColumnId14Text=x1124.ColumnDesc'
+ ', ColumnLink14=b14.ColumnLink'
+ ', DtlLstPosId14=x7542.DtlLstPosId'
+ ', DtlLstPosId14Text=x7542.DtlLstPosNm'
+ ', LabelVertical14=b14.LabelVertical'
+ ', LabelCss14=b14.LabelCss'
+ ', ContentCss14=b14.ContentCss'
+ ', DefaultValue14=b14.DefaultValue'
+ ', HyperLinkUrl14=b14.HyperLinkUrl'
+ ', DefAfter14=b14.DefAfter'
+ ', SystemValue14=b14.SystemValue'
+ ', DefAlways14=b14.DefAlways'
+ ', AggregateCd14=x1082.AggregateCd'
+ ', AggregateCd14Text=x1082.AggregateName'
+ ', GenerateSp14=b14.GenerateSp'
+ ', MaskValid14=b14.MaskValid'
+ ', RangeValidType14=b14.RangeValidType'
+ ', RangeValidMax14=b14.RangeValidMax'
+ ', RangeValidMin14=b14.RangeValidMin'
+ ', MatchCd14=x1849.MatchCd'
+ ', MatchCd14Text=x1849.MatchName'
SELECT @oClause='ORDER BY b14.ScreenObjId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b14.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b14.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b14.ScreenObjId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmScreenTab54') AND type='P')
DROP PROCEDURE dbo.GetExpAdmScreenTab54
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmScreenTab54
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause='FROM dbo.ScreenTab b19 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenId,ScreenDesc FROM dbo.Screen (NOLOCK))x5338 ON b19.ScreenId = x5338.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN dbo.ScreenTabHlp b80 (NOLOCK) ON b19.ScreenTabId = b80.ScreenTabId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture (NOLOCK))x621 ON b80.CultureId = x621.CultureId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenTabId19Text=b19.ScreenTabId'
+ ', ScreenTabId19=b19.ScreenTabId'
+ ', ScreenId19=x5338.ScreenId'
+ ', ScreenId19Text=x5338.ScreenDesc'
+ ', TabFolderName19=b19.TabFolderName'
+ ', TabFolderOrder19=b19.TabFolderOrder'
+ ', ScreenTabHlpId80=' + case when charindex('b80 ',@fClause) > 0 then 'b80.ScreenTabHlpId' else 'null' end
+ ', CultureId80=x621.CultureId'
+ ', CultureId80Text=x621.CultureTypeDesc'
+ ', TabFolderName80=' + case when charindex('b80 ',@fClause) > 0 then 'b80.TabFolderName' else 'null' end + ''
SELECT @oClause='ORDER BY b19.ScreenTabId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b19.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b19.')
			END
		END
	END
END
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b80.','Y','N',null,'N','ScreenTabHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b80.','Y','N',null,'N','ScreenTabHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b19.ScreenTabId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmServerRule14') AND type='P')
DROP PROCEDURE dbo.GetExpAdmServerRule14
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmServerRule14
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId16	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.ServerRule b24 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RuleTypeId,RuleTypeDesc FROM RODesign.dbo.CtRuleType (NOLOCK))x188 ON b24.RuleTypeId = x188.RuleTypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenId,ScreenDesc FROM dbo.Screen (NOLOCK))x1140 ON b24.ScreenId = x1140.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CrudTypeCd,CrudTypeName,CrudTypeDesc FROM RODesign.dbo.CtCrudType (NOLOCK))x200 ON b24.BeforeCRUD = x200.CrudTypeCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT UsrId,UsrName FROM RODesign.dbo.Usr (NOLOCK))x1264 ON b24.ModifiedBy = x1264.UsrId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ServerRuleId24Text=b24.ServerRuleId'
+ ', ServerRuleId24=b24.ServerRuleId'
+ ', RuleName24=b24.RuleName'
+ ', RuleDescription24=b24.RuleDescription'
+ ', RuleTypeId24=x188.RuleTypeId'
+ ', RuleTypeId24Text=x188.RuleTypeDesc'
+ ', ScreenId24=x1140.ScreenId'
+ ', ScreenId24Text=x1140.ScreenDesc'
+ ', RuleOrder24=b24.RuleOrder'
+ ', ProcedureName24=b24.ProcedureName'
+ ', ParameterNames24=b24.ParameterNames'
+ ', ParameterTypes24=b24.ParameterTypes'
+ ', CallingParams24=b24.CallingParams'
+ ', MasterTable24=b24.MasterTable'
+ ', OnAdd24=b24.OnAdd'
+ ', OnUpd24=b24.OnUpd'
+ ', OnDel24=b24.OnDel'
+ ', BeforeCRUD24=x200.CrudTypeCd'
+ ', BeforeCRUD24Text=x200.CrudTypeName'
+ ', CrudTypeDesc1289=x200.CrudTypeDesc'
+ ', RuleCode24=b24.RuleCode'
+ ', ModifiedBy24=x1264.UsrId'
+ ', ModifiedBy24Text=x1264.UsrName'
+ ', ModifiedOn24=b24.ModifiedOn'
+ ', LastGenDt24=b24.LastGenDt'
SELECT @oClause='ORDER BY b24.ServerRuleId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b24.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b24.')
			END
		END
	END
END
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','b24.','N','N',null,'Y','ServerRuleId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b24.ServerRuleId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId16 is not null SELECT @wClause = @wClause + ' AND (b24.ScreenId = ' + convert(varchar,@ScreenId16) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmStaticCs115') AND type='P')
DROP PROCEDURE dbo.GetExpAdmStaticCs115
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmStaticCs115
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.StaticCs b260 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' StaticCsId260Text=b260.StaticCsId'
+ ', StaticCsId260=b260.StaticCsId'
+ ', StaticCsNm260=b260.StaticCsNm'
+ ', StyleDef260=b260.StyleDef'
SELECT @oClause='ORDER BY b260.StaticCsId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b260.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b260.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b260.StaticCsId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmStaticJs116') AND type='P')
DROP PROCEDURE dbo.GetExpAdmStaticJs116
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmStaticJs116
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.StaticJs b261 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' StaticJsId261Text=b261.StaticJsId'
+ ', StaticJsId261=b261.StaticJsId'
+ ', StaticJsNm261=b261.StaticJsNm'
+ ', ScriptDef261=b261.ScriptDef'
SELECT @oClause='ORDER BY b261.StaticJsId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b261.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b261.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b261.StaticJsId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmStaticPg114') AND type='P')
DROP PROCEDURE dbo.GetExpAdmStaticPg114
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmStaticPg114
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@StaticPgId1070	Int
,@StaticMeta55	NVarChar(1000)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.StaticPg b259 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT StaticCsId,StaticCsNm FROM dbo.StaticCs (NOLOCK))x2140 ON b259.StaticCsId = x2140.StaticCsId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT StaticJsId,StaticJsNm FROM dbo.StaticJs (NOLOCK))x2141 ON b259.StaticJsId = x2141.StaticJsId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' StaticPgId259Text=b259.StaticPgId'
+ ', StaticPgId259=b259.StaticPgId'
+ ', StaticPgNm259=b259.StaticPgNm'
+ ', StaticPgTitle259=b259.StaticPgTitle'
+ ', MasterPgFile259=b259.MasterPgFile'
+ ', StaticCsId259=x2140.StaticCsId'
+ ', StaticCsId259Text=x2140.StaticCsNm'
+ ', StaticJsId259=x2141.StaticJsId'
+ ', StaticJsId259Text=x2141.StaticJsNm'
+ ', StaticPgUrl259=b259.StaticPgUrl'
+ ', StaticMeta259=b259.StaticMeta'
+ ', StaticPgHtm259=b259.StaticPgHtm'
+ ', StaticPgCss259=b259.StaticPgCss'
+ ', StaticPgJs259=b259.StaticPgJs'
SELECT @oClause='ORDER BY b259.StaticPgId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b259.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b259.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b259.StaticPgId = ' + @key + ')'
ELSE
BEGIN
	IF @StaticPgId1070 is not null SELECT @wClause = @wClause + ' AND (b259.StaticPgId = ' + convert(varchar,@StaticPgId1070) + ')'
	IF @StaticMeta55 is not null SELECT @wClause = @wClause + ' AND (b259.StaticMeta like N''%' + replace(@StaticMeta55,'''','''''') + '%'')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmTbdRule113') AND type='P')
DROP PROCEDURE dbo.GetExpAdmTbdRule113
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmTbdRule113
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId52	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.TbdRule b254 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenId,ScreenDesc FROM dbo.Screen (NOLOCK))x2082 ON b254.ScreenId = x2082.ScreenId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' TbdRuleId254Text=b254.TbdRuleId'
+ ', TbdRuleId254=b254.TbdRuleId'
+ ', ScreenId254=x2082.ScreenId'
+ ', ScreenId254Text=x2082.ScreenDesc'
+ ', TbdRuleName254=b254.TbdRuleName'
+ ', TbdRuleDesc254=b254.TbdRuleDesc'
SELECT @oClause='ORDER BY b254.TbdRuleId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b254.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b254.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b254.TbdRuleId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId52 is not null SELECT @wClause = @wClause + ' AND (b254.ScreenId = ' + convert(varchar,@ScreenId52) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmWebRule80') AND type='P')
DROP PROCEDURE dbo.GetExpAdmWebRule80
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmWebRule80
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId15	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.WebRule b128 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RuleTypeId,RuleTypeDesc FROM RODesign.dbo.CtRuleType (NOLOCK))x1127 ON b128.RuleTypeId = x1127.RuleTypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenId,ScreenDesc FROM dbo.Screen (NOLOCK))x1129 ON b128.ScreenId = x1129.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenObjId,ColumnDesc,ScreenId FROM dbo.ScreenObj (NOLOCK))x1130 ON b128.ScreenObjId = x1130.ScreenObjId AND x1129.ScreenId = x1130.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ButtonTypeId,ButtonTypeDesc FROM RODesign.dbo.VwScrButton (NOLOCK))x1131 ON b128.ButtonTypeId = x1131.ButtonTypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT EventId,EventDesc FROM RODesign.dbo.CtEvent (NOLOCK))x1132 ON b128.EventId = x1132.EventId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RuleReactTypeId,RuleReactTypeDesc FROM RODesign.dbo.CtRuleReactType (NOLOCK))x7552 ON b128.ReactEventId = x7552.RuleReactTypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RuleReduxTypeId,RuleReduxTypeDesc FROM RODesign.dbo.CtRuleReduxType (NOLOCK))x7550 ON b128.ReduxEventId = x7550.RuleReduxTypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RuleServiceTypeId,RuleServiceTypeDesc FROM RODesign.dbo.CtRuleServiceType (NOLOCK))x7548 ON b128.ServiceEventId = x7548.RuleServiceTypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RuleAsmxTypeId,RuleAsmxTypeDesc FROM RODesign.dbo.CtRuleAsmxType (NOLOCK))x7546 ON b128.AsmxEventId = x7546.RuleAsmxTypeId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' WebRuleId128Text=b128.WebRuleId'
+ ', WebRuleId128=b128.WebRuleId'
+ ', RuleName128=b128.RuleName'
+ ', RuleDescription128=b128.RuleDescription'
+ ', RuleTypeId128=x1127.RuleTypeId'
+ ', RuleTypeId128Text=x1127.RuleTypeDesc'
+ ', ScreenId128=x1129.ScreenId'
+ ', ScreenId128Text=x1129.ScreenDesc'
+ ', ScreenObjId128=x1130.ScreenObjId'
+ ', ScreenObjId128Text=x1130.ColumnDesc'
+ ', ButtonTypeId128=x1131.ButtonTypeId'
+ ', ButtonTypeId128Text=x1131.ButtonTypeDesc'
+ ', EventId128=x1132.EventId'
+ ', EventId128Text=x1132.EventDesc'
+ ', WebRuleProg128=b128.WebRuleProg'
+ ', ReactEventId128=x7552.RuleReactTypeId'
+ ', ReactEventId128Text=x7552.RuleReactTypeDesc'
+ ', ReactRuleProg128=b128.ReactRuleProg'
+ ', ReduxEventId128=x7550.RuleReduxTypeId'
+ ', ReduxEventId128Text=x7550.RuleReduxTypeDesc'
+ ', ReduxRuleProg128=b128.ReduxRuleProg'
+ ', ServiceEventId128=x7548.RuleServiceTypeId'
+ ', ServiceEventId128Text=x7548.RuleServiceTypeDesc'
+ ', ServiceRuleProg128=b128.ServiceRuleProg'
+ ', AsmxEventId128=x7546.RuleAsmxTypeId'
+ ', AsmxEventId128Text=x7546.RuleAsmxTypeDesc'
+ ', AsmxRuleProg128=b128.AsmxRuleProg'
SELECT @oClause='ORDER BY b128.WebRuleId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b128.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b128.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b128.WebRuleId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId15 is not null SELECT @wClause = @wClause + ' AND (b128.ScreenId = ' + convert(varchar,@ScreenId15) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmWizardObj49') AND type='P')
DROP PROCEDURE dbo.GetExpAdmWizardObj49
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmWizardObj49
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.Wizard b71 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT WizardTypeId,WizardTypeDesc FROM RODesign.dbo.CtWizardType (NOLOCK))x543 ON b71.WizardTypeId = x543.WizardTypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT TableId,TableDesc FROM dbo.DbTable (NOLOCK))x544 ON b71.MasterTableId = x544.TableId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN dbo.WizardObj b72 (NOLOCK) ON b71.WizardId = b72.WizardId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ColumnId,ColumnDesc FROM dbo.DbColumn (NOLOCK))x551 ON b72.ColumnId = x551.ColumnId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' WizardId71Text=b71.WizardId'
+ ', WizardId71=b71.WizardId'
+ ', WizardTypeId71=x543.WizardTypeId'
+ ', WizardTypeId71Text=x543.WizardTypeDesc'
+ ', MasterTableId71=x544.TableId'
+ ', MasterTableId71Text=x544.TableDesc'
+ ', WizardTitle71=b71.WizardTitle'
+ ', ProgramName71=b71.ProgramName'
+ ', DefWorkSheet71=b71.DefWorkSheet'
+ ', DefStartRow71=b71.DefStartRow'
+ ', DefOverwrite71=b71.DefOverwrite'
+ ', OvwrReadonly71=b71.OvwrReadonly'
+ ', AuthRequired71=b71.AuthRequired'
+ ', WizardObjId72=' + case when charindex('b72 ',@fClause) > 0 then 'b72.WizardObjId' else 'null' end
+ ', ColumnId72=x551.ColumnId'
+ ', ColumnId72Text=x551.ColumnDesc'
+ ', TabIndex72=' + case when charindex('b72 ',@fClause) > 0 then 'b72.TabIndex' else 'null' end + ''
SELECT @oClause='ORDER BY b71.WizardId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b71.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b71.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b71.WizardId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetExpAdmWizardRule50') AND type='P')
DROP PROCEDURE dbo.GetExpAdmWizardRule50
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetExpAdmWizardRule50
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@WizardId17	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.WizardRule b73 (NOLOCK)' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RuleTypeId,RuleTypeDesc FROM RODesign.dbo.CtRuleType (NOLOCK))x556 ON b73.RuleTypeId = x556.RuleTypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT WizardId,WizardTitle FROM dbo.Wizard (NOLOCK))x1141 ON b73.WizardId = x1141.WizardId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' WizardRuleId73Text=b73.WizardRuleId'
+ ', WizardRuleId73=b73.WizardRuleId'
+ ', RuleName73=b73.RuleName'
+ ', RuleDescription73=b73.RuleDescription'
+ ', RuleTypeId73=x556.RuleTypeId'
+ ', RuleTypeId73Text=x556.RuleTypeDesc'
+ ', WizardId73=x1141.WizardId'
+ ', WizardId73Text=x1141.WizardTitle'
+ ', RuleOrder73=b73.RuleOrder'
+ ', ProcedureName73=b73.ProcedureName'
+ ', BeforeCRUD73=b73.BeforeCRUD'
SELECT @oClause='ORDER BY b73.WizardRuleId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b73.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b73.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b73.WizardRuleId = ' + @key + ')'
ELSE
BEGIN
	IF @WizardId17 is not null SELECT @wClause = @wClause + ' AND (b73.WizardId = ' + convert(varchar,@WizardId17) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetGaugeValue') AND type='P')
DROP PROCEDURE dbo.GetGaugeValue
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetGaugeValue]
 @ReportId	Int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
SELECT GMinValue, GLowRange, GMidRange, GMaxValue, GNeedle
	,GMinValueCol = b1.ColumnName, GLowRangeCol = b2.ColumnName, GMidRangeCol = b3.ColumnName
	,GMaxValueCol = b4.ColumnName, GNeedleCol = b5.ColumnName, GPositive, GFormat
	FROM dbo.RptWiz a
	LEFT OUTER JOIN dbo.DbColumn b1 ON a.GMinValueId = b1.ColumnId
	LEFT OUTER JOIN dbo.DbColumn b2 ON a.GLowRangeId = b2.ColumnId
	LEFT OUTER JOIN dbo.DbColumn b3 ON a.GMidRangeId = b3.ColumnId
	LEFT OUTER JOIN dbo.DbColumn b4 ON a.GMaxValueId = b4.ColumnId
	LEFT OUTER JOIN dbo.DbColumn b5 ON a.GNeedleId = b5.ColumnId
	WHERE ReportId = @ReportId
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetGlobalFilter') AND type='P')
DROP PROCEDURE dbo.GetGlobalFilter
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[GetGlobalFilter]
 @usrId		int
,@screenId	int
,@cultureId	smallint
/* WITH ENCRYPTION */
AS
DECLARE	@FilterDesc	nvarchar(4000)
SET NOCOUNT ON
SELECT @FilterDesc = convert(nvarchar(4000),FilterDesc) FROM dbo.GlobalFilter WHERE UsrId = @usrId AND ScreenId = @screenId
IF @@ROWCOUNT <> 0 SELECT FilterDesc = @FilterDesc
ELSE
BEGIN
	SELECT @FilterDesc = convert(nvarchar(4000),FilterDesc) FROM dbo.GlobalFilter WHERE UsrId = @usrId AND FilterDefault = 'Y'
	IF @@ROWCOUNT <> 0 SELECT FilterDesc = @FilterDesc
END
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetInfoByCol') AND type='P')
DROP PROCEDURE dbo.GetInfoByCol
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO







CREATE PROCEDURE [dbo].[GetInfoByCol]
 @ScreenId	int
,@ColumnName	varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(4000)
	,@fClause	varchar(4000)
	,@wClause	varchar(4000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT b.TableId, c.TypeName'
SELECT @fClause = 'FROM dbo.ScreenObj a'
+ ' INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId'
+ ' INNER JOIN RODesign.dbo.CtDisplayType c ON a.DisplayModeId = c.TypeId'
SELECT @wClause = 'WHERE a.MasterTable = ''Y'' AND a.ScreenId = ' + convert(varchar,@ScreenId) + ' AND a.ColumnName = ''' + @ColumnName + ''''
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0


 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLabel') AND type='P')
DROP PROCEDURE dbo.GetLabel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetLabel]
 @CultureId		smallint
,@LabelCat		varchar(50)
,@LabelKey		varchar(50)
,@CompanyId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause		varchar(4000)
		,@fClause		varchar(4000)
		,@wClause		varchar(4000)
		,@oClause		varchar(4000)
		,@DefCultureId	smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF @CultureId <> @DefCultureId AND NOT EXISTS
	(SELECT 1 FROM dbo.Label WHERE CultureId = @CultureId AND LabelKey = @LabelKey)
	SELECT @wClause = 'WHERE CultureId = ' + convert(varchar,@DefCultureId) + ' AND LabelCat = ''' + @LabelCat + ''' AND LabelKey = ''' + @LabelKey + ''''
ELSE
	SELECT @wClause = 'WHERE CultureId = ' + convert(varchar,@CultureId) + ' AND LabelCat = ''' + @LabelCat + ''' AND LabelKey = ''' + @LabelKey + ''''
SELECT @sClause = 'SELECT LabelText'
SELECT @fClause = 'FROM dbo.Label'
IF @CompanyId is null
	SELECT @wClause = @wClause + ' AND CompanyId is null'
ELSE
	SELECT @wClause = @wClause + ' AND CompanyId = ' + convert(varchar,@CompanyId)
SELECT @oClause = 'ORDER BY SortOrder'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLabels') AND type='P')
DROP PROCEDURE dbo.GetLabels
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetLabels]
 @CultureId		smallint
,@LabelCat		varchar(50)
,@CompanyId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId	smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF object_id('tempdb.dbo.#label') is not null DROP TABLE dbo.#label
CREATE TABLE #label (tid smallint IDENTITY(1,1) not null, LabelKey varchar(50) not null, LabelText nvarchar(max) not null, SortOrder smallint null)
IF @CompanyId is null
BEGIN
INSERT #label (LabelKey, LabelText, SortOrder)
	SELECT LabelKey, LabelText, SortOrder FROM dbo.Label WHERE CultureId = @CultureId
	AND LabelCat = @LabelCat AND CompanyId is null
INSERT #label (LabelKey, LabelText, SortOrder)
	SELECT LabelKey, LabelText, SortOrder FROM dbo.Label WHERE CultureId = @DefCultureId
	AND LabelCat = @LabelCat AND CompanyId is null
	AND NOT EXISTS (SELECT 1 FROM #Label WHERE LabelKey = dbo.Label.LabelKey)
END
ELSE
BEGIN
INSERT #label (LabelKey, LabelText, SortOrder)
	SELECT LabelKey, LabelText, SortOrder FROM dbo.Label WHERE CultureId = @CultureId
	AND LabelCat = @LabelCat AND CompanyId = @CompanyId
INSERT #label (LabelKey, LabelText, SortOrder)
	SELECT LabelKey, LabelText, SortOrder FROM dbo.Label WHERE CultureId = @DefCultureId
	AND LabelCat = @LabelCat AND CompanyId = @CompanyId
	AND NOT EXISTS (SELECT 1 FROM #Label WHERE LabelKey = dbo.Label.LabelKey)
END
SELECT LabelKey, LabelText FROM #Label ORDER BY SortOrder
DROP TABLE dbo.#label
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLastCriteria') AND type='P')
DROP PROCEDURE dbo.GetLastCriteria
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetLastCriteria]
 @ScreenId	Int
,@ReportId	Int
,@UsrId		Int
/* WITH ENCRYPTION */
AS
DECLARE	 @LstCnt	int
		,@CriCnt	int
SET NOCOUNT ON
-- Left outer join is needed to include ScreenCriId = 0 in the result set.
-- CANNOT: DELETE FROM dbo.ScreenLstCri WHERE UsrId = @UsrId AND ScreenId = @ScreenId
IF @ScreenId is not null AND @ScreenId > 0
BEGIN
	SELECT @LstCnt = COUNT(1) FROM dbo.ScreenLstCri WHERE UsrId = @UsrId AND ScreenId = @ScreenId
	SELECT @CriCnt = COUNT(1) FROM dbo.ScreenCri WHERE ScreenId = @ScreenId
	IF @LstCnt > 0 AND @CriCnt > 0 AND @LstCnt <> @CriCnt + 1
	BEGIN RAISERROR('Please truncate table ScreenLstCri and try again.',18,2) WITH SETERROR RETURN 1 END
	SELECT a.LastCriteria FROM dbo.ScreenLstCri a
		LEFT OUTER JOIN dbo.ScreenCri b ON a.ScreenCriId = b.ScreenCriId
		WHERE a.UsrId = @UsrId AND a.ScreenId = @ScreenId ORDER BY b.TabIndex
END
ELSE
BEGIN
	SELECT @LstCnt = COUNT(1) FROM dbo.ReportLstCri WHERE UsrId = @UsrId AND ReportId = @ReportId
	SELECT @CriCnt = COUNT(1) FROM dbo.ReportCri WHERE ReportId = @ReportId
	IF @LstCnt > 0 AND @CriCnt > 0 AND @LstCnt <> @CriCnt
	BEGIN RAISERROR('Please truncate table ReportLstCri and try again.',18,2) WITH SETERROR RETURN 1 END
	SELECT a.LastCriteria FROM dbo.ReportLstCri a
		LEFT OUTER JOIN dbo.ReportCri b ON a.ReportCriId = b.ReportCriId
		WHERE a.UsrId = @UsrId AND a.ReportId = @ReportId ORDER BY b.TabIndex
END
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLastPageInfo') AND type='P')
DROP PROCEDURE dbo.GetLastPageInfo
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetLastPageInfo]
 @ScreenId	Int
,@UsrId		Int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF NOT EXISTS (SELECT 1 FROM dbo.ScreenLstInf WHERE UsrId = @UsrId AND ScreenId = @ScreenId AND LastPageInfo is not null)
BEGIN
	DELETE FROM dbo.ScreenLstInf WHERE UsrId = @UsrId AND ScreenId = @ScreenId
	INSERT INTO dbo.ScreenLstInf (UsrId, ScreenId, LastPageInfo)
		SELECT @UsrId, @ScreenId, isnull(convert(varchar,GridRows),10)
		FROM dbo.Screen WHERE ScreenId = @ScreenId
END
SELECT LastPageInfo FROM dbo.ScreenLstInf WHERE UsrId = @UsrId AND ScreenId = @ScreenId
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmAppInfo82') AND type='P')
DROP PROCEDURE dbo.GetLisAdmAppInfo82
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmAppInfo82
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@VersionDt53	DateTime
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.AppInfo b135 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' AppInfoId135=b135.AppInfoId, AppInfoId135Text=b135.AppInfoDesc, AppInfoId135Dtl=b135.Readme, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b135.AppInfoDesc DESC'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b135.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b135.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b135.AppInfoId = ' + @key + ')'
ELSE
BEGIN
	IF @VersionDt53 is not null SELECT @wClause = @wClause + ' AND (DATEADD(hour, DATEDIFF(hour, 0, b135.VersionDt), 0) >= ''' + convert(varchar,@VersionDt53,120) + ''')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b135.AppInfoDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'' OR b135.Readme LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmAppItem83') AND type='P')
DROP PROCEDURE dbo.GetLisAdmAppItem83
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmAppItem83
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@AppItemCode44	NVarChar(max)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.AppItem b136 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' AppItemId136=b136.AppItemId, AppItemId136Text=b136.AppItemDesc, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b136.AppItemDesc DESC'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b136.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b136.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b136.AppItemId = ' + @key + ')'
ELSE
BEGIN
	IF @AppItemCode44 is not null SELECT @wClause = @wClause + ' AND (b136.AppItemCode like N''%' + replace(@AppItemCode44,'''','''''') + '%'')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b136.AppItemDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmAuthCol16') AND type='P')
DROP PROCEDURE dbo.GetLisAdmAuthCol16
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmAuthCol16
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.ScreenObj b14 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenObjId14=b14.ScreenObjId, ScreenObjId14Text=b14.ColumnDesc, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b14.ColumnDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b14.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b14.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b14.ScreenObjId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b14.ColumnDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmButtonHlp76') AND type='P')
DROP PROCEDURE dbo.GetLisAdmButtonHlp76
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmButtonHlp76
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@CultureId19	SmallInt
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause='FROM dbo.ButtonHlp b116' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CultureId,CultureTypeDesc FROM RODesign.dbo.VwCulture)x1022 ON b116.CultureId = x1022.CultureId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ButtonTypeId,ButtonTypeDesc FROM RODesign.dbo.CtButtonType)x1023 ON b116.ButtonTypeId = x1023.ButtonTypeId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenId,ScreenDesc FROM dbo.Screen)x1021 ON b116.ScreenId = x1021.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportId,ReportDesc FROM dbo.Report)x1041 ON b116.ReportId = x1041.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT WizardId,WizardTitle FROM dbo.Wizard)x1042 ON b116.WizardId = x1042.WizardId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ButtonStyleCd,ButtonStyleDesc FROM RODesign.dbo.CtButtonStyle)x7473 ON b116.TopVisible = x7473.ButtonStyleCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ButtonStyleCd,ButtonStyleDesc FROM RODesign.dbo.CtButtonStyle)x7475 ON b116.RowVisible = x7475.ButtonStyleCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ButtonStyleCd,ButtonStyleDesc FROM RODesign.dbo.CtButtonStyle)x7474 ON b116.BotVisible = x7474.ButtonStyleCd'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ButtonHlpId116=b116.ButtonHlpId'
+ ', CultureId116=x1022.CultureId'
+ ', CultureId116Text=x1022.CultureTypeDesc'
+ ', ButtonTypeId116=x1023.ButtonTypeId'
+ ', ButtonTypeId116Text=x1023.ButtonTypeDesc'
+ ', ButtonName116=b116.ButtonName'
+ ', ButtonLongNm116=b116.ButtonLongNm'
+ ', ScreenId116=x1021.ScreenId'
+ ', ScreenId116Text=x1021.ScreenDesc'
+ ', ReportId116=x1041.ReportId'
+ ', ReportId116Text=x1041.ReportDesc'
+ ', WizardId116=x1042.WizardId'
+ ', WizardId116Text=x1042.WizardTitle'
+ ', ButtonToolTip116=b116.ButtonToolTip'
+ ', ButtonVisible116=b116.ButtonVisible'
+ ', TopVisible116=x7473.ButtonStyleCd'
+ ', TopVisible116Text=x7473.ButtonStyleDesc'
+ ', RowVisible116=x7475.ButtonStyleCd'
+ ', RowVisible116Text=x7475.ButtonStyleDesc'
+ ', BotVisible116=x7474.ButtonStyleCd'
+ ', BotVisible116Text=x7474.ButtonStyleDesc, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY x1021.ScreenDesc, x1041.ReportDesc, x1042.WizardTitle'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b116.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b116.')
			END
		END
	END
END
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b116.','Y','N',null,'N','ButtonHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b116.','Y','N',null,'N','ButtonHlpId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b116.','Y','N',null,'N','ButtonHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b116.ButtonHlpId = ' + @key + ')'
ELSE
BEGIN
	IF @CultureId19 is not null SELECT @wClause = @wClause + ' AND (b116.CultureId = ' + convert(varchar,@CultureId19) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmClientRule79') AND type='P')
DROP PROCEDURE dbo.GetLisAdmClientRule79
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmClientRule79
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId9	Int
,@ReportId11	Int
,@CultureId10	SmallInt
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause='FROM dbo.ClientRule b127 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ClientRuleId127=b127.ClientRuleId, ClientRuleId127Text=b127.RuleDesc, ClientRuleId127Dtl=b127.RuleDescription, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b127.RuleDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b127.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b127.')
			END
		END
	END
END
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b127.','Y','N',null,'N','ClientRuleId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b127.ClientRuleId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId9 is not null SELECT @wClause = @wClause + ' AND (b127.ScreenId = ' + convert(varchar,@ScreenId9) + ')'
	IF @ReportId11 is not null SELECT @wClause = @wClause + ' AND (b127.ReportId = ' + convert(varchar,@ReportId11) + ')'
	IF @CultureId10 is not null SELECT @wClause = @wClause + ' AND (b127.CultureId = ' + convert(varchar,@CultureId10) + ')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b127.RuleDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'' OR b127.RuleDescription LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmColDrg1007') AND type='P')
DROP PROCEDURE dbo.GetLisAdmColDrg1007
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmColDrg1007
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId1074	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.ScreenObj b14' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenId,ProgramName FROM dbo.Screen)x934 ON b14.ScreenId = x934.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT GroupRowId,GroupRowName FROM RODesign.dbo.GroupRow)x5279 ON b14.GroupRowId = x5279.GroupRowId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT GroupColId,GroupColName FROM RODesign.dbo.GroupCol)x1016 ON b14.GroupColId = x1016.GroupColId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenTabId,TabFolderName FROM dbo.ScreenTab)x119 ON b14.TabFolderId = x119.ScreenTabId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenObjId14=b14.ScreenObjId'
+ ', ScreenId14=x934.ScreenId'
+ ', ScreenId14Text=x934.ProgramName'
+ ', GroupRowId14=x5279.GroupRowId'
+ ', GroupRowId14Text=x5279.GroupRowName'
+ ', GroupColId14=x1016.GroupColId'
+ ', GroupColId14Text=x1016.GroupColName'
+ ', ColumnName14=b14.ColumnName'
+ ', TabFolderId14=x119.ScreenTabId'
+ ', TabFolderId14Text=x119.TabFolderName'
+ ', TabIndex14=b14.TabIndex'
+ ', MasterTable14=b14.MasterTable, MatchCount=COUNT(1) OVER ()'
SELECT @oClause=''
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b14.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b14.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b14.ScreenObjId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId1074 is not null SELECT @wClause = @wClause + ' AND (b14.ScreenId = ' + convert(varchar,@ScreenId1074) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmColHlp1006') AND type='P')
DROP PROCEDURE dbo.GetLisAdmColHlp1006
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmColHlp1006
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.ScreenObj b14 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenObjId14=b14.ScreenObjId, ScreenObjId14Text=b14.ColumnDesc, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b14.ColumnDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b14.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b14.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b14.ScreenObjId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b14.ColumnDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmCronJob118') AND type='P')
DROP PROCEDURE dbo.GetLisAdmCronJob118
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmCronJob118
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.CronJob b264 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' CronJobId264=b264.CronJobId, CronJobId264Text=b264.CronJobName, CronJobId264Dtl=b264.LastStatus, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b264.CronJobName'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b264.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b264.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b264.CronJobId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b264.CronJobName LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'' OR b264.LastStatus LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmDataCat96') AND type='P')
DROP PROCEDURE dbo.GetLisAdmDataCat96
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmDataCat96
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.RptwizCat b181 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptwizCatId181=b181.RptwizCatId, RptwizCatId181Text=b181.RptwizCatDesc, RptwizCatId181Dtl=b181.CatDescription, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b181.RptwizCatDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b181.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b181.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b181.RptwizCatId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b181.RptwizCatDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'' OR b181.CatDescription LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmDbKey15') AND type='P')
DROP PROCEDURE dbo.GetLisAdmDbKey15
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmDbKey15
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.DbKey b20 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' KeyId20=b20.KeyId, KeyId20Text=b20.KeyName, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b20.KeyName'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b20.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b20.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b20.KeyId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b20.KeyName LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmDbTable2') AND type='P')
DROP PROCEDURE dbo.GetLisAdmDbTable2
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmDbTable2
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@TableName25	VarChar(500)
,@TableDesc42	NVarChar(100)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.DbTable b3 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' TableId3=b3.TableId, TableId3Text=b3.TableDesc, TableId3Dtl=b3.TblObjective, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b3.TableDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b3.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b3.')
			END
		END
	END
END
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','b3.','N','N',null,'Y','TableId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b3.TableId = ' + @key + ')'
ELSE
BEGIN
	IF @TableName25 is not null SELECT @wClause = @wClause + ' AND (b3.TableName like N''%' + replace(@TableName25,'''','''''') + '%'')'
	IF @TableDesc42 is not null SELECT @wClause = @wClause + ' AND (b3.TableDesc like N''%' + replace(@TableDesc42,'''','''''') + '%'')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b3.TableDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'' OR b3.TblObjective LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmLabel112') AND type='P')
DROP PROCEDURE dbo.GetLisAdmLabel112
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmLabel112
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@CultureId48	SmallInt
,@LabelCat49	VarChar(50)
,@LabelKey51	VarChar(50)
,@LabelText50	NVarChar(max)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
	,@CompanyId		Int
SELECT @fClause='FROM dbo.Label b215 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' LabelId215=b215.LabelId, LabelId215Text=b215.LabelDesc, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b215.LabelDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b215.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b215.')
			END
		END
	END
END
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b215.','Y','N',null,'N','LabelId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b215.','Y','N',null,'N','LabelId',@wClause OUTPUT,@Usrs
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyId','Company','b215.','Y','N',null,'Y','LabelId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyId','Company','b215.','N',null,'LabelId',@wClause OUTPUT
IF @key is not null SELECT @wClause = @wClause + ' AND (b215.LabelId = ' + @key + ')'
ELSE
BEGIN
	IF @CultureId48 is not null SELECT @wClause = @wClause + ' AND (b215.CultureId = ' + convert(varchar,@CultureId48) + ')'
	IF @LabelCat49 is not null SELECT @wClause = @wClause + ' AND (b215.LabelCat like N''%' + replace(@LabelCat49,'''','''''') + '%'')'
	IF @LabelKey51 is not null SELECT @wClause = @wClause + ' AND (b215.LabelKey like N''%' + replace(@LabelKey51,'''','''''') + '%'')'
	IF @LabelText50 is not null SELECT @wClause = @wClause + ' AND (b215.LabelText like N''%' + replace(@LabelText50,'''','''''') + '%'')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b215.LabelDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmLabelVw119') AND type='P')
DROP PROCEDURE dbo.GetLisAdmLabelVw119
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmLabelVw119
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@CultureId56	SmallInt
,@LabelCat59	VarChar(50)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause='FROM dbo.VwLabel b265'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' LabelId265=b265.LabelId'
+ ', LabelLink265=b265.LabelLink'
+ ', LabelLink265URL=b265.LabelLink'
+ ', CultureId265=b265.CultureId'
+ ', LabelCat265=b265.LabelCat'
+ ', LabelKey265=b265.LabelKey'
+ ', LabelText265=b265.LabelText'
+ ', SortOrder265=b265.SortOrder, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b265.SortOrder'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b265.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b265.')
			END
		END
	END
END
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b265.','Y','N',null,'N','LabelId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b265.LabelId = ' + @key + ')'
ELSE
BEGIN
	IF @CultureId56 is not null SELECT @wClause = @wClause + ' AND (b265.CultureId = ' + convert(varchar,@CultureId56) + ')'
	IF @LabelCat59 is not null SELECT @wClause = @wClause + ' AND (b265.LabelCat = N''' + @LabelCat59 + ''')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmMenu35') AND type='P')
DROP PROCEDURE dbo.GetLisAdmMenu35
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmMenu35
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.Menu b39 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' MenuId39=b39.MenuId, MenuId39Text=b39.MenuId, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b39.MenuId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b39.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b39.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b39.MenuId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b39.MenuId LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmMenuDrg121') AND type='P')
DROP PROCEDURE dbo.GetLisAdmMenuDrg121
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmMenuDrg121
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.Menu b39 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' MenuId39=b39.MenuId, MenuId39Text=b39.MenuId, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b39.MenuId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b39.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b39.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b39.MenuId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b39.MenuId LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmMenuHlp36') AND type='P')
DROP PROCEDURE dbo.GetLisAdmMenuHlp36
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmMenuHlp36
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.Menu b39 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' MenuId39=b39.MenuId, MenuId39Text=b39.MenuId, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b39.MenuId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b39.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b39.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b39.MenuId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b39.MenuId LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmMenuPerm58') AND type='P')
DROP PROCEDURE dbo.GetLisAdmMenuPerm58
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmMenuPerm58
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.Menu b39 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' MenuId39=b39.MenuId, MenuId39Text=b39.MenuId, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b39.MenuId'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b39.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b39.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b39.MenuId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b39.MenuId LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmMsgCenter86') AND type='P')
DROP PROCEDURE dbo.GetLisAdmMsgCenter86
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmMsgCenter86
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@MsgId28	Int
,@MsgSource27	VarChar(50)
,@MsgName70	NVarChar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.Msg b146 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' MsgId146=b146.MsgId, MsgId146Text=b146.MsgName, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b146.MsgName'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b146.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b146.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b146.MsgId = ' + @key + ')'
ELSE
BEGIN
	IF @MsgId28 is not null SELECT @wClause = @wClause + ' AND (b146.MsgId = ' + convert(varchar,@MsgId28) + ')'
	IF @MsgSource27 is not null SELECT @wClause = @wClause + ' AND (b146.MsgSource like N''%' + replace(@MsgSource27,'''','''''') + '%'')'
	IF @MsgName70 is not null SELECT @wClause = @wClause + ' AND (b146.MsgName like N''%' + replace(@MsgName70,'''','''''') + '%'')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b146.MsgName LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmOvride78') AND type='P')
DROP PROCEDURE dbo.GetLisAdmOvride78
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetLisAdmOvride78]
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM RODesign.dbo.Ovride b122 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' OvrideId122=b122.OvrideId, OvrideId122Text=b122.OvrideName'
SELECT @oClause='ORDER BY b122.OvrideName'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b122.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b122.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b122.OvrideId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b122.OvrideName LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmReport67') AND type='P')
DROP PROCEDURE dbo.GetLisAdmReport67
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmReport67
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CompanyId		VarChar
SELECT @fClause='FROM dbo.Report b22 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportId22=b22.ReportId, ReportId22Text=b22.ReportDesc, ReportId22Dtl=b22.ProgramName, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b22.ReportDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b22.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b22.')
			END
		END
	END
END
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Companys,'CompanyLs','Company','b22.','Y','Y',null,'Y','ReportId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','b22.','N','N',null,'Y','ReportId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','b22.','Y',null,'ReportId',@wClause OUTPUT
IF @key is not null SELECT @wClause = @wClause + ' AND (b22.ReportId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b22.ReportDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'' OR b22.ProgramName LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmReportCri69') AND type='P')
DROP PROCEDURE dbo.GetLisAdmReportCri69
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmReportCri69
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ReportId4	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.ReportCri b97 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportCriId97=b97.ReportCriId, ReportCriId97Text=b97.ReportCriDesc, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b97.ReportCriDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b97.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b97.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b97.ReportCriId = ' + @key + ')'
ELSE
BEGIN
	IF @ReportId4 is not null SELECT @wClause = @wClause + ' AND (b97.ReportId = ' + convert(varchar,@ReportId4) + ')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b97.ReportCriDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmReportGrp65') AND type='P')
DROP PROCEDURE dbo.GetLisAdmReportGrp65
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmReportGrp65
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ReportId2	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.ReportGrp b94' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportId,ReportDesc FROM dbo.Report)x882 ON b94.ReportId = x882.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportGrpId,ReportGrpName FROM dbo.ReportGrp)x885 ON b94.ParentGrpId = x885.ReportGrpId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportGrpId94=b94.ReportGrpId'
+ ', ReportId94=x882.ReportId'
+ ', ReportId94Text=x882.ReportDesc'
+ ', ReportGrpIndex94=b94.ReportGrpIndex'
+ ', ParentGrpId94=x885.ReportGrpId'
+ ', ParentGrpId94Text=x885.ReportGrpName'
+ ', ReportGrpName94=b94.ReportGrpName'
+ ', ContentVertical94=b94.ContentVertical'
+ ', LabelVertical94=b94.LabelVertical'
+ ', BorderWidth94=b94.BorderWidth'
+ ', GrpStyle94=b94.GrpStyle, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY x882.ReportDesc, b94.ReportGrpIndex'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b94.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b94.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b94.ReportGrpId = ' + @key + ')'
ELSE
BEGIN
	IF @ReportId2 is not null SELECT @wClause = @wClause + ' AND (b94.ReportId = ' + convert(varchar,@ReportId2) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmReportObj13') AND type='P')
DROP PROCEDURE dbo.GetLisAdmReportObj13
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmReportObj13
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ReportId13	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.ReportObj b23 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ReportObjId23=b23.ReportObjId, ReportObjId23Text=b23.ColumnDesc, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b23.ColumnDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b23.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b23.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b23.ReportObjId = ' + @key + ')'
ELSE
BEGIN
	IF @ReportId13 is not null SELECT @wClause = @wClause + ' AND (b23.ReportId = ' + convert(varchar,@ReportId13) + ')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b23.ColumnDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmRowOvrd17') AND type='P')
DROP PROCEDURE dbo.GetLisAdmRowOvrd17
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmRowOvrd17
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId38	Int
,@ReportId39	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.RowOvrd b238 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RowOvrdId238=b238.RowOvrdId, RowOvrdId238Text=b238.RowOvrdDesc, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b238.RowOvrdDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b238.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b238.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b238.RowOvrdId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId38 is not null SELECT @wClause = @wClause + ' AND (b238.ScreenId = ' + convert(varchar,@ScreenId38) + ')'
	IF @ReportId39 is not null SELECT @wClause = @wClause + ' AND (b238.ReportId = ' + convert(varchar,@ReportId39) + ')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b238.RowOvrdDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmRptCha100') AND type='P')
DROP PROCEDURE dbo.GetLisAdmRptCha100
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmRptCha100
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.RptCha b206 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptChaId206=b206.RptChaId, RptChaId206Text=b206.RptChaDesc, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b206.RptChaDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b206.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b206.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b206.RptChaId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b206.RptChaDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmRptCtr90') AND type='P')
DROP PROCEDURE dbo.GetLisAdmRptCtr90
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmRptCtr90
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ReportId29	Int
,@CtrValue67	NVarChar(1000)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.RptCtr b161 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptCtrId161=b161.RptCtrId, RptCtrId161Text=b161.RptCtrDesc, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b161.RptCtrDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b161.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b161.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b161.RptCtrId = ' + @key + ')'
ELSE
BEGIN
	IF @ReportId29 is not null SELECT @wClause = @wClause + ' AND (b161.ReportId = ' + convert(varchar,@ReportId29) + ')'
	IF @CtrValue67 is not null SELECT @wClause = @wClause + ' AND (b161.CtrValue like N''%' + replace(@CtrValue67,'''','''''') + '%'')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b161.RptCtrDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmRptElm91') AND type='P')
DROP PROCEDURE dbo.GetLisAdmRptElm91
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmRptElm91
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ReportId30	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.RptElm b160' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ReportId,ReportDesc FROM dbo.Report)x1420 ON b160.ReportId = x1420.ReportId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptElmTypeCd,RptElmTypeName FROM RODesign.dbo.CtRptElmType)x1421 ON b160.RptElmTypeCd = x1421.RptElmTypeCd' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT RptStyleId,RptStyleDesc FROM dbo.RptStyle)x1422 ON b160.RptStyleId = x1422.RptStyleId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptElmId160=b160.RptElmId'
+ ', ReportId160=x1420.ReportId'
+ ', ReportId160Text=x1420.ReportDesc'
+ ', RptElmTypeCd160=x1421.RptElmTypeCd'
+ ', RptElmTypeCd160Text=x1421.RptElmTypeName'
+ ', RptStyleId160=x1422.RptStyleId'
+ ', RptStyleId160Text=x1422.RptStyleDesc'
+ ', ElmHeight160=b160.ElmHeight'
+ ', ElmColumns160=b160.ElmColumns'
+ ', ElmColSpacing160=b160.ElmColSpacing'
+ ', ElmPrintFirst160=b160.ElmPrintFirst'
+ ', ElmPrintLast160=b160.ElmPrintLast, MatchCount=COUNT(1) OVER ()'
SELECT @oClause=''
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b160.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b160.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b160.RptElmId = ' + @key + ')'
ELSE
BEGIN
	IF @ReportId30 is not null SELECT @wClause = @wClause + ' AND (b160.ReportId = ' + convert(varchar,@ReportId30) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmRptStyle89') AND type='P')
DROP PROCEDURE dbo.GetLisAdmRptStyle89
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmRptStyle89
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@DefaultCd32	Char(2)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.RptStyle b167 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptStyleId167=b167.RptStyleId, RptStyleId167Text=b167.RptStyleDesc, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b167.RptStyleDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b167.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b167.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b167.RptStyleId = ' + @key + ')'
ELSE
BEGIN
	IF @DefaultCd32 is not null SELECT @wClause = @wClause + ' AND (b167.DefaultCd = N''' + @DefaultCd32 + ''')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b167.RptStyleDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmRptTbl92') AND type='P')
DROP PROCEDURE dbo.GetLisAdmRptTbl92
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmRptTbl92
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ReportId34	Int
,@RptCtrId31	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.RptTbl b162 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptTblId162=b162.RptTblId, RptTblId162Text=b162.RptTblDesc, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b162.RptTblDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b162.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b162.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b162.RptTblId = ' + @key + ')'
ELSE
BEGIN
	IF @ReportId34 is not null SELECT @wClause = @wClause + ' AND (b162.ReportId = ' + convert(varchar,@ReportId34) + ')'
	IF @RptCtrId31 is not null SELECT @wClause = @wClause + ' AND (b162.RptCtrId = ' + convert(varchar,@RptCtrId31) + ')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b162.RptTblDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmRptWiz95') AND type='P')
DROP PROCEDURE dbo.GetLisAdmRptWiz95
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetLisAdmRptWiz95]
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Key			nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.Rptwiz b183 (NOLOCK) INNER JOIN dbo.UtReport b22 ON b183.ReportId = b22.ReportId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptwizId183=b183.RptwizId, RptwizId183Text=b183.RptwizName'
SELECT @oClause='ORDER BY b183.RptwizName'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b183.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b183.')
			END
		END
	END
END
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'UsrId','Usr','b183.','N','N',null,'N','RptwizId',@tClause OUTPUT
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b183.RptwizId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(@FilterTxt, '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b183.RptwizName LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmRptwizTyp97') AND type='P')
DROP PROCEDURE dbo.GetLisAdmRptwizTyp97
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmRptwizTyp97
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.RptwizTyp b185'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' RptwizTypId185=b185.RptwizTypId'
+ ', RptwizTypName185=b185.RptwizTypName, MatchCount=COUNT(1) OVER ()'
SELECT @oClause=''
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b185.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b185.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b185.RptwizTypId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmScrAudit1019') AND type='P')
DROP PROCEDURE dbo.GetLisAdmScrAudit1019
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmScrAudit1019
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId1075	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.ScrAudit b1300' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT CudAction,CudActionDesc FROM RODesign.dbo.CtCudAction)x7420 ON b1300.CudAction = x7420.CudAction' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT ScreenId,ScreenDesc FROM dbo.Screen)x7425 ON b1300.ScreenId = x7425.ScreenId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT TableId,TableDesc FROM dbo.DbTable)x7426 ON b1300.TableId = x7426.TableId' 
SELECT @fClause = @fClause + ' LEFT OUTER JOIN (SELECT DISTINCT UsrId,UsrName FROM RODesign.dbo.VwUsr)x7418 ON b1300.ChangedBy = x7418.UsrId'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScrAuditId1300=b1300.ScrAuditId'
+ ', CudAction1300=x7420.CudAction'
+ ', CudAction1300Text=x7420.CudActionDesc'
+ ', ScreenId1300=x7425.ScreenId'
+ ', ScreenId1300Text=x7425.ScreenDesc'
+ ', MasterTable1300=b1300.MasterTable'
+ ', TableId1300=x7426.TableId'
+ ', TableId1300Text=x7426.TableDesc'
+ ', RowId1300=b1300.RowId'
+ ', RowDesc1300=b1300.RowDesc'
+ ', ChangedBy1300=x7418.UsrId'
+ ', ChangedBy1300Text=x7418.UsrName'
+ ', ChangedOn1300=b1300.ChangedOn, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY x7425.ScreenDesc, b1300.ChangedOn'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b1300.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b1300.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b1300.ScrAuditId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId1075 is not null SELECT @wClause = @wClause + ' AND (b1300.ScreenId = ' + convert(varchar,@ScreenId1075) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmScrAuditDtl1020') AND type='P')
DROP PROCEDURE dbo.GetLisAdmScrAuditDtl1020
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmScrAuditDtl1020
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScrAuditId1076	BigInt
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.ScrAuditDtl b1301'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScrAuditDtlId1301=b1301.ScrAuditDtlId'
+ ', ScrAuditId1301=b1301.ScrAuditId'
+ ', ScreenObjId1301=b1301.ScreenObjId'
+ ', ScreenObjDesc1301=b1301.ScreenObjDesc'
+ ', ColumnId1301=b1301.ColumnId'
+ ', ColumnDesc1301=b1301.ColumnDesc'
+ ', ChangedFr1301=b1301.ChangedFr'
+ ', ChangedTo1301=b1301.ChangedTo, MatchCount=COUNT(1) OVER ()'
SELECT @oClause=''
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b1301.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b1301.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b1301.ScrAuditDtlId = ' + @key + ')'
ELSE
BEGIN
	IF @ScrAuditId1076 is not null SELECT @wClause = @wClause + ' AND (b1301.ScrAuditId = ' + convert(varchar,@ScrAuditId1076) + ')'
END
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmScreen9') AND type='P')
DROP PROCEDURE dbo.GetLisAdmScreen9
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmScreen9
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId60	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.Screen b15 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenId15=b15.ScreenId, ScreenId15Text=b15.ScreenDesc, ScreenId15Dtl=b15.ProgramName, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b15.ScreenDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b15.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b15.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b15.ScreenId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId60 is not null SELECT @wClause = @wClause + ' AND (b15.ScreenId = ' + convert(varchar,@ScreenId60) + ')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b15.ScreenDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'' OR b15.ProgramName LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmScreenCri73') AND type='P')
DROP PROCEDURE dbo.GetLisAdmScreenCri73
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmScreenCri73
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId3	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.ScreenCri b104 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenCriId104=b104.ScreenCriId, ScreenCriId104Text=b104.ScreenCriDesc, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b104.ScreenCriDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b104.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b104.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b104.ScreenCriId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId3 is not null SELECT @wClause = @wClause + ' AND (b104.ScreenId = ' + convert(varchar,@ScreenId3) + ')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b104.ScreenCriDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmScreenFilter59') AND type='P')
DROP PROCEDURE dbo.GetLisAdmScreenFilter59
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmScreenFilter59
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId1072	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.ScreenFilter b86 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenFilterId86=b86.ScreenFilterId, ScreenFilterId86Text=b86.ScreenFilterDesc, ScreenFilterId86Dtl=b86.FilterClause, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b86.ScreenFilterDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b86.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b86.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b86.ScreenFilterId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId1072 is not null SELECT @wClause = @wClause + ' AND (b86.ScreenId = ' + convert(varchar,@ScreenId1072) + ')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b86.ScreenFilterDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'' OR b86.FilterClause LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmScreenObj10') AND type='P')
DROP PROCEDURE dbo.GetLisAdmScreenObj10
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmScreenObj10
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.ScreenObj b14 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenObjId14=b14.ScreenObjId, ScreenObjId14Text=b14.ColumnDesc, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b14.ColumnDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b14.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b14.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b14.ScreenObjId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b14.ColumnDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmScreenTab54') AND type='P')
DROP PROCEDURE dbo.GetLisAdmScreenTab54
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmScreenTab54
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.ScreenTab b19 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ScreenTabId19=b19.ScreenTabId, ScreenTabId19Text=b19.ScreenTabDesc, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b19.ScreenTabDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b19.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b19.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b19.ScreenTabId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b19.ScreenTabDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmServerRule14') AND type='P')
DROP PROCEDURE dbo.GetLisAdmServerRule14
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmServerRule14
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId16	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.ServerRule b24 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' ServerRuleId24=b24.ServerRuleId, ServerRuleId24Text=b24.RuleDesc, ServerRuleId24Dtl=b24.RuleDescription, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b24.RuleDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b24.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b24.')
			END
		END
	END
END
SELECT @tClause = ''
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Usrs,'ModifiedBy','Usr','b24.','N','N',null,'Y','ServerRuleId',@tClause OUTPUT,@Usrs
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b24.ServerRuleId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId16 is not null SELECT @wClause = @wClause + ' AND (b24.ScreenId = ' + convert(varchar,@ScreenId16) + ')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b24.RuleDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'' OR b24.RuleDescription LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmStaticCs115') AND type='P')
DROP PROCEDURE dbo.GetLisAdmStaticCs115
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmStaticCs115
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.StaticCs b260 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' StaticCsId260=b260.StaticCsId, StaticCsId260Text=b260.StaticCsNm, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b260.StaticCsNm'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b260.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b260.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b260.StaticCsId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b260.StaticCsNm LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmStaticFi117') AND type='P')
DROP PROCEDURE dbo.GetLisAdmStaticFi117
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmStaticFi117
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.StaticFi b262'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' StaticFiId262=b262.StaticFiId'
+ ', StaticFiUrl262=b262.StaticFiUrl, MatchCount=COUNT(1) OVER ()'
SELECT @oClause=''
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b262.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b262.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b262.StaticFiId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmStaticJs116') AND type='P')
DROP PROCEDURE dbo.GetLisAdmStaticJs116
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmStaticJs116
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.StaticJs b261 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' StaticJsId261=b261.StaticJsId, StaticJsId261Text=b261.StaticJsNm, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b261.StaticJsNm'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b261.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b261.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b261.StaticJsId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b261.StaticJsNm LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmStaticPg114') AND type='P')
DROP PROCEDURE dbo.GetLisAdmStaticPg114
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmStaticPg114
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@StaticPgId1070	Int
,@StaticMeta55	NVarChar(1000)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.StaticPg b259 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' StaticPgId259=b259.StaticPgId, StaticPgId259Text=b259.StaticPgDesc, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b259.StaticPgDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b259.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b259.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b259.StaticPgId = ' + @key + ')'
ELSE
BEGIN
	IF @StaticPgId1070 is not null SELECT @wClause = @wClause + ' AND (b259.StaticPgId = ' + convert(varchar,@StaticPgId1070) + ')'
	IF @StaticMeta55 is not null SELECT @wClause = @wClause + ' AND (b259.StaticMeta like N''%' + replace(@StaticMeta55,'''','''''') + '%'')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b259.StaticPgDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmTbdRule113') AND type='P')
DROP PROCEDURE dbo.GetLisAdmTbdRule113
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmTbdRule113
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId52	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.TbdRule b254 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' TbdRuleId254=b254.TbdRuleId, TbdRuleId254Text=b254.TbdRuleName, TbdRuleId254Dtl=b254.TbdRuleDesc, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b254.TbdRuleName'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b254.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b254.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b254.TbdRuleId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId52 is not null SELECT @wClause = @wClause + ' AND (b254.ScreenId = ' + convert(varchar,@ScreenId52) + ')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b254.TbdRuleName LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'' OR b254.TbdRuleDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmTemplate53') AND type='P')
DROP PROCEDURE dbo.GetLisAdmTemplate53
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmTemplate53
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.Template b79'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' TemplateId79=b79.TemplateId'
+ ', TemplateName79=b79.TemplateName'
+ ', TmplPrefix79=b79.TmplPrefix'
+ ', TmplDefault79=b79.TmplDefault, MatchCount=COUNT(1) OVER ()'
SELECT @oClause=''
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b79.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b79.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b79.TemplateId = ' + @key + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmWebRule80') AND type='P')
DROP PROCEDURE dbo.GetLisAdmWebRule80
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmWebRule80
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@ScreenId15	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.WebRule b128 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' WebRuleId128=b128.WebRuleId, WebRuleId128Text=b128.RuleDesc, WebRuleId128Dtl=b128.RuleDescription, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b128.RuleDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b128.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b128.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b128.WebRuleId = ' + @key + ')'
ELSE
BEGIN
	IF @ScreenId15 is not null SELECT @wClause = @wClause + ' AND (b128.ScreenId = ' + convert(varchar,@ScreenId15) + ')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b128.RuleDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'' OR b128.RuleDescription LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmWizardObj49') AND type='P')
DROP PROCEDURE dbo.GetLisAdmWizardObj49
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmWizardObj49
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.Wizard b71 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' WizardId71=b71.WizardId, WizardId71Text=b71.WizardTitle, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b71.WizardTitle'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b71.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b71.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b71.WizardId = ' + @key + ')'

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b71.WizardTitle LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetLisAdmWizardRule50') AND type='P')
DROP PROCEDURE dbo.GetLisAdmWizardRule50
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE GetLisAdmWizardRule50
 @useGlobalFilter	char(1)
,@screenId		int
,@Usrs			varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@Key		nvarchar(500)
,@FilterTxt		nvarchar(500)
,@WizardId17	Int
,@screenFilterId	int
,@currCompanyId	int
,@currProjectId	int
,@topN	smallint = null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@bUsr		char(1)
	,@UsrId			int
	,@tClause		nvarchar(max)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelLender		char(1)
	,@SelBorrower		char(1)
	,@SelGuarantor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause='FROM dbo.WizardRule b73 (NOLOCK)'
SELECT @sClause='SELECT DISTINCT ' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '' ELSE ' TOP ' + CONVERT(varchar(10),@topN) END + ' WizardRuleId73=b73.WizardRuleId, WizardRuleId73Text=b73.RuleDesc, WizardRuleId73Dtl=b73.RuleDescription, MatchCount=COUNT(1) OVER ()'
SELECT @oClause='ORDER BY b73.RuleDesc'
SELECT @wClause='WHERE 1=1', @bUsr='Y'
SELECT @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT
	IF @bUsr='Y'
	BEGIN
		SELECT @bUsr='N'
		SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst='Y'
		IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
		IF @useGlobalFilter='Y'
		BEGIN
			SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId
			IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b73.')
			ELSE
			BEGIN
				SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault='Y'
				IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + ' ' + replace(@filterClause,'~~.','b73.')
			END
		END
	END
END
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
IF @key is not null SELECT @wClause = @wClause + ' AND (b73.WizardRuleId = ' + @key + ')'
ELSE
BEGIN
	IF @WizardId17 is not null SELECT @wClause = @wClause + ' AND (b73.WizardId = ' + convert(varchar,@WizardId17) + ')'
END

SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,'[','[[]'),'%','[%]'),'_','[_]'), '''','''''') 
IF @FilterTxt is not null AND @FilterTxt <> '' SELECT @wClause = @wClause + ' AND (b73.RuleDesc LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'' OR b73.RuleDescription LIKE N''%' + REPLACE(@FilterTxt,' ','%') + '%'') '
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetMemCri') AND type='P')
DROP PROCEDURE dbo.GetMemCri
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetMemCri]
 @GenPrefix	varchar(10)
,@ReportId	Int
,@MemCriId	Int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
-- Left outer join is needed to include ScreenCriId = 0 in the result set.
IF @GenPrefix = 'Ut'
	SELECT LastCriteria = a.MemCriteria FROM dbo.UtRptMemCriDtl a
		LEFT OUTER JOIN dbo.UtReportCri b ON a.ReportCriId = b.ReportCriId
		WHERE a.RptMemCriId = @MemCriId ORDER BY b.TabIndex
ELSE
	SELECT LastCriteria = a.MemCriteria FROM dbo.RptMemCriDtl a
		LEFT OUTER JOIN dbo.ReportCri b ON a.ReportCriId = b.ReportCriId
		WHERE a.RptMemCriId = @MemCriId ORDER BY b.TabIndex
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetMenu') AND type='P')
DROP PROCEDURE dbo.GetMenu
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[GetMenu]
 @CultureId		smallint
,@SystemId		tinyint
,@RowAuthoritys		varchar(1000)
,@Usrs			varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@Customers		varchar(1000)
,@Investors		varchar(1000)
,@Members		varchar(1000)
,@Vendors		varchar(1000)
,@Screenid		int=null
,@Reportid		int=null
,@Wizardid		int=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(8000)
		,@fClause		varchar(8000)
		,@wClause		varchar(8000)
		,@oClause		varchar(8000)
		,@tClause		varchar(8000)
		,@cClause		varchar(8000)
		,@RowAuthId		smallint
		,@DefCultureId	smallint
IF object_id('tempdb.dbo.#menu') is not null DROP TABLE dbo.#menu
CREATE TABLE #menu (tid smallint IDENTITY(1,1) not null, RootQId varchar(1000) null, ParentQId varchar(1000) null, QId varchar(1000) not null
, ParentId int null, MenuIndex smallint NOT NULL, MenuId int not null, MenuText nvarchar(50) not null, ScreenId int null, ReportId int null, WizardId int null 
, NavigateUrl varchar(1000) NOT NULL, QueryStr varchar(1000) NOT NULL, IconUrl nvarchar(500) null, Popup char(1) not null, GroupTitle char(1) null)
IF object_id('tempdb.dbo.#hlp') is not null DROP TABLE dbo.#hlp
CREATE TABLE #hlp (tid smallint IDENTITY(1,1) not null, MenuId int not null, MenuText nvarchar(50) not null)
INSERT #hlp (MenuId, MenuText) SELECT MenuId, MenuText FROM dbo.MenuHlp WHERE CultureId = @CultureId
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF @CultureId <> @DefCultureId
	INSERT #hlp (MenuId, MenuText) SELECT a.MenuId, a.MenuText FROM dbo.MenuHlp a WHERE a.CultureId = @DefCultureId
	AND NOT EXISTS (SELECT 'true' FROM dbo.MenuHlp b WHERE a.MenuId = b.MenuId AND b.CultureId = @CultureId)
SELECT @sClause = 'INSERT #menu (RootQId, ParentQId, QId, ParentId, MenuIndex, MenuId, MenuText, ScreenId, ReportId, WizardId, NavigateUrl, QueryStr, IconUrl, Popup, GroupTitle)'
+ ' SELECT null, null, '''', a.ParentId, a.MenuIndex, a.MenuId, b.MenuText, a.ScreenId, a.ReportId, a.WizardId'
+ ' , NavigateUrl = CASE WHEN c.ProgramName IS NOT NULL THEN c.ProgramName + ''.aspx?csy=' + convert(varchar,@SystemId) + ''''
+ ' WHEN d.ReportTypeCd in (''S'',''R'',''T'',''E'') THEN ''SqlReport.aspx?csy=' + convert(varchar,@SystemId) + '&msy=' + convert(varchar,@SystemId) + '&rpt='' + convert(varchar,d.ReportId)'
+ ' WHEN f.StaticPgId IS NOT NULL THEN ''ShowPage.aspx?csy=' + convert(varchar,@SystemId) + '&msy=' + convert(varchar,@SystemId) + '&pg='' + convert(varchar,f.StaticPgId)'
+ ' WHEN d.ProgramName IS NOT NULL THEN d.ProgramName + ''.aspx?csy=' + convert(varchar,@SystemId) + ''''
+ ' WHEN e.ProgramName IS NOT NULL THEN e.ProgramName + ''.aspx?csy=' + convert(varchar,@SystemId) + ''''
+ ' WHEN a.Miscellaneous IS NULL OR a.Miscellaneous = '''' THEN '''''
+ ' WHEN charindex(''javascript:'',LTRIM(a.Miscellaneous),0) <> 1 AND charindex(''?'',a.Miscellaneous) > 0 THEN substring(a.Miscellaneous,1,charindex(''?'',a.Miscellaneous) - 1)'
+ ' ELSE a.Miscellaneous END'
+ ', QueryStr = CASE WHEN a.Miscellaneous IS NULL OR a.Miscellaneous = '''' OR charindex(''javascript:'',LTRIM(a.Miscellaneous),0) = 1 THEN '''''
+ ' WHEN charindex(substring(a.Miscellaneous,1,4),''file,mail,http,java,ftp:'') <= 0 THEN'
+ '  CASE WHEN charindex(''?'',a.Miscellaneous) > 0 AND charindex(''csy='',a.Miscellaneous) <= 0 THEN substring(a.Miscellaneous,charindex(''?'',a.Miscellaneous) + 1,len(a.Miscellaneous) - charindex(''?'',a.Miscellaneous)) + ''&csy=' + convert(varchar,@SystemId) + ''''
+ '  WHEN charindex(''?'',a.Miscellaneous) > 0 AND charindex(''csy='',a.Miscellaneous) > 0 THEN substring(a.Miscellaneous,charindex(''?'',a.Miscellaneous) + 1,len(a.Miscellaneous) - charindex(''?'',a.Miscellaneous)) ' 
+ '  WHEN charindex(''csy='',a.Miscellaneous) <= 0 THEN ''csy=' + convert(varchar,@SystemId) + ''' ELSE substring(a.Miscellaneous,charindex(''?'',a.Miscellaneous) + 1,len(a.Miscellaneous) - charindex(''?'',a.Miscellaneous)) END'
+ ' ELSE CASE WHEN charindex(''?'',a.Miscellaneous) > 0 THEN substring(a.Miscellaneous,charindex(''?'',a.Miscellaneous) + 1,len(a.Miscellaneous) - charindex(''?'',a.Miscellaneous)) ELSE '''' END END'
+ ', IconUrl = a.IconUrl, Popup = a.Popup'
+ ', GroupTitle = case when a.ScreenId is null and a.ReportId is null and a.WizardId is null and a.miscellaneous is null then  ''Y'' else ''N'' end'
SELECT @fClause = 'FROM dbo.Menu a INNER JOIN #hlp b ON a.MenuId = b.MenuId'
+ ' LEFT OUTER JOIN dbo.Screen c ON a.ScreenId = c.ScreenId'
+ ' LEFT OUTER JOIN dbo.Report d ON a.ReportId = d.ReportId'
+ ' LEFT OUTER JOIN dbo.Wizard e ON a.WizardId = e.WizardId'
+ ' LEFT OUTER JOIN dbo.StaticPg f ON a.StaticPgId = f.StaticPgId'
SELECT @oClause = 'ORDER BY a.ParentId, a.MenuIndex'
SELECT @tClause = ''
DECLARE @DefaultSystemAccess varchar(max)
SELECT @DefaultSystemAccess = '1=1'
/* Test NO ACCESS on target system */
IF EXISTS (SELECT 1 FROM RODesign.dbo.UsrGroupAuth a INNER JOIN RODesign.dbo.CtRowAuth b ON a.SysRowAuthorityId = b.RowAuthId WHERE charindex(','+convert(varchar,a.UsrGroupId)+',',','+replace(@UsrGroups,nchar(191),',')+',') > 0 AND a.SystemId = @SystemId AND b.AllowSel = 'N')
	--SELECT @RowAuthoritys = '', @tClause = 'OR 1<>1'
	SELECT @DefaultSystemAccess ='1<>1'
WHILE @RowAuthoritys <> '' AND datalength(@RowAuthoritys) > 0
BEGIN
	EXEC RODesign.dbo.Pop1SmallInt @RowAuthoritys OUTPUT, @RowAuthId OUTPUT
	-- Remove duplicates:
	WHILE charindex(nchar(191)+convert(varchar,@RowAuthId)+nchar(191),nchar(191)+@RowAuthoritys+nchar(191)) > 0
	BEGIN
		EXEC RODesign.dbo.Pop1SmallInt @RowAuthoritys OUTPUT, @RowAuthId OUTPUT
	END
	IF dbo.fSelRowAuth(@RowAuthId, null, null, 'AllowSel') = 'N' SELECT @DefaultSystemAccess = '1<>1'
	--EXEC RODesign.dbo.GetAllowMnuByLevel @RowAuthId, @sysAdmin OUTPUT, @AllowSel OUTPUT, @SelCompany OUTPUT, @SelProject OUTPUT, @SelAgent OUTPUT, @SelBroker OUTPUT, @SelCustomer OUTPUT, @SelInvestor OUTPUT, @SelMember OUTPUT, @SelVendor OUTPUT
	IF 1<>1 AND dbo.fSelRowAuth(@RowAuthId, null, null, 'AllowSel') = 'N' AND charindex('1<>1',@tClause) <= 0 SELECT @tClause = @tClause + ' OR 1<>1'
	ELSE --IF dbo.fSelRowAuth(@RowAuthId, null, null, 'SysAdmin') <> 'Y'
	BEGIN
		SELECT @cClause = ''
		IF @Usrs <> '' AND datalength(@Usrs) > 0
			SELECT @cClause = @cClause + ' OR EXISTS (SELECT 1 FROM dbo.MenuPrm WHERE MenuId = a.MenuId AND PermKeyId = 12 AND ((GrantDeny = ''G'' AND PermId in (' + replace(@Usrs,nchar(191),',') + ')) OR ( ' + @DefaultSystemAccess + 'AND GrantDeny = ''D'' AND PermId not in (' + replace(@Usrs,nchar(191),',') + '))))'
		IF @UsrGroups <> '' AND datalength(@UsrGroups) > 0
			SELECT @cClause = @cClause + ' OR EXISTS (SELECT 1 FROM dbo.MenuPrm WHERE MenuId = a.MenuId AND PermKeyId = 8 AND ((GrantDeny = ''G'' AND PermId in (' + replace(@UsrGroups,nchar(191),',') + ')) OR ( ' + @DefaultSystemAccess + 'AND GrantDeny = ''D'' AND PermId not in (' + replace(@UsrGroups,nchar(191),',') + '))))'
		IF dbo.fSelRowAuth(@RowAuthId, null, null, 'Agent') = 'S' AND @Agents <> '' AND datalength(@Agents) > 0 AND @Agents <> '0'
			SELECT @cClause = @cClause + ' OR EXISTS (SELECT 1 FROM dbo.MenuPrm WHERE MenuId = a.MenuId AND PermKeyId = 1 AND ((GrantDeny = ''G'' AND PermId in (' + replace(@Agents,nchar(191),',') + ')) OR ( ' + @DefaultSystemAccess + 'AND GrantDeny = ''D'' AND PermId not in (' + replace(@Agents,nchar(191),',') + '))))'
		IF dbo.fSelRowAuth(@RowAuthId, null, null, 'Broker') = 'S' AND @Brokers <> '' AND datalength(@Brokers) > 0 AND @Brokers <> '0'
			SELECT @cClause = @cClause + ' OR EXISTS (SELECT 1 FROM dbo.MenuPrm WHERE MenuId = a.MenuId AND PermKeyId = 2 AND ((GrantDeny = ''G'' AND PermId in (' + replace(@Brokers,nchar(191),',') + ')) OR ( ' + @DefaultSystemAccess + 'AND GrantDeny = ''D'' AND PermId not in (' + replace(@Brokers,nchar(191),',') + '))))'
		IF dbo.fSelRowAuth(@RowAuthId, null, null, 'Customer') = 'S' AND @Customers <> '' AND datalength(@Customers) > 0 AND @Customers <> '0'
			SELECT @cClause = @cClause + ' OR EXISTS (SELECT 1 FROM dbo.MenuPrm WHERE MenuId = a.MenuId AND PermKeyId = 4 AND ((GrantDeny = ''G'' AND PermId in (' + replace(@Customers,nchar(191),',') + ')) OR ( ' + @DefaultSystemAccess + 'AND GrantDeny = ''D'' AND PermId not in (' + replace(@Customers,nchar(191),',') + '))))'
		IF dbo.fSelRowAuth(@RowAuthId, null, null, 'Investor') = 'S' AND @Investors <> '' AND datalength(@Investors) > 0 AND @Investors <> '0'
			SELECT @cClause = @cClause + ' OR EXISTS (SELECT 1 FROM dbo.MenuPrm WHERE MenuId = a.MenuId AND PermKeyId = 6 AND ((GrantDeny = ''G'' AND PermId in (' + replace(@Investors,nchar(191),',') + ')) OR ( ' + @DefaultSystemAccess + 'AND GrantDeny = ''D'' AND PermId not in (' + replace(@Investors,nchar(191),',') + '))))'
		IF dbo.fSelRowAuth(@RowAuthId, null, null, 'Member') = 'S' AND @Members <> '' AND datalength(@Members) > 0 AND @Members <> '0'
			SELECT @cClause = @cClause + ' OR EXISTS (SELECT 1 FROM dbo.MenuPrm WHERE MenuId = a.MenuId AND PermKeyId = 7 AND ((GrantDeny = ''G'' AND PermId in (' + replace(@Members,nchar(191),',') + ')) OR ( ' + @DefaultSystemAccess + 'AND GrantDeny = ''D'' AND PermId not in (' + replace(@Members,nchar(191),',') + '))))'
		IF dbo.fSelRowAuth(@RowAuthId, null, null, 'Vendor') = 'S' AND @Vendors <> '' AND datalength(@Vendors) > 0 AND @Vendors <> '0'
			SELECT @cClause = @cClause + ' OR EXISTS (SELECT 1 FROM dbo.MenuPrm WHERE MenuId = a.MenuId AND PermKeyId = 9 AND ((GrantDeny = ''G'' AND PermId in (' + replace(@Vendors,nchar(191),',') + ')) OR ( ' + @DefaultSystemAccess + 'AND GrantDeny = ''D'' AND PermId not in (' + replace(@Vendors,nchar(191),',') + '))))'
		IF @cClause <> '' SELECT @cClause = '(' + @cClause + ')'
		IF dbo.fSelRowAuth(@RowAuthId, null, null, 'Company') = 'S' AND @Companys <> '' AND datalength(@Companys) > 0 AND @Companys <> '0'
			SELECT @cClause = @cClause + ' AND (NOT EXISTS (SELECT 1 FROM dbo.MenuPrm WHERE MenuId = a.MenuId AND PermKeyId = 10) OR EXISTS (SELECT 1 FROM dbo.MenuPrm WHERE MenuId = a.MenuId AND PermKeyId = 10 AND ((GrantDeny = ''G'' AND PermId in (' + replace(@Companys,nchar(191),',') + ')) OR ( ' + @DefaultSystemAccess + 'AND GrantDeny = ''D'' AND PermId not in (' + replace(@Companys,nchar(191),',') + ')))))'
		IF dbo.fSelRowAuth(@RowAuthId, null, null, 'Project') = 'S' AND @Projects <> '' AND datalength(@Projects) > 0 AND @Projects <> '0'
			SELECT @cClause = @cClause + ' AND (NOT EXISTS (SELECT 1 FROM dbo.MenuPrm WHERE MenuId = a.MenuId AND PermKeyId = 11) OR EXISTS (SELECT 1 FROM dbo.MenuPrm WHERE MenuId = a.MenuId AND PermKeyId = 11 AND ((GrantDeny = ''G'' AND PermId in (' + replace(@Projects,nchar(191),',') + ')) OR ( ' + @DefaultSystemAccess + 'AND GrantDeny = ''D'' AND PermId not in (' + replace(@Projects,nchar(191),',') + ')))))'
		IF @cClause <> '' SELECT @tClause = @tClause + CASE WHEN LEFT(@cClause,1) = '(' THEN ' OR ((' ELSE ' OR (' END + right(@cClause,len(@cClause) - 5) + ')'
	END
END
IF @tClause = '' SELECT @wClause = ''
ELSE
BEGIN
	IF charindex('OR 1<>1',@tClause) > 0
		SELECT @wClause = 'WHERE 1<>1'
	ELSE
		SELECT @wClause = 'WHERE (' + @DefaultSystemAccess + 'AND NOT EXISTS (SELECT 1 FROM dbo.MenuPrm WHERE MenuId = a.MenuId))' + @tClause
END
IF @Screenid = 0 AND @Reportid = 0 AND @Wizardid = 0	-- Special case to allow everything for MenuIDE only.
	EXEC (@sClause + ' ' + @fClause + ' ' + @oClause)
ELSE
	EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
DECLARE @ParentId int, @MenuId int, @ii int, @PrevPid int, @Pid varchar(50)
DECLARE curs CURSOR FAST_FORWARD FOR SELECT ParentId,MenuId FROM #menu ORDER BY ParentId,MenuIndex FOR READ ONLY
OPEN curs FETCH NEXT FROM curs INTO @ParentId,@MenuId
SELECT  @ii = 0, @PrevPid = null
WHILE @@FETCH_STATUS = 0
BEGIN
	IF (@ParentId is not null AND @PrevPid is null) OR (@ParentId <> @PrevPid) SELECT @ii = 0
	IF @ParentId is null
		UPDATE #menu SET QId = right('0' + convert(varchar,@ii), 2) WHERE MenuId = @MenuId
	ELSE
	BEGIN
		SELECT @Pid = QId FROM #menu WHERE MenuId = @ParentId
		IF @Pid is not null AND @Pid <> ''
			UPDATE #menu SET
				 RootQId = case when charindex('.',@Pid) > 0 then substring(@Pid,1,charindex('.',@Pid) - 1) else @Pid end
				,ParentQId = @Pid
				,QId = @Pid + '.' + right('000' + convert(varchar,@ii), 4)
			WHERE MenuId = @MenuId
	END
	SELECT @ii = @ii + 1, @PrevPid = @ParentId
	FETCH NEXT FROM curs INTO @ParentId,@MenuId
END
CLOSE curs
DEALLOCATE curs
-- In case the order of menu items are not chronological:
DECLARE curs CURSOR FAST_FORWARD FOR SELECT ParentId,MenuId FROM #menu WHERE Qid = '' ORDER BY ParentId,MenuIndex FOR READ ONLY
OPEN curs FETCH NEXT FROM curs INTO @ParentId,@MenuId
SELECT  @ii = 0, @PrevPid = null
WHILE @@FETCH_STATUS = 0
BEGIN
	IF (@ParentId is not null AND @PrevPid is null) OR (@ParentId <> @PrevPid) SELECT @ii = 0
	SELECT @Pid = QId FROM #menu WHERE MenuId = @ParentId
	IF @Pid is not null AND @Pid <> ''
		UPDATE #menu SET
			 RootQId = case when charindex('.',@Pid) > 0 then substring(@Pid,1,charindex('.',@Pid) - 1) else @Pid end
			,ParentQId = @Pid
			,QId = @Pid + '.' + right('000' + convert(varchar,@ii), 4)
		WHERE MenuId = @MenuId
	SELECT @ii = @ii + 1, @PrevPid = @ParentId
	FETCH NEXT FROM curs INTO @ParentId,@MenuId
END
CLOSE curs
DEALLOCATE curs
IF @Screenid IS NOT NULL AND @Screenid <> 0
	SELECT RootQId,ParentQId,QId,ParentId,MenuId,MenuText,NavigateUrl,QueryStr,IconUrl,Popup,GroupTitle, ScreenId FROM #menu WHERE ScreenId IS NOT NULL AND ScreenId = @ScreenId ORDER BY Qid
ELSE IF @Reportid IS NOT NULL AND @Reportid <> 0
	SELECT RootQId,ParentQId,QId,ParentId,MenuId,MenuText,NavigateUrl,QueryStr,IconUrl,Popup,GroupTitle, ScreenId FROM #menu  WHERE ReportId IS NOT NULL AND ReportId = @ReportId ORDER BY Qid
ELSE IF @Wizardid IS NOT NULL AND @Wizardid <> 0
	SELECT RootQId,ParentQId,QId,ParentId,MenuId,MenuText,NavigateUrl,QueryStr,IconUrl,Popup,GroupTitle, ScreenId FROM #menu  WHERE WizardId IS NOT NULL AND WizardId = @WizardId ORDER BY Qid
ELSE
	SELECT RootQId,ParentQId,QId,ParentId,MenuId,MenuText,NavigateUrl,QueryStr,IconUrl,Popup,GroupTitle, ScreenId FROM #menu ORDER BY Qid
DROP TABLE dbo.#menu
DROP TABLE dbo.#hlp
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetMsg') AND type='P')
DROP PROCEDURE dbo.GetMsg
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetMsg]
 @MsgId		Int
,@CultureId	smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @DefCultureId	smallint
	,@MsgSource	varchar(50)
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT @MsgSource = MsgSource FROM dbo.Msg WHERE MsgId = @MsgId
IF @CultureId <> @DefCultureId AND EXISTS (SELECT 'true' FROM dbo.MsgCenter WHERE MsgId = @MsgId and CultureId = @CultureId)
	SELECT a.Msg, MsgSource = @MsgSource, b.CultureTypeName FROM dbo.MsgCenter a INNER JOIN RODesign.dbo.VwCulture b ON a.CultureId = b.CultureId
	WHERE a.MsgId = @MsgId and a.CultureId = @CultureId
ELSE
	SELECT a.Msg, MsgSource = @MsgSource, b.CultureTypeName FROM dbo.MsgCenter a INNER JOIN RODesign.dbo.VwCulture b ON a.CultureId = b.CultureId
	WHERE a.MsgId = @MsgId and a.CultureId = @DefCultureId
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetObjGroupCol') AND type='P')
DROP PROCEDURE dbo.GetObjGroupCol
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetObjGroupCol]
 @screenId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @xClause			varchar(8000)
		,@GroupColId		int
		,@TabFolderId		int
SET NOCOUNT ON
IF object_id('tempdb.dbo.#tbl') is not null DROP TABLE dbo.#tbl
CREATE TABLE #tbl (GroupColId int not null, ColCssClass varchar(50) null, TabFolderId int null)
SELECT @xClause = 'INSERT #tbl (GroupColId, ColCssClass, TabFolderId) SELECT a.GroupColId, a.ColCssClass, null'
+ ' FROM RODesign.dbo.GroupCol a'
+ ' WHERE EXISTS (SELECT 1 FROM dbo.ScreenObj b'
+ ' WHERE b.ScreenId = ' + CONVERT(varchar,@screenId) + ' AND a.GroupColId = b.GroupColId)'
EXEC (@xClause)
DECLARE cur1 CURSOR FAST_FORWARD FOR SELECT GroupColId FROM #tbl FOR READ ONLY
OPEN cur1
FETCH NEXT FROM cur1 INTO @GroupColId
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @xClause = 'DECLARE @TabFolderId int SELECT @TabFolderId = TabFolderId FROM dbo.ScreenObj'
	+ ' WHERE ScreenId = ' + CONVERT(varchar,@screenId) + ' AND GroupColId = ' + convert(varchar,@GroupColId) + ' AND TabFolderId is not null'
	+ ' IF @TabFolderId is not null BEGIN UPDATE #tbl SET TabFolderId = @TabFolderId WHERE GroupColId = ' + convert(varchar,@GroupColId) + ' END'
	EXEC (@xClause)
	FETCH NEXT FROM cur1 INTO @GroupColId
END
CLOSE cur1
DEALLOCATE cur1
SELECT GroupColId, ColCssClass, TabFolderId FROM #tbl
DROP TABLE #tbl
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetPermFilter') AND type='P')
DROP PROCEDURE dbo.GetPermFilter
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





/* DECLARE @wClause nvarchar(4000) EXEC RODesign.dbo.GetPermFilter 1,null,'1','8?1','CompanyLs','Company','b1.','Y','Y',null,'Y','UsrId',@wClause OUTPUT SELECT @wClause */
CREATE PROCEDURE [dbo].[GetPermFilter]
 @ScreenId			int  
,@ReportId			int  
,@RowAuthoritys		varchar(1000)  
,@PermKeys			varchar(1000)  
,@PermKeyName		varchar(50)  
,@TableName			varchar(500)  
,@TableAbbr			varchar(50)  
,@AndCondition		char(1)  
,@MultiValue		char(1)  
,@ExternalTable		varchar(50)  
,@ParamAllowNulls	char(1)  
,@PKeyColName		varchar(50)  
,@wClause			varchar(8000) OUTPUT
,@Usrs				varchar(max) = null
/* WITH ENCRYPTION */  
AS  
DECLARE  @rr			varchar(1000)  
		,@rrid			smallint  
		,@pp			varchar(1000)  
		,@ppid			int  
		,@kk			varchar(1000)  
		,@kkid			int  
		,@or			varchar(10)  
		,@SelUsr		char(1)
		,@SelUsrGroup	char(1)
		,@SelCulture	char(1)
		,@SelCompany	char(1)
		,@SelAgent		char(1)
		,@SelBroker		char(1)
		,@SelCustomer	char(1)
		,@SelInvestor	char(1)
		,@SelMember		char(1)
		,@SelVendor		char(1)
		,@SelProject	char(1)
		,@Sel			char(1)
		,@wFilter		varchar(4000)  
		,@gFilter		varchar(4000)
		,@dFilter		varchar(4000)
		,@SysAdmin		char(1)
SET NOCOUNT ON
/* Prepare additional user filtering regardless of row authority: DO NOT add @SysAdmin <> 'Y' */
SELECT @dFilter = '', @gFilter = '', @pp = @Usrs
WHILE @pp <> '' AND datalength(@pp) > 0
BEGIN
	EXEC RODesign.dbo.Pop1Int @pp OUTPUT,@ppid OUTPUT
	IF @dFilter <> '' SELECT @dFilter = @dFilter + ' OR '
	SELECT @dFilter = @dFilter + 'NOT EXISTS (SELECT 1 FROM ROCmon.dbo.' + @TableName + 'Usr u WHERE u.' + @PermKeyName + '='
	IF @PermKeyName = @PKeyColName SELECT @dFilter = @dFilter + @TableAbbr ELSE SELECT @dFilter = @dFilter + 'x.'
	SELECT @dFilter = @dFilter + @PermKeyName + ' AND u.GrantDeny=''D'' AND u.UsrId=' + convert(varchar,@ppid) + ')'
	IF @gFilter <> '' SELECT @gFilter = @gFilter + ' OR '
	SELECT @gFilter = @gFilter + 'EXISTS (SELECT 1 FROM ROCmon.dbo.' + @TableName + 'Usr u WHERE u.' + @PermKeyName + '='
	IF @PermKeyName = @PKeyColName SELECT @gFilter = @gFilter + @TableAbbr ELSE SELECT @gFilter = @gFilter + 'x.'
	SELECT @gFilter = @gFilter + @PermKeyName + ' AND u.GrantDeny=''G'' AND u.UsrId=' + convert(varchar,@ppid) + ')'
END
IF @dFilter <> '' SELECT @dFilter = ' AND (' + @dFilter + ')'
IF @gFilter <> '' SELECT @gFilter = ' OR (' + @gFilter + ')'

IF @AndCondition = 'N'
BEGIN
	IF @ExternalTable is not null AND @ExternalTable <> ''
		SELECT @wFilter = ' OR (((' + case when @ParamAllowNulls = 'Y' then 'NOT EXISTS (SELECT 1 FROM ' + @ExternalTable + ' x WHERE ' + @TableAbbr + @PKeyColName + ' = x.' + @PKeyColName + ')' else '' end
	ELSE
		SELECT @wFilter = ' OR (((' + case when @ParamAllowNulls = 'Y' then @TableAbbr + @PermKeyName + ' is null' else '' end
	END
ELSE
BEGIN
	IF @ExternalTable is not null AND @ExternalTable <> ''
		SELECT @wFilter = ' AND (((' + case when @ParamAllowNulls = 'Y' then 'NOT EXISTS (SELECT 1 FROM ' + @ExternalTable + ' x WHERE ' + @TableAbbr + @PKeyColName + ' = x.' + @PKeyColName + ')' else '' end
	ELSE
		SELECT @wFilter = ' AND (((' + case when @ParamAllowNulls = 'Y' then @TableAbbr + @PermKeyName + ' is null' else '' end
	END
SELECT @rr = @RowAuthoritys, @SysAdmin = 'N'
WHILE @rr <> '' AND datalength(@rr) > 0
BEGIN
	EXEC RODesign.dbo.Pop1SmallInt @rr OUTPUT, @rrid OUTPUT
	IF dbo.fSelRowAuth(@rrid, null, null, 'SysAdmin') = 'Y' SELECT @SysAdmin = 'Y'
	SELECT @pp = @PermKeys
	WHILE @pp <> '' AND datalength(@pp) > 0
	BEGIN
		EXEC RODesign.dbo.Pop1Int @pp OUTPUT, @ppid OUTPUT
		IF right(@wFilter,1) <> '(' SELECT @wFilter = @wFilter + ' OR '
		SELECT @Sel = isnull(dbo.fSelRowAuth(@rrid, @ScreenId, @ReportId, @TableName), dbo.fSelRowAuth(@rrid, @ScreenId, @ReportId, 'Usr'))
		IF @Sel = 'S'
		BEGIN
			IF @ExternalTable is not null AND @ExternalTable <> ''
				SELECT @wFilter = @wFilter + 'EXISTS (SELECT 1 FROM ' + @ExternalTable + ' x WHERE ' + @TableAbbr + @PKeyColName + ' = x.' + @PKeyColName + ' AND (((('
			IF @MultiValue = 'N'
				SELECT @wFilter = @wFilter + case when @ExternalTable is not null AND @ExternalTable <> '' then 'x.' else @TableAbbr end
					+ @PermKeyName + ' IN ' + RODesign.dbo.fKeyHier(@TableName,@ppid)
			ELSE
			BEGIN
				SELECT @kk = RODesign.dbo.fKeyHier(@TableName,@ppid)
				SELECT @kk = replace(replace(replace(@kk,'(',space(0)),')',space(0)),',',nchar(191)), @or = ''
				WHILE @kk <> '' AND datalength(@kk) > 0
				BEGIN
					EXEC RODesign.dbo.Pop1Int @kk OUTPUT, @kkid OUTPUT
					SELECT @wFilter = @wFilter + @or + 'charindex('',' + convert(varchar,@kkid)
						+ ','',replace(replace(' + case when @ExternalTable is not null AND @ExternalTable <> '' then 'x.' else @TableAbbr end
						+ @PermKeyName + ',''('','',''),'')'','','')) > 0'
					SELECT @or = ' OR '
				END
			END
			IF @ExternalTable is not null AND @ExternalTable <> ''
			BEGIN
				IF @Usrs is not null AND EXISTS (SELECT 1 FROM ROCmon.dbo.sysobjects WHERE id = object_id('ROCmon.dbo.' + @TableName + 'Usr'))
					SELECT @wFilter = @wFilter + ')' + @dFilter + ')' + @gFilter + ')'
				ELSE
					SELECT @wFilter = @wFilter + ')))'
				SELECT @wFilter = @wFilter + '))'
			END
		END
		ELSE IF @Sel = 'A' SELECT @wFilter = @wFilter + '1=1'
		ELSE SELECT @wFilter = @wFilter + '1<>1'
	END
END
IF @Usrs is not null AND @PermKeyName = @PKeyColName AND EXISTS (SELECT 1 FROM ROCmon.dbo.sysobjects WHERE id = object_id('ROCmon.dbo.' + @TableName + 'Usr'))
	SELECT @wClause = isnull(@wClause,space(0)) + @wFilter + ')' + @dFilter + ')' + @gFilter + ')'
ELSE
	SELECT @wClause = isnull(@wClause,space(0)) + @wFilter + ')))'
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetReportById') AND type='P')
DROP PROCEDURE dbo.GetReportById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetReportById]
 @GenPrefix		varchar(10)
,@desDatabase	varchar(50)
,@srcDatabase	varchar(50)
,@reportId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.ReportId,a.ProgramName,a.GenerateRp,b.SysProgram,a.OrientationCd,a.ReportTypeCd'
+ ',a.RegClause,a.UpdClause,a.XlsClause,b.dbAppDatabase,b.dbDesDatabase,a.TemplateName'
+ ',a.UnitCd,a.TopMargin,a.BottomMargin,a.LeftMargin,a.RightMargin,a.PageWidth,a.PageHeight'
+ ',RptWidth = a.PageWidth - a.LeftMargin - a.RightMargin'
+ case when @GenPrefix = '' then ',a.AuthRequired' else '' end
SELECT @fClause = 'FROM dbo.' + @GenPrefix + 'Report a'
+ ' INNER JOIN RODesign.dbo.Systems b ON b.dbDesDatabase = ''' + @srcDatabase + ''''
SELECT @wClause = 'WHERE a.ReportId = ' + CONVERT(varchar,@reportId)
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetReportCha') AND type='P')
DROP PROCEDURE dbo.GetReportCha
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetReportCha]
 @GenPrefix		varchar(10)
,@RptCtrId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.RptChaId, a.RptChaTypeCd, a.ThreeD, t.CtrValue, a.ChartData'
+ ', CategoryTtl = ''=Parameters!L_'' + cg.ColumnName + ''.Value'''
+ ', CategoryLbl = ''=Fields!'' + cg.ColumnName + ''.Value'''
+ ', CategoryGrp = ''<Grouping Name="CG'' + convert(varchar,a.RptChaId) + ''"><GroupExpressions><GroupExpression>=Fields!'' + cg.ColumnName + ''.Value</GroupExpression></GroupExpressions></Grouping>'''
+ ', SeriesLbl = ''=Fields!'' + sg.ColumnName + ''.Value'''
+ ', SeriesGrp = ''<Grouping Name="SG'' + convert(varchar,a.RptChaId) + ''"><GroupExpressions><GroupExpression>=Fields!'' + sg.ColumnName + ''.Value</GroupExpression></GroupExpressions></Grouping>'''
SELECT @fClause = 'FROM dbo.' + @GenPrefix + 'RptCha a'
+ ' INNER JOIN dbo.' + @GenPrefix + 'RptCtr t ON a.RptCtrId = t.RptCtrId'
+ ' INNER JOIN dbo.' + @GenPrefix + 'ReportObj cg ON a.CategoryGrp = cg.ReportObjId'
+ ' LEFT OUTER JOIN dbo.' + @GenPrefix + 'ReportObj sg ON a.SeriesGrp = sg.ReportObjId'
SELECT @wClause = 'WHERE a.RptCtrId = ' + CONVERT(varchar,@RptCtrId)
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetReportColumns') AND type='P')
DROP PROCEDURE dbo.GetReportColumns
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetReportColumns]
 @GenPrefix		varchar(10)
,@reportId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
	,@oClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.ColumnName,a.RptObjTypeCd,b.ColumnHeader,a.ColumnFormat,a.PaddSize'
+ ',PaddChar=isnull(a.PaddChar,'' ''),d.DataTypeName,d.DataTypeSysName,a.OperatorId,d.DataTypeRdlParm'
SELECT @fClause = 'FROM dbo.' + @GenPrefix + 'ReportObj a'
+ ' INNER JOIN dbo.' + @GenPrefix + 'ReportObjHlp b ON a.ReportObjId = b.ReportObjId'
+ ' INNER JOIN RODesign.dbo.VwCulture e ON b.CultureId = e.CultureId AND e.CultureDefault = ''Y'''
+ ' INNER JOIN RODesign.dbo.CtDataType d ON a.DataTypeId = d.DataTypeId'
SELECT @wClause = 'WHERE a.ReportId = ' + CONVERT(varchar,@reportId)
SELECT @oClause = 'ORDER BY a.TabIndex'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetReportCriDel') AND type='P')
DROP PROCEDURE dbo.GetReportCriDel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetReportCriDel]
 @GenPrefix		varchar(10)
,@reportId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT ProcedureName = ColumnName'
SELECT @fClause = 'FROM dbo.' + @GenPrefix + 'ReportCri'
SELECT @wClause = 'WHERE ReportId = ' + convert(varchar,@reportId)
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetReportCriHlp') AND type='P')
DROP PROCEDURE dbo.GetReportCriHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetReportCriHlp]
 @ReportId	int
,@CultureId	smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @DefCultureId	smallint
IF object_id('tempdb.dbo.#hlp') is not null DROP TABLE dbo.#hlp
CREATE TABLE #hlp (tid smallint IDENTITY(1,1) not null, TabIndex smallint not null, ReportCriId int not null, ColumnHeader nvarchar(50) null)
INSERT #hlp (TabIndex, ReportCriId, ColumnHeader) SELECT a.TabIndex, a.ReportCriId, b.ColumnHeader
	FROM dbo.ReportCri a INNER JOIN dbo.ReportCriHlp b ON a.ReportCriId = b.ReportCriId
	WHERE a.ReportId = @ReportId AND b.CultureId = @CultureId
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF @CultureId <> @DefCultureId
	INSERT #hlp (TabIndex, ReportCriId, ColumnHeader) SELECT a.TabIndex, a.ReportCriId, b.ColumnHeader
		FROM dbo.ReportCri a INNER JOIN dbo.ReportCriHlp b ON a.ReportCriId = b.ReportCriId
		WHERE a.ReportId = @ReportId AND b.CultureId = @DefCultureId
		AND NOT EXISTS (SELECT 'true' FROM dbo.ReportCriHlp c WHERE c.ReportCriId = a.ReportCriId AND c.CultureId = @CultureId)
SELECT ColumnHeader = isnull(a.ColumnHeader,''), b.ColumnSize, RowSize=CASE WHEN e.TypeName='ListBox' THEN ISNULL(b.RowSize,1) ELSE b.RowSize END
	, DisplayName = e.TypeName, DisplayMode = e.TypeDesc, b.RequiredValid, b.DefaultValue
	FROM dbo.#hlp a
	INNER JOIN dbo.ReportCri b ON a.ReportCriId = b.ReportCriId
	INNER JOIN RODesign.dbo.CtDisplayType e ON b.DisplayModeId = e.TypeId
	ORDER BY a.TabIndex
DROP TABLE dbo.#hlp
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetReportCriteria') AND type='P')
DROP PROCEDURE dbo.GetReportCriteria
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetReportCriteria]
 @GenPrefix		varchar(10)
,@reportId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
	,@oClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.ReportCriId,a.ReportGrpId,a.LabelCss,a.ContentCss'
+ ',a.ColumnName,b.ColumnHeader,a.ColumnSize,RowSize=CASE WHEN c.TypeName=''ListBox'' THEN ISNULL(a.RowSize,1) ELSE a.RowSize END'
+ ',a.DdlKeyColumnName,a.DdlRefColumnName,a.DdlFtrColumnId, DdlFtrColumnName=r.ColumnName'
+ ',DisplayMode = CASE WHEN f.ReportId IS NOT NULL AND c.TypeDesc = ''Date'' AND (CHARINDEX(''usagedt'',lower(f.ColumnName)) > 0 OR CHARINDEX(''modifiedon'',lower(f.ColumnName)) > 0 OR CHARINDEX(''inputon'',lower(f.ColumnName)) > 0)THEN ''DateUTC'' ELSE c.TypeDesc END,DisplayName = c.TypeName'
+ ',DataTypeSysName = CASE WHEN c.TypeName=''ListBox'' THEN ''String'' ELSE d.DataTypeSysName END'
+ ',DataTypeSByteOle = CASE WHEN c.TypeName=''ListBox'' THEN ''VarChar'' ELSE d.DataTypeSByteOle END'
+ ',DataTypeDByteOle = CASE WHEN c.TypeName=''ListBox'' THEN ''VarWChar'' ELSE d.DataTypeDByteOle END'
+ ',DataTypeRdlParm = CASE WHEN c.TypeName=''ListBox'' THEN ''String'' ELSE d.DataTypeRdlParm END'
+ ',a.RequiredValid'
SELECT @fClause = 'FROM dbo.' + @GenPrefix + 'ReportCri a'
+ ' INNER JOIN dbo.' + @GenPrefix + 'ReportCriHlp b ON a.ReportCriId = b.ReportCriId'
+ ' INNER JOIN RODesign.dbo.VwCulture e ON b.CultureId = e.CultureId AND e.CultureDefault = ''Y'''
+ ' INNER JOIN RODesign.dbo.CtDataType d ON a.DataTypeId = d.DataTypeId'
+ ' INNER JOIN RODesign.dbo.CtDisplayType c ON a.DisplayModeId = c.TypeId'
+ ' LEFT OUTER JOIN dbo.ReportObj f ON a.ReportCriId = f.ReportCriId AND f.ReportId = a.ReportId'  
+ ' LEFT OUTER JOIN dbo.ReportCri r ON a.DdlFtrColumnId = r.ReportCriId'
SELECT @wClause = 'WHERE a.ReportId = ' + CONVERT(varchar,@reportId)
SELECT @oClause = 'ORDER BY a.TabIndex'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetReportCtr') AND type='P')
DROP PROCEDURE dbo.GetReportCtr
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetReportCtr]
 @GenPrefix		varchar(10)
,@PRptCtrId		int
,@RptElmId		int
,@RptCelId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
		,@fClause	varchar(8000)
		,@wClause	varchar(8000)
SET NOCOUNT ON
IF (SELECT COUNT(1) FROM dbo.RptStyle) <= 0 EXEC dbo.MkRptStyle
SELECT @sClause = 'SELECT a.RptCtrId, a.RptCtrTypeCd, b.RptCtrTypeName, b.HasChildCtr, a.RptCtrName'
+ ', CtrTop = convert(varchar,a.CtrTop) + r.UnitCd, CtrLeft = convert(varchar,a.CtrLeft) + r.UnitCd'
+ ', CtrHeight = convert(varchar,a.CtrHeight) + r.UnitCd, CtrWidth = convert(varchar,a.CtrWidth) + r.UnitCd'
+ ', CtrAction = ''<Action><Hyperlink>'' + case when a.CtrAction is null then null else a.CtrAction end + ''</Hyperlink></Action>'''
+ ', CtrVisibility = ''<Visibility><Hidden>'' + case when a.CtrVisibility is null then null when a.CtrVisibility = ''Y'' then ''true'' else ''false'' end + ''</Hidden>'''
	+ ' + case when a.CtrToggle is null then '''' else ''<ToggleItem>'' + v.RptCtrName + ''</ToggleItem>'' end + ''</Visibility>'''
+ ', CtrGrouping = ''<Grouping Name="G'' + convert(varchar,a.RptCtrId) + ''"><GroupExpressions><GroupExpression>=Fields!'' + z.ColumnName + ''.Value</GroupExpression></GroupExpressions></Grouping>'''
+ ', a.CtrZIndex, a.CtrToolTip, a.CtrPgBrStart, a.CtrPgBrEnd, a.CtrValue, a.CtrCanGrow, a.CtrCanShrink, a.CtrTogether'
+ ', c.RptStyleId, c.BorderColorD, c.BorderColorL, c.BorderColorR, c.BorderColorT, c.BorderColorB'
+ ', BorderStyleD = dd.BorderStyleName, BorderStyleL = dl.BorderStyleName, BorderStyleR = dr.BorderStyleName'
+ ', BorderStyleT = dt.BorderStyleName, BorderStyleB = db.BorderStyleName'
+ ', c.BorderWidthD, c.BorderWidthL, c.BorderWidthR, c.BorderWidthT, c.BorderWidthB'
+ ', c.Color, c.BgColor, BgGradType = e.BgGradTypeName, c.BgGradColor, c.BgImage'
+ ', c.LineHeight, c.Format, FontStyle = f.FontStyleName, c.FontFamily, c.FontSize, FontWeight = g.FontWeightName'
+ ', TextDecor = h.TextDecorName, TextAlign = i.TextAlignName, VerticalAlign = j.VerticalAlignName'
+ ', c.PadLeft, c.PadRight, c.PadTop, c.PadBottom, Direction = k.DirectionName, WritingMode = m.WritingModeName'
SELECT @fClause = 'FROM dbo.' + @GenPrefix + 'RptCtr a'
+ ' INNER JOIN RODesign.dbo.CtRptCtrType b ON a.RptCtrTypeCd = b.RptCtrTypeCd'
+ ' INNER JOIN dbo.' + @GenPrefix + 'Report r ON a.ReportId = r.ReportId'
+ ' LEFT OUTER JOIN dbo.RptStyle c ON a.RptStyleId = c.RptStyleId'
+ ' LEFT OUTER JOIN RODesign.dbo.CtBorderStyle dd ON c.BorderStyleD = dd.BorderStyleId'
+ ' LEFT OUTER JOIN RODesign.dbo.CtBorderStyle dl ON c.BorderStyleL = dd.BorderStyleId'
+ ' LEFT OUTER JOIN RODesign.dbo.CtBorderStyle dr ON c.BorderStyleR = dd.BorderStyleId'
+ ' LEFT OUTER JOIN RODesign.dbo.CtBorderStyle dt ON c.BorderStyleT = dd.BorderStyleId'
+ ' LEFT OUTER JOIN RODesign.dbo.CtBorderStyle db ON c.BorderStyleB = dd.BorderStyleId'
+ ' LEFT OUTER JOIN RODesign.dbo.CtBgGradType e ON c.BgGradType = e.BgGradTypeId'
+ ' LEFT OUTER JOIN RODesign.dbo.CtFontStyle f ON c.FontStyle = f.FontStyleCd'
+ ' LEFT OUTER JOIN RODesign.dbo.CtFontWeight g ON c.FontWeight = g.FontWeightCd'
+ ' LEFT OUTER JOIN RODesign.dbo.CtTextDecor h ON c.TextDecor = h.TextDecorCd'
+ ' LEFT OUTER JOIN RODesign.dbo.CtTextAlign i ON c.TextAlign = i.TextAlignCd'
+ ' LEFT OUTER JOIN RODesign.dbo.CtVerticalAlign j ON c.VerticalAlign = j.VerticalAlignCd'
+ ' LEFT OUTER JOIN RODesign.dbo.CtDirection k ON c.Direction = k.DirectionCd'
+ ' LEFT OUTER JOIN RODesign.dbo.CtWritingMode m ON c.WritingMode = m.WritingModeCd'
+ ' LEFT OUTER JOIN dbo.' + @GenPrefix + 'ReportObj z ON a.CtrGrouping = z.ReportObjId'
+ ' LEFT OUTER JOIN dbo.' + @GenPrefix + 'RptCtr v ON a.CtrToggle = v.RptCtrId'
IF @PRptCtrId is not null SELECT @wClause = 'WHERE a.PRptCtrId = ' + CONVERT(varchar,@PRptCtrId)
ELSE IF @RptElmId is not null SELECT @wClause = 'WHERE a.RptElmId = ' + CONVERT(varchar,@RptElmId)
ELSE SELECT @wClause = 'WHERE a.RptCelId = ' + CONVERT(varchar,@RptCelId)
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0 
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetReportDel') AND type='P')
DROP PROCEDURE dbo.GetReportDel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetReportDel]
 @GenPrefix			varchar(10)
,@srcDatabase		varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(max)
		,@fClause	varchar(max)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.ReportId, a.ProgramName, b.dbAppDatabase'
SELECT @fClause = 'FROM dbo.' + @GenPrefix + 'ReportDel a INNER JOIN RODesign.dbo.Systems b ON b.dbDesDatabase = ''' + @srcDatabase + ''''
EXEC (@sClause + ' ' + @fClause)
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetReportElm') AND type='P')
DROP PROCEDURE dbo.GetReportElm
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetReportElm]
 @GenPrefix		varchar(10)
,@reportId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
SET NOCOUNT ON
IF (SELECT COUNT(1) FROM dbo.RptStyle) <= 0 EXEC dbo.MkRptStyle
SELECT @sClause = 'SELECT a.RptElmId, a.RptElmTypeCd, b.RptElmTypeName'
+ ', ElmHeight = convert(varchar,a.ElmHeight) + r.UnitCd, a.ElmColumns'
+ ', ElmColSpacing = convert(varchar,a.ElmColSpacing) + r.UnitCd, a.ElmPrintFirst, a.ElmPrintLast'
+ ', c.RptStyleId, c.BorderColorD, c.BorderColorL, c.BorderColorR, c.BorderColorT, c.BorderColorB'
+ ', BorderStyleD = dd.BorderStyleName, BorderStyleL = dl.BorderStyleName, BorderStyleR = dr.BorderStyleName'
+ ', BorderStyleT = dt.BorderStyleName, BorderStyleB = db.BorderStyleName'
+ ', c.BorderWidthD, c.BorderWidthL, c.BorderWidthR, c.BorderWidthT, c.BorderWidthB'
+ ', c.Color, c.BgColor, BgGradType = e.BgGradTypeName, c.BgGradColor, c.BgImage'
+ ', c.LineHeight, c.Format, FontStyle = f.FontStyleName, c.FontFamily, c.FontSize, FontWeight = g.FontWeightName'
+ ', TextDecor = h.TextDecorName, TextAlign = i.TextAlignName, VerticalAlign = j.VerticalAlignName'
+ ', c.PadLeft, c.PadRight, c.PadTop, c.PadBottom, Direction = k.DirectionName, WritingMode = m.WritingModeName'
SELECT @fClause = 'FROM dbo.' + @GenPrefix + 'RptElm a'
+ ' INNER JOIN RODesign.dbo.CtRptElmType b ON a.RptElmTypeCd = b.RptElmTypeCd'
+ ' INNER JOIN dbo.' + @GenPrefix + 'Report r ON a.ReportId = r.ReportId'
+ ' LEFT OUTER JOIN dbo.RptStyle c ON a.RptStyleId = c.RptStyleId'
+ ' LEFT OUTER JOIN RODesign.dbo.CtBorderStyle dd ON c.BorderStyleD = dd.BorderStyleId'
+ ' LEFT OUTER JOIN RODesign.dbo.CtBorderStyle dl ON c.BorderStyleL = dd.BorderStyleId'
+ ' LEFT OUTER JOIN RODesign.dbo.CtBorderStyle dr ON c.BorderStyleR = dd.BorderStyleId'
+ ' LEFT OUTER JOIN RODesign.dbo.CtBorderStyle dt ON c.BorderStyleT = dd.BorderStyleId'
+ ' LEFT OUTER JOIN RODesign.dbo.CtBorderStyle db ON c.BorderStyleB = dd.BorderStyleId'
+ ' LEFT OUTER JOIN RODesign.dbo.CtBgGradType e ON c.BgGradType = e.BgGradTypeId'
+ ' LEFT OUTER JOIN RODesign.dbo.CtFontStyle f ON c.FontStyle = f.FontStyleCd'
+ ' LEFT OUTER JOIN RODesign.dbo.CtFontWeight g ON c.FontWeight = g.FontWeightCd'
+ ' LEFT OUTER JOIN RODesign.dbo.CtTextDecor h ON c.TextDecor = h.TextDecorCd'
+ ' LEFT OUTER JOIN RODesign.dbo.CtTextAlign i ON c.TextAlign = i.TextAlignCd'
+ ' LEFT OUTER JOIN RODesign.dbo.CtVerticalAlign j ON c.VerticalAlign = j.VerticalAlignCd'
+ ' LEFT OUTER JOIN RODesign.dbo.CtDirection k ON c.Direction = k.DirectionCd'
+ ' LEFT OUTER JOIN RODesign.dbo.CtWritingMode m ON c.WritingMode = m.WritingModeCd'
SELECT @wClause = 'WHERE a.ReportId = ' + CONVERT(varchar,@reportId)
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0 
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetReportHlp') AND type='P')
DROP PROCEDURE dbo.GetReportHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetReportHlp]
 @ReportId		int
,@CultureId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @DefCultureId	smallint
		,@ProgramName	varchar(50)
		,@ReportTypeCd	char(1)
		,@TemplateName  varchar(100)
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT @ProgramName = ProgramName, @ReportTypeCd = ReportTypeCd,@TemplateName=TemplateName FROM dbo.Report WHERE ReportId = @ReportId
IF @@ERROR <> 0 OR @@ROWCOUNT <> 1 BEGIN RAISERROR('{36}',18,2) WITH SETERROR RETURN 1 END
IF @CultureId <> @DefCultureId AND EXISTS (SELECT 'true' FROM dbo.ReportHlp WHERE ReportId = @ReportId and CultureId = @CultureId)
	SELECT DefaultHlpMsg, ReportTitle, ProgramName = @ProgramName, ReportTypeCd = @ReportTypeCd, TemplateName = @TemplateName
		FROM dbo.ReportHlp WHERE ReportId = @ReportId and CultureId = @CultureId
ELSE
	SELECT DefaultHlpMsg, ReportTitle, ProgramName = @ProgramName, ReportTypeCd = @ReportTypeCd, TemplateName = @TemplateName
		FROM dbo.ReportHlp WHERE ReportId = @ReportId and CultureId = @DefCultureId
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetReportItem') AND type='P')
DROP PROCEDURE dbo.GetReportItem
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO







CREATE PROCEDURE [dbo].[GetReportItem]
 @ReportId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
SELECT ReportSctName='', ReportItemName='', ItemFormula='', FontFamily='', FontSize='', FontBold='', FontItalic='', PosLeft=0, PosTop=0
	,PosWidth=0, PosHeight=0, Suppress='', Alignment='', LineTop='', LineBottom='', InternalField='', FormulaReady='N'
WHERE 1<>1
/* All references to dbo.ReportItem should be removed:
SELECT b.ReportSctName, a.ReportItemName, a.ItemFormula, a.FontFamily, a.FontSize, a.FontBold, a.FontItalic, a.PosLeft, a.PosTop
	,a.PosWidth, a.PosHeight, a.Suppress, a.Alignment, a.LineTop, a.LineBottom, InternalField = '', FormulaReady = 'N'
FROM dbo.ReportItem a INNER JOIN RODesign.dbo.CtReportSct b ON a.ReportSctId = b.ReportSctId
WHERE ReportId = @ReportId ORDER BY ReportSctName
*/
RETURN 0


 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetReportList') AND type='P')
DROP PROCEDURE dbo.GetReportList
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetReportList]
 @searchTxt		nvarchar(25)
/* WITH ENCRYPTION */
AS
DECLARE	  @sClause	varchar(8000)
	, @fClause	varchar(8000)
	, @wClause	varchar(8000)
	, @oClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.ReportId, b.GenerateRp, b.ProgramName, b.ReportTypeCd'
+ ', ReportTitle = a.ReportTitle + CASE WHEN b.GenerateRp = ''N'' THEN '' (no gen)'' ELSE space(0) END'
SELECT @fClause = 'FROM dbo.ReportHlp a'
+ ' INNER JOIN dbo.Report b ON a.ReportId = b.ReportId'
+ ' INNER JOIN RODesign.dbo.VwCulture d ON a.CultureId = d.CultureId AND d.CultureDefault = ''Y'''
IF (@searchTxt IS NULL OR @searchTxt = '')
	SELECT @wClause = ''
ELSE
	SELECT @wClause = 'WHERE a.ReportTitle LIKE ''%' + LOWER(@searchTxt) + '%'''
SELECT @oClause = 'ORDER BY a.ReportTitle'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetReportObjHlp') AND type='P')
DROP PROCEDURE dbo.GetReportObjHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetReportObjHlp]
 @GenPrefix	varchar(10)
,@ReportId	int
,@CultureId	smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	@DefCultureId	smallint
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF object_id('tempdb.dbo.#labl') is not null DROP TABLE dbo.#labl
CREATE TABLE #labl (TabIndex smallint not null, ReportObjId int not null, ColumnName varchar(50) not null, ColumnHeader nvarchar(50) null, RptObjTypeCd char(1) not null)
IF @GenPrefix = 'Ut'
BEGIN
	INSERT INTO #labl (TabIndex, ReportObjId, ColumnName, ColumnHeader, RptObjTypeCd)
		SELECT a.TabIndex, a.ReportObjId, a.ColumnName, b.ColumnHeader, a.RptObjTypeCd
		FROM dbo.UtReportObj a
		INNER JOIN dbo.UtReportObjHlp b ON a.ReportObjId = b.ReportObjId
		WHERE a.ReportId = @ReportId and b.CultureId = @DefCultureId
	IF @CultureId <> @DefCultureId
		UPDATE #labl SET ColumnHeader = b.ColumnHeader
		FROM dbo.#labl a
		INNER JOIN dbo.UtReportObjHlp b ON a.ReportObjId = b.ReportObjId
		WHERE b.CultureId = @CultureId
END
ELSE
BEGIN
	INSERT INTO #labl (TabIndex, ReportObjId, ColumnName, ColumnHeader, RptObjTypeCd)
		SELECT a.TabIndex, a.ReportObjId, a.ColumnName, b.ColumnHeader, a.RptObjTypeCd
		FROM dbo.ReportObj a
		INNER JOIN dbo.ReportObjHlp b ON a.ReportObjId = b.ReportObjId
		WHERE a.ReportId = @ReportId and b.CultureId = @DefCultureId
	IF @CultureId <> @DefCultureId
		UPDATE #labl SET ColumnHeader = b.ColumnHeader
		FROM dbo.#labl a
		INNER JOIN dbo.ReportObjHlp b ON a.ReportObjId = b.ReportObjId
		WHERE b.CultureId = @CultureId
END
SELECT ColumnName, ColumnHeader, RptObjTypeCd FROM #labl ORDER BY TabIndex
DROP table dbo.#labl
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetReportParm') AND type='P')
DROP PROCEDURE dbo.GetReportParm
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetReportParm]
 @GenPrefix		varchar(10)
,@reportId		int
,@WhereClause	varchar(4000)
,@tc			varchar(4000) OUTPUT
,@paramClause	varchar(8000) OUTPUT
,@SelfColumns	varchar(2000) OUTPUT
,@SelfHeaders	varchar(2000) OUTPUT
,@callingParm	varchar(4000) OUTPUT
/* WITH ENCRYPTION */
AS
DECLARE	 @ReportCriId		int
	,@ColumnName		varchar(50)
	,@DataTypeSqlName		varchar(30)
	,@NumericData		char(1)
	,@DataTypeSize		smallint
	,@ObjColumnName		varchar(50)
	,@OperatorName		varchar(10)
	,@TableId		int
	,@RequiredValid		char(1)
	,@ColumnHeader		varchar(50)
SET NOCOUNT ON
SELECT @SelfColumns = '', @SelfHeaders = ''
IF @GenPrefix = 'Ut'
BEGIN
	DECLARE criCursor CURSOR FOR
	SELECT a.ReportCriId, a.ColumnName, b.DataTypeSqlName, b.NumericData, a.DataTypeSize, a.TableId, a.RequiredValid, c.ColumnHeader
	FROM dbo.UtReportCri a
	INNER JOIN dbo.UtReportCriHlp c ON a.ReportCriId = c.ReportCriId
	INNER JOIN RODesign.dbo.VwCulture d ON c.CultureId = d.CultureId AND d.CultureDefault = 'Y'
	INNER JOIN RODesign.dbo.CtDataType b ON a.DataTypeId = b.DataTypeId
	WHERE a.ReportId = @reportId
	ORDER BY a.TabIndex FOR READ ONLY
END
ELSE
BEGIN
	DECLARE criCursor CURSOR FOR
	SELECT a.ReportCriId, a.ColumnName, b.DataTypeSqlName, b.NumericData, a.DataTypeSize, a.TableId, a.RequiredValid, c.ColumnHeader
	FROM dbo.ReportCri a
	INNER JOIN dbo.ReportCriHlp c ON a.ReportCriId = c.ReportCriId
	INNER JOIN RODesign.dbo.VwCulture d ON c.CultureId = d.CultureId AND d.CultureDefault = 'Y'
	INNER JOIN RODesign.dbo.CtDataType b ON a.DataTypeId = b.DataTypeId
	WHERE a.ReportId = @reportId
	ORDER BY a.TabIndex FOR READ ONLY
END
OPEN criCursor
FETCH NEXT FROM criCursor INTO @ReportCriId, @ColumnName, @DataTypeSqlName, @NumericData, @DataTypeSize, @TableId, @RequiredValid, @ColumnHeader
WHILE @@FETCH_STATUS = 0
BEGIN
	IF @TableId is not null AND @RequiredValid = 'N'
	BEGIN
		IF @SelfColumns <> '' SELECT @SelfColumns = @SelfColumns + nchar(191)
		IF @SelfHeaders <> '' SELECT @SelfHeaders = @SelfHeaders + nchar(191)
		SELECT @SelfColumns = @SelfColumns + @ColumnName, @SelfHeaders = @SelfHeaders + @ColumnHeader
	END
	SELECT @callingParm = @callingParm + ', @' + @ColumnName
	SELECT @paramClause = @paramClause + CHAR(13) + ',@' + @ColumnName + ' ' + @DataTypeSqlName
	IF charindex('char',lower(@DataTypeSqlName)) > 0
	BEGIN
		IF @DataTypeSize is not null SELECT @paramClause = @paramClause + '(' + case when @DataTypeSize > 0 then convert(varchar,@DataTypeSize) else 'max' end + ')'
		ELSE
		BEGIN
			RAISERROR('Please specify character size for column "%s".',18,2,@ColumnName) WITH SETERROR
			RETURN 1
		END
	END
	IF @GenPrefix = 'Ut'
	BEGIN
		DECLARE objCursor CURSOR FOR SELECT a.ColumnName, b.OperatorName
		FROM dbo.UtReportObj a INNER JOIN RODesign.dbo.CtOperator b ON a.OperatorId = b.OperatorId
		WHERE a.ReportCriId = @ReportCriId AND a.ReportId = @reportId
		FOR READ ONLY
	END
	ELSE
	BEGIN
		DECLARE objCursor CURSOR FOR SELECT a.ColumnName, b.OperatorName
		FROM dbo.ReportObj a INNER JOIN RODesign.dbo.CtOperator b ON a.OperatorId = b.OperatorId
		WHERE a.ReportCriId = @ReportCriId AND a.ReportId = @reportId
		FOR READ ONLY
	END
	OPEN objCursor
	FETCH NEXT FROM objCursor INTO @ObjColumnName, @OperatorName
	WHILE @@FETCH_STATUS = 0
	BEGIN
        /* in the case of <= datetime, the incoming datetime is at 12:00am which makes it non-inclusive
         * we just make it becomes < @incoming + 1 2012.8.23 gary
         */
        SELECT @tc = @tc + 'IF @' + @ColumnName + ' IS NOT NULL SELECT @wClause = @wClause + '''' AND (' + @ObjColumnName + ' ' + CASE WHEN (lower(@DataTypeSqlName) = 'datetime' OR lower(@DataTypeSqlName) = 'smalldatetime') AND @OperatorName='<=' THEN '<' ELSE @OperatorName END 
        IF @NumericData = 'Y' SELECT @tc = @tc + ' '''' + convert(varchar,@'+ @ColumnName + ') + '''')''''' + CHAR(13)
        ELSE IF lower(@DataTypeSqlName) = 'datetime' OR lower(@DataTypeSqlName) = 'smalldatetime'
              SELECT @tc = @tc + ' '''''''''''' + convert(varchar,' + + CASE WHEN @OperatorName='<=' THEN 'DATEADD(day,1,' ELSE '' END + '@' + @ColumnName + CASE WHEN @OperatorName='<=' THEN ')' ELSE '' END + ',102) + '''''''''''')''''' + CHAR(13)
        ELSE IF lower(@OperatorName) = 'in'
              SELECT @tc = @tc + ' '''' + @' + @ColumnName + ' + '''')''''' + CHAR(13)
        ELSE IF lower(@OperatorName) = 'like'
              SELECT @tc = @tc + ' ''''''''%'''' + @' + @ColumnName + ' + ''''%'''''''')''''' + CHAR(13)
        ELSE SELECT @tc = @tc + ' '''''''''''' + @' + @ColumnName + ' + '''''''''''')''''' + CHAR(13)
        IF @RequiredValid = 'Y'
        BEGIN
              SELECT @tc = @tc + 'ELSE' + CHAR(13) + 'BEGIN' + CHAR(13)
              SELECT @tc = @tc + '    RAISERROR(''''Please enter a value for ' + @ColumnHeader + ' and try again.'''',18,2) WITH SETERROR' + CHAR(13)
              SELECT @tc = @tc + '    RETURN 1' + CHAR(13)
              SELECT @tc = @tc + 'END' + CHAR(13)
        END
		FETCH NEXT FROM objCursor INTO @ObjColumnName, @OperatorName
	END
	CLOSE objCursor
	DEALLOCATE objCursor
	FETCH NEXT FROM criCursor INTO @ReportCriId, @ColumnName, @DataTypeSqlName, @NumericData, @DataTypeSize, @TableId, @RequiredValid, @ColumnHeader
END
CLOSE criCursor
DEALLOCATE criCursor
RETURN 0

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetReportTbl') AND type='P')
DROP PROCEDURE dbo.GetReportTbl
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetReportTbl]
 @GenPrefix		varchar(10)
,@RptCtrId		int
,@ParentId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
	,@oClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.RptTblId, a.ParentId, a.RptTblTypeCd, a.TblRepeatNew'
+ ', ColWidth = convert(varchar,a.ColWidth) + r.UnitCd'
+ ', TblGrouping = ''<Grouping Name="G'' + convert(varchar,a.RptTblId) + ''"><GroupExpressions><GroupExpression>=Fields!'' + z.ColumnName + ''.Value</GroupExpression></GroupExpressions></Grouping>'''
+ ', TblVisibility = ''<Visibility><Hidden>'' + case when a.TblVisibility is null then null when a.TblVisibility = ''Y'' then ''true'' else ''false'' end + ''</Hidden>'''
	+ ' + case when a.TblToggle is null then '''' else ''<ToggleItem>'' + v.RptCtrName + ''</ToggleItem>'' end + ''</Visibility>'''
+ ', b.RptCelId, b.RowNum, RowHeight = convert(varchar,b.RowHeight) + r.UnitCd, b.RowVisibility, b.CelColSpan'
SELECT @fClause = 'FROM dbo.' + @GenPrefix + 'RptTbl a'
+ ' INNER JOIN dbo.' + @GenPrefix + 'RptCtr t ON a.RptCtrId = t.RptCtrId'
+ ' INNER JOIN dbo.' + @GenPrefix + 'Report r ON t.ReportId = r.ReportId'
+ ' LEFT OUTER JOIN dbo.' + @GenPrefix + 'RptCel b ON a.RptTblId = b.RptTblId'
+ ' LEFT OUTER JOIN dbo.' + @GenPrefix + 'RptTbl c ON b.CelNum = c.RptTblId'
+ ' LEFT OUTER JOIN dbo.' + @GenPrefix + 'ReportObj z ON a.TblGrouping = z.ReportObjId'
+ ' LEFT OUTER JOIN dbo.' + @GenPrefix + 'RptCtr v ON a.TblToggle = v.RptCtrId'
SELECT @wClause = 'WHERE a.RptCtrId = ' + CONVERT(varchar,@RptCtrId)
IF @ParentId is null
	SELECT @wClause = @wClause + ' AND a.ParentId is null'
ELSE
	SELECT @wClause = @wClause + ' AND a.ParentId = ' + convert(varchar,@ParentId)
SELECT @oClause = 'ORDER BY a.RptTblTypeCd, a.TblOrder, b.RowNum, c.TblOrder'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetRptCriHlp') AND type='P')
DROP PROCEDURE dbo.GetRptCriHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetRptCriHlp]
 @GenPrefix	varchar(10)
,@ReportId	int
,@CultureId	smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @DefCultureId	smallint
IF object_id('tempdb.dbo.#hlp') is not null DROP TABLE dbo.#hlp
CREATE TABLE #hlp (tid smallint IDENTITY(1,1) not null, TabIndex smallint not null, ReportCriId int not null, ColumnHeader nvarchar(50) null)
IF @GenPrefix = 'Ut'
	INSERT #hlp (TabIndex, ReportCriId, ColumnHeader) SELECT a.TabIndex, a.ReportCriId, b.ColumnHeader
		FROM dbo.UtReportCri a INNER JOIN dbo.UtReportCriHlp b ON a.ReportCriId = b.ReportCriId
		WHERE a.ReportId = @ReportId AND b.CultureId = @CultureId
ELSE
	INSERT #hlp (TabIndex, ReportCriId, ColumnHeader) SELECT a.TabIndex, a.ReportCriId, b.ColumnHeader
		FROM dbo.ReportCri a INNER JOIN dbo.ReportCriHlp b ON a.ReportCriId = b.ReportCriId
		WHERE a.ReportId = @ReportId AND b.CultureId = @CultureId
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF @CultureId <> @DefCultureId
BEGIN
	IF @GenPrefix = 'Ut'
		INSERT #hlp (TabIndex, ReportCriId, ColumnHeader) SELECT a.TabIndex, a.ReportCriId, b.ColumnHeader
			FROM dbo.UtReportCri a INNER JOIN dbo.UtReportCriHlp b ON a.ReportCriId = b.ReportCriId
			WHERE a.ReportId = @ReportId AND b.CultureId = @DefCultureId
			AND NOT EXISTS (SELECT 'true' FROM dbo.UtReportCriHlp c WHERE c.ReportCriId = a.ReportCriId AND c.CultureId = @CultureId)
	ELSE
		INSERT #hlp (TabIndex, ReportCriId, ColumnHeader) SELECT a.TabIndex, a.ReportCriId, b.ColumnHeader
			FROM dbo.ReportCri a INNER JOIN dbo.ReportCriHlp b ON a.ReportCriId = b.ReportCriId
			WHERE a.ReportId = @ReportId AND b.CultureId = @DefCultureId
			AND NOT EXISTS (SELECT 'true' FROM dbo.ReportCriHlp c WHERE c.ReportCriId = a.ReportCriId AND c.CultureId = @CultureId)
END
IF @GenPrefix = 'Ut'
	SELECT ColumnHeader = isnull(a.ColumnHeader,''), b.ColumnSize, b.RowSize, DisplayName = e.TypeName, DisplayMode = e.TypeDesc, b.RequiredValid, DefaultValue=''
		FROM dbo.#hlp a
		INNER JOIN dbo.UtReportCri b ON a.ReportCriId = b.ReportCriId
		INNER JOIN RODesign.dbo.CtDisplayType e ON b.DisplayModeId = e.TypeId
		ORDER BY a.TabIndex
ELSE
	SELECT ColumnHeader = isnull(a.ColumnHeader,''), b.ColumnSize, b.RowSize, DisplayName = e.TypeName, DisplayMode = e.TypeDesc, b.RequiredValid, b.DefaultValue
		FROM dbo.#hlp a
		INNER JOIN dbo.ReportCri b ON a.ReportCriId = b.ReportCriId
		INNER JOIN RODesign.dbo.CtDisplayType e ON b.DisplayModeId = e.TypeId
		ORDER BY a.TabIndex
DROP TABLE dbo.#hlp
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetRptCriteria') AND type='P')
DROP PROCEDURE dbo.GetRptCriteria
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[GetRptCriteria]
 @GenPrefix		varchar(10)
,@ReportId	Int
,@UsrId		Int
/* WITH ENCRYPTION */
AS
DECLARE	 @LstCnt	int
		,@CriCnt	int
SET NOCOUNT ON
-- Left outer join is needed to include ReportCriId = 0 in the result set.
IF @GenPrefix = 'Ut'
BEGIN
	SELECT @LstCnt = COUNT(1) FROM dbo.UtReportLstCri WHERE UsrId = @UsrId AND ReportId = @ReportId
	SELECT @CriCnt = COUNT(1) FROM dbo.UtReportCri WHERE ReportId = @ReportId
	IF @LstCnt > 0 AND @LstCnt <> @CriCnt DELETE FROM dbo.ReportLstCri WHERE UsrId = @UsrId AND ReportId = @ReportId
	SELECT a.LastCriteria FROM dbo.UtReportLstCri a
		LEFT OUTER JOIN dbo.UtReportCri b ON a.ReportCriId = b.ReportCriId
		WHERE a.UsrId = @UsrId AND a.ReportId = @ReportId ORDER BY b.TabIndex
END
ELSE
BEGIN
	SELECT @LstCnt = COUNT(1) FROM dbo.ReportLstCri WHERE UsrId = @UsrId AND ReportId = @ReportId
	SELECT @CriCnt = COUNT(1) FROM dbo.ReportCri WHERE ReportId = @ReportId
	IF @LstCnt > 0 AND @LstCnt <> @CriCnt DELETE FROM dbo.ReportLstCri WHERE UsrId = @UsrId AND ReportId = @ReportId
	SELECT a.LastCriteria FROM dbo.ReportLstCri a
		LEFT OUTER JOIN dbo.ReportCri b ON a.ReportCriId = b.ReportCriId
		WHERE a.UsrId = @UsrId AND a.ReportId = @ReportId ORDER BY b.TabIndex
END
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetRptHlp') AND type='P')
DROP PROCEDURE dbo.GetRptHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetRptHlp]
 @GenPrefix	varchar(10)
,@ReportId		int
,@CultureId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @DefCultureId	smallint
		,@ProgramName	varchar(50)
		,@ReportTypeCd	char(1)
		,@TemplateName  varchar(100)
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF @GenPrefix = 'Ut'
BEGIN
	SELECT @ProgramName = ProgramName, @ReportTypeCd = ReportTypeCd, @TemplateName=TemplateName FROM dbo.UtReport WHERE ReportId = @ReportId
	IF @@ERROR <> 0 OR @@ROWCOUNT <> 1 BEGIN RAISERROR('{36}',18,2) WITH SETERROR RETURN 1 END
	IF @CultureId <> @DefCultureId AND EXISTS (SELECT 1 FROM dbo.UtReportHlp WHERE ReportId = @ReportId and CultureId = @CultureId)
		SELECT DefaultHlpMsg, ReportTitle, ProgramName = @ProgramName, ReportTypeCd = @ReportTypeCd,TemplateName=@TemplateName
			FROM dbo.UtReportHlp WHERE ReportId = @ReportId and CultureId = @CultureId
	ELSE
		SELECT DefaultHlpMsg, ReportTitle, ProgramName = @ProgramName, ReportTypeCd = @ReportTypeCd,TemplateName=@TemplateName
			FROM dbo.UtReportHlp WHERE ReportId = @ReportId and CultureId = @DefCultureId
END
ELSE
BEGIN
	SELECT @ProgramName = ProgramName, @ReportTypeCd = ReportTypeCd, @TemplateName=TemplateName FROM dbo.Report WHERE ReportId = @ReportId
	IF @@ERROR <> 0 OR @@ROWCOUNT <> 1 BEGIN RAISERROR('{36}',18,2) WITH SETERROR RETURN 1 END
	IF @CultureId <> @DefCultureId AND EXISTS (SELECT 1 FROM dbo.ReportHlp WHERE ReportId = @ReportId and CultureId = @CultureId)
		SELECT DefaultHlpMsg, ReportTitle, ProgramName = @ProgramName, ReportTypeCd = @ReportTypeCd,TemplateName=@TemplateName
			FROM dbo.ReportHlp WHERE ReportId = @ReportId and CultureId = @CultureId
	ELSE
		SELECT DefaultHlpMsg, ReportTitle, ProgramName = @ProgramName, ReportTypeCd = @ReportTypeCd,TemplateName=@TemplateName
			FROM dbo.ReportHlp WHERE ReportId = @ReportId and CultureId = @DefCultureId
END
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetRptWizId') AND type='P')
DROP PROCEDURE dbo.GetRptWizId
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetRptWizId]
 @reportId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
SELECT RptWizId FROM dbo.RptWiz WHERE ReportId = @reportId
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetSchemaScrImp') AND type='P')
DROP PROCEDURE dbo.GetSchemaScrImp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetSchemaScrImp]
 @screenId	int
,@cultureId	smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @ColumnHeader		nvarchar(max)
	,@DataTypeSysName	varchar(50)
	,@DisplayMode		varchar(50)
	,@DisplayName		varchar(50)
	,@ImpNullable		varchar(3)
	,@ColumnIdentity	varchar(3)
	,@DdlColName		varchar(50)
	,@ErrMessage		nvarchar(300)
	,@ScreenTitle		nvarchar(50)
	,@DefCultureId		smallint
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF EXISTS (SELECT 1 FROM dbo.ScreenHlp WHERE ScreenId = @screenId AND CultureId = @cultureId)
	SELECT @ScreenTitle = ScreenTitle FROM dbo.ScreenHlp WHERE ScreenId = @screenId AND CultureId = @cultureId
ELSE
	SELECT @ScreenTitle = ScreenTitle FROM dbo.ScreenHlp WHERE ScreenId = @screenId AND CultureId = @DefCultureId
IF object_id('tempdb.dbo.#buff') is not null DROP TABLE dbo.#buff
CREATE TABLE #buff (tid smallint IDENTITY(1,1) not null, sXml nvarchar(4000) NOT NULL)
INSERT INTO #buff (sXml) VALUES ('<TABLE STYLE=''FONT-SIZE:14pt;FONT-FAMILY:verdana;''>'
+ '<TR><TD><B>Screen Import Schema - ' + isnull(@ScreenTitle,'') + '</B></TD></TR></TABLE><BR>'
+ '<TABLE border=1 cellspacing=0 cellpadding=4 STYLE=''FONT-SIZE:9pt;FONT-FAMILY:verdana;''>'
+ '<THEAD bgcolor=yellow><TD><B>Column Name</B></TD><TD><B>DataType</B></TD><TD><B>Display</B></TD>'
+ '<TD><B>Null</B></TD><TD><B>Ident</B></TD><TD><B>Description</B></TD></THEAD>')
DECLARE objCur CURSOR FOR
	SELECT	 f.ColumnHeader
		,e.DataTypeSysName
		,d.TypeDesc
		,d.TypeName
		,case when b.AllowNulls = 'Y' then 'YES' else 'NO' end
		,case when b.ColumnIdentity = 'Y' then 'YES' else 'NO' end
		,case when x8.TableId is null then x4.ColumnName else x7.ColumnName end
		,case when b.ColumnIdentity = 'Y' then 'Please leave this column empty.' else f.ErrMessage end
	FROM dbo.ScreenObj a
		INNER JOIN dbo.Screen c ON a.ScreenId = c.ScreenId
		INNER JOIN dbo.ScreenObjHlp f ON a.ScreenObjId = f.ScreenObjId
		LEFT OUTER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
		LEFT OUTER JOIN RODesign.dbo.CtDataType e ON b.DataType = e.DataTypeId
		LEFT OUTER JOIN RODesign.dbo.CtDisplayType d ON a.DisplayModeId = d.TypeId
		LEFT OUTER JOIN dbo.DbColumn x4 ON a.DdlRefColumnId = x4.ColumnId
		LEFT OUTER JOIN dbo.ScreenObj x ON a.DdlRefColumnId = x.ColumnId AND a.ScreenId = x.ScreenId
		LEFT OUTER JOIN dbo.DbColumn x7 ON x.DdlKeyColumnId = x7.ColumnId
		LEFT OUTER JOIN dbo.DbTable x8 ON x7.TableId = x8.TableId
	WHERE a.ScreenId = @screenId
	AND f.CultureId = CASE WHEN EXISTS (SELECT 1 FROM dbo.ScreenObjHlp x WHERE x.ScreenObjId = a.ScreenObjId AND CultureId = @cultureId) THEN @cultureId ELSE @DefCultureId END
	AND a.MasterTable = (SELECT CASE WHEN b.ScreenTypeName='I2' THEN 'N' ELSE 'Y' END FROM dbo.Screen a INNER JOIN RODesign.dbo.CtScreenType b ON a.ScreenTypeId = b.ScreenTypeId WHERE a.ScreenId = @screenId)
	ORDER BY a.TabIndex
FOR READ ONLY
OPEN objCur
FETCH NEXT FROM objCur INTO @ColumnHeader, @DataTypeSysName, @DisplayMode, @DisplayName, @ImpNullable, @ColumnIdentity, @DdlColName, @ErrMessage
WHILE @@FETCH_STATUS = 0
BEGIN
	INSERT INTO #buff (sXml) VALUES ('<TR><TD>' + isnull(@ColumnHeader,'') + '</TD><TD>' + isnull(@DataTypeSysName,'')
		+ '</TD><TD>' + isnull(@DisplayMode,'') + '</TD><TD>' + isnull(@ImpNullable,'')
		+ '</TD><TD>' + isnull(@ColumnIdentity,'') + '</TD><TD>' + isnull(@ErrMessage,'&nbsp') + '</TD></TR>')
	IF @DdlColName is not null AND @DisplayName in ('DropDownList','ComboBox','ListBox','RadioButtonList')
		INSERT INTO #buff (sXml) VALUES ('<TR><TD>' + @DdlColName + '</TD><TD>String</TD><TD>TextBox</TD><TD>YES</TD><TD>NO</TD><TD>Description of the previous column - ' + @ColumnHeader + '.</TD></TR>')
	FETCH NEXT FROM objCur INTO @ColumnHeader, @DataTypeSysName, @DisplayMode, @DisplayName, @ImpNullable, @ColumnIdentity, @DdlColName, @ErrMessage
END
CLOSE objCur
DEALLOCATE objCur
INSERT INTO #buff (sXml) VALUES ('</TABLE>')
INSERT INTO #buff (sXml) VALUES ('<BR><SPAN STYLE=''FONT-SIZE:9pt;FONT-FAMILY:verdana;''>Note: Please be aware that the first row is reserved for heading and it should be filled. The non-nullable column of an AutoComplete, DropDownList, ListBox or RadioButtonList can be left empty if the description followed can be matched uniquely by the system. For numeric columns please only use "General", "Percentage" or "Number" format with "-" for negative number. The row is not imported when all non-nullable columns are empty.</SPAN>')
SELECT sXml FROM #buff ORDER BY tid
DROP TABLE dbo.#buff
RETURN 0

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetSchemaWizImp') AND type='P')
DROP PROCEDURE dbo.GetSchemaWizImp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetSchemaWizImp]
 @wizardId	int
,@cultureId	smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @ColumnName		varchar(50)
	,@DataTypeSysName	varchar(50)
	,@ImpNullable		varchar(3)
	,@ColumnIdentity	varchar(3)
	,@ErrMessage		nvarchar(300)
	,@WizardTitle		nvarchar(50)
IF object_id('tempdb.dbo.#buff') is not null DROP TABLE dbo.#buff
CREATE TABLE #buff (tid smallint IDENTITY(1,1) not null, sXml nvarchar(4000) NOT NULL)
SELECT @WizardTitle = WizardTitle FROM dbo.Wizard WHERE WizardId = @wizardId
INSERT INTO #buff (sXml) VALUES ('<TABLE STYLE=''FONT-SIZE:14pt;FONT-FAMILY:verdana;''>'
+ '<TR><TD><B>Batch Import Schema - ' + isnull(@WizardTitle,'') + '</B></TD></TR></TABLE><BR>'
+ '<TABLE border=1 cellspacing=0 cellpadding=4 STYLE=''FONT-SIZE:9pt;FONT-FAMILY:verdana;''>'
+ '<THEAD bgcolor=yellow><TD><B>Column Name</B></TD><TD><B>DataType</B></TD><TD><B>Null</B></TD><TD><B>Ident</B></TD><TD><B>Description</B></TD></THEAD>')
DECLARE objCur CURSOR FOR
	SELECT	 b.ColumnName
		,e.DataTypeSysName
		,case when b.AllowNulls = 'Y' then 'YES' else 'NO' end
		,case when b.ColumnIdentity = 'Y' then 'YES' else 'NO' end
		,a.ColumnDesc
	FROM dbo.WizardObj a
		LEFT OUTER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
		LEFT OUTER JOIN RODesign.dbo.CtDataType e ON b.DataType = e.DataTypeId
	WHERE a.WizardId = @wizardId
	ORDER BY a.TabIndex
FOR READ ONLY
OPEN objCur
FETCH NEXT FROM objCur INTO @ColumnName, @DataTypeSysName, @ImpNullable, @ColumnIdentity, @ErrMessage
WHILE @@FETCH_STATUS = 0
BEGIN
	INSERT INTO #buff (sXml) VALUES ('<TR><TD>' + isnull(@ColumnName,'') + '</TD><TD>' + isnull(@DataTypeSysName,'')
		+ '</TD><TD>' + isnull(@ImpNullable,'') + '</TD><TD>' + isnull(@ColumnIdentity,'') + '</TD><TD>' + isnull(@ErrMessage,'&nbsp') + '</TD></TR>')
	FETCH NEXT FROM objCur INTO @ColumnName, @DataTypeSysName, @ImpNullable, @ColumnIdentity, @ErrMessage
END
CLOSE objCur
DEALLOCATE objCur
INSERT INTO #buff (sXml) VALUES ('</TABLE>')
INSERT INTO #buff (sXml) VALUES ('<BR><SPAN STYLE=''FONT-SIZE:9pt;FONT-FAMILY:verdana;''>Note: Please be aware that the first row is reserved for heading and it should be filled. For numeric columns please only use "General", "Percentage" or "Number" format with "-" for negative number. The row is not imported when all non-nullable columns are empty.</SPAN>')
SELECT sXml FROM #buff ORDER BY tid
DROP TABLE dbo.#buff
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenAud') AND type='P')
DROP PROCEDURE dbo.GetScreenAud
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetScreenAud]
 @screenId		int
,@screenTypeName	char(2)
,@desDatabase		varchar(50)
,@multiDesignDb		char(1)
/* WITH ENCRYPTION */
AS
DECLARE	 	 @spDelSql		varchar(8000)
		,@spAddSql		varchar(8000)
		,@spUpdSql		varchar(8000)
		,@spDdtSql		varchar(8000)
		,@spAdtSql		varchar(8000)
		,@spUdtSql		varchar(8000)
		,@dropSpDelSql		varchar(8000)
		,@dropSpAddSql		varchar(8000)
		,@dropSpUpdSql		varchar(8000)
		,@dropSpDdtSql		varchar(8000)
		,@dropSpAdtSql		varchar(8000)
		,@dropSpUdtSql		varchar(8000)
		,@mstTable		varchar(50)
		,@dtlTable		varchar(50)
		,@othTable		varchar(50)
		,@varName		varchar(100)
		,@pKeyMCol		varchar(50)
		,@pKeyMVar		varchar(100)
		,@pKeyDCol		varchar(50)
		,@pKeyDVar		varchar(100)
		,@whereMClause		varchar(8000)
		,@whereDClause		varchar(8000)
		,@insM1Clause		varchar(8000)
		,@insM2Clause		varchar(8000)
		,@insM3Clause		varchar(8000)
		,@insD1Clause		varchar(8000)
		,@insD2Clause		varchar(8000)
		,@insD3Clause		varchar(8000)
		,@setMClause		varchar(8000)
		,@setDClause		varchar(8000)
		,@masterTable		char(1)
		,@systemValue		nvarchar(1000)
		,@DefAlways			char(1)
		,@tableId		int
		,@tableName		varchar(500)
		,@columnName		varchar(50)
		,@primaryKey		char(1)
		,@columnIdentity	char(1)
		,@columnLength		smallint
		,@dataTypeSqlName	varchar(50)
		,@displayName		varchar(50)
		,@ddlRefColumnId	int
		,@iClause		varchar(2000)
		,@sClause		varchar(2000)
		,@uClause		varchar(2000)
		,@cma			char(1)
		,@qtn			char(1)
		,@dbAppDatabase varchar(50)
		,@numericData	char(1)
		,@logDelete		char(1)
		,@dbDesDatabase varchar(50)
		,@readonlyColumn char(1)		
SET NOCOUNT ON
SELECT @cma = ',', @qtn = '?'
SELECT @mstTable = space(0), @dtlTable = space(0), @whereMClause = space(0), @whereDClause = space(0), @setMClause = space(0), @setDClause = space(0)
, @insM1Clause = space(0), @insM2Clause = space(0), @insM3Clause = space(0), @insD1Clause = space(0), @insD2Clause = space(0), @insD3Clause = space(0)
, @spDelSql = space(0), @spAddSql = space(0), @spUpdSql = space(0), @spDdtSql = space(0), @spAdtSql = space(0), @spUdtSql = space(0)
IF object_id('tempdb.dbo.#rtn') is not null DROP TABLE dbo.#rtn
CREATE TABLE #rtn (tid smallint IDENTITY(1,1) not null, rClause nvarchar(4000) not null)
IF object_id('tempdb.dbo.#mst') is not null DROP TABLE dbo.#mst
CREATE TABLE #mst (tid smallint IDENTITY(1,1) not null, otherTable varchar(50) not null, iClause varchar(2000) null, sClause varchar(2000) null, uClause varchar(2000) null)
IF object_id('tempdb.dbo.#dtl') is not null DROP TABLE dbo.#dtl
CREATE TABLE #dtl (tid smallint IDENTITY(1,1) not null, otherTable varchar(50) not null, iClause varchar(2000) null, sClause varchar(2000) null, uClause varchar(2000) null)
DECLARE objCursor CURSOR FOR SELECT a.MasterTable, a.SystemValue, a.DefAlways, b.TableId
	, CASE WHEN c.MultiDesignDb='N' THEN s.dbAppDatabase+'.dbo.'+c.TableName WHEN @multiDesignDb='N' THEN @desDatabase+'.dbo.'+c.TableName ELSE 'dbo.'+c.TableName END
	, b.ColumnName, b.PrimaryKey, b.ColumnIdentity
	, ColumnLength = CASE WHEN e.DataTypeSqlName = 'NText' THEN 4000 WHEN e.DataTypeSqlName = 'Text' THEN 8000 ELSE b.ColumnLength END
	, DataTypeSqlName = CASE WHEN e.DataTypeSqlName = 'Decimal' THEN 'Float'
				WHEN e.DataTypeSqlName = 'NText' THEN 'NVarChar'
				WHEN e.DataTypeSqlName = 'Text' THEN 'VarChar'
				WHEN e.DataTypeSqlName = 'TinyInt' THEN 'numeric(3,0)'
				WHEN e.DataTypeSqlName = 'SmallInt' THEN 'numeric(5,0)'
				WHEN e.DataTypeSqlName = 'BigInt' THEN 'numeric(19,0)'
				WHEN e.DataTypeSqlName = 'Int' THEN 'numeric(10,0)'
				ELSE e.DataTypeSqlName END
	,d.TypeName ,a.DdlRefColumnId
	,dbAppDatabase
	,NumericData
	,LogDelete = 'Y'
	,s.dbDesDatabase
	,ReadOnlyColumn = CASE WHEN d.TypeDesc='Label' THEN 'Y' ELSE 'N' END
	FROM dbo.ScreenObj a
		LEFT OUTER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
		LEFT OUTER JOIN dbo.DbTable c ON b.TableId = c.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems s ON c.SystemId = s.SystemId
		LEFT OUTER JOIN RODesign.dbo.CtDataType e ON b.DataType = e.DataTypeId
		LEFT OUTER JOIN RODesign.dbo.CtDisplayType d ON a.DisplayModeId = d.TypeId
	WHERE a.ScreenId = @screenId ORDER BY a.MasterTable desc, b.PrimaryKey desc, a.TabIndex
FOR READ ONLY
OPEN objCursor
FETCH NEXT FROM objCursor INTO @masterTable, @systemValue, @DefAlways, @tableId, @tableName, @columnName, @primaryKey, @columnIdentity, @columnLength, @dataTypeSqlName, @displayName, @ddlRefColumnId, @dbAppDatabase, @numericData, @logDelete, @dbDesDatabase, @readonlycolumn
WHILE @@FETCH_STATUS = 0
BEGIN
	IF @primaryKey = 'Y'	/* This is the first row for each master and detail tables and assume one and only one column as primary key and identity */
	BEGIN
		SELECT @varName = '@' + @columnName + CONVERT(VARCHAR(10),@tableId) + space(1) + @dataTypeSqlName
		IF CHARINDEX(lower(@dataTypeSqlName),'binary,varbinary,nchar,nvarchar,char,varchar') > 0 SELECT @varName = @varName + '(' + case when @columnLength > 0 then convert(varchar,@columnLength) else 'max' end + ')'
		IF @masterTable = 'Y'
		BEGIN
			SELECT @pKeyMCol = @columnName, @pKeyMVar =  '@' + @columnName + CONVERT(VARCHAR(10),@tableId)
			SELECT @whereMClause = ' WHERE ' + @columnName + ' = ' + @pKeyMVar
			IF @columnIdentity = 'Y'
			BEGIN
				SELECT @insM3Clause = ' SELECT ' + @pKeyMVar + ' = @@IDENTITY'
			END
			ELSE
			BEGIN
				IF @insM1Clause = space(0) SELECT @insM1Clause = @pKeyMCol ELSE SELECT @insM1Clause = @insM1Clause + @cma + @pKeyMCol
				IF @insM2Clause = space(0) SELECT @insM2Clause = @pKeyMVar ELSE SELECT @insM2Clause = @insM2Clause + @cma + @pKeyMVar
			END
			IF @insD1Clause = space(0) SELECT @insD1Clause = @pKeyMCol ELSE SELECT @insD1Clause = @insD1Clause + @cma + @pKeyMCol
			IF @insD2Clause = space(0) SELECT @insD2Clause = @pKeyMVar ELSE SELECT @insD2Clause = @insD2Clause + @cma + @pKeyMVar
			SELECT @spAddSql = @spAddSql + ' DECLARE ' + @varName +  ' SELECT ' + @pKeyMVar + '=' + @qtn
			SELECT @spDelSql = @spDelSql + ' DECLARE ' + @varName + ', @UsrId int, @CurrDb varchar(50) ' +  ' SELECT ' + @pKeyMVar + '=' + @qtn + ' ,@UsrId = ?, @CurrDb = DB_NAME() ' + CASE WHEN @logDelete = 'N' THEN '' ELSE ' EXEC ' + @dbDesDatabase + '.dbo.LogDelete @UsrId, @CurrDb, ''' + @dbDesDatabase + ''',''' + @dbAppDatabase + ''',''' + @tableName + ''',''' + @whereMClause + ''',' + @pKeyMVar + ',''' +@varName+''',''' + @pKeyMVar + ''',''' + @numericData + '''' END
			SELECT @spUpdSql = @spUpdSql + ' DECLARE ' + @varName +  ' SELECT ' + @pKeyMVar + '=' + @qtn
			SELECT @spAdtSql = @spAdtSql + ' DECLARE ' + @varName +  ' SELECT ' + @pKeyMVar + '=' + @qtn
			SELECT @mstTable = @tableName
		END
		ELSE
		BEGIN
			SELECT @pKeyDCol = @columnName, @pKeyDVar =  '@' + @columnName + CONVERT(VARCHAR(10),@tableId)
			SELECT @whereDClause = ' WHERE ' + @columnName + ' = ' + @pKeyDVar
			IF @columnIdentity = 'Y'
			BEGIN
				SELECT @insD3Clause = ' SELECT ' + @pKeyDVar + ' = @@IDENTITY'
			END
			ELSE
			BEGIN
				IF @insD1Clause = space(0) SELECT @insD1Clause = @pKeyDCol ELSE SELECT @insD1Clause = @insD1Clause + @cma + @pKeyDCol
				IF @insD2Clause = space(0) SELECT @insD2Clause = @pKeyDVar ELSE SELECT @insD2Clause = @insD2Clause + @cma + @pKeyDVar
			END
			SELECT @spAdtSql = @spAdtSql + ' DECLARE ' + @varName +  ' SELECT ' + @pKeyDVar + '=' + @qtn
			SELECT @spDdtSql = @spDdtSql + ' DECLARE ' + @varName + ' ,@UsrId int, @CurrDb varchar(50) ' +  ' SELECT ' + @pKeyDVar + '=' + @qtn + ' ,@UsrId = ?, @CurrDb = DB_NAME() ' + CASE WHEN @logDelete = 'N' THEN '' ELSE ' EXEC ' + @dbDesDatabase + '.dbo.LogDelete @UsrId, @CurrDb, ''' + @dbDesDatabase + ''',''' + @dbAppDatabase + ''',''' + @tableName + ''',''' + @whereDClause + ''',' + @pKeyDVar + ',''' +@varName+''',''' + @pKeyDVar + ''',''' + @numericData + '''' END
			SELECT @spUdtSql = @spUdtSql + ' DECLARE ' + @varName +  ' SELECT ' + @pKeyDVar + '=' + @qtn
			SELECT @dtlTable = @tableName
		END
	END
	ELSE IF @tableId IS NOT NULL AND @displayName not in ('HyperLink','DataGrid') 
		AND NOT (@displayName = 'ImageButton' AND lower(@dataTypeSqlName) = 'varbinary')
		AND @readonlyColumn = 'N'
	BEGIN
		IF @masterTable = 'Y'
		BEGIN
			IF @tableName = @mstTable
			BEGIN
				IF @insM1Clause = space(0) SELECT @insM1Clause = @columnName ELSE SELECT @insM1Clause = @insM1Clause + @cma + @columnName
				IF @systemValue IS NULL OR @systemValue = space(0)
					IF @insM2Clause = space(0) SELECT @insM2Clause = @qtn ELSE SELECT @insM2Clause = @insM2Clause + @cma + @qtn
				ELSE
					IF @insM2Clause = space(0) SELECT @insM2Clause = CASE WHEN @DefAlways <> 'Y' THEN 'COALESCE(' + @qtn + ',' +  @systemValue + ')' ELSE @systemValue END ELSE SELECT @insM2Clause = @insM2Clause + @cma + CASE WHEN @DefAlways <> 'Y' THEN 'COALESCE(' + @qtn + ',' +  @systemValue + ')' ELSE @systemValue END
				IF @systemValue IS NULL OR @systemValue = space(0)
					IF @setMClause = space(0) SELECT @setMClause = @columnName + '=' + @qtn ELSE SELECT @setMClause = @setMClause + @cma + @columnName + '=' + @qtn
				ELSE
					IF @setMClause = space(0) SELECT @setMClause = @columnName + '=' + CASE WHEN @DefAlways <> 'Y' THEN 'COALESCE(' + @qtn + ',' +  @systemValue + ')' ELSE @systemValue END ELSE SELECT @setMClause = @setMClause + @cma + @columnName + '=' + CASE WHEN @DefAlways <> 'Y' THEN 'COALESCE(' + @qtn + ',' +  @systemValue + ')' ELSE @systemValue END
			END
			ELSE IF @displayName IN ('ComboBox','DropDownList','ListBox','RadioButtonList') OR @ddlRefColumnId IS NULL
			BEGIN
				IF @systemValue IS NULL OR @systemValue = space(0) SELECT @sClause = @qtn ELSE SELECT @sClause = + CASE WHEN @DefAlways <> 'Y' THEN 'COALESCE(' + @qtn + ',' +  @systemValue + ')' ELSE @systemValue END
				IF @systemValue IS NULL OR @systemValue = space(0) SELECT @uClause = @columnName + '=' + @qtn 
				ELSE SELECT @uClause = @columnName + '=' + CASE WHEN @DefAlways <> 'Y' THEN 'COALESCE(' + @qtn + ',' +  @systemValue + ')' ELSE @systemValue END
				IF NOT EXISTS (SELECT 'true' FROM #mst WHERE otherTable = @tableName)
					INSERT #mst (otherTable,iClause,sClause,uClause) SELECT @tableName, @pKeyMCol + @cma + @columnName, @pKeyMVar + @cma + @sClause, @uClause
				ELSE
					UPDATE #mst SET iClause = iClause + @cma + @columnName, sClause = sClause + @cma + @sClause,  uClause = uClause + @cma + @uClause
			END
		END
		ELSE
		BEGIN
			IF @tableName = @dtlTable
			BEGIN
				IF @insD1Clause = space(0) SELECT @insD1Clause = @columnName ELSE SELECT @insD1Clause = @insD1Clause + @cma + @columnName
				IF @systemValue IS NULL OR @systemValue = space(0)
					IF @insD2Clause = space(0) SELECT @insD2Clause = @qtn ELSE SELECT @insD2Clause = @insD2Clause + @cma + @qtn
				ELSE
					IF @insD2Clause = space(0) SELECT @insD2Clause = + CASE WHEN @DefAlways <> 'Y' THEN 'COALESCE(' + @qtn + ',' +  @systemValue + ')' ELSE @systemValue END ELSE SELECT @insD2Clause = @insD2Clause + @cma + CASE WHEN @DefAlways <> 'Y' THEN 'COALESCE(' + @qtn + ',' +  @systemValue + ')' ELSE @systemValue END
				IF @systemValue IS NULL OR @systemValue = space(0)
					IF @setDClause = space(0) SELECT @setDClause = @columnName + '=' + @qtn ELSE SELECT @setDClause = @setDClause + @cma + @columnName + '=' + @qtn
				ELSE
					IF @setDClause = space(0) SELECT @setDClause = @columnName + '=' + CASE WHEN @DefAlways <> 'Y' THEN 'COALESCE(' + @qtn + ',' +  @systemValue + ')' ELSE @systemValue END ELSE SELECT @setDClause = @setDClause + @cma + @columnName + '=' + CASE WHEN @DefAlways <> 'Y' THEN 'COALESCE(' + @qtn + ',' +  @systemValue + ')' ELSE @systemValue END
			END
			ELSE IF @displayName IN ('ComboBox','DropDownList','ListBox','RadioButtonList') OR @ddlRefColumnId IS NULL
			BEGIN
				IF @systemValue IS NULL OR @systemValue = space(0) SELECT @sClause = @qtn ELSE SELECT @sClause = CASE WHEN @DefAlways <> 'Y' THEN 'COALESCE(' + @qtn + ',' +  @systemValue + ')' ELSE @systemValue END
				IF @systemValue IS NULL OR @systemValue = space(0) SELECT @uClause = @columnName + '=' + @qtn ELSE SELECT @uClause = @columnName + '=' + CASE WHEN @DefAlways <> 'Y' THEN 'COALESCE(' + @qtn + ',' +  @systemValue + ')' ELSE @systemValue END
				IF NOT EXISTS (SELECT 'true' FROM #dtl WHERE otherTable = @tableName)
					INSERT #dtl (otherTable,iClause,sClause,uClause) SELECT @tableName, @pKeyDCol + @cma + @columnName, @pKeyDVar + @cma + @sClause, @uClause
				ELSE
					UPDATE #dtl SET iClause = iClause + @cma + @columnName, sClause = sClause + @cma + @sClause,  uClause = uClause + @cma + @uClause
			END
		END
	END
	FETCH NEXT FROM objCursor INTO @masterTable, @systemValue, @DefAlways, @tableId, @tableName, @columnName, @primaryKey, @columnIdentity, @columnLength, @dataTypeSqlName, @displayName, @ddlRefColumnId, @dbAppDatabase,@numericData, @logDelete,@dbDesDatabase,@readonlycolumn
END
CLOSE objCursor
DEALLOCATE objCursor
IF @screenTypeName = 'I2'
BEGIN
	SELECT @spDelSql = @spDelSql + ' DELETE ' + @dtlTable + @whereMClause
	DECLARE cur CURSOR FOR SELECT otherTable FROM #dtl ORDER BY tid FOR READ ONLY
	OPEN cur
	FETCH NEXT FROM cur INTO @othTable
	WHILE @@FETCH_STATUS = 0
	BEGIN
		SELECT @spDelSql = @spDelSql + ' DELETE ' + @othTable + @whereMClause

		FETCH NEXT FROM cur INTO @othTable
	END
	CLOSE cur
	DEALLOCATE cur
END
SELECT @spDelSql = @spDelSql + ' DELETE ' + @mstTable + @whereMClause
DECLARE cur CURSOR FOR SELECT otherTable FROM #mst ORDER BY tid FOR READ ONLY
OPEN cur
FETCH NEXT FROM cur INTO @othTable
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @spDelSql = @spDelSql + ' DELETE ' + @othTable + @whereMClause
	FETCH NEXT FROM cur INTO @othTable
END
CLOSE cur
DEALLOCATE cur
IF @spDelSql = space(0)
BEGIN
	DROP TABLE dbo.#rtn
	DROP TABLE dbo.#mst
	DROP TABLE dbo.#dtl
	RAISERROR('Delete master script not generated because of NULL.',18,2) WITH SETERROR
	RETURN 1
END
ELSE INSERT #rtn (rClause) SELECT @spDelSql
IF @insM1Clause <> space(0) AND @insM2Clause <> space(0)
BEGIN
	SELECT @spAddSql = @spAddSql + ' INSERT ' + @mstTable + ' (' + @insM1Clause + ') SELECT ' + @insM2Clause
	IF @insM3Clause <> space(0) SELECT @spAddSql = @spAddSql + @insM3Clause
	DECLARE cur CURSOR FOR SELECT otherTable, iClause, sClause FROM #mst ORDER BY tid FOR READ ONLY
	OPEN cur
	FETCH NEXT FROM cur INTO @othTable, @iClause, @sClause
	WHILE @@FETCH_STATUS = 0
	BEGIN
		IF @iClause <> space(0) AND @sClause <> space(0)
			SELECT @spAddSql = @spAddSql + ' INSERT ' + @othTable + ' (' + @iClause + ') SELECT ' + @sClause
		FETCH NEXT FROM cur INTO @othTable, @iClause, @sClause
	END
	CLOSE cur
	DEALLOCATE cur
END
IF @spAddSql = space(0)
BEGIN
	DROP TABLE dbo.#rtn
	DROP TABLE dbo.#mst
	DROP TABLE dbo.#dtl
	RAISERROR('Add master script not generated because of NULL.',18,2) WITH SETERROR
	RETURN 1
END
/* ELSE INSERT #rtn (rClause) SELECT replace(@spAddSql,'RODesign.','" + Config.AppNameSpace + "Design.') + CHAR(13) + '			+ " SELECT ' + @pKeyMVar + '"' */
ELSE INSERT #rtn (rClause) SELECT @spAddSql + ' SELECT ' + @pKeyMVar
IF @setMClause <> space(0)
BEGIN
	SELECT @spUpdSql = @spUpdSql + ' UPDATE ' + @mstTable + ' SET ' + @setMClause + @whereMClause
	DECLARE cur CURSOR FOR SELECT otherTable, uClause FROM #mst ORDER BY tid FOR READ ONLY
	OPEN cur
	FETCH NEXT FROM cur INTO @othTable, @uClause
	WHILE @@FETCH_STATUS = 0
	BEGIN
		IF @uClause <> space(0) SELECT @spUpdSql = @spUpdSql + ' UPDATE ' + @othTable + ' SET ' + @uClause + @whereMClause
		FETCH NEXT FROM cur INTO @othTable, @uClause
	END
	CLOSE cur
	DEALLOCATE cur
END
IF @spUpdSql = space(0)
BEGIN
	DROP TABLE dbo.#rtn
	DROP TABLE dbo.#mst
	DROP TABLE dbo.#dtl
	RAISERROR('Update master script not generated because of NULL.',18,2) WITH SETERROR
	RETURN 1
END
/* ELSE INSERT #rtn (rClause) SELECT replace(@spUpdSql,'RODesign.','" + Config.AppNameSpace + "Design.') */
ELSE INSERT #rtn (rClause) SELECT @spUpdSql
IF @screenTypeName = 'I2'
BEGIN
	SELECT @spDdtSql = @spDdtSql + ' DELETE ' + @dtlTable + @whereDClause
	DECLARE cur CURSOR FOR SELECT otherTable FROM #dtl ORDER BY tid FOR READ ONLY
	OPEN cur
	FETCH NEXT FROM cur INTO @othTable
	WHILE @@FETCH_STATUS = 0
	BEGIN
		SELECT @spDdtSql = @spDdtSql + ' DELETE ' + @othTable + @whereDClause
		FETCH NEXT FROM cur INTO @othTable
	END
	CLOSE cur
	DEALLOCATE cur
	IF @spDdtSql = space(0)
	BEGIN
		DROP TABLE dbo.#rtn
		DROP TABLE dbo.#mst
		DROP TABLE dbo.#dtl
		RAISERROR('Delete detail script not generated because of NULL.',18,2) WITH SETERROR
		RETURN 1
	END
	/* ELSE INSERT #rtn (rClause) SELECT replace(@spDdtSql,'RODesign.','" + Config.AppNameSpace + "Design.') */
	ELSE INSERT #rtn (rClause) SELECT @spDdtSql
	IF @insD1Clause <> space(0) AND @insD2Clause <> space(0)
	BEGIN
		SELECT @spAdtSql = @spAdtSql + ' INSERT ' + @dtlTable + ' (' + @insD1Clause + ') SELECT ' + @insD2Clause
		IF @insD3Clause <> space(0) SELECT @spAdtSql = @spAdtSql + @insD3Clause
		DECLARE cur CURSOR FOR SELECT otherTable, iClause, sClause FROM #dtl ORDER BY tid FOR READ ONLY
		OPEN cur
		FETCH NEXT FROM cur INTO @othTable, @iClause, @sClause
		WHILE @@FETCH_STATUS = 0
		BEGIN
			IF @iClause <> space(0) AND @sClause <> space(0)
				SELECT @spAdtSql = @spAdtSql + ' INSERT ' + @othTable + ' (' + @iClause + ') SELECT ' + @sClause
			FETCH NEXT FROM cur INTO @othTable, @iClause, @sClause
		END
		CLOSE cur
		DEALLOCATE cur
	END
	IF @spAdtSql = space(0)
	BEGIN
		DROP TABLE dbo.#rtn
		DROP TABLE dbo.#mst
		DROP TABLE dbo.#dtl
		RAISERROR('Add detail script not generated because of NULL.',18,2) WITH SETERROR
		RETURN 1
	END
	/* ELSE INSERT #rtn (rClause) SELECT replace(@spAdtSql,'RODesign.','" + Config.AppNameSpace + "Design.') + CHAR(13) + '			+ " SELECT ' + @pKeyDVar + '"' */
	ELSE INSERT #rtn (rClause) SELECT @spAdtSql + ' SELECT ' + @pKeyDVar
	IF @setDClause <> space(0)
	BEGIN
		SELECT @spUdtSql = @spUdtSql + ' UPDATE ' + @dtlTable + ' SET ' + @setDClause + @whereDClause
		DECLARE cur CURSOR FOR SELECT otherTable, uClause FROM #dtl ORDER BY tid FOR READ ONLY
		OPEN cur
		FETCH NEXT FROM cur INTO @othTable, @uClause
		WHILE @@FETCH_STATUS = 0
		BEGIN
			IF @uClause <> space(0) SELECT @spUdtSql = @spUdtSql + ' UPDATE ' + @othTable + ' SET ' + @uClause + @whereDClause
			FETCH NEXT FROM cur INTO @othTable, @uClause
		END
		CLOSE cur
		DEALLOCATE cur
	END
	IF @spUdtSql = space(0)
	BEGIN
		DROP TABLE dbo.#rtn
		DROP TABLE dbo.#mst
		DROP TABLE dbo.#dtl
		RAISERROR('Update detail script not generated because of NULL.',18,2) WITH SETERROR
		RETURN 1
	END
	/* ELSE INSERT #rtn (rClause) SELECT replace(@spUdtSql,'RODesign.','" + Config.AppNameSpace + "Design.') */
	ELSE INSERT #rtn (rClause) SELECT @spUdtSql
END
SELECT rClause FROM #rtn ORDER BY tid
DROP TABLE dbo.#rtn
DROP TABLE dbo.#mst
DROP TABLE dbo.#dtl
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenById') AND type='P')
DROP PROCEDURE dbo.GetScreenById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[GetScreenById]
 @desDatabase		varchar(50)
,@srcDatabase		varchar(50)
,@screenId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause		varchar(8000)
	,@wClause		varchar(8000)
	,@dClause		varchar(8000)
SET NOCOUNT ON
SELECT @dClause = 'DECLARE @MultiDb char(1) EXEC RODesign.dbo.MultiDesignDb ' + convert(varchar,@screenId) + ', @MultiDb OUTPUT'
IF @srcDatabase <> @desDatabase SELECT @dClause = @dClause + ' SELECT @MultiDb = ''N'''
SELECT @sClause = 'SELECT a.MasterTableId,a.DetailTableId,a.ProgramName,a.GenerateSc,a.GenerateSr,a.DeferError'
+ ',b.SysProgram,b.dbAppDatabase,b.dbDesDatabase,GridRows=ISNULL(a.GridRows,0),a.HasDeleteAll,a.ShowGridHead'
+ ',MultiDesignDb=@MultiDb,c.ScreenTypeName,a.ValidateReq,a.NeedRegen,a.AuthRequired,a.ViewOnly,a.GenAudit'
SELECT @fClause = 'FROM dbo.Screen a'
+ ' INNER JOIN RODesign.dbo.CtScreenType c ON a.ScreenTypeId = c.ScreenTypeId'
+ ' INNER JOIN RODesign.dbo.Systems b ON b.dbDesDatabase = ''' + @srcDatabase + ''''
SELECT @wClause = 'WHERE a.ScreenId = ' + CONVERT(varchar,@screenId)
EXEC (@dClause + ' ' + @sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0


 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenColumns') AND type='P')
DROP PROCEDURE dbo.GetScreenColumns
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[GetScreenColumns]
 @screenId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
-- #mst is added to handle distributed computing:
DECLARE @tableId int, @mstId int, @dtlId int
SELECT @mstId = MasterTableId, @dtlId = isnull(DetailTableId,MasterTableId) FROM dbo.Screen WHERE ScreenId = @screenId
IF object_id('tempdb.dbo.#mst') is not null DROP TABLE dbo.#mst
CREATE TABLE #mst (TableId int not null, TableOrder int not null)
DECLARE TblCur CURSOR FAST_FORWARD FOR SELECT b.TableId FROM dbo.ScreenObj a INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
WHERE a.ScreenId = @screenId ORDER BY a.MasterTable desc, a.TabIndex	/* Do not sort by b.PrimaryKey desc */
FOR READ ONLY OPEN TblCur
FETCH NEXT FROM TblCur INTO @tableId
WHILE @@FETCH_STATUS = 0 BEGIN
IF NOT EXISTS (SELECT 1 FROM #mst WHERE TableId = @tableId)
	INSERT #mst (TableId,TableOrder) SELECT @tableId, isnull(max(TableOrder)+1,1) FROM #mst
FETCH NEXT FROM TblCur INTO @tableId END
CLOSE TblCur DEALLOCATE TblCur

SELECT a.IgnoreConfirm,a.MasterTable,m.TableOrder,a.TabIndex,a.ScreenObjId,g1.RowCssClass,g2.ColCssClass, a.NewGroupRow,a.LabelVertical,a.LabelCss,a.ContentCss
,a.ColumnId,ColName=isnull(b.ColumnName,a.ColumnName),a.ColumnName,ColTblPK=f.ColumnName,a.DefaultValue,a.HyperLinkUrl,a.SystemValue,a.ColumnWrap,a.GridGrpCd,a.HideOnTablet,a.HideOnMobile
,a.ColumnSize,ColumnHeight=CASE WHEN c.TypeName='ListBox' THEN ISNULL(a.ColumnHeight,1) ELSE a.ColumnHeight END, a.ResizeWidth, a.ResizeHeight
,DisplayMode=c.TypeDesc,DisplayName=c.TypeName,ColumnScale=ISNULL(b.ColumnScale,CASE WHEN b.DataType=6 THEN '4' WHEN b.DataType='7' THEN '2' ELSE '0' END),NumericData=ISNULL(d.NumericData,'N'),ColumnJustify=ISNULL(a.ColumnJustify,'L')
,DdlKeySystemId=t0.SystemId,DdlKeyTableId=x0.TableId,DdlKeyTableName=t0.TableName,DdlKeyColumnName=x0.ColumnName,a.DdlKeyColumnId,DdlKeyNumeric=ISNULL(d0.NumericData,'N')
,DdlRefTableId=x3.TableId,a.DdlRefColumnId,DdlRefColLen=x3.ColumnLength,DdlRefColumnName=x3.ColumnName
,DdlRefDisplayName=(SELECT i3.TypeName FROM dbo.ScreenObj s3 INNER JOIN RODesign.dbo.CtDisplayType i3 ON s3.DisplayModeId = i3.TypeId WHERE s3.ScreenId = a.ScreenId AND s3.ColumnId = a.DdlRefColumnId)
,DdlAdnColumnName=x1.ColumnName,DdlFtrColumnName=x2.ColumnName,a.DdlFtrColumnId,DdlFtrTableId=x2.TableId,a.AggregateCd
,a.GenerateSp,a.TabFolderId,a.MaskValid,a.RangeValidType,a.RangeValidMax,a.RangeValidMin,a.ColumnLink,a.RefreshOnCUD
,s.SystemId,s.dbAppDatabase,b.TableId,e.TableName,b.ColumnLength,b.AllowNulls
,a.TrimOnEntry,a.MatchCd,ColumnIdentity=ISNULL(b.ColumnIdentity,'N'),PrimaryKey=ISNULL(b.PrimaryKey,'N'),MultiDesignDb=ISNULL(e.MultiDesignDb,'N')
,DataTypeName = case when d.DataTypeName is null then 'NVarChar' when d.DataTypeName = 'Decimal' then 'Float' else d.DataTypeName end
,DataTypeSqlName = case when d.DataTypeSqlName is null then 'NVarChar' when d.DataTypeSqlName = 'Decimal' then 'Float' else d.DataTypeSqlName end
,DataTypeSysName = ISNULL(d.DataTypeSysName,'String'),DdlAdnDataType = ISNULL(d1.DataTypeSqlName,'VarChar'),DdlFtrDataType = ISNULL(d2.DataTypeSqlName,'VarChar')
,DataTypeSByteOle = ISNULL(d.DataTypeSByteOle,'VarChar'),DataTypeDByteOle = ISNULL(d.DataTypeDByteOle,'VarWChar'),a.RequiredValid
,ColPostBack = CASE WHEN c.TypeName in ('Button','ImageButton') 
	OR EXISTS (SELECT 1 from dbo.ScreenObj aa INNER JOIN RODesign.dbo.CtDisplayType cc ON aa.DisplayModeId = cc.TypeId
	WHERE aa.ScreenId = @screenId AND (
		(a.ColumnId = aa.DdlRefColumnId and cc.TypeName not in ('DropDownList','ListBox','ComboBox','RadioButtonList') and cc.TypeDesc <> 'Currency')
		OR a.ColumnId = aa.DdlFtrColumnId))
	OR EXISTS (SELECT 'true' from dbo.WebRule bb where bb.ScreenObjId is not null AND a.ScreenObjId = bb.ScreenObjId)
	then 'Y' else 'N' end
,PwdOvride = case when exists (select 'true' from dbo.DbColumn aa WHERE aa.TableId = x0.TableId AND aa.ColumnName = 'OvrideId') then 'Y' else 'N' end	
,a.DefAfter, a.DefAlways
FROM dbo.ScreenObj a
LEFT OUTER JOIN RODesign.dbo.GroupRow g1 ON a.GroupRowId = g1.GroupRowId
LEFT OUTER JOIN RODesign.dbo.GroupCol g2 ON a.GroupColId = g2.GroupColId
LEFT OUTER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
LEFT OUTER JOIN dbo.DbTable e ON b.TableId = e.TableId
LEFT OUTER JOIN RODesign.dbo.Systems s ON e.SystemId = s.SystemId
LEFT OUTER JOIN (SELECT TableId,ColumnName FROM DbColumn WHERE PrimaryKey = 'Y') f ON b.TableId = f.TableId
LEFT OUTER JOIN RODesign.dbo.CtDisplayType c ON a.DisplayModeId = c.TypeId
LEFT OUTER JOIN RODesign.dbo.CtDataType d ON b.DataType = d.DataTypeId
LEFT OUTER JOIN dbo.DbColumn x0 ON a.DdlKeyColumnId = x0.ColumnId
LEFT OUTER JOIN dbo.DbTable t0 ON x0.TableId = t0.TableId
LEFT OUTER JOIN RODesign.dbo.CtDataType d0 ON x0.DataType = d0.DataTypeId
LEFT OUTER JOIN dbo.DbColumn x1 ON a.DdlAdnColumnId = x1.ColumnId
LEFT OUTER JOIN dbo.DbColumn x2 ON a.DdlFtrColumnId = x2.ColumnId
LEFT OUTER JOIN dbo.DbColumn x3 ON a.DdlRefColumnId = x3.ColumnId
LEFT OUTER JOIN RODesign.dbo.CtDataType d1 ON x1.DataType = d1.DataTypeId
LEFT OUTER JOIN RODesign.dbo.CtDataType d2 ON x2.DataType = d2.DataTypeId
LEFT OUTER JOIN #mst m ON (case when b.TableId is null then (case when a.MasterTable='Y' then @mstId else @dtlId end) when a.DdlKeyColumnId = a.ColumnId then isnull(x3.TableId,b.TableId) else b.TableId end) = m.TableId
WHERE a.ScreenId = @screenId
ORDER BY a.TabIndex	/* Do not sort by b.PrimaryKey desc; Assuming order by MasterTable DESC, TabFolderOrder, TabIndex from Ir_UpdScreenObjInd */
DROP TABLE dbo.#mst
RETURN 0
 
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenCriDel') AND type='P')
DROP PROCEDURE dbo.GetScreenCriDel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[GetScreenCriDel]
 @screenId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @s1Clause	varchar(8000)
	,@f1Clause	varchar(8000)
	,@w1Clause	varchar(8000)
	,@s2Clause	varchar(8000)
	,@f2Clause	varchar(8000)
	,@w2Clause	varchar(8000)
SET NOCOUNT ON
SELECT @s1Clause = 'SELECT ProcedureName = b.ColumnName + convert(varchar,a.ScreenCriId) + ''In'''
SELECT @f1Clause = 'FROM dbo.ScreenCri a INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId'
SELECT @w1Clause = 'WHERE a.ScreenId = ' + convert(varchar,@screenId) + ' AND a.DdlKeyColumnId is not null'
SELECT @s2Clause = 'SELECT ProcedureName = a.ColumnName + convert(varchar,b.TableId)'
SELECT @f2Clause = 'FROM dbo.ScreenObj a INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId'
SELECT @w2Clause = 'WHERE a.ScreenId = ' + convert(varchar,@screenId) + ' AND a.DdlKeyColumnId is not null'
EXEC (@s1Clause + ' ' + @f1Clause + ' ' + @w1Clause + ' UNION ' + @s2Clause + ' ' + @f2Clause + ' ' + @w2Clause)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenCriHlp') AND type='P')
DROP PROCEDURE dbo.GetScreenCriHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetScreenCriHlp]
 @ScreenId	int
,@CultureId	smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	@DefCultureId	smallint
IF object_id('tempdb.dbo.#hlp') is not null DROP TABLE dbo.#hlp
CREATE TABLE #hlp (tid smallint IDENTITY(1,1) not null, TabIndex smallint not null, ScreenCriId int not null, ColumnHeader nvarchar(50) null)
INSERT #hlp (TabIndex, ScreenCriId, ColumnHeader) SELECT a.TabIndex, a.ScreenCriId, b.ColumnHeader
	FROM dbo.ScreenCri a
	INNER JOIN dbo.ScreenCriHlp b ON a.ScreenCriId = b.ScreenCriId
	WHERE a.ScreenId = @ScreenId AND b.CultureId = @CultureId
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF @CultureId <> @DefCultureId
	INSERT #hlp (TabIndex, ScreenCriId, ColumnHeader) SELECT a.TabIndex, a.ScreenCriId, b.ColumnHeader
		FROM dbo.ScreenCri a
		INNER JOIN dbo.ScreenCriHlp b ON a.ScreenCriId = b.ScreenCriId
		WHERE a.ScreenId = @ScreenId AND b.CultureId = @DefCultureId
		AND NOT EXISTS (SELECT 'true' FROM dbo.ScreenCriHlp c WHERE c.ScreenCriId = a.ScreenCriId AND c.CultureId = @CultureId)
SELECT ColumnHeader = isnull(a.ColumnHeader,''), b.ColumnSize, b.RowSize, DisplayName = e.TypeName, DisplayMode = e.TypeDesc, b.RequiredValid
	FROM dbo.#hlp a
	INNER JOIN dbo.ScreenCri b ON a.ScreenCriId = b.ScreenCriId
	INNER JOIN RODesign.dbo.CtDisplayType e ON b.DisplayModeId = e.TypeId
	ORDER BY a.TabIndex
DROP TABLE dbo.#hlp
RETURN 0
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenCriteria') AND type='P')
DROP PROCEDURE dbo.GetScreenCriteria
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[GetScreenCriteria]
 @screenId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
	,@oClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.ScreenCriId,a.LabelCss,a.ContentCss'
+ ',a.ColumnId,ColumnName = f.ColumnName + convert(varchar,a.TabIndex)'
+ ',a.DdlFtrColumnId, DdlFtrColumnName=rc.ColumnName, DdlFtrDataType=d2.DataTypeSysName, DdlFtrColumnTabIndex=convert(varchar,r.TabIndex)'
+ ',f.TableId,b.ColumnHeader,a.ColumnJustify,a.ColumnSize,RowSize=CASE WHEN c.TypeName=''ListBox'' THEN ISNULL(a.RowSize,1) ELSE a.RowSize END'
+ ',DdlKeyColumnName=x1.ColumnName,DdlRefColumnName=x2.ColumnName'
+ ',MultiDesignDb=ISNULL(y.MultiDesignDb,''Y''),DisplayMode=CASE WHEN c.TypeDesc = ''Date'' AND CHARINDEX(lower(f.ColumnName),''usagedt,inputon,modifiedon'') > 0 THEN ''DateUTC'' ELSE c.TypeDesc END,DisplayName = c.TypeName,NumericData=ISNULL(d.NumericData,''N'')'
+ ',DataTypeSysName = CASE WHEN c.TypeName=''ListBox'' THEN ''String'' ELSE d.DataTypeSysName END'
+ ',DataTypeSByteOle = CASE WHEN c.TypeName=''ListBox'' THEN ''VarChar'' ELSE d.DataTypeSByteOle END'
+ ',DataTypeDByteOle = CASE WHEN c.TypeName=''ListBox'' THEN ''VarWChar'' ELSE d.DataTypeDByteOle END'
+ ',a.RequiredValid'
SELECT @fClause = 'FROM dbo.ScreenCri a'
+ ' INNER JOIN dbo.ScreenCriHlp b ON a.ScreenCriId = b.ScreenCriId'
+ ' INNER JOIN RODesign.dbo.VwCulture e ON b.CultureId = e.CultureId AND e.CultureDefault = ''Y'''
+ ' INNER JOIN dbo.DbColumn f ON a.ColumnId = f.ColumnId'
+ ' INNER JOIN RODesign.dbo.CtDataType d ON f.DataType = d.DataTypeId'
+ ' INNER JOIN RODesign.dbo.CtDisplayType c ON a.DisplayModeId = c.TypeId'
+ ' LEFT OUTER JOIN dbo.DbColumn x1 ON a.DdlKeyColumnId = x1.ColumnId'
+ ' LEFT OUTER JOIN dbo.DbColumn x2 ON a.DdlRefColumnId = x2.ColumnId'
+ ' LEFT OUTER JOIN dbo.DbTable y ON x1.TableId = y.TableId'
+ ' LEFT OUTER JOIN dbo.ScreenCri r ON a.DdlFtrColumnId = r.ScreenCriId'
+ ' LEFT OUTER JOIN dbo.DbColumn rc ON rc.ColumnId = r.ColumnId'
+ ' LEFT OUTER JOIN RODesign.dbo.CtDataType d2 ON rc.DataType = d2.DataTypeId'
SELECT @wClause = 'WHERE a.ScreenId = ' + CONVERT(varchar,@screenId)
SELECT @oClause = 'ORDER BY a.TabIndex'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenCud') AND type='P')
DROP PROCEDURE dbo.GetScreenCud
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetScreenCud]
 @screenId		int
,@screenTypeName	char(2)
,@desDatabase		varchar(50)
,@multiDesignDb		char(1)
/* WITH ENCRYPTION */
AS
/* Obsolete. To be deleted.
DECLARE	 	 @spDelSql		varchar(8000)
		,@spAddSql		varchar(8000)
		,@spUpdSql		varchar(8000)
		,@spDdtSql		varchar(8000)
		,@spAdtSql		varchar(8000)
		,@spUdtSql		varchar(8000)
		,@dropSpDelSql		varchar(8000)
		,@dropSpAddSql		varchar(8000)
		,@dropSpUpdSql		varchar(8000)
		,@dropSpDdtSql		varchar(8000)
		,@dropSpAdtSql		varchar(8000)
		,@dropSpUdtSql		varchar(8000)
		,@mstTable		varchar(50)
		,@dtlTable		varchar(50)
		,@othTable		varchar(50)
		,@varName		varchar(100)
		,@pKeyMCol		varchar(50)
		,@pKeyMVar		varchar(100)
		,@pKeyDCol		varchar(50)
		,@pKeyDVar		varchar(100)
		,@whereMClause		varchar(8000)
		,@whereDClause		varchar(8000)
		,@insM1Clause		varchar(8000)
		,@insM2Clause		varchar(8000)
		,@insM3Clause		varchar(8000)
		,@insD1Clause		varchar(8000)
		,@insD2Clause		varchar(8000)
		,@insD3Clause		varchar(8000)
		,@setMClause		varchar(8000)
		,@setDClause		varchar(8000)
		,@masterTable		char(1)
		,@systemValue		nvarchar(1000)
		,@tableId		int
		,@tableName		varchar(50)
		,@columnName		varchar(50)
		,@primaryKey		char(1)
		,@columnIdentity	char(1)
		,@columnLength		smallint
		,@dataTypeSqlName	varchar(50)
		,@displayName		varchar(50)
		,@ddlRefColumnId	int
		,@iClause		varchar(2000)
		,@sClause		varchar(2000)
		,@uClause		varchar(2000)
		,@cma			char(1)
		,@qtn			char(1)
SET NOCOUNT ON
SELECT @cma = ',', @qtn = '?'
SELECT @mstTable = space(0), @dtlTable = space(0), @whereMClause = space(0), @whereDClause = space(0), @setMClause = space(0), @setDClause = space(0)
, @insM1Clause = space(0), @insM2Clause = space(0), @insM3Clause = space(0), @insD1Clause = space(0), @insD2Clause = space(0), @insD3Clause = space(0)
, @spDelSql = space(0), @spAddSql = space(0), @spUpdSql = space(0), @spDdtSql = space(0), @spAdtSql = space(0), @spUdtSql = space(0)
IF object_id('tempdb.dbo.#rtn') is not null DROP TABLE dbo.#rtn
CREATE TABLE #rtn (tid smallint IDENTITY(1,1) not null, rClause nvarchar(4000) not null)
IF object_id('tempdb.dbo.#mst') is not null DROP TABLE dbo.#mst
CREATE TABLE #mst (tid smallint IDENTITY(1,1) not null, otherTable varchar(50) not null, iClause varchar(2000) null, sClause varchar(2000) null, uClause varchar(2000) null)
IF object_id('tempdb.dbo.#dtl') is not null DROP TABLE dbo.#dtl
CREATE TABLE #dtl (tid smallint IDENTITY(1,1) not null, otherTable varchar(50) not null, iClause varchar(2000) null, sClause varchar(2000) null, uClause varchar(2000) null)
DECLARE objCursor CURSOR FOR SELECT a.MasterTable, a.SystemValue, b.TableId
	, CASE WHEN c.MultiDesignDb='N' THEN s.dbAppDatabase+'.dbo.'+c.TableName WHEN @multiDesignDb='N' THEN @desDatabase+'.dbo.'+c.TableName ELSE 'dbo.'+c.TableName END
	, b.ColumnName, b.PrimaryKey, b.ColumnIdentity
	, ColumnLength = CASE WHEN e.DataTypeSqlName = 'NText' THEN 4000 WHEN e.DataTypeSqlName = 'Text' THEN 8000 ELSE b.ColumnLength END
	, DataTypeSqlName = CASE WHEN e.DataTypeSqlName = 'Decimal' THEN 'Float'
				WHEN e.DataTypeSqlName = 'NText' THEN 'NVarChar'
				WHEN e.DataTypeSqlName = 'Text' THEN 'VarChar'
				WHEN e.DataTypeSqlName = 'TinyInt' THEN 'numeric(3,0)'
				WHEN e.DataTypeSqlName = 'SmallInt' THEN 'numeric(5,0)'
				WHEN e.DataTypeSqlName = 'BigInt' THEN 'numeric(19,0)'
				WHEN e.DataTypeSqlName = 'Int' THEN 'numeric(10,0)'
				ELSE e.DataTypeSqlName END
	,d.TypeName ,a.DdlRefColumnId
	FROM dbo.ScreenObj a
		LEFT OUTER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
		LEFT OUTER JOIN dbo.DbTable c ON b.TableId = c.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems s ON c.SystemId = s.SystemId
		LEFT OUTER JOIN RODesign.dbo.CtDataType e ON b.DataType = e.DataTypeId
		LEFT OUTER JOIN RODesign.dbo.CtDisplayType d ON a.DisplayModeId = d.TypeId
	WHERE a.ScreenId = @screenId ORDER BY a.MasterTable desc, b.PrimaryKey desc, a.TabIndex
FOR READ ONLY
OPEN objCursor
FETCH NEXT FROM objCursor INTO @masterTable, @systemValue, @tableId, @tableName, @columnName, @primaryKey, @columnIdentity, @columnLength, @dataTypeSqlName, @displayName, @ddlRefColumnId
WHILE @@FETCH_STATUS = 0
BEGIN
	IF @primaryKey = 'Y'	/* This is the first row for each master and detail tables and assume one and only one column as primary key and identity */
	BEGIN
		SELECT @varName = '@' + @columnName + CONVERT(VARCHAR(10),@tableId) + space(1) + @dataTypeSqlName
		IF CHARINDEX(lower(@dataTypeSqlName),'binary,varbinary,nchar,nvarchar,char,varchar') > 0 SELECT @varName = @varName + '(' + case when @columnLength > 0 then convert(varchar,@columnLength) else 'max' end + ')'
		IF @masterTable = 'Y'
		BEGIN
			SELECT @pKeyMCol = @columnName, @pKeyMVar =  '@' + @columnName + CONVERT(VARCHAR(10),@tableId)
			SELECT @whereMClause = CHAR(13) + '			+ " WHERE ' + @columnName + ' = ' + @pKeyMVar + '"'
			IF @columnIdentity = 'Y'
			BEGIN
				SELECT @insM3Clause = CHAR(13) + '			+ " SELECT ' + @pKeyMVar + ' = @@IDENTITY"'
			END
			ELSE
			BEGIN
				IF @insM1Clause = space(0) SELECT @insM1Clause = @pKeyMCol ELSE SELECT @insM1Clause = @insM1Clause + @cma + @pKeyMCol
				IF @insM2Clause = space(0) SELECT @insM2Clause = @pKeyMVar ELSE SELECT @insM2Clause = @insM2Clause + @cma + @pKeyMVar
			END
			IF @insD1Clause = space(0) SELECT @insD1Clause = @pKeyMCol ELSE SELECT @insD1Clause = @insD1Clause + @cma + @pKeyMCol
			IF @insD2Clause = space(0) SELECT @insD2Clause = @pKeyMVar ELSE SELECT @insD2Clause = @insD2Clause + @cma + @pKeyMVar
			SELECT @spAddSql = @spAddSql + CHAR(13) + '			+ " DECLARE ' + @varName +  ' SELECT ' + @pKeyMVar + '=' + @qtn + '"'
			SELECT @spDelSql = @spDelSql + CHAR(13) + '			+ " DECLARE ' + @varName +  ' SELECT ' + @pKeyMVar + '=' + @qtn + '"'
			SELECT @spUpdSql = @spUpdSql + CHAR(13) + '			+ " DECLARE ' + @varName +  ' SELECT ' + @pKeyMVar + '=' + @qtn + '"'
			SELECT @spAdtSql = @spAdtSql + CHAR(13) + '			+ " DECLARE ' + @varName +  ' SELECT ' + @pKeyMVar + '=' + @qtn + '"'
			SELECT @mstTable = @tableName
		END
		ELSE
		BEGIN
			SELECT @pKeyDCol = @columnName, @pKeyDVar =  '@' + @columnName + CONVERT(VARCHAR(10),@tableId)
			SELECT @whereDClause = CHAR(13) + '			+ " WHERE ' + @columnName + ' = ' + @pKeyDVar + '"'
			IF @columnIdentity = 'Y'
			BEGIN
				SELECT @insD3Clause = CHAR(13) + '			+ " SELECT ' + @pKeyDVar + ' = @@IDENTITY"'
			END
			ELSE
			BEGIN
				IF @insD1Clause = space(0) SELECT @insD1Clause = @pKeyDCol ELSE SELECT @insD1Clause = @insD1Clause + @cma + @pKeyDCol
				IF @insD2Clause = space(0) SELECT @insD2Clause = @pKeyDVar ELSE SELECT @insD2Clause = @insD2Clause + @cma + @pKeyDVar
			END
			SELECT @spAdtSql = @spAdtSql + CHAR(13) + '			+ " DECLARE ' + @varName +  ' SELECT ' + @pKeyDVar + '=' + @qtn + '"'
			SELECT @spDdtSql = @spDdtSql + CHAR(13) + '			+ " DECLARE ' + @varName +  ' SELECT ' + @pKeyDVar + '=' + @qtn + '"'
			SELECT @spUdtSql = @spUdtSql + CHAR(13) + '			+ " DECLARE ' + @varName +  ' SELECT ' + @pKeyDVar + '=' + @qtn + '"'
			SELECT @dtlTable = @tableName
		END
	END
	ELSE IF @tableId IS NOT NULL AND (@masterTable = 'N' OR @screenTypeName = 'I3' OR @displayName not in ('HyperLink','DataGrid'))
	BEGIN
		IF @masterTable = 'Y'
		BEGIN
			IF @tableName = @mstTable
			BEGIN
				IF @insM1Clause = space(0) SELECT @insM1Clause = @columnName ELSE SELECT @insM1Clause = @insM1Clause + @cma + @columnName
				IF @systemValue IS NULL OR @systemValue = space(0)
					IF @insM2Clause = space(0) SELECT @insM2Clause = @qtn ELSE SELECT @insM2Clause = @insM2Clause + @cma + @qtn
				ELSE
					IF @insM2Clause = space(0) SELECT @insM2Clause = @systemValue ELSE SELECT @insM2Clause = @insM2Clause + @cma + @systemValue
				IF @systemValue IS NULL OR @systemValue = space(0)
					IF @setMClause = space(0) SELECT @setMClause = @columnName + '=' + @qtn ELSE SELECT @setMClause = @setMClause + @cma + @columnName + '=' + @qtn
				ELSE
					IF @setMClause = space(0) SELECT @setMClause = @columnName + '=' + @systemValue ELSE SELECT @setMClause = @setMClause + @cma + @columnName + '=' + @systemValue
			END
			ELSE IF @displayName IN ('ComboBox','DropDownList','ListBox','RadioButtonList') OR @ddlRefColumnId IS NULL
			BEGIN
				IF @systemValue IS NULL OR @systemValue = space(0) SELECT @sClause = @qtn ELSE SELECT @sClause = @systemValue
				IF @systemValue IS NULL OR @systemValue = space(0) SELECT @uClause = @columnName + '=' + @qtn ELSE SELECT @uClause = @columnName + '=' + @systemValue
				IF NOT EXISTS (SELECT 'true' FROM #mst WHERE otherTable = @tableName)
					INSERT #mst (otherTable,iClause,sClause,uClause) SELECT @tableName, @pKeyMCol + @cma + @columnName, @pKeyMVar + @cma + @sClause, @uClause
				ELSE
					UPDATE #mst SET iClause = iClause + @cma + @columnName, sClause = sClause + @cma + @sClause,  uClause = uClause + @cma + @uClause
			END
		END
		ELSE
		BEGIN
			IF @tableName = @dtlTable
			BEGIN
				IF @insD1Clause = space(0) SELECT @insD1Clause = @columnName ELSE SELECT @insD1Clause = @insD1Clause + @cma + @columnName
				IF @systemValue IS NULL OR @systemValue = space(0)
					IF @insD2Clause = space(0) SELECT @insD2Clause = @qtn ELSE SELECT @insD2Clause = @insD2Clause + @cma + @qtn
				ELSE
					IF @insD2Clause = space(0) SELECT @insD2Clause = @systemValue ELSE SELECT @insD2Clause = @insD2Clause + @cma + @systemValue
				IF @systemValue IS NULL OR @systemValue = space(0)
					IF @setDClause = space(0) SELECT @setDClause = @columnName + '=' + @qtn ELSE SELECT @setDClause = @setDClause + @cma + @columnName + '=' + @qtn
				ELSE
					IF @setDClause = space(0) SELECT @setDClause = @columnName + '=' + @systemValue ELSE SELECT @setDClause = @setDClause + @cma + @columnName + '=' + @systemValue
			END
			ELSE IF @displayName IN ('ComboBox','DropDownList','ListBox','RadioButtonList') OR @ddlRefColumnId IS NULL
			BEGIN
				IF @systemValue IS NULL OR @systemValue = space(0) SELECT @sClause = @qtn ELSE SELECT @sClause = @systemValue
				IF @systemValue IS NULL OR @systemValue = space(0) SELECT @uClause = @columnName + '=' + @qtn ELSE SELECT @uClause = @columnName + '=' + @systemValue
				IF NOT EXISTS (SELECT 'true' FROM #dtl WHERE otherTable = @tableName)
					INSERT #dtl (otherTable,iClause,sClause,uClause) SELECT @tableName, @pKeyDCol + @cma + @columnName, @pKeyDVar + @cma + @sClause, @uClause
				ELSE
					UPDATE #dtl SET iClause = iClause + @cma + @columnName, sClause = sClause + @cma + @sClause,  uClause = uClause + @cma + @uClause
			END
		END
	END
	FETCH NEXT FROM objCursor INTO @masterTable, @systemValue, @tableId, @tableName, @columnName, @primaryKey, @columnIdentity, @columnLength, @dataTypeSqlName, @displayName, @ddlRefColumnId
END
CLOSE objCursor
DEALLOCATE objCursor
IF @screenTypeName = 'I2'
BEGIN
	SELECT @spDelSql = @spDelSql + CHAR(13) + '			+ " DELETE ' + @dtlTable + '"' + @whereMClause
	DECLARE cur CURSOR FOR SELECT otherTable FROM #dtl ORDER BY tid FOR READ ONLY
	OPEN cur
	FETCH NEXT FROM cur INTO @othTable
	WHILE @@FETCH_STATUS = 0
	BEGIN
		SELECT @spDelSql = @spDelSql + CHAR(13) + '			+ " DELETE ' + @othTable + '"' + @whereMClause

		FETCH NEXT FROM cur INTO @othTable
	END
	CLOSE cur
	DEALLOCATE cur
END
SELECT @spDelSql = @spDelSql + CHAR(13) + '			+ " DELETE ' + @mstTable + '"' + @whereMClause
DECLARE cur CURSOR FOR SELECT otherTable FROM #mst ORDER BY tid FOR READ ONLY
OPEN cur
FETCH NEXT FROM cur INTO @othTable
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @spDelSql = @spDelSql + CHAR(13) + '			+ " DELETE ' + @othTable + '"' + @whereMClause
	FETCH NEXT FROM cur INTO @othTable
END
CLOSE cur
DEALLOCATE cur
IF @spDelSql = space(0)
BEGIN
	DROP TABLE dbo.#rtn
	DROP TABLE dbo.#mst
	DROP TABLE dbo.#dtl
	RAISERROR('Delete master script not generated because of NULL.',18,2) WITH SETERROR
	RETURN 1
END
ELSE INSERT #rtn (rClause) SELECT replace(@spDelSql,'RODesign.','" + Config.AppNameSpace + "Design.')
IF @insM1Clause <> space(0) AND @insM2Clause <> space(0)
BEGIN
	SELECT @spAddSql = @spAddSql + CHAR(13) + '			+ " INSERT ' + @mstTable + ' (' + @insM1Clause + ')"'
	+ CHAR(13) + '			+ " SELECT ' + @insM2Clause + '"'
	IF @insM3Clause <> space(0) SELECT @spAddSql = @spAddSql + @insM3Clause
	DECLARE cur CURSOR FOR SELECT otherTable, iClause, sClause FROM #mst ORDER BY tid FOR READ ONLY
	OPEN cur
	FETCH NEXT FROM cur INTO @othTable, @iClause, @sClause
	WHILE @@FETCH_STATUS = 0
	BEGIN
		IF @iClause <> space(0) AND @sClause <> space(0)
			SELECT @spAddSql = @spAddSql + CHAR(13) + '			+ " INSERT ' + @othTable + ' (' + @iClause + ')"'
			+ CHAR(13) + '			+ " SELECT ' + @sClause + '"'
		FETCH NEXT FROM cur INTO @othTable, @iClause, @sClause
	END
	CLOSE cur
	DEALLOCATE cur
END
IF @spAddSql = space(0)
BEGIN
	DROP TABLE dbo.#rtn
	DROP TABLE dbo.#mst
	DROP TABLE dbo.#dtl
	RAISERROR('Add master script not generated because of NULL.',18,2) WITH SETERROR
	RETURN 1
END
ELSE INSERT #rtn (rClause) SELECT replace(@spAddSql,'RODesign.','" + Config.AppNameSpace + "Design.') + CHAR(13) + '			+ " SELECT ' + @pKeyMVar + '"'
IF @setMClause <> space(0)
BEGIN
	SELECT @spUpdSql = @spUpdSql + CHAR(13) + '			+ " UPDATE ' + @mstTable + ' SET ' + @setMClause + '"' + @whereMClause
	DECLARE cur CURSOR FOR SELECT otherTable, uClause FROM #mst ORDER BY tid FOR READ ONLY
	OPEN cur
	FETCH NEXT FROM cur INTO @othTable, @uClause
	WHILE @@FETCH_STATUS = 0
	BEGIN
		IF @uClause <> space(0) SELECT @spUpdSql = @spUpdSql + CHAR(13) + '			+ " UPDATE ' + @othTable + ' SET ' + @uClause + '"' + @whereMClause
		FETCH NEXT FROM cur INTO @othTable, @uClause
	END
	CLOSE cur
	DEALLOCATE cur
END
IF @spUpdSql = space(0)
BEGIN
	DROP TABLE dbo.#rtn
	DROP TABLE dbo.#mst
	DROP TABLE dbo.#dtl
	RAISERROR('Update master script not generated because of NULL.',18,2) WITH SETERROR
	RETURN 1
END
ELSE INSERT #rtn (rClause) SELECT replace(@spUpdSql,'RODesign.','" + Config.AppNameSpace + "Design.')
IF @screenTypeName = 'I2'
BEGIN
	SELECT @spDdtSql = @spDdtSql + CHAR(13) + '			+ " DELETE ' + @dtlTable + '"' + @whereDClause
	DECLARE cur CURSOR FOR SELECT otherTable FROM #dtl ORDER BY tid FOR READ ONLY
	OPEN cur
	FETCH NEXT FROM cur INTO @othTable
	WHILE @@FETCH_STATUS = 0
	BEGIN
		SELECT @spDdtSql = @spDdtSql + CHAR(13) + '			+ " DELETE ' + @othTable + '"' + @whereDClause
		FETCH NEXT FROM cur INTO @othTable
	END
	CLOSE cur
	DEALLOCATE cur
	IF @spDdtSql = space(0)
	BEGIN
		DROP TABLE dbo.#rtn
		DROP TABLE dbo.#mst
		DROP TABLE dbo.#dtl
		RAISERROR('Delete detail script not generated because of NULL.',18,2) WITH SETERROR
		RETURN 1
	END
	ELSE INSERT #rtn (rClause) SELECT replace(@spDdtSql,'RODesign.','" + Config.AppNameSpace + "Design.')
	IF @insD1Clause <> space(0) AND @insD2Clause <> space(0)
	BEGIN
		SELECT @spAdtSql = @spAdtSql + CHAR(13) + '			+ " INSERT ' + @dtlTable + ' (' + @insD1Clause + ')"'
		+ CHAR(13) + '			+ " SELECT ' + @insD2Clause + '"'
		IF @insD3Clause <> space(0) SELECT @spAdtSql = @spAdtSql + @insD3Clause
		DECLARE cur CURSOR FOR SELECT otherTable, iClause, sClause FROM #dtl ORDER BY tid FOR READ ONLY
		OPEN cur
		FETCH NEXT FROM cur INTO @othTable, @iClause, @sClause
		WHILE @@FETCH_STATUS = 0
		BEGIN
			IF @iClause <> space(0) AND @sClause <> space(0)
				SELECT @spAdtSql = @spAdtSql + CHAR(13) + '			+ " INSERT ' + @othTable + ' (' + @iClause + ')"'
				+ CHAR(13) + '			+ " SELECT ' + @sClause + '"'
			FETCH NEXT FROM cur INTO @othTable, @iClause, @sClause
		END
		CLOSE cur
		DEALLOCATE cur
	END
	IF @spAdtSql = space(0)
	BEGIN
		DROP TABLE dbo.#rtn
		DROP TABLE dbo.#mst
		DROP TABLE dbo.#dtl
		RAISERROR('Add detail script not generated because of NULL.',18,2) WITH SETERROR
		RETURN 1
	END
	ELSE INSERT #rtn (rClause) SELECT replace(@spAdtSql,'RODesign.','" + Config.AppNameSpace + "Design.') + CHAR(13) + '			+ " SELECT ' + @pKeyDVar + '"'
	IF @setDClause <> space(0)
	BEGIN
		SELECT @spUdtSql = @spUdtSql + CHAR(13) + '			+ " UPDATE ' + @dtlTable + ' SET ' + @setDClause + '"' + @whereDClause
		DECLARE cur CURSOR FOR SELECT otherTable, uClause FROM #dtl ORDER BY tid FOR READ ONLY
		OPEN cur
		FETCH NEXT FROM cur INTO @othTable, @uClause
		WHILE @@FETCH_STATUS = 0
		BEGIN
			IF @uClause <> space(0) SELECT @spUdtSql = @spUdtSql + CHAR(13) + '			+ " UPDATE ' + @othTable + ' SET ' + @uClause + '"' + @whereDClause
			FETCH NEXT FROM cur INTO @othTable, @uClause
		END
		CLOSE cur
		DEALLOCATE cur
	END
	IF @spUdtSql = space(0)
	BEGIN
		DROP TABLE dbo.#rtn
		DROP TABLE dbo.#mst
		DROP TABLE dbo.#dtl
		RAISERROR('Update detail script not generated because of NULL.',18,2) WITH SETERROR
		RETURN 1
	END
	ELSE INSERT #rtn (rClause) SELECT replace(@spUdtSql,'RODesign.','" + Config.AppNameSpace + "Design.')
END
SELECT rClause FROM #rtn ORDER BY tid
DROP TABLE dbo.#rtn
DROP TABLE dbo.#mst
DROP TABLE dbo.#dtl
*/
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenDel') AND type='P')
DROP PROCEDURE dbo.GetScreenDel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetScreenDel]
 @srcDatabase		varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.ScreenId, a.ProgramName, a.MultiDesignDb, b.dbAppDatabase, b.SysProgram'
SELECT @fClause = 'FROM dbo.ScreenDel a'
SELECT @fClause = @fClause + ' INNER JOIN RODesign.dbo.Systems b ON b.dbDesDatabase = ''' + @srcDatabase + ''''
EXEC (@sClause + ' ' + @fClause)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenFilter') AND type='P')
DROP PROCEDURE dbo.GetScreenFilter
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetScreenFilter]
@ScreenId	int,
@CultureId	smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	@DefCultureId	smallint
IF object_id('tempdb.dbo.#hlp') is not null DROP TABLE dbo.#hlp
CREATE TABLE #hlp (tid smallint IDENTITY(1,1) not null, ScreenFilterId int not null, FilterName nvarchar(50) not null)
INSERT #hlp (ScreenFilterId, FilterName) SELECT ScreenFilterId, FilterName FROM dbo.ScreenFilterHlp WHERE CultureId = @CultureId
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF @CultureId <> @DefCultureId
	INSERT #hlp (ScreenFilterId, FilterName) SELECT a.ScreenFilterId, a.FilterName FROM dbo.ScreenFilterHlp a WHERE a.CultureId = @DefCultureId
	AND NOT EXISTS (SELECT 'true' FROM dbo.ScreenFilterHlp b WHERE a.ScreenFilterId = b.ScreenFilterId AND b.CultureId = @CultureId)
SELECT a.ScreenFilterId, b.FilterName
	FROM dbo.ScreenFilter a
	INNER JOIN #hlp b ON a.ScreenFilterId = b.ScreenFilterId
	WHERE a.ScreenId = @screenId ORDER BY a.FilterOrder
DROP TABLE dbo.#hlp
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenHlp') AND type='P')
DROP PROCEDURE dbo.GetScreenHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[GetScreenHlp]
 @ScreenId	int
,@CultureId	smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	@DefCultureId smallint
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF @CultureId <> @DefCultureId AND EXISTS (SELECT 'true' FROM dbo.ScreenHlp WHERE ScreenId = @ScreenId and CultureId = @CultureId)
	SELECT DefaultHlpMsg, FootNote, ScreenTitle, AddMsg, UpdMsg, DelMsg, MasterLstTitle, MasterLstSubtitle, MasterRecTitle, MasterRecSubtitle, DetailLstTitle, DetailLstSubtitle, DetailRecTitle, DetailRecSubtitle, NoMasterMsg, NoDetailMsg, AddMasterMsg, AddDetailMsg, MasterFoundMsg, DetailFoundMsg, IncrementMsg
		FROM dbo.ScreenHlp WHERE ScreenId = @ScreenId and CultureId = @CultureId
ELSE
	SELECT DefaultHlpMsg, FootNote, ScreenTitle, AddMsg, UpdMsg, DelMsg, MasterLstTitle, MasterLstSubtitle, MasterRecTitle, MasterRecSubtitle, DetailLstTitle, DetailLstSubtitle, DetailRecTitle, DetailRecSubtitle, NoMasterMsg, NoDetailMsg, AddMasterMsg, AddDetailMsg, MasterFoundMsg, DetailFoundMsg, IncrementMsg
		FROM dbo.ScreenHlp WHERE ScreenId = @ScreenId and CultureId = @DefCultureId
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenLabel') AND type='P')
DROP PROCEDURE dbo.GetScreenLabel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[GetScreenLabel]
 @ScreenId		int
,@CultureId		smallint
,@Usrs			varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors	varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId	int
,@currProjectId	int
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId	smallint
		,@ScreenObjId	int
		,@PermKeyDesc	varchar(50)
		,@PermId		int
		,@ColumnHeader	nvarchar(max)
		,@ToolTip		nvarchar(200)
		,@ErrMessage	nvarchar(200)
		,@upd			char(1)
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF object_id('tempdb.dbo.#hlp') is not null DROP TABLE dbo.#hlp
CREATE TABLE #hlp (tid smallint IDENTITY(1,1) not null, ScreenObjId int not null, ColumnHeader nvarchar(max) null, ToolTip nvarchar(1000) null, ErrMessage nvarchar(1000) null, TbHint nvarchar(1000))
INSERT #hlp (ScreenObjId, ColumnHeader, ToolTip, ErrMessage, TbHint)
	SELECT b.ScreenObjId, isnull(h2.ColumnHeader,h1.ColumnHeader), isnull(h2.ToolTip,h1.ToolTip), isnull(h2.ErrMessage,h1.ErrMessage), isnull(h2.TbHint,h1.TbHint)
	FROM dbo.ScreenObj b
	INNER JOIN dbo.ScreenObjHlp h1 ON b.ScreenObjId = h1.ScreenObjId AND h1.CultureId = @DefCultureId
	LEFT OUTER JOIN dbo.ScreenObjHlp h2 ON b.ScreenObjId = h2.ScreenObjId AND h2.CultureId = @CultureId
	WHERE b.ScreenId = @ScreenId

DECLARE cur1 CURSOR FAST_FORWARD FOR
	SELECT a.ScreenObjId, b.PermKeyDesc, a.PermId, a.ColumnHeader, a.ToolTip, a.ErrMessage
	FROM dbo.ColOvrd a LEFT OUTER JOIN RODesign.dbo.VwPermKey b ON a.PermKeyId = b.PermKeyId
	WHERE a.ScreenId = @ScreenId
	ORDER BY a.ScreenObjId, a.Priority DESC
FOR READ ONLY
OPEN cur1 FETCH NEXT FROM cur1 INTO @ScreenObjId, @PermKeyDesc, @PermId, @ColumnHeader, @ToolTip, @ErrMessage
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @upd = 'N'
	IF @PermKeyDesc is null SELECT @upd = 'Y'
	ELSE IF @PermKeyDesc = 'UsrGroup'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@UsrGroups+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Company'
		BEGIN  IF @PermId = @currCompanyId OR charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Companys+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Project'
		BEGIN  IF @PermId = @currProjectId OR charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Projects+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Culture'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Cultures+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Usr'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Usrs+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Customer'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Customers+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Vendor'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Vendors+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Member'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Members+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Investor'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Investors+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Agent'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Agents+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Broker'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Brokers+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Borrower'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Borrowers+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Guarantor'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Guarantors+nchar(191)) > 0 SELECT @upd = 'Y' END
	ELSE IF @PermKeyDesc = 'Lender'
		BEGIN  IF charindex(nchar(191)+convert(varchar,@PermId)+nchar(191), nchar(191)+@Lenders+nchar(191)) > 0 SELECT @upd = 'Y' END
	IF @upd = 'Y' UPDATE #hlp SET ColumnHeader = isnull(@ColumnHeader,ColumnHeader)
			, ToolTip = isnull(@ToolTip,ToolTip), ErrMessage = isnull(@ErrMessage,ErrMessage)
		WHERE ScreenObjId = @ScreenObjId
	FETCH NEXT FROM cur1 INTO @ScreenObjId, @PermKeyDesc, @PermId, @ColumnHeader, @ToolTip, @ErrMessage
END
CLOSE cur1 DEALLOCATE cur1

SELECT ColumnHeader = isnull(a.ColumnHeader,''), b.ResizeWidth, b.ResizeHeight
	, b.ColumnSize, ColumnHeight=CASE WHEN e.TypeName='ListBox' THEN ISNULL(b.ColumnHeight,1) ELSE b.ColumnHeight END
	, b.ColumnJustify, a.ToolTip, a.ErrMessage, a.tbHint, b.RequiredValid, b.MaskValid, b.RangeValidType, c.TableId
	, b.ColumnName, DisplayMode = e.TypeDesc, DisplayName = e.TypeName, b.IgnoreConfirm, b.GridGrpCd
	, c.ColumnLength, c.DataType, b.DtlLstPosId
	FROM #hlp a
	INNER JOIN dbo.ScreenObj b ON a.ScreenObjId = b.ScreenObjId
	INNER JOIN RODesign.dbo.CtDisplayType e ON b.DisplayModeId = e.TypeId
	LEFT OUTER JOIN dbo.DbColumn c ON b.ColumnId = c.ColumnId
	ORDER BY b.TabIndex
DROP TABLE dbo.#hlp
RETURN 0



 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenLis1Proc') AND type='P')
DROP PROCEDURE dbo.GetScreenLis1Proc
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO



CREATE PROCEDURE [dbo].[GetScreenLis1Proc]
 @procedureName		varchar(200)
,@criClause			varchar(4000)
,@paramCriSql		varchar(4000)
,@param1Sql			varchar(4000)
,@declare1Sql		varchar(4000)
,@select1Clause		varchar(max)
,@fromClause		varchar(max)
,@orderClause		varchar(max)
,@allClause			varchar(max)
,@selfClause		varchar(max)
,@screenId			int
,@tableAbbrM		varchar(10)
,@sysDatabase		varchar(50)
,@desDatabase		varchar(50)
,@procedureSql1		varchar(max) OUTPUT
,@procedureSql2		varchar(max) OUTPUT
,@procedureSql3		varchar(max) OUTPUT
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
SELECT @procedureSql1 = 'CREATE PROCEDURE ' + @procedureName + CHAR(13) + ' @useGlobalFilter' + CHAR(9) + 'char(1)' + CHAR(13)
+ ',@screenId' + CHAR(9) + CHAR(9) + 'int' + CHAR(13)
+ ',@Usrs' + CHAR(9) + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@RowAuthoritys' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Customers' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Vendors' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Members' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Investors' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Agents' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Brokers' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@UsrGroups' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Companys' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Projects' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Cultures' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Borrowers' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Guarantors' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Lenders' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Key' + CHAR(9) + CHAR(9) + 'nvarchar(500)' + CHAR(13)
+ ',@FilterTxt' + CHAR(9) + CHAR(9) + 'nvarchar(500)' + CHAR(13)
+ @paramCriSql
+ ',@screenFilterId' + CHAR(9) + 'int' + CHAR(13)
+ ',@currCompanyId' + CHAR(9) + 'int' + CHAR(13)
+ ',@currProjectId' + CHAR(9) + 'int' + CHAR(13)
+ ',@topN' + CHAR(9) + 'smallint = null' + CHAR(13)
+ '/* WITH ENCRYPTION */' + CHAR(13)
+ 'AS' + CHAR(13) + 'SET NOCOUNT ON' + CHAR(13) + 'DECLARE'
+ CHAR(9) + ' @sClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@fClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@wClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@oClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@filterClause' + CHAR(9) + CHAR(9) + 'nvarchar(2000)' + CHAR(13)
+ CHAR(9) + ',@bUsr' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@UsrId' + CHAR(9) + CHAR(9) + CHAR(9) + 'int' + CHAR(13)
+ CHAR(9) + ',@tClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@cc' + CHAR(9) + CHAR(9) + 'varchar(max)' + CHAR(13)
+ CHAR(9) + ',@rr' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ CHAR(9) + ',@pp' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ CHAR(9) + ',@SelUsr' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelUsrGroup' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelCulture' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelCompany' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelAgent' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelBroker' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelCustomer' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelInvestor' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelMember' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelVendor' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelLender' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelBorrower' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelGuarantor' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelProject' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@RowAuthorityId' + CHAR(9) + 'smallint' + CHAR(13) + @declare1Sql
-- @sClause comes after @fClause for GetExp to work properly:
-- Use DISTINCT to avoid duplicate arising from impersonation:
SELECT @procedureSql1 = @procedureSql1 + 'SELECT @fClause=''''FROM ' + @fromClause + '''''' + CHAR(13)
+ 'SELECT @sClause=''''SELECT DISTINCT '''' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '''''''' ELSE '''' TOP '''' + CONVERT(varchar(10),@topN) END + '''' '  + @select1Clause + '''''' + CHAR(13)
IF @orderClause <> ''
	SELECT @procedureSql1 = @procedureSql1 + 'SELECT @oClause=''''ORDER BY ' + @orderClause + '''''' + CHAR(13)
ELSE
	SELECT @procedureSql1 = @procedureSql1 + 'SELECT @oClause=''''''''' + CHAR(13)
SELECT @procedureSql1 = @procedureSql1 + 'SELECT @wClause=''''WHERE 1=1'''', @bUsr=''''Y''''' + CHAR(13)
SELECT @procedureSql2 = 'SELECT @pp = @Usrs' + CHAR(13)
+ 'WHILE @pp <> '''''''' AND datalength(@pp) > 0' + CHAR(13)
+ 'BEGIN' + CHAR(13)
+ CHAR(9) + 'EXEC ' + @desDatabase + '.dbo.Pop1Int @pp OUTPUT,@UsrId OUTPUT' + CHAR(13)
+ CHAR(9) + 'IF @bUsr=''''Y''''' + CHAR(13)
+ CHAR(9) + 'BEGIN' + CHAR(13)
+ CHAR(9) + CHAR(9) + 'SELECT @bUsr=''''N''''' + CHAR(13)
+ CHAR(9) + CHAR(9) + 'SELECT @filterClause=rtrim(FilterClause) FROM '
+ @sysDatabase + '.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst=''''Y''''' + CHAR(13)
+ CHAR(9) + CHAR(9) + 'IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + '''' AND '''' + @filterClause' + CHAR(13)
+ CHAR(9) + CHAR(9) + 'IF @useGlobalFilter=''''Y''''' + CHAR(13)
+ CHAR(9) + CHAR(9) + 'BEGIN' + CHAR(13)
+ CHAR(9) + CHAR(9) + CHAR(9) + 'SELECT @filterClause=rtrim(FilterClause) FROM '
+ @sysDatabase + '.dbo.GlobalFilter WHERE UsrId=@UsrId AND ScreenId=@screenId' + CHAR(13)
+ CHAR(9) + CHAR(9) + CHAR(9) + 'IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + '''' '''' + replace(@filterClause,''''~~.'''','''''
+ @tableAbbrM + '.'''')' + CHAR(13)
+ CHAR(9) + CHAR(9) + CHAR(9) + 'ELSE' + CHAR(13)
+ CHAR(9) + CHAR(9) + CHAR(9) + 'BEGIN' + CHAR(13)
+ CHAR(9) + CHAR(9) + CHAR(9) + CHAR(9) + 'SELECT @filterClause=rtrim(FilterClause) FROM '
+ @sysDatabase + '.dbo.GlobalFilter WHERE UsrId=@UsrId AND FilterDefault=''''Y''''' + CHAR(13)
+ CHAR(9) + CHAR(9) + CHAR(9) + CHAR(9) + 'IF @@ROWCOUNT <> 0 SELECT @fClause=@fClause + '''' '''' + replace(@filterClause,''''~~.'''','''''
+ @tableAbbrM + '.'''')' + CHAR(13)
+ CHAR(9) + CHAR(9) + CHAR(9) + 'END' + CHAR(13)
+ CHAR(9) + CHAR(9) + 'END' + CHAR(13)
+ CHAR(9) + 'END' + CHAR(13)
+ 'END' + CHAR(13)
+ @allClause
SELECT @procedureSql3 = @selfClause + @criClause
+ 'EXEC (@sClause + '''' '''' + @fClause + '''' '''' + @wClause + '''' '''' + @oClause)' + CHAR(13)
+ 'RETURN 0' + CHAR(13)
RETURN 0



 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenLis2Proc') AND type='P')
DROP PROCEDURE dbo.GetScreenLis2Proc
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetScreenLis2Proc]
 @procedureName		varchar(200)
,@param2Sql			varchar(4000)
,@select2Clause		varchar(max)
,@fromClause		varchar(max)
,@whereClause		varchar(max)
,@procedure2Sql		varchar(max) OUTPUT
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
SELECT @procedure2Sql = 'CREATE PROCEDURE ' + @procedureName + CHAR(13)
+ ' ' + RIGHT(@param2Sql,LEN(@param2Sql)-1) + '/* WITH ENCRYPTION */' + CHAR(13) + 'AS' + CHAR(13) + 'SET NOCOUNT ON' + CHAR(13) + 'DECLARE'
+ CHAR(9) + ' @sClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@fClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@wClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ 'SELECT @fClause = ''''FROM ' + @fromClause + '''''' + CHAR(13)
+ 'SELECT @sClause = ''''SELECT ' + @select2Clause + '''''' + CHAR(13)
+ @whereClause
+ 'EXEC (@sClause + '''' '''' + @fClause + '''' '''' + @wClause)' + CHAR(13)
+ 'RETURN 0' + CHAR(13)
RETURN 0





 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenLis3Proc') AND type='P')
DROP PROCEDURE dbo.GetScreenLis3Proc
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[GetScreenLis3Proc]
 @procedureName		varchar(200)
,@paramKeySql		varchar(4000)
,@paramSql			varchar(4000)
,@declareSql		varchar(4000)
,@selectClause		varchar(max)
,@fromClause		varchar(max)
,@orderClause		varchar(max)
,@whereClause		varchar(max)
,@allClause			varchar(max)
,@selfClause		varchar(max)
,@screenId			int
,@sysDatabase		varchar(50)
,@procedureSql1		varchar(max) OUTPUT
,@procedureSql2		varchar(max) OUTPUT
,@procedureSql3		varchar(max) OUTPUT
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
/* @paramSql is temporary ignored */
SELECT @procedureSql1 = 'CREATE PROCEDURE ' + @procedureName + CHAR(13)
+ ' @screenId' + CHAR(9) + CHAR(9) + 'int' + CHAR(13) + @paramKeySql
+ ',@Usrs' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@RowAuthoritys' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Customers' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Vendors' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Members' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Investors' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Agents' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Brokers' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@UsrGroups' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Companys' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Projects' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Cultures' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Borrowers' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Guarantors' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Lenders' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@screenFilterId' + CHAR(9) + 'int' + CHAR(13)
+ ',@currCompanyId' + CHAR(9) + CHAR(9) + 'int' + CHAR(13)
+ ',@currProjectId' + CHAR(9) + CHAR(9) + 'int' + CHAR(13)
+ '/* WITH ENCRYPTION */' + CHAR(13)
+ 'AS' + CHAR(13) + 'SET NOCOUNT ON' + CHAR(13) + 'DECLARE'
+ CHAR(9) + ' @sClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@fClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@wClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@oClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@tClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@filterClause' + CHAR(9) + CHAR(9) + 'nvarchar(2000)' + CHAR(13)
+ CHAR(9) + ',@cc' + CHAR(9) + CHAR(9) + 'varchar(max)' + CHAR(13)
+ CHAR(9) + ',@rr' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ CHAR(9) + ',@pp' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ CHAR(9) + ',@SelUsr' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelUsrGroup' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelCulture' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelCompany' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelAgent' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelBroker' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelCustomer' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelInvestor' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelMember' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelVendor' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelLender' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelBorrower' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelGuarantor' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelProject' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@RowAuthorityId' + CHAR(9) + 'smallint' + CHAR(13) + @declareSql
+ 'SELECT @fClause = ''''FROM ' + @fromClause + '''''' + CHAR(13)
+ 'SELECT @sClause = ''''SELECT ' + @selectClause + '''''' + CHAR(13)
IF @orderClause <> ''
	SELECT @procedureSql1 = @procedureSql1 + 'SELECT @oClause = ''''ORDER BY ' + @orderClause + '''''' + CHAR(13)
ELSE
	SELECT @procedureSql1 = @procedureSql1 + 'SELECT @oClause = ''''''''' + CHAR(13)
SELECT @procedureSql2 = @whereClause
+ 'SELECT @filterClause=rtrim(FilterClause) FROM '
+ @sysDatabase + '.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>''''Y''''' + CHAR(13)
+ 'IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + '''' AND '''' + @filterClause' + CHAR(13)
+ @allClause
SELECT @procedureSql3 = @selfClause
+ 'EXEC (@sClause + '''' '''' + @fClause + '''' '''' + @wClause + '''' '''' + @oClause)' + CHAR(13)
+ 'RETURN 0' + CHAR(13)
RETURN 0



 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenLisCri') AND type='P')
DROP PROCEDURE dbo.GetScreenLisCri
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





-- Do not check for RequiredValid because criteria could pass null even when manadatory.
CREATE PROCEDURE [dbo].[GetScreenLisCri]
 @screenId		int
,@tableId		int
,@tableAbbr		varchar(10)
,@criClause		varchar(4000) OUTPUT
,@paramCriSql	varchar(4000) OUTPUT
/* WITH ENCRYPTION */
AS
DECLARE	 @ColumnName		varchar(50)
		,@OperatorName		varchar(10)
		,@NumericData		char(1)
		,@DataTypeSqlName	varchar(30)
		,@CriColumnName		varchar(50)
		,@CriTableName		varchar(500)
		,@CriDataType		varchar(50)
		,@AllowNulls		char(1)
		,@PKeyColumnName	varchar(50)
		,@ExternalTable		varchar(50)
		,@tmpClause			varchar(4000)
SET NOCOUNT ON
SELECT @PKeyColumnName = b.ColumnName, @NumericData = e.NumericData
	FROM dbo.DbColumn b
	LEFT OUTER JOIN RODesign.dbo.CtDataType e ON b.DataType = e.DataTypeId
	WHERE b.TableId = @tableId AND b.PrimaryKey = 'Y'
IF @tableAbbr is null OR rtrim(@tableAbbr) = '' SELECT @tableAbbr = '' ELSE SELECT @tableAbbr = @tableAbbr + '.'
SELECT @paramCriSql = '', @tmpClause = ''
SELECT @criClause = 'IF @key is not null SELECT @wClause = @wClause + '''' AND (' + @tableAbbr + @PKeyColumnName
IF @numericData = 'Y'
	SELECT @criClause = @criClause + ' = '''' + @key + '''')''''' + CHAR(13)
ELSE
	SELECT @criClause = @criClause + ' = '''''''''''' + @key + '''''''''''')''''' + CHAR(13)
DECLARE criCursor CURSOR FOR
	SELECT a1.ColumnName, a1.AllowNulls, e.OperatorName, a2.NumericData, a2.DataTypeSqlName
	, b1.ColumnName + convert(varchar,a.ScreenCriId), isnull(a3.TableName,'')
	, CASE	WHEN c.TypeName = 'ListBox' THEN 'NVarChar(2000)'
		WHEN charindex('char',b2.DataTypeSqlName) > 0 THEN b2.DataTypeSqlName + '(' + case when b1.ColumnLength > 0 then convert(varchar,b1.ColumnLength) else 'max' end + ')'
		WHEN b2.DataTypeSqlName = 'NText' THEN 'NVarChar(' + isnull(convert(varchar,a.ColumnSize),'200') + ')'
		WHEN b2.DataTypeSqlName = 'Text' THEN 'VarChar(' + isnull(convert(varchar,a.ColumnSize),'200') + ')'
		WHEN b2.DataTypeSqlName = 'Decimal' THEN b2.DataTypeSqlName + '(' + convert(varchar,b1.ColumnLength) + ',' + convert(varchar,b1.ColumnScale) + ')'
		ELSE b2.DataTypeSqlName END
	, a1.ExternalTable
	FROM dbo.ScreenCri a
	INNER JOIN RODesign.dbo.CtOperator e ON a.OperatorId = e.OperatorId
	INNER JOIN RODesign.dbo.CtDisplayType c ON a.DisplayModeId = c.TypeId
	INNER JOIN dbo.DbColumn b1 ON a.ColumnId = b1.ColumnId
	INNER JOIN RODesign.dbo.CtDataType b2 ON b1.DataType = b2.DataTypeId
	INNER JOIN dbo.DbColumn a1 ON a.ColumnId = a1.ColumnId
	INNER JOIN RODesign.dbo.CtDataType a2 ON a1.DataType = a2.DataTypeId
	LEFT OUTER JOIN RODesign.dbo.CtPermKey a3 ON a1.ColumnName = a3.CtPermKeyName
	WHERE a.ScreenId = @screenId AND b1.tableId = @tableId
	ORDER BY a.TabIndex
FOR READ ONLY
OPEN criCursor
FETCH NEXT FROM criCursor INTO @ColumnName, @AllowNulls, @OperatorName, @NumericData, @DataTypeSqlName, @CriColumnName, @CriTableName, @CriDataType, @ExternalTable
WHILE @@FETCH_STATUS = 0
BEGIN
	IF charindex(@CriColumnName, @paramCriSql) <= 0 SELECT @paramCriSql = @paramCriSql + ',@' + @CriColumnName + CHAR(9) + @CriDataType + CHAR(13)
	IF ISNULL(@OperatorName,'noop') <> 'noop'
	BEGIN
		SELECT @tmpClause = @tmpClause + CHAR(9) + 'IF @' + @CriColumnName + ' is not null SELECT @wClause = @wClause + '''' AND '
		IF @ExternalTable is not null AND @ExternalTable <> ''
			SELECT @tmpClause = @tmpClause + 'EXISTS (SELECT ''''''''true'''''''' FROM dbo.' + @ExternalTable + ' x WHERE ' + @tableAbbr + @PKeyColumnName + ' = x.' + @PKeyColumnName
			+ ' AND x.' + @ColumnName + ' IN '''' + RODesign.dbo.fKeyHier(''''' + @CriTableName + ''''',@' + @CriColumnName + ') + '''')''''' + CHAR(13)
		ELSE
		BEGIN
			IF LOWER(@OperatorName) IN ('have some','have none')
				SELECT @tmpClause = @tmpClause + CASE WHEN LOWER(@OperatorName) = 'have none' THEN ' NOT' ELSE '' END +  ' EXISTS ( SELECT 1 FROM RODesign.dbo.SplitID_Match('+ @tableAbbr + @ColumnName + ','''''''''''' + replace(@' + @CriColumnName + ','''''''''''''''','''''''''''''''''''''''') + '''''''''''','''''''','''''''',''''''''O'''''''') m)'
			ELSE IF LOWER(@OperatorName) = 'only in'
				SELECT @tmpClause = @tmpClause  +  ' EXISTS ( SELECT 1 FROM RODesign.dbo.SplitID_Match('+ @tableAbbr + @ColumnName + ','''''''''''' + replace(@' + @CriColumnName + ','''''''''''''''','''''''''''''''''''''''') + '''''''''''','''''''','''''''',''''''''I'''''''') m)'
			ELSE IF LOWER(@OperatorName) = 'have all'
				SELECT @tmpClause = @tmpClause  +  ' EXISTS ( SELECT 1 FROM RODesign.dbo.SplitID_Match('+ @tableAbbr + @ColumnName + ','''''''''''' + replace(@' + @CriColumnName + ','''''''''''''''','''''''''''''''''''''''') + '''''''''''','''''''','''''''',''''''''C'''''''') m)'
			ELSE IF LOWER(@OperatorName) = 'same as'
				SELECT @tmpClause = @tmpClause  +  ' EXISTS ( SELECT 1 FROM RODesign.dbo.SplitID_Match('+ @tableAbbr + @ColumnName + ','''''''''''' + replace(@' + @CriColumnName + ','''''''''''''''','''''''''''''''''''''''') + '''''''''''','''''''','''''''',''''''''S'''''''') m)'
			ELSE IF lower(@DataTypeSqlName) = 'datetime' OR lower(@DataTypeSqlName) = 'smalldatetime'
				SELECT @tmpClause = @tmpClause + '(DATEADD(hour, DATEDIFF(hour, 0, ' + @tableAbbr + @ColumnName + '), 0) ' + @OperatorName + ' '''''''''''' + convert(varchar,@'+ @CriColumnName + ',120) + '''''''''''')'
			ELSE
			BEGIN
				SELECT @tmpClause = @tmpClause + '(' + @tableAbbr + @ColumnName + ' ' + @OperatorName
				IF lower(@OperatorName) = 'in'
					SELECT @tmpClause = @tmpClause + ' '''' + @' + @CriColumnName + ' + '''')'
				ELSE IF lower(@OperatorName) = 'like'
					SELECT @tmpClause = @tmpClause + ' N''''''''%'''' + replace(@' + @CriColumnName + ','''''''''''''''','''''''''''''''''''''''') + ''''%'''''''')'
				ELSE IF @NumericData = 'Y'
					SELECT @tmpClause = @tmpClause + ' '''' + convert(varchar,@'+ @CriColumnName + ') + '''')'
				ELSE SELECT @tmpClause = @tmpClause + ' N'''''''''''' + @' + @CriColumnName + ' + '''''''''''')'
			END
			SELECT @tmpClause = @tmpClause + '''''' + CHAR(13)
		END
	END
	FETCH NEXT FROM criCursor INTO @ColumnName, @AllowNulls, @OperatorName, @NumericData, @DataTypeSqlName, @CriColumnName, @CriTableName, @CriDataType, @ExternalTable
END
CLOSE criCursor
DEALLOCATE criCursor
IF @tmpClause <> '' SELECT @criClause = @criClause + 'ELSE' + CHAR(13) + 'BEGIN' + CHAR(13) + @tmpClause + 'END' + CHAR(13)
RETURN 0 
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenLisI1ById') AND type='P')
DROP PROCEDURE dbo.GetScreenLisI1ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[GetScreenLisI1ById]
 @screenId		int
,@procedureName		varchar(200)
,@appDatabase		varchar(50)
,@sysDatabase		varchar(50)
,@desDatabase		varchar(50)
,@multiDesignDb		char(1)
,@sysProgram		char(1)
/* WITH ENCRYPTION */
AS
DECLARE	 @proc1Name		varchar(200)
	,@proc2Name			varchar(200)
	,@proc4Name			varchar(200)
	,@procedure1Sql1	varchar(max)
	,@procedure1Sql2	varchar(max)
	,@procedure1Sql3	varchar(max)
	,@procedure2Sql		varchar(max)
	,@procedure4Sql1	varchar(max)
	,@procedure4Sql2	varchar(max)
	,@procedure4Sql3	varchar(max)
	,@dropProcedure1Sql	varchar(max)
	,@dropProcedure2Sql	varchar(max)
	,@dropProcedure4Sql	varchar(max)
	,@select1Clause		varchar(max)
	,@select2Clause		varchar(max)
	,@select4Clause		varchar(max)
	,@fromClause		varchar(max)
	,@from1Clause		varchar(max)
	,@from2Clause		varchar(max)
	,@from4Clause		varchar(max)
	,@fr4				varchar(max)
	,@order1Clause		varchar(max)
	,@order4Clause		varchar(max)
	,@allClause			varchar(max)
	,@selfClause		varchar(max)
	,@all4Clause		varchar(max)
	,@self4Clause		varchar(max)
	,@whereClause		varchar(max)
	,@parameter1Names	varchar(1000)
	,@parameter1Types	varchar(1000)
	,@parameter1SByte	varchar(1000)
	,@calling1Params	varchar(1000)
	,@parameter2Names	varchar(1000)
	,@parameter2Types	varchar(1000)
	,@parameter2SByte	varchar(1000)
	,@parameter2DByte	varchar(1000)
	,@tableId			int
	,@tableName			varchar(500)
	,@tableAbbr			varchar(10)
	,@columnName		varchar(50)
	,@dbColumnName		varchar(50)
	,@DataTypeSqlName	varchar(30)
	,@dataTypeSysName	varchar(50)
	,@dataTypeSByteOle	varchar(50)
	,@dataTypeDByteOle	varchar(50)
	,@numericData		char(1)
	,@displayName		varchar(50)
	,@displayMode		varchar(50)
	,@ddlTableAbbr		varchar(10)
	,@joinColumn1		varchar(50)
	,@joinColumn2		varchar(50)
	,@param1Sql			varchar(4000)
	,@declare1Sql		varchar(4000)
	,@param2Sql			varchar(4000)
	,@pKey				char(1)
	,@pKeyParamName		varchar(400)
	,@pKeyDataType		varchar(50)
	,@pKeyTableName		varchar(500)
	,@pKeyTableAbbr		varchar(10)
	,@allowNulls		char(1)
	,@ddlKeyTableId		int
	,@ddlKeyTableAbbr	varchar(10)
	,@ddlKeyTableName	varchar(500)
	,@ddlKeyColumnName	varchar(50)
	,@ddlRefTableId		int
	,@ddlRefTableAbbr	varchar(10)
	,@ddlRefTableName	varchar(500)
	,@ddlRefColumnName	varchar(50)
	,@ddlAdnTableId		int
	,@ddlAdnTableAbbr	varchar(10)
	,@ddlAdnTableName	varchar(500)
	,@ddlAdnColumnName	varchar(50)
	,@ddlFtrTableId		int
	,@ddlFtrTableAbbr	varchar(10)
	,@ddlFtrTableName	varchar(500)
	,@ddlFtrColumnName	varchar(50)
	,@searchColumnName	varchar(50)
	,@searchTableName	varchar(500)
	,@searchAscending	char(1)
	,@searchDtlName		varchar(50)
	,@searchUrlName		varchar(50)
	,@searchImgName		varchar(50)
	,@searchIdRName		varchar(50)
	,@searchDtlRName	varchar(50)
	,@foundIndex		int
	,@foundEnd			int
	,@foundLen			int
	,@criClause			varchar(4000)
	,@criNfilterTxtClause	varchar(max)
	,@paramCriSql		varchar(4000)
	,@MasterTableId		int
	,@DetailTableId		int
	,@pullColumn		char(1)
	,@ii				int
	,@jj				int
	,@tableLen			int
	,@masterTable		char(1)
	,@parameter4Names	varchar(1000)
	,@parameter4Types	varchar(1000)
	,@parameter4SByte	varchar(1000)
	,@calling4Params	varchar(1000)
	,@param4Sql			varchar(4000)
	,@declare4Sql		varchar(4000)
	,@tableDb			varchar(50)
	,@ddlKeyTableDb		varchar(50)
	,@ddlRefTableDb		varchar(50)
SET NOCOUNT ON
SELECT @parameter1Names='', @parameter1Types='', @parameter1SByte='', @calling1Params='', @param1Sql='', @declare1Sql='', @parameter2Names='', @parameter2Types='', @parameter2SByte='', @parameter2DByte='', @param2Sql='', @jj=0
SELECT @select1Clause='', @select2Clause='', @select4Clause='', @fromClause='', @from2Clause='', @from4Clause='', @order1Clause='', @order4Clause=''
SELECT @MasterTableId = MasterTableId, @DetailTableId = DetailTableId FROM dbo.Screen WHERE ScreenId = @screenId
DECLARE objCursor CURSOR FOR
	SELECT	 a.MasterTable
		,b.TableId
		,'b' + convert(varchar,b.TableId)
		,CASE WHEN c.MultiDesignDb='N' THEN s.dbAppDatabase+'.dbo.'+c.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+c.TableName ELSE 'dbo.'+c.TableName END
		,a.ColumnName
		,b.ColumnName
		,e.DataTypeSqlName
		,e.DataTypeSysName
		,e.DataTypeSByteOle
		,e.DataTypeDByteOle
		,e.NumericData
		,d.TypeName
		,d.TypeDesc
		,b.PrimaryKey
		,b.AllowNulls
		,x1.TableId
		,CASE WHEN a.DdlKeyColumnId is null THEN null ELSE 'x' + convert(varchar,a.ColumnId) END
		,CASE WHEN x2.MultiDesignDb='N' THEN x3.dbAppDatabase+'.dbo.'+x2.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+x2.TableName ELSE 'dbo.'+x2.TableName END
		,x1.ColumnName
		,x4.TableId
		,'x' + convert(varchar,x4.ColumnId)
		,CASE WHEN x8.TableId is null AND x5.MultiDesignDb='N' THEN x6.dbAppDatabase+'.dbo.'+x5.TableName
			WHEN x8.TableId is null AND @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+x5.TableName
			WHEN x8.TableId is null THEN 'dbo.'+x5.TableName
			WHEN x8.TableId is not null AND x8.MultiDesignDb='N' THEN x9.dbAppDatabase+'.dbo.'+x8.TableName
			WHEN x8.TableId is not null AND @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+x8.TableName
			ELSE 'dbo.'+x8.TableName END
		,CASE WHEN x8.TableId is null THEN x4.ColumnName ELSE x7.ColumnName END
		,x11.TableId
		,CASE WHEN a.DdlAdnColumnId is null THEN null ELSE 'x' + convert(varchar,x11.ColumnId) END
		,CASE WHEN x12.MultiDesignDb='N' THEN x13.dbAppDatabase+'.dbo.'+x12.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+x12.TableName ELSE 'dbo.'+x12.TableName END
		,x11.ColumnName
		,x14.TableId
		,CASE WHEN a.DdlFtrColumnId is null THEN null ELSE 'x' + convert(varchar,x14.ColumnId) END
		,CASE WHEN x15.MultiDesignDb='N' THEN x16.dbAppDatabase+'.dbo.'+x15.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+x15.TableName ELSE 'dbo.'+x15.TableName END
		,CASE WHEN x17.ColumnName is NOT NULL THEN x17.ColumnName ELSE x14.ColumnName END	-- Column name of look up table may not be the same.
		,CASE WHEN EXISTS (SELECT 'true' FROM dbo.ScreenObj aa WHERE aa.ScreenId = a.ScreenId AND aa.ColumnId = a.DdlRefColumnId) AND x1.TableId <> x4.TableId THEN 'Y' ELSE 'N' END
		,CASE WHEN c.MultiDesignDb='N' THEN s.dbAppDatabase WHEN @multiDesignDb='N' THEN @sysDatabase ELSE '' END
		,CASE WHEN x2.MultiDesignDb='N' THEN x3.dbAppDatabase WHEN @multiDesignDb='N' THEN @sysDatabase ELSE '' END
		,CASE WHEN x8.TableId is null AND x5.MultiDesignDb='N' THEN x6.dbAppDatabase
			WHEN x8.TableId is null AND @multiDesignDb='N' THEN @sysDatabase
			WHEN x8.TableId is null THEN ''
			WHEN x8.TableId is not null AND x8.MultiDesignDb='N' THEN x9.dbAppDatabase
			WHEN x8.TableId is not null AND @multiDesignDb='N' THEN @sysDatabase
			ELSE '' END
	FROM dbo.ScreenObj a
		LEFT OUTER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
		LEFT OUTER JOIN dbo.DbTable c ON b.TableId = c.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems s ON c.SystemId = s.SystemId
		LEFT OUTER JOIN RODesign.dbo.CtDataType e ON b.DataType = e.DataTypeId
		LEFT OUTER JOIN RODesign.dbo.CtDisplayType d ON a.DisplayModeId = d.TypeId
		LEFT OUTER JOIN dbo.DbColumn x1 ON a.DdlKeyColumnId = x1.ColumnId
		LEFT OUTER JOIN dbo.DbTable x2 ON x1.TableId = x2.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems x3 ON x2.SystemId = x3.SystemId
		LEFT OUTER JOIN dbo.DbColumn x4 ON a.DdlRefColumnId = x4.ColumnId
		LEFT OUTER JOIN dbo.DbTable x5 ON x4.TableId = x5.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems x6 ON x5.SystemId = x6.SystemId
		LEFT OUTER JOIN dbo.ScreenObj x ON a.DdlRefColumnId = x.ColumnId AND a.ScreenId = x.ScreenId
		LEFT OUTER JOIN dbo.DbColumn x7 ON x.DdlKeyColumnId = x7.ColumnId
		LEFT OUTER JOIN dbo.DbTable x8 ON x7.TableId = x8.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems x9 ON x8.SystemId = x9.SystemId
		LEFT OUTER JOIN dbo.DbColumn x11 ON a.DdlAdnColumnId = x11.ColumnId
		LEFT OUTER JOIN dbo.DbTable x12 ON x11.TableId = x12.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems x13 ON x12.SystemId = x13.SystemId
		LEFT OUTER JOIN dbo.DbColumn x14 ON a.DdlFtrColumnId = x14.ColumnId
		LEFT OUTER JOIN dbo.DbTable x15 ON x14.TableId = x15.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems x16 ON x15.SystemId = x16.SystemId
		LEFT OUTER JOIN (SELECT DISTINCT t1.ColumnId, t2.ColumnName FROM dbo.ScreenObj t1 LEFT OUTER JOIN dbo.DbColumn t2 ON t1.DdlKeyColumnId = t2.ColumnId) x17 ON a.DdlFtrColumnId = x17.ColumnId
	WHERE a.ScreenId = @ScreenId ORDER BY a.TabIndex
FOR READ ONLY
OPEN objCursor
FETCH NEXT FROM objCursor INTO @masterTable, @tableId, @tableAbbr, @tableName, @columnName, @dbColumnName, @DataTypeSqlName, @dataTypeSysName
	, @dataTypeSByteOle, @dataTypeDByteOle, @numericData, @displayName, @displayMode, @pKey, @allowNulls
	, @ddlKeyTableId, @ddlKeyTableAbbr, @ddlKeyTableName, @ddlKeyColumnName, @ddlRefTableId, @ddlRefTableAbbr, @ddlRefTableName, @ddlRefColumnName
	, @ddlAdnTableId, @ddlAdnTableAbbr, @ddlAdnTableName, @ddlAdnColumnName, @ddlFtrTableId, @ddlFtrTableAbbr, @ddlFtrTableName, @ddlFtrColumnName
	, @pullColumn, @tableDb, @ddlKeyTableDb, @ddlRefTableDb
WHILE @@FETCH_STATUS = 0
BEGIN
	IF @tableId is NOT NULL
	BEGIN
		IF @tableId = @MasterTableId AND @masterTable = 'Y' AND CHARINDEX(@tableName,@fromClause) = 0
		BEGIN
			EXEC dbo.GetScreenLisCri @screenId, @tableId, @tableAbbr, @criClause OUTPUT, @paramCriSql OUTPUT
			EXEC dbo.GetScreenLisParm @screenId, null, @tableId, @tableAbbr, '', @sysDatabase, @desDatabase, 'Usrs', @allClause OUTPUT, @selfClause OUTPUT, @parameter1Names OUTPUT, @parameter1Types OUTPUT, @parameter1SByte OUTPUT, @calling1Params OUTPUT, @param1Sql OUTPUT, @declare1Sql OUTPUT
			IF @fromClause = '' SELECT @fromClause = @tableName + ' ' + @tableAbbr + ' (NOLOCK)'
			SELECT @all4Clause = @allClause, @self4Clause = @selfClause	-- In case of single table screen.
			SELECT @parameter4Names = @parameter1Names, @parameter4Types = @parameter1Types, @parameter4SByte = @parameter1SByte, @calling4Params = @calling1Params, @param4Sql = @param1Sql, @declare4Sql = @declare1Sql
		END
		IF @tableId = @DetailTableId AND @masterTable = 'N' AND CHARINDEX(@tableName,@from4Clause) = 0
		BEGIN
			EXEC dbo.GetScreenLisParm @screenId, null, @tableId, @tableAbbr, '', @sysDatabase, @desDatabase, 'Usrs', @all4Clause OUTPUT, @self4Clause OUTPUT, @parameter4Names OUTPUT, @parameter4Types OUTPUT, @parameter4SByte OUTPUT, @calling4Params OUTPUT, @param4Sql OUTPUT, @declare4Sql OUTPUT
			SELECT @all4Clause = @allClause + @all4Clause, @self4Clause = @selfClause + @self4Clause
		END
	END
	IF @pKey = 'Y' AND @masterTable = 'Y'
	BEGIN
		SELECT @searchTableName = CASE WHEN d.MultiDesignDb='N' THEN s.dbAppDatabase+'.dbo.'+d.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+d.TableName ELSE 'dbo.'+d.TableName END
			,@searchColumnName = c1.ColumnName, @searchAscending = a.SearchAscending
			,@searchDtlName = c2.ColumnName, @searchUrlName = c3.ColumnName, @searchImgName = c4.ColumnName
			,@searchIdRName = c5.ColumnName,@searchDtlRName = c6.ColumnName
			FROM dbo.Screen a
			LEFT OUTER JOIN dbo.DbColumn c1 ON a.SearchId = c1.ColumnId
			LEFT OUTER JOIN dbo.DbTable d ON c1.TableId = d.TableId
			LEFT OUTER JOIN RODesign.dbo.Systems s ON d.SystemId = s.SystemId
			LEFT OUTER JOIN dbo.DbColumn c2 ON a.SearchDtlId = c2.ColumnId
			LEFT OUTER JOIN dbo.DbColumn c3 ON a.SearchUrlId = c3.ColumnId
			LEFT OUTER JOIN dbo.DbColumn c4 ON a.SearchImgId = c4.ColumnId
			LEFT OUTER JOIN dbo.DbColumn c5 ON a.SearchIdR = c5.ColumnId
			LEFT OUTER JOIN dbo.DbColumn c6 ON a.SearchDtlIdR = c6.ColumnId
			WHERE a.ScreenId = @screenId
		IF @@ROWCOUNT <> 1 RAISERROR('Please specify search column and try again.',18,2) WITH SETERROR
		--IF @searchTableName <> @tableName RAISERROR('Search column %s of table %s must belong to the master table %s, operation aborted.',18,2,@columnName,@searchTableName,@tableName) WITH SETERROR
		SELECT @from1Clause = REPLACE(@fromClause,@tableName,@searchTableName)
		SELECT @select1Clause = @columnName + CONVERT(VARCHAR(10),@tableId) + '=' + @tableAbbr + '.' + @dbColumnName
			+ ', ' + @columnName + CONVERT(VARCHAR(10),@tableId) + 'Text=' + @tableAbbr+'.'+@searchColumnName
			+ ISNULL(', ' + @columnName + CONVERT(VARCHAR(10),@tableId) + 'TextR=' + @tableAbbr+'.'+@searchIdRName,'')
			+ ISNULL(', ' + @columnName + CONVERT(VARCHAR(10),@tableId) + 'Dtl=' + @tableAbbr+'.'+@searchDtlName,'')
			+ ISNULL(', ' + @columnName + CONVERT(VARCHAR(10),@tableId) + 'DtlR=' + @tableAbbr+'.'+@searchDtlRName,'')
			+ ISNULL(', ' + @columnName + CONVERT(VARCHAR(10),@tableId) + 'Url=' + @tableAbbr+'.'+@searchUrlName,'')
			+ ISNULL(', ' + @columnName + CONVERT(VARCHAR(10),@tableId) + 'Img=' + @tableAbbr+'.'+@searchImgName,'')
		-- SELECT DISCTINCT requires order clause in the select clause:
		IF @select4Clause <> ''
		BEGIN
			IF right(@select4Clause,4) <> ' end' SELECT @select4Clause = @select4Clause + ''''''
			SELECT @select4Clause = @select4Clause + CHAR(13) + '+ '''', '
		END
		SELECT @select4Clause = @select4Clause + @columnName + CONVERT(VARCHAR(10),@tableId) + 'Text=' + @tableAbbr+'.'+@columnName
		IF EXISTS (SELECT 'true' FROM dbo.DbColumn WHERE TableId = @tableId AND ColumnName = 'Active')
			SELECT @order1Clause = @tableAbbr + '.Active DESC,', @select1Clause = @select1Clause + ', ' + @tableAbbr + '.Active'
		SELECT @order1Clause = @order1Clause + @tableAbbr+'.'+@searchColumnName, @order4Clause = @order4Clause + @tableAbbr+'.'+@columnName
		IF @searchAscending = 'N' SELECT @order1Clause = @order1Clause + ' DESC', @order4Clause = @order4Clause + ' DESC'
		SELECT @pKeyParamName = @dbColumnName, @pKeyDataType = @dataTypeSysName, @pKeyTableName = @tableName, @pKeyTableAbbr = @tableAbbr
		IF CHARINDEX(',@'+@pKeyParamName,@param2Sql) = 0
		BEGIN
			/* SELECT	 @param2Sql = @param2Sql + ',@' + @pKeyParamName + CHAR(9) + CHAR(9) + @DataTypeSqlName + CHAR(13) */
			SELECT @jj = @jj + 1
			SELECT @param2Sql = @param2Sql + ',@KeyId' + CONVERT(varchar,@jj) + CHAR(9) + CHAR(9) + 'nvarchar(1000)' + CHAR(13)
				,@parameter2Names = @parameter2Names + ',' + @pKeyParamName
				,@parameter2Types = @parameter2Types + ',' + @dataTypeSysName
				,@parameter2SByte = @parameter2SByte + ',' + @dataTypeSByteOle
				,@parameter2DByte = @parameter2DByte + ',' + @dataTypeDByteOle
		END
		IF @numericData = 'Y'
			SELECT @whereClause = 'SELECT @wClause = ''''WHERE ' + @tableAbbr + '.' + @dbColumnName + ''''' + isnull(''''=''''+@KeyId' + CONVERT(varchar,@jj) + ','''' is null'''')' + CHAR(13)
		ELSE
			SELECT @whereClause = 'SELECT @wClause = ''''WHERE ' + @tableAbbr + '.' + @dbColumnName + ' = '''''''''''' + isnull(@KeyId' + CONVERT(varchar,@jj) + ','''''''') + ''''''''''''''''' + CHAR(13)
		SELECT @criNfilterTxtClause = @criClause + CHAR(13)
			+ 'SELECT @FilterTxt = REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,''''['''',''''[[]''''),''''%'''',''''[%]''''),''''_'''',''''[_]''''), '''''''''''''''','''''''''''''''''''''''') ' + CHAR(13)
			+ 'IF @FilterTxt is not null AND @FilterTxt <> '''''''' SELECT @wClause = @wClause + '''' AND ('
			+ @tableAbbr+'.'+@searchColumnName +' LIKE N''''''''%'''' + REPLACE(@FilterTxt,'''' '''',''''%'''') + ''''%'''''''''
			+ ISNULL(' OR ' + @tableAbbr+'.'+@searchIdRName +' LIKE N''''''''%'''' + REPLACE(@FilterTxt,'''' '''',''''%'''') + ''''%''''''''','')
			+ ISNULL(' OR ' + @tableAbbr+'.'+@searchDtlName +' LIKE N''''''''%'''' + REPLACE(@FilterTxt,'''' '''',''''%'''') + ''''%''''''''','')
			+ ISNULL(' OR ' + @tableAbbr+'.'+@searchDtlRName +' LIKE N''''''''%'''' + REPLACE(@FilterTxt,'''' '''',''''%'''') + ''''%''''''''','')
			+ ') ''''' + CHAR(13)
	END
	IF @tableId is NOT NULL
	BEGIN
		IF @from2Clause = '' SELECT @from2Clause = @fromClause + ''''''
		IF @from4Clause = '' SELECT @from4Clause = @fromClause + ''''''
		IF @displayName IN ('HyperLink','ComboBox','DropDownList','ListBox','RadioButtonList') OR @ddlKeyTableName IS NULL OR @displayMode in ('Document','Currency')
		BEGIN
			IF @masterTable = 'Y'
			BEGIN
				IF @select2Clause <> ''
				BEGIN
					IF right(@select2Clause,4) <> ' end' SELECT @select2Clause = @select2Clause + ''''''
					SELECT @select2Clause = @select2Clause + CHAR(13) + '+ '''', '
				END
				SELECT @select2Clause = @select2Clause + @columnName + CONVERT(VARCHAR,@tableId)
				IF @tableAbbr <> '' AND @tableAbbr <> @pKeyTableAbbr AND @tableAbbr <> 'RODesign' AND @tableAbbr <> 'ROCmon'
					SELECT @select2Clause = @select2Clause + '='''' + case when charindex(''''' + @tableAbbr + ' '''',@fClause) > 0 then ''''' + @tableAbbr + '.' + @dbColumnName + ''''' else ''''null'''' end'
				ELSE
					SELECT @select2Clause = @select2Clause + '=' + @tableAbbr + '.' + @dbColumnName
				IF @from2Clause <> '' AND CHARINDEX(@tableName,@from2Clause) = 0
				BEGIN
					IF @tableDb <> '' AND @tableDb <> 'RODesign' AND @tableDb <> 'ROCmon'
						SELECT @from2Clause = @from2Clause + ' ' + CHAR(13) + 'IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name=''''' + @tableDb + ''''')'
					SELECT @from2Clause = @from2Clause + ' ' + CHAR(13) + 'SELECT @fClause = @fClause + '''' '
					SELECT @from2Clause = @from2Clause + 'INNER JOIN ' + @tableName + ' ' + @tableAbbr + ' ON ' + @pKeyTableAbbr + '.' + @pKeyParamName + ' = ' + @tableAbbr + '.' +  + @pKeyParamName + ''''''
				END
			END
			-- Listbox and DataGrid are currently multiple selection and may return duplicate rows:
			IF @displayName NOT IN ('ListBox','DataGrid') AND @from4Clause <> '' AND CHARINDEX(@tableName,@from4Clause) = 0
			BEGIN
				-- The space before CHAR(13) is needed for @foundEnd evaluation:
				IF @tableDb <> '' AND @tableDb <> 'RODesign' AND @tableDb <> 'ROCmon'
					SELECT @from4Clause = @from4Clause + ' ' + CHAR(13) + 'IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name=''''' + @tableDb + ''''')'
				SELECT @from4Clause = @from4Clause + ' ' + CHAR(13) + 'SELECT @fClause = @fClause + '''' '
				IF @masterTable = 'Y' SELECT @from4Clause = @from4Clause + 'INNER JOIN ' ELSE SELECT @from4Clause = @from4Clause + 'LEFT OUTER JOIN '
				SELECT @from4Clause = @from4Clause + @tableName + ' ' + @tableAbbr + ' (NOLOCK) ON ' + @pKeyTableAbbr + '.' + @pKeyParamName + ' = ' + @tableAbbr + '.' +  + @pKeyParamName + ''''''
			END
		END
		-- Listbox and DataGrid are currently multiple selection and may return duplicate rows:
		IF @displayName NOT IN ('ListBox','DataGrid') AND @displayMode <> 'Currency' AND @ddlKeyTableName IS NOT NULL AND @ddlRefTableName IS NOT NULL AND CHARINDEX(@ddlKeyTableAbbr + space(1),@from4Clause) = 0 AND NOT (@pullColumn = 'Y' AND @ddlKeyTableName = @ddlRefTableName)
		BEGIN
			SELECT @joinColumn1=d.ColumnName, @joinColumn2=e.ColumnName
			FROM dbo.DbKey a
				INNER JOIN dbo.DbTable b ON a.TableId = b.TableId
				INNER JOIN RODesign.dbo.Systems s1 ON b.SystemId = s1.SystemId AND CASE
					WHEN b.MultiDesignDb='N' THEN s1.dbAppDatabase+'.dbo.'+b.TableName
					WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+b.TableName
					ELSE 'dbo.'+b.TableName END = case when @ddlKeyTableName = @ddlRefTableName then @tableName else @ddlRefTableName end
				INNER JOIN dbo.DbColumn d ON a.ColumnId = d.ColumnId
				INNER JOIN dbo.DbTable c ON a.RefTableId = c.TableId
				INNER JOIN RODesign.dbo.Systems s2 ON c.SystemId = s2.SystemId AND CASE
					WHEN c.MultiDesignDb='N' THEN s2.dbAppDatabase+'.dbo.'+c.TableName
					WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+c.TableName
					ELSE 'dbo.'+c.TableName END = @ddlKeyTableName
				INNER JOIN dbo.DbColumn e ON a.RefColumnId = e.ColumnId
			IF @@ROWCOUNT <= 0 AND @tableName <> @ddlKeyTableName
				RAISERROR('Foreign key relationship has not been established for tables %s and %s.',18,2,@tableName,@ddlKeyTableName) WITH SETERROR
			IF @ddlKeyTableDb <> ''
			BEGIN
				-- The space before CHAR(13) is needed for @foundEnd evaluation:
				IF @ddlKeyTableDb <> '' AND @ddlKeyTableDb <> 'RODesign' AND @ddlKeyTableDb <> 'ROCmon'
				BEGIN
					SELECT @from4Clause = @from4Clause + ' ' + CHAR(13) + 'IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name=''''' + @ddlKeyTableDb + ''''')'
					IF @ddlKeyTableDb <> @ddlRefTableDb AND @ddlRefTableDb <> '' AND @ddlRefTableDb <> 'RODesign' AND @ddlRefTableDb <> 'ROCmon'
						SELECT @from4Clause = @from4Clause + ' AND EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name=''''' + @ddlRefTableDb + ''''')'
				END
			END
			SELECT @from4Clause = @from4Clause + ' ' + CHAR(13) + 'SELECT @fClause = @fClause + '''' '
			SELECT @from4Clause = @from4Clause + 'LEFT OUTER JOIN '		-- No inner join so rows will show up even when ddl not found.
			IF @ddlKeyTableName <> @ddlRefTableName AND SUBSTRING(@from4Clause,CHARINDEX(@ddlRefTableName,@from4Clause)+LEN(@ddlRefTableName)+9,1) = ')' AND CHARINDEX(@joinColumn1,@from4Clause) <= 0
				SELECT @from4Clause = REPLACE(@from4Clause,' FROM ' + @ddlRefTableName,',' + @joinColumn1 + ' FROM ' + @ddlRefTableName)
			SELECT @from4Clause = @from4Clause + '(SELECT DISTINCT ' + @joinColumn2
			IF @joinColumn2 <> @ddlRefColumnName AND @ddlKeyTableName = @ddlRefTableName SELECT @from4Clause = @from4Clause + ',' + @ddlRefColumnName
			IF @joinColumn2 <> @ddlKeyColumnName SELECT @from4Clause = @from4Clause + ',' + @ddlKeyColumnName
			IF @ddlAdnColumnName IS NOT NULL AND @ddlFtrTableId = @TableId SELECT @from4Clause = @from4Clause + ',' + @ddlAdnColumnName
			SELECT @from4Clause = @from4Clause + ' FROM ' + @ddlKeyTableName + ' (NOLOCK))' + @ddlKeyTableAbbr + ' ON '
			+ case when @ddlKeyTableName = @ddlRefTableName then @tableAbbr + '.' + @dbColumnName else @ddlRefTableAbbr + '.' + @joinColumn1 end + ' = ' + @ddlKeyTableAbbr + '.' + @joinColumn2
			+ case when @ddlAdnColumnName IS NOT NULL AND @ddlFtrColumnName IS NOT NULL AND @ddlFtrTableId = @TableId then ' AND ' + @ddlFtrTableAbbr + '.' + @ddlFtrColumnName + ' = ' + @ddlKeyTableAbbr + '.' + @ddlAdnColumnName else '' end
			+ ''''''
		END
		-- Listbox and DataGrid are currently multiple selection and may return duplicate rows:
		IF @displayName IN ('ComboBox','DropDownList','RadioButtonList')
		BEGIN
			IF @ddlKeyTableName is NULL OR @ddlRefTableName is NULL RAISERROR('Reference column ID for Drop down column %s is missing.',18,2,@columnName) WITH SETERROR
			IF @select4Clause <> ''
			BEGIN
				IF right(@select4Clause,4) <> ' end' SELECT @select4Clause = @select4Clause + ''''''
				SELECT @select4Clause = @select4Clause + CHAR(13) + '+ '''', '
			END
			SELECT @select4Clause = @select4Clause + @columnName + CONVERT(VARCHAR,@tableId)
			IF @ddlKeyTableDb <> '' AND @ddlTableAbbr <> @pKeyTableAbbr AND @ddlKeyTableDb <> 'RODesign' AND @ddlKeyTableDb <> 'ROCmon'
				SELECT @select4Clause = @select4Clause + '='''' + case when charindex(''''' + @ddlKeyTableAbbr + ' '''',@fClause) > 0 then ''''' + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName + ''''' else ''''null'''' end'
			ELSE
				SELECT @select4Clause = @select4Clause + '=' + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName
			IF @select4Clause <> ''
			BEGIN
				IF right(@select4Clause,4) <> ' end' SELECT @select4Clause = @select4Clause + ''''''
				SELECT @select4Clause = @select4Clause + CHAR(13) + '+ '''', '
			END
			SELECT @select4Clause = @select4Clause + @columnName + CONVERT(VARCHAR,@tableId) + 'Text'
			IF @ddlKeyTableDb <> '' AND @ddlTableAbbr <> @pKeyTableAbbr AND @ddlKeyTableDb <> 'RODesign' AND @ddlKeyTableDb <> 'ROCmon'
				SELECT @select4Clause = @select4Clause  + '='''' + case when charindex(''''' + @ddlKeyTableAbbr + ' '''',@fClause) > 0 then ''''' + @ddlKeyTableAbbr + '.' + @ddlRefColumnName + ''''' else ''''null'''' end'
			ELSE
				SELECT @select4Clause = @select4Clause + '=' + @ddlKeyTableAbbr + '.' + @ddlRefColumnName
		END
		ELSE
		BEGIN
			SELECT @fr4 = replace(@from4Clause,'''',space(0))
			IF @pullColumn = 'Y'
			BEGIN
				SELECT @ii = CHARINDEX(@tableName+' (NOLOCK))',@fr4), @foundIndex = 0, @tableLen = 0
				WHILE @ii > 0
				BEGIN
					SELECT @foundIndex = @ii + @foundIndex + @tableLen + 9, @tableLen = LEN(@tableName)
					SELECT @ii = CHARINDEX(@tableName+' (NOLOCK))',RIGHT(@fr4,LEN(@fr4) - @foundIndex - @tableLen))
				END
			END
			ELSE SELECT @foundIndex = CHARINDEX(@tableName,@fr4)
			IF @foundIndex <= 0 RAISERROR('Table %s needs to be from a Drop Down column of a smaller TabIndex.',18,2,@tableName) WITH SETERROR
			SELECT @foundEnd = CHARINDEX(' ',right(@fr4,len(@fr4)-(@foundIndex+LEN(@tableName)+1)+1))
			IF @foundEnd <= 0 SELECT @foundLen = LEN(@fr4) - (@foundIndex + LEN(@tableName)) ELSE SELECT @foundLen = @foundEnd - 1
			SELECT @ddlTableAbbr = SUBSTRING(@fr4,@foundIndex + LEN(@tableName) + 1,@foundLen)
			IF SUBSTRING(@fr4,@foundIndex+LEN(@tableName),1) = ')' AND CHARINDEX(@dbColumnName,@fr4) <= 0
				SELECT @from4Clause = REPLACE(@from4Clause,' FROM ' + @tableName,',' + @dbColumnName + ' FROM ' + @tableName)
			IF @DataTypeSqlName NOT IN ('Image','NText','Text')
			BEGIN
				IF @select4Clause <> ''
				BEGIN
					IF right(@select4Clause,4) <> ' end' SELECT @select4Clause = @select4Clause + ''''''
					SELECT @select4Clause = @select4Clause + CHAR(13) + '+ '''', '
				END
				SELECT @select4Clause = @select4Clause + @columnName + CONVERT(VARCHAR,@tableId)
				IF @ddlTableAbbr <> @pKeyTableAbbr AND @tableDb <> 'RODesign' AND @tableDb <> 'ROCmon'
					SELECT @select4Clause = @select4Clause + '='''' + case when charindex(''''' + @ddlTableAbbr + ' '''',@fClause) > 0 then ''''' + @ddlTableAbbr + '.' + @dbColumnName + ''''' else ''''null'''' end'
				ELSE
					SELECT @select4Clause = @select4Clause + '=' + @ddlTableAbbr + '.' + @dbColumnName
			END
		END
	END
	/* The following takes care of dynamic hyperlinks. Don't forget to add " AND @masterTable = 'Y'" for GetScreenLis1ById */
	IF @displayName = 'HyperLink' AND @ddlKeyColumnName is not null AND @ddlKeyTableId is not null AND @masterTable = 'Y'
	BEGIN
		IF @select2Clause <> ''
		BEGIN
			IF right(@select2Clause,4) <> ' end' SELECT @select2Clause = @select2Clause + ''''''
			SELECT @select2Clause = @select2Clause + CHAR(13) + '+ '''', '
		END
		SELECT @select2Clause = @select2Clause + @ddlKeyColumnName + CONVERT(VARCHAR,@ddlKeyTableId) + 'URL'
		IF @ddlKeyTableDb <> '' AND @ddlTableAbbr <> @pKeyTableAbbr AND @ddlKeyTableDb <> 'RODesign' AND @ddlKeyTableDb <> 'ROCmon'
			SELECT @select2Clause = @select2Clause + '='''' + case when charindex(''''' + @ddlKeyTableAbbr + ' '''',@fClause) > 0 then ''''' + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName + ''''' else ''''null'''' end'
		ELSE
			SELECT @select2Clause = @select2Clause + '=' + @ddlTableAbbr + '.' + @ddlKeyColumnName
	END
	FETCH NEXT FROM objCursor INTO @masterTable, @tableId, @tableAbbr, @tableName, @columnName, @dbColumnName, @DataTypeSqlName, @dataTypeSysName
		, @dataTypeSByteOle, @dataTypeDByteOle, @numericData, @displayName, @displayMode, @pKey, @allowNulls
		, @ddlKeyTableId, @ddlKeyTableAbbr, @ddlKeyTableName, @ddlKeyColumnName, @ddlRefTableId, @ddlRefTableAbbr, @ddlRefTableName, @ddlRefColumnName
		, @ddlAdnTableId, @ddlAdnTableAbbr, @ddlAdnTableName, @ddlAdnColumnName, @ddlFtrTableId, @ddlFtrTableAbbr, @ddlFtrTableName, @ddlFtrColumnName
		, @pullColumn, @tableDb, @ddlKeyTableDb, @ddlRefTableDb
END
CLOSE objCursor
DEALLOCATE objCursor
/* Prepare Search List procedure */
SELECT @proc1Name = 'GetLis' + @procedureName, @select1Clause = @select1Clause + ', MatchCount=COUNT(1) OVER ()'
IF @order1Clause = '' EXEC dbo.GetSortOrder @screenId,@fromClause,@sysDatabase,'Y',@order1Clause OUTPUT
EXEC dbo.GetScreenLis1Proc @proc1Name, @criNfilterTxtClause, @paramCriSql, @param1Sql, @declare1Sql, @select1Clause, @from1Clause, @order1Clause, @allClause, @selfClause, @screenId, @pKeyTableAbbr, @sysDatabase, @desDatabase, @procedure1Sql1 OUTPUT, @procedure1Sql2 OUTPUT, @procedure1Sql3 OUTPUT
IF @procedure1Sql1 IS NULL OR @procedure1Sql2 IS NULL OR @procedure1Sql3 IS NULL
BEGIN
	RAISERROR('Stored Procedure1 %s not generated because of null.',18,2,@proc1Name) WITH SETERROR
	RETURN 1
END
/* Prepare Master table select procedure */
SELECT @proc2Name = 'Get' + @procedureName + 'ById', @from2Clause = left(@from2Clause,len(@from2Clause)-2)
IF @select2Clause <> '' AND right(@select2Clause,4) = ' end' SELECT @select2Clause = @select2Clause + ' + '''''
SELECT @from2Clause = replace(@from2Clause,' (NOLOCK)',space(0))	-- Ready for update.
EXEC dbo.GetScreenLis2Proc @proc2Name, @param2Sql, @select2Clause, @from2Clause, @whereClause, @procedure2Sql OUTPUT
IF @procedure2Sql IS NULL
BEGIN
	RAISERROR('Stored Procedure2 %s not generated because of null.',18,2,@proc2Name) WITH SETERROR
	RETURN 1
END
/* Prepare Export procedure */
SELECT @proc4Name = 'GetExp' + @procedureName, @from4Clause = left(@from4Clause,len(@from4Clause)-2)
IF @select4Clause <> '' AND right(@select4Clause,4) = ' end' SELECT @select4Clause = @select4Clause + ' + '''''
IF @order4Clause = '' EXEC dbo.GetSortOrder @screenId,@from4Clause,@sysDatabase,'Y',@order4Clause OUTPUT
EXEC dbo.GetScreenLis1Proc @proc4Name, @criClause, @paramCriSql, @param4Sql, @declare4Sql, @select4Clause, @from4Clause, @order4Clause, @all4Clause, @self4Clause, @screenId, @pKeyTableAbbr, @sysDatabase, @desDatabase, @procedure4Sql1 OUTPUT, @procedure4Sql2 OUTPUT, @procedure4Sql3 OUTPUT
IF @procedure4Sql1 IS NULL OR @procedure4Sql2 IS NULL OR @procedure4Sql3 IS NULL
BEGIN
	RAISERROR('Stored Procedure4 %s not generated because of null.',18,2,@proc4Name) WITH SETERROR
	RETURN 1
END
SELECT @dropProcedure1Sql = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''' + @proc1Name + ''''') AND type = ''''P'''') DROP PROCEDURE ' + @proc1Name
SELECT @dropProcedure2Sql = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''' + @proc2Name + ''''') AND type = ''''P'''') DROP PROCEDURE ' + @proc2Name
SELECT @dropProcedure4Sql = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''' + @proc4Name + ''''') AND type = ''''P'''') DROP PROCEDURE ' + @proc4Name
IF @multiDesignDb = 'Y'
BEGIN
	DECLARE sysCursor CURSOR FOR SELECT dbDesDatabase FROM RODesign.dbo.Systems FOR READ ONLY
	OPEN sysCursor
	FETCH NEXT FROM sysCursor INTO @sysDatabase
	WHILE @@FETCH_STATUS = 0
	BEGIN
		EXEC (@sysDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure1Sql + '''')
		EXEC (@sysDatabase + '.dbo.MkStoredProcedure ''' + @procedure1Sql1 + ''',''' + @procedure1Sql2 + ''',''' + @procedure1Sql3 + '''')
		EXEC (@sysDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure2Sql + '''')
		EXEC (@sysDatabase + '.dbo.MkStoredProcedure ''' + @procedure2Sql + '''')
		EXEC (@sysDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure4Sql + '''')
		EXEC (@sysDatabase + '.dbo.MkStoredProcedure ''' + @procedure4Sql1 + ''',''' + @procedure4Sql2 + ''',''' + @procedure4Sql3 + '''')
		FETCH NEXT FROM sysCursor INTO @sysDatabase
	END
	CLOSE sysCursor
	DEALLOCATE sysCursor
END
ELSE IF @sysProgram <> 'Y'
BEGIN
	-- USE Database is not allowed!  Needs to be replaced by Dynamic EXECUTION.
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure1Sql + '''')
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @procedure1Sql1 + ''',''' + @procedure1Sql2 + ''',''' + @procedure1Sql3 + '''')
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure2Sql + '''')
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @procedure2Sql + '''')
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure4Sql + '''')
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @procedure4Sql1 + ''',''' + @procedure4Sql2 + ''',''' + @procedure4Sql3 + '''')
END
ELSE
BEGIN
	EXEC (@desDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure1Sql + '''')
	EXEC (@desDatabase + '.dbo.MkStoredProcedure ''' + @procedure1Sql1 + ''',''' + @procedure1Sql2 + ''',''' + @procedure1Sql3 + '''')
	EXEC (@desDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure2Sql + '''')
	EXEC (@desDatabase + '.dbo.MkStoredProcedure ''' + @procedure2Sql + '''')
	EXEC (@desDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure4Sql + '''')
	EXEC (@desDatabase + '.dbo.MkStoredProcedure ''' + @procedure4Sql1 + ''',''' + @procedure4Sql2 + ''',''' + @procedure4Sql3 + '''')
END
SELECT 	 parameter1Names='Usrs,RowAuthoritys'+@parameter1Names
	,parameter1Types='string,string'+@parameter1Types
	,parameter1SByte='VarChar,VarChar'+@parameter1SByte
	,parameter2Names=RIGHT(@parameter2Names,LEN(@parameter2Names)-1)
	,parameter2Types=RIGHT(@parameter2Types,LEN(@parameter2Types)-1)
	,parameter2SByte=RIGHT(@parameter2SByte,LEN(@parameter2SByte)-1)
	,parameter2DByte=RIGHT(@parameter2DByte,LEN(@parameter2DByte)-1)
	,calling2Params='c'+@procedureName+'List.SelectedValue'
	,parameter4Names='Usrs,RowAuthoritys'+@parameter4Names
	,parameter4Types='string,string'+@parameter4Types
	,parameter4SByte='VarChar,VarChar'+@parameter4SByte
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenLisI2ById') AND type='P')
DROP PROCEDURE dbo.GetScreenLisI2ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[GetScreenLisI2ById]
 @screenId		int
,@procedureName		varchar(200)
,@appDatabase		varchar(50)
,@sysDatabase		varchar(50)
,@desDatabase		varchar(50)
,@multiDesignDb		char(1)
,@sysProgram		char(1)
/* WITH ENCRYPTION */
AS
DECLARE		 @proc3Name		varchar(200)
		,@procedureSql1		varchar(max)
		,@procedureSql2		varchar(max)
		,@procedureSql3		varchar(max)
		,@dropProcedure3Sql	varchar(max)
		,@select3Clause		varchar(max)
		,@from3Clause		varchar(max)
		,@order3Clause		varchar(max)
		,@fr3				varchar(max)
		,@allClause			varchar(max)
		,@selfClause		varchar(max)
		,@whereClause		varchar(max)
		,@parameter1Names	varchar(1000)
		,@parameter1Types	varchar(1000)
		,@parameter1SByte	varchar(1000)
		,@calling1Params	varchar(1000)
		,@parameter2Types	varchar(1000)
		,@parameter2SByte	varchar(1000)
		,@parameter2DByte	varchar(1000)
		,@masterTable		char(1)
		,@tableId			int
		,@tableName			varchar(500)
		,@tableAbbr			varchar(10)
		,@columnName		varchar(50)
		,@dbColumnName		varchar(50)
		,@DataTypeSqlName	varchar(30)
		,@dataTypeSysName	varchar(50)
		,@dataTypeSByteOle	varchar(50)
		,@dataTypeDByteOle	varchar(50)
		,@numericData		char(1)
		,@displayName		varchar(50)
		,@displayMode		varchar(50)
		,@ddlTableAbbr		varchar(10)
		,@ddlColumnName		varchar(50)
		,@dtlTableName		varchar(500)
		,@dtlTableAbbr		varchar(10)
		,@joinColumn1		varchar(50)
		,@joinColumn2		varchar(50)
		,@param1Sql		varchar(4000)
		,@paramKeySql		varchar(4000)
		,@declare1Sql		varchar(4000)
		,@pKey			char(1)
		,@pKeyParamName		varchar(200)
		,@pKeyDataType		varchar(50)
		,@pKeyTableName		varchar(500)
		,@pKeyTableAbbr		varchar(10)
		,@fKeyColName		varchar(50)
		,@allowNulls		char(1)
		,@ddlKeyTableId		int
		,@ddlKeyTableAbbr	varchar(10)
		,@ddlKeyTableName	varchar(500)
		,@ddlKeyColumnName	varchar(50)
		,@ddlRefTableId		int
		,@ddlRefTableAbbr	varchar(10)
		,@ddlRefTableName	varchar(500)
		,@ddlRefColumnName	varchar(50)
		,@ddlAdnTableId		int
		,@ddlAdnTableAbbr	varchar(10)
		,@ddlAdnTableName	varchar(500)
		,@ddlAdnColumnName	varchar(50)
		,@ddlFtrTableId		int
		,@ddlFtrTableAbbr	varchar(10)
		,@ddlFtrTableName	varchar(500)
		,@ddlFtrColumnName	varchar(50)
		/*
		,@searchColumnName	varchar(50)
		,@searchTableName	varchar(500)
		,@searchAscending	char(1)
		*/
		,@foundIndex		int
		,@foundEnd			int
		,@foundLen			int
		,@pullColumn		char(1)
		,@ii				int
		,@tableLen			int
		,@CultureId			smallint
		,@ScreenObjId		int
		,@tableDb			varchar(50)
		,@ddlKeyTableDb		varchar(50)
		,@ddlRefTableDb		varchar(50)
		,@DefaultValue		nvarchar(100)
SET NOCOUNT ON
SELECT @parameter1Names='', @parameter1Types='', @parameter1SByte='', @calling1Params='', @param1Sql='', @paramKeySql='', @declare1Sql=''
, @parameter2Types='', @parameter2SByte='', @parameter2DByte='', @select3Clause='', @from3Clause='', @allClause='', @selfClause=''
DECLARE objCursor CURSOR FOR
	SELECT	 a.ScreenObjId
		,a.MasterTable
		,b.TableId
		,'b' + convert(varchar,b.TableId)
		,CASE WHEN c.MultiDesignDb='N' THEN s.dbAppDatabase+'.dbo.'+c.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+c.TableName ELSE 'dbo.'+c.TableName END
		,a.ColumnName
		,b.ColumnName
		,e.DataTypeSqlName
		,e.DataTypeSysName
		,e.DataTypeSByteOle
		,e.DataTypeDByteOle
		,e.NumericData
		,d.TypeName
		,d.TypeDesc
		,b.PrimaryKey
		,b.AllowNulls
		,x1.TableId
		,CASE WHEN a.DdlKeyColumnId is null THEN null ELSE 'x' + convert(varchar,a.ColumnId) END
		,CASE WHEN x2.MultiDesignDb='N' THEN x3.dbAppDatabase+'.dbo.'+x2.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+x2.TableName ELSE 'dbo.'+x2.TableName END
		,x1.ColumnName
		,x4.TableId
		,'x' + convert(varchar,x4.ColumnId)
		,CASE WHEN x8.TableId is null AND x5.MultiDesignDb='N' THEN x6.dbAppDatabase+'.dbo.'+x5.TableName
			WHEN x8.TableId is null AND @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+x5.TableName
			WHEN x8.TableId is null THEN 'dbo.'+x5.TableName
			WHEN x8.TableId is not null AND x8.MultiDesignDb='N' THEN x9.dbAppDatabase+'.dbo.'+x8.TableName
			WHEN x8.TableId is not null AND @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+x8.TableName
			ELSE 'dbo.'+x8.TableName END
		,CASE WHEN x8.TableId is null THEN x4.ColumnName ELSE x7.ColumnName END
		,x11.TableId
		,CASE WHEN a.DdlAdnColumnId is null THEN null ELSE 'x' + convert(varchar,x11.ColumnId) END
		,CASE WHEN x12.MultiDesignDb='N' THEN x13.dbAppDatabase+'.dbo.'+x12.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+x12.TableName ELSE 'dbo.'+x12.TableName END
		,x11.ColumnName
		,x14.TableId
		,CASE WHEN a.DdlFtrColumnId is null THEN null ELSE 'x' + convert(varchar,x14.ColumnId) END
		,CASE WHEN x15.MultiDesignDb='N' THEN x16.dbAppDatabase+'.dbo.'+x15.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+x15.TableName ELSE 'dbo.'+x15.TableName END
		,CASE WHEN x17.ColumnName is NOT NULL THEN x17.ColumnName ELSE x14.ColumnName END	-- Column name of look up table may not be the same.
		,CASE WHEN EXISTS (SELECT 'true' FROM dbo.ScreenObj aa WHERE aa.ScreenId = a.ScreenId AND aa.ColumnId = a.DdlRefColumnId) AND x1.TableId <> x4.TableId THEN 'Y' ELSE 'N' END
		,CASE WHEN c.MultiDesignDb='N' THEN s.dbAppDatabase WHEN @multiDesignDb='N' THEN @sysDatabase ELSE '' END
		,CASE WHEN x2.MultiDesignDb='N' THEN x3.dbAppDatabase WHEN @multiDesignDb='N' THEN @sysDatabase ELSE '' END
		,CASE WHEN x8.TableId is null AND x5.MultiDesignDb='N' THEN x6.dbAppDatabase
			WHEN x8.TableId is null AND @multiDesignDb='N' THEN @sysDatabase
			WHEN x8.TableId is null THEN ''
			WHEN x8.TableId is not null AND x8.MultiDesignDb='N' THEN x9.dbAppDatabase
			WHEN x8.TableId is not null AND @multiDesignDb='N' THEN @sysDatabase
			ELSE '' END
		,replace(a.DefaultValue,'''',space(0))
	FROM dbo.ScreenObj a
		LEFT OUTER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
		LEFT OUTER JOIN dbo.DbTable c ON b.TableId = c.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems s ON c.SystemId = s.SystemId
		LEFT OUTER JOIN RODesign.dbo.CtDataType e ON b.DataType = e.DataTypeId
		LEFT OUTER JOIN RODesign.dbo.CtDisplayType d ON a.DisplayModeId = d.TypeId
		LEFT OUTER JOIN dbo.DbColumn x1 ON a.DdlKeyColumnId = x1.ColumnId
		LEFT OUTER JOIN dbo.DbTable x2 ON x1.TableId = x2.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems x3 ON x2.SystemId = x3.SystemId
		LEFT OUTER JOIN dbo.DbColumn x4 ON a.DdlRefColumnId = x4.ColumnId
		LEFT OUTER JOIN dbo.DbTable x5 ON x4.TableId = x5.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems x6 ON x5.SystemId = x6.SystemId
		LEFT OUTER JOIN dbo.ScreenObj x ON a.DdlRefColumnId = x.ColumnId AND a.ScreenId = x.ScreenId
		LEFT OUTER JOIN dbo.DbColumn x7 ON x.DdlKeyColumnId = x7.ColumnId
		LEFT OUTER JOIN dbo.DbTable x8 ON x7.TableId = x8.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems x9 ON x8.SystemId = x9.SystemId
		LEFT OUTER JOIN dbo.DbColumn x11 ON a.DdlAdnColumnId = x11.ColumnId
		LEFT OUTER JOIN dbo.DbTable x12 ON x11.TableId = x12.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems x13 ON x12.SystemId = x13.SystemId
		LEFT OUTER JOIN dbo.DbColumn x14 ON a.DdlFtrColumnId = x14.ColumnId
		LEFT OUTER JOIN dbo.DbTable x15 ON x14.TableId = x15.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems x16 ON x15.SystemId = x16.SystemId
		LEFT OUTER JOIN (SELECT DISTINCT t1.ColumnId, t2.ColumnName FROM dbo.ScreenObj t1 LEFT OUTER JOIN dbo.DbColumn t2 ON t1.DdlKeyColumnId = t2.ColumnId) x17 ON a.DdlFtrColumnId = x17.ColumnId
	WHERE a.ScreenId = @ScreenId ORDER BY a.TabIndex
FOR READ ONLY
OPEN objCursor
FETCH NEXT FROM objCursor INTO @ScreenObjId, @masterTable, @tableId, @tableAbbr, @tableName, @columnName, @dbColumnName, @DataTypeSqlName
, @dataTypeSysName, @dataTypeSByteOle, @dataTypeDByteOle, @numericData, @displayName, @displayMode, @pKey, @allowNulls
, @ddlKeyTableId, @ddlKeyTableAbbr, @ddlKeyTableName, @ddlKeyColumnName, @ddlRefTableId, @ddlRefTableAbbr, @ddlRefTableName, @ddlRefColumnName
, @ddlAdnTableId, @ddlAdnTableAbbr, @ddlAdnTableName, @ddlAdnColumnName, @ddlFtrTableId, @ddlFtrTableAbbr, @ddlFtrTableName, @ddlFtrColumnName
, @pullColumn, @tableDb, @ddlKeyTableDb, @ddlRefTableDb, @DefaultValue
WHILE @@FETCH_STATUS = 0
BEGIN
	IF @tableId is NOT NULL AND @masterTable <> 'Y' AND @from3Clause = ''
	BEGIN
		IF @masterTable <> 'Y' AND @from3Clause = ''
			SELECT @dtlTableName = @tableName, @dtlTableAbbr = @tableAbbr, @from3Clause = @tableName + ' ' + @tableAbbr + ' (NOLOCK)'''''
		EXEC dbo.GetScreenLisParm @screenId, null, @tableId, @tableAbbr, @fKeyColName, @sysDatabase, @desDatabase, '', @allClause OUTPUT, @selfClause OUTPUT, @parameter1Names OUTPUT, @parameter1Types OUTPUT, @parameter1SByte OUTPUT, @calling1Params OUTPUT, @param1Sql OUTPUT, @declare1Sql OUTPUT
	END
	IF @pKey = 'Y' AND @masterTable = 'Y'
	BEGIN
		SELECT @fKeyColName = @dbColumnName	-- Foreign key to master table.
		/*
		SELECT	 @searchTableName = CASE WHEN d.MultiDesignDb='N' THEN s.dbAppDatabase+'.dbo.'+d.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+d.TableName ELSE 'dbo.'+d.TableName END
			,@searchColumnName = c.ColumnName
			,@searchAscending = a.SearchAscending
			FROM dbo.Screen a
			LEFT OUTER JOIN dbo.DbColumn c ON a.SearchId = c.ColumnId
			LEFT OUTER JOIN dbo.DbTable d ON c.TableId = d.TableId
			LEFT OUTER JOIN RODesign.dbo.Systems s ON d.SystemId = s.SystemId
			WHERE a.ScreenId = @screenId
		IF @@ROWCOUNT <> 1 RAISERROR('Please specify search column and try again.',18,2) WITH SETERROR
		IF @searchTableName <> @tableName RAISERROR('Search column %s of table %s must belong to the master table %s, operation aborted.',18,2,@columnName,@searchTableName,@tableName) WITH SETERROR
		*/
		SELECT @pKeyParamName = @dbColumnName, @pKeyDataType = @dataTypeSysName, @pKeyTableName = @tableName, @pKeyTableAbbr = @tableAbbr
		IF CHARINDEX(',@keyId',@paramKeySql) = 0
		BEGIN
			SELECT	 @paramKeySql = @paramKeySql + ',@keyId' + CHAR(9) + CHAR(9) + 'nvarchar(1000)' + CHAR(13)
				,@parameter2Types = @parameter2Types + ',' + @dataTypeSysName
				,@parameter2SByte = @parameter2SByte + ',' + @dataTypeSByteOle
				,@parameter2DByte = @parameter2DByte + ',' + @dataTypeDByteOle
		END
		IF @numericData = 'Y'
			SELECT @whereClause = 'SELECT @wClause = ''''WHERE ' + @tableAbbr + '.' + @dbColumnName + ''''' + case when @KeyId' + ' is null then '''' is null'''' else ''''='''' + convert(varchar,@KeyId) end' + CHAR(13)
		ELSE
			SELECT @whereClause = 'SELECT @wClause = ''''WHERE ' + @tableAbbr + '.' + @dbColumnName + ''''' + case when @KeyId' + ' is null then '''' is null'''' else ''''='''''''''''' + convert(varchar,@KeyId) + '''''''''''''''' end' + CHAR(13)
	END
	IF @tableId is NOT NULL
	BEGIN
		IF @displayMode <> 'Currency' AND @ddlKeyTableName IS NOT NULL AND @ddlRefTableName IS NOT NULL AND CHARINDEX(@ddlKeyTableAbbr + space(1),@from3Clause) = 0 AND NOT (@pullColumn = 'Y' AND @ddlKeyTableName = @ddlRefTableName)
		BEGIN
			SELECT @joinColumn1=d.ColumnName, @joinColumn2=e.ColumnName
			FROM dbo.DbKey a
				INNER JOIN dbo.DbTable b ON a.TableId = b.TableId
				INNER JOIN RODesign.dbo.Systems s1 ON b.SystemId = s1.SystemId AND CASE
					WHEN b.MultiDesignDb='N' THEN s1.dbAppDatabase+'.dbo.'+b.TableName
					WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+b.TableName
					ELSE 'dbo.'+b.TableName END = case when @ddlKeyTableName = @ddlRefTableName then
					case when @masterTable = 'Y' then @tableName else @dtlTableName end else @ddlRefTableName end
				INNER JOIN dbo.DbColumn d ON a.ColumnId = d.ColumnId
				INNER JOIN dbo.DbTable c ON a.RefTableId = c.TableId
				INNER JOIN RODesign.dbo.Systems s2 ON c.SystemId = s2.SystemId AND CASE
					WHEN c.MultiDesignDb='N' THEN s2.dbAppDatabase+'.dbo.'+c.TableName
					WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+c.TableName
					ELSE 'dbo.'+c.TableName END = @ddlKeyTableName
				INNER JOIN dbo.DbColumn e ON a.RefColumnId = e.ColumnId
			IF @@ROWCOUNT <= 0 AND @tableName <> @ddlKeyTableName
				RAISERROR('Foreign key relationship has not been established for tables (%s/%s) and %s.',18,2,@tableName,@dtlTableName,@ddlKeyTableName) WITH SETERROR
			IF @masterTable <> 'Y'
			BEGIN
				IF @ddlKeyTableDb <> ''
				BEGIN
					-- The space before CHAR(13) is needed for @foundEnd evaluation:
					IF @ddlKeyTableDb <> '' AND @ddlKeyTableDb <> 'RODesign' AND @ddlKeyTableDb <> 'ROCmon'
					BEGIN
						SELECT @from3Clause = @from3Clause + ' ' + CHAR(13) + 'IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name=''''' + @ddlKeyTableDb + ''''')'
						IF @ddlKeyTableDb <> @ddlRefTableDb AND @ddlRefTableDb <> '' AND @ddlRefTableDb <> 'RODesign' AND @ddlRefTableDb <> 'ROCmon'
							SELECT @from3Clause = @from3Clause + ' AND EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name=''''' + @ddlRefTableDb + ''''')'
					END
				END
				SELECT @from3Clause = @from3Clause + ' ' + CHAR(13) + 'SELECT @fClause = @fClause + '''' '
				SELECT @from3Clause = @from3Clause + 'LEFT OUTER JOIN '		-- No inner join so rows will show up even when DDL not found.
				IF @ddlKeyTableName <> @ddlRefTableName AND SUBSTRING(@from3Clause,CHARINDEX(@ddlRefTableName,@from3Clause)+LEN(@ddlRefTableName)+9,1) = ')' AND CHARINDEX(@joinColumn2,@from3Clause) <= 0
					SELECT @from3Clause = REPLACE(@from3Clause,' FROM ' + @ddlRefTableName,',' + @joinColumn2 + ' FROM ' + @ddlRefTableName)
				SELECT @from3Clause = @from3Clause + '(SELECT DISTINCT ' + @joinColumn2
				IF @joinColumn2 <> @ddlRefColumnName AND @ddlKeyTableName = @ddlRefTableName SELECT @from3Clause = @from3Clause + ',' + @ddlRefColumnName
				IF @joinColumn2 <> @ddlKeyColumnName SELECT @from3Clause = @from3Clause + ',' + @ddlKeyColumnName
				IF @ddlAdnColumnName IS NOT NULL AND @ddlFtrTableId = @TableId SELECT @from3Clause = @from3Clause + ',' + @ddlAdnColumnName
				SELECT @from3Clause = @from3Clause + ' FROM ' + @ddlKeyTableName + ' (NOLOCK))' + @ddlKeyTableAbbr + ' ON '
				+ case when @ddlKeyTableName = @ddlRefTableName then @tableAbbr + '.' + @dbColumnName else @ddlRefTableAbbr + '.' + @joinColumn1 end + ' = ' + @ddlKeyTableAbbr + '.' + @joinColumn2
				+ case when @ddlAdnColumnName IS NOT NULL AND @ddlFtrColumnName IS NOT NULL AND @ddlFtrTableId = @TableId then ' AND ' + @ddlFtrTableAbbr + '.' + @ddlFtrColumnName + ' = ' + @ddlKeyTableAbbr + '.' + @ddlAdnColumnName else '' end
				+ ''''''
			END
		END
		IF @masterTable <> 'Y'
		BEGIN
			-- Listbox and DataGrid are currently multiple selection and may return duplicate rows:
			IF lower(@displayName) IN ('combobox','dropdownlist','radiobuttonlist')
			BEGIN
				IF @ddlKeyTableName is NULL OR @ddlRefTableName is NULL RAISERROR('Reference column ID for Drop down column %s is missing.',18,2,@columnName) WITH SETERROR
				IF @select3Clause <> ''
				BEGIN
					IF right(@select3Clause,4) <> ' end' SELECT @select3Clause = @select3Clause + ''''''
					SELECT @select3Clause = @select3Clause + CHAR(13) + '+ '''', '
				END
				SELECT @select3Clause = @select3Clause + @columnName + CONVERT(VARCHAR,@tableId)
				IF @ddlKeyTableDb <> '' AND @ddlTableAbbr <> @dtlTableAbbr AND @ddlKeyTableDb <> 'RODesign' AND @ddlKeyTableDb <> 'ROCmon'
					SELECT @select3Clause = @select3Clause + '='''' + case when charindex(''''' + @ddlKeyTableAbbr + ' '''',@fClause) > 0 then ''''' + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName + ''''' else ''''null'''' end'
				ELSE
					SELECT @select3Clause = @select3Clause + '=' + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName
				IF @select3Clause <> ''
				BEGIN
					IF right(@select3Clause,4) <> ' end' SELECT @select3Clause = @select3Clause + ''''''
					SELECT @select3Clause = @select3Clause + CHAR(13) + '+ '''', '
				END
				SELECT @select3Clause = @select3Clause + @columnName + CONVERT(VARCHAR,@tableId) + 'Text'
				IF @ddlKeyTableDb <> '' AND @ddlTableAbbr <> @dtlTableAbbr AND @ddlKeyTableDb <> 'RODesign' AND @ddlKeyTableDb <> 'ROCmon'
					SELECT @select3Clause = @select3Clause  + '='''' + case when charindex(''''' + @ddlKeyTableAbbr + ' '''',@fClause) > 0 then ''''' + @ddlKeyTableAbbr + '.' + @ddlRefColumnName + ''''' else ''''null'''' end'
				ELSE
					SELECT @select3Clause = @select3Clause + '=' + @ddlKeyTableAbbr + '.' + @ddlRefColumnName
			END
			ELSE
			BEGIN
				SELECT @fr3 = replace(@from3Clause,'''',space(0))
				IF @pullColumn = 'Y'
				BEGIN
					SELECT @ii = CHARINDEX(@tableName+' (NOLOCK))',@fr3), @foundIndex = 0, @tableLen = 0
					WHILE @ii > 0
					BEGIN
						SELECT @foundIndex = @ii + @foundIndex + @tableLen + 9, @tableLen = LEN(@tableName)
						SELECT @ii = CHARINDEX(@tableName+' (NOLOCK))',RIGHT(@fr3,LEN(@fr3) - @foundIndex - @tableLen))
					END
				END
				ELSE SELECT @foundIndex = CHARINDEX(@tableName,@fr3)
				IF @foundIndex <= 0 RAISERROR('Table %s needs to be from a Drop Down column of a smaller TabIndex.',18,2,@tableName) WITH SETERROR
				SELECT @foundEnd = CHARINDEX(' ',right(@fr3,len(@fr3)-(@foundIndex+LEN(@tableName)+1)+1))
				IF @foundEnd <= 0 SELECT @foundLen = LEN(@fr3) - (@foundIndex + LEN(@tableName)) ELSE SELECT @foundLen = @foundEnd - 1
				SELECT @ddlTableAbbr = SUBSTRING(@fr3,@foundIndex + LEN(@tableName) + 1,@foundLen)
				IF SUBSTRING(@fr3,@foundIndex+LEN(@tableName),1) = ')' AND CHARINDEX(@dbColumnName,@fr3) <= 0
					SELECT @from3Clause = REPLACE(@from3Clause,' FROM ' + @tableName,',' + @dbColumnName + ' FROM ' + @tableName)
				IF @select3Clause <> ''
				BEGIN
					IF right(@select3Clause,4) <> ' end' SELECT @select3Clause = @select3Clause + ''''''
					SELECT @select3Clause = @select3Clause + CHAR(13) + '+ '''', '
				END
				SELECT @select3Clause = @select3Clause + @columnName + CONVERT(VARCHAR,@tableId)
				IF @ddlTableAbbr <> @dtlTableAbbr AND @tableDb <> 'RODesign' AND @tableDb <> 'ROCmon'
					SELECT @select3Clause = @select3Clause + '='''' + case when charindex(''''' + @ddlTableAbbr + ' '''',@fClause) > 0 then ''''' + @ddlTableAbbr + '.' + @dbColumnName + ''''' else ''''null'''' end'
				ELSE
					SELECT @select3Clause = @select3Clause + '=' + @ddlTableAbbr + '.' + @dbColumnName
				/* The following takes care of link column different from column displaying image */
				IF lower(@displayMode) IN ('imagelink','imagepopup') AND @columnName <> @ddlKeyColumnName
				BEGIN
					IF @select3Clause <> ''
					BEGIN
						IF right(@select3Clause,4) <> ' end' SELECT @select3Clause = @select3Clause + ''''''
						SELECT @select3Clause = @select3Clause + CHAR(13) + '+ '''', '
					END
					SELECT @select3Clause = @select3Clause + @ddlKeyColumnName + CONVERT(VARCHAR,@tableId)
					IF @ddlKeyTableDb <> '' AND @ddlTableAbbr <> @dtlTableAbbr AND @ddlKeyTableDb <> 'RODesign' AND @ddlKeyTableDb <> 'ROCmon'
						SELECT @select3Clause = @select3Clause + '='''' + case when charindex(''''' + @ddlKeyTableAbbr + ' '''',@fClause) > 0 then ''''' + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName + ''''' else ''''null'''' end'
					ELSE
						SELECT @select3Clause = @select3Clause + '=' + @ddlTableAbbr + '.' + @ddlKeyColumnName
				END
			END
		END
	END
	ELSE	-- Get the label instead.
	BEGIN
		IF @masterTable <> 'Y'
		BEGIN
			IF @select3Clause <> ''
			BEGIN
				IF right(@select3Clause,4) <> ' end' SELECT @select3Clause = @select3Clause + ''''''
				SELECT @select3Clause = @select3Clause + CHAR(13) + '+ '''', '
			END
			SELECT @CultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
			SELECT @select3Clause = @select3Clause + @columnName + '=''''''''' + isnull(@DefaultValue,isnull(ColumnHeader,space(0))) + ''''''''''
				FROM dbo.ScreenObjHlp WHERE ScreenObjId = @ScreenObjId AND CultureId = @CultureId
		END
	END
	/* The following takes care of dynamic hyperlinks in detail table */
	IF @displayName = 'HyperLink' AND @ddlKeyColumnName is not null AND @ddlKeyTableId is not null AND @masterTable <> 'Y'
	BEGIN
		IF @select3Clause <> ''
		BEGIN
			IF right(@select3Clause,4) <> ' end' SELECT @select3Clause = @select3Clause + ''''''
			SELECT @select3Clause = @select3Clause + CHAR(13) + '+ '''', '
		END
		SELECT @select3Clause = @select3Clause + @ddlKeyColumnName + CONVERT(VARCHAR,@ddlKeyTableId) + 'URL'
		IF @ddlKeyTableDb <> '' AND @ddlTableAbbr <> @dtlTableAbbr AND @ddlKeyTableDb <> 'RODesign' AND @ddlKeyTableDb <> 'ROCmon'
			SELECT @select3Clause = @select3Clause + '='''' + case when charindex(''''' + @ddlKeyTableAbbr + ' '''',@fClause) > 0 then ''''' + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName + ''''' else ''''null'''' end'
		ELSE
			SELECT @select3Clause = @select3Clause + '=' + @ddlTableAbbr + '.' + @ddlKeyColumnName
	END
	FETCH NEXT FROM objCursor INTO @ScreenObjId, @masterTable, @tableId, @tableAbbr, @tableName, @columnName, @dbColumnName, @DataTypeSqlName
	, @dataTypeSysName, @dataTypeSByteOle, @dataTypeDByteOle, @numericData, @displayName, @displayMode, @pKey, @allowNulls
	, @ddlKeyTableId, @ddlKeyTableAbbr, @ddlKeyTableName, @ddlKeyColumnName, @ddlRefTableId, @ddlRefTableAbbr, @ddlRefTableName, @ddlRefColumnName
	, @ddlAdnTableId, @ddlAdnTableAbbr, @ddlAdnTableName, @ddlAdnColumnName, @ddlFtrTableId, @ddlFtrTableAbbr, @ddlFtrTableName, @ddlFtrColumnName
	, @pullColumn, @tableDb, @ddlKeyTableDb, @ddlRefTableDb, @DefaultValue
END
CLOSE objCursor
DEALLOCATE objCursor
/* Prepare Detail table select procedure */
SELECT @whereClause = replace(@whereClause,@pKeyTableAbbr+'.',@dtlTableAbbr+'.')
SELECT @proc3Name = 'Get' + @procedureName + 'DtlById', @from3Clause = left(@from3Clause,len(@from3Clause)-2)
IF @select3Clause <> '' AND right(@select3Clause,4) = ' end' SELECT @select3Clause = @select3Clause + ' + '''''
EXEC dbo.GetSortOrder @screenId,@from3Clause,@sysDatabase,'N',@order3Clause OUTPUT
SELECT @from3Clause = replace(@from3Clause,' (NOLOCK)',space(0))	-- Ready for update.
EXEC dbo.GetScreenLis3Proc @proc3Name, @paramKeySql, @param1Sql, @declare1Sql, @select3Clause, @from3Clause, @order3Clause, @whereClause, @allClause, @selfClause, @screenId, @sysDatabase, @procedureSql1 OUTPUT, @procedureSql2 OUTPUT, @procedureSql3 OUTPUT
IF @procedureSql1 is null or @procedureSql2 is null or @procedureSql3 is null
BEGIN
	RAISERROR('Stored Procedure3 %s not generated because of null; Possibly no column has been selected for detail grid.',18,2,@proc3Name) WITH SETERROR
	RETURN 1
END
SELECT @dropProcedure3Sql = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''' + @proc3Name + ''''') AND type = ''''P'''') DROP PROCEDURE ' + @proc3Name
IF @multiDesignDb = 'Y'
BEGIN
	DECLARE sysCursor CURSOR FOR SELECT dbDesDatabase FROM RODesign.dbo.Systems FOR READ ONLY
	OPEN sysCursor
	FETCH NEXT FROM sysCursor INTO @sysDatabase
	WHILE @@FETCH_STATUS = 0
	BEGIN
		EXEC (@sysDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure3Sql + '''')
		EXEC (@sysDatabase + '.dbo.MkStoredProcedure ''' + @procedureSql1 + ''',''' + @procedureSql2 + ''',''' + @procedureSql3 + '''')
		FETCH NEXT FROM sysCursor INTO @sysDatabase
	END
	CLOSE sysCursor
	DEALLOCATE sysCursor
END
ELSE IF @sysProgram <> 'Y'
BEGIN
	-- USE Database is not allowed!  Needs to be replaced by Dynamic EXECUTION.
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure3Sql + '''')
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @procedureSql1 + ''',''' + @procedureSql2 + ''',''' + @procedureSql3 + '''')
END
ELSE
BEGIN
	EXEC (@desDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure3Sql + '''')
	EXEC (@desDatabase + '.dbo.MkStoredProcedure ''' + @procedureSql1 + ''',''' + @procedureSql2 + ''',''' + @procedureSql3 + '''')
END
SELECT 	 parameter1Names='RowAuthoritys'+@parameter1Names
	,parameter1Types='string'+@parameter1Types
	,parameter1SByte='VarChar'+@parameter1SByte
	,parameter2Names='keyId'
	,parameter2Types=RIGHT(@parameter2Types,LEN(@parameter2Types)-1)
	,parameter2SByte=RIGHT(@parameter2SByte,LEN(@parameter2SByte)-1)
	,parameter2DByte=RIGHT(@parameter2DByte,LEN(@parameter2DByte)-1)
	,calling2Params='c'+@procedureName+'List.SelectedValue'
RETURN 0

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenLisI3ById') AND type='P')
DROP PROCEDURE dbo.GetScreenLisI3ById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[GetScreenLisI3ById]
 @screenId		int
,@procedureName		varchar(200)
,@appDatabase		varchar(50)
,@sysDatabase		varchar(50)
,@desDatabase		varchar(50)
,@multiDesignDb		char(1)
,@sysProgram		char(1)
/* WITH ENCRYPTION */
AS
DECLARE		 @proc1Name		varchar(200)
		,@procedure1Sql1	varchar(max)
		,@procedure1Sql2	varchar(max)
		,@procedure1Sql3	varchar(max)
		,@dropProcedure1Sql	varchar(max)
		,@select1Clause		varchar(max)
		,@fromClause		varchar(max)
		,@fr				varchar(max)
		,@orderClause		varchar(max)
		,@allClause			varchar(max)
		,@selfClause		varchar(max)
		,@parameter1Names	varchar(1000)
		,@parameter1Types	varchar(1000)
		,@parameter1SByte	varchar(1000)
		,@calling1Params	varchar(1000)
		,@tableId			int
		,@tableName			varchar(500)
		,@tableAbbr			varchar(10)
		,@pKeyTableAbbr		varchar(10)
		,@columnId			int
		,@columnName		varchar(50)
		,@dbColumnName		varchar(50)
		,@DataTypeSqlName	varchar(30)
		,@displayName		varchar(50)
		,@displayMode		varchar(50)
		,@ddlTableName		varchar(500)
		,@ddlTableAbbr		varchar(10)
		,@ddlColumnName		varchar(50)
		,@joinColumn1		varchar(50)
		,@joinColumn2		varchar(50)
		,@param1Sql			varchar(4000)
		,@declare1Sql		varchar(4000)
		,@pop1Sql			varchar(4000)
		,@allowNulls		char(1)
		,@ddlKeyTableId		int
		,@ddlKeyTableAbbr	varchar(10)
		,@ddlKeyTableName	varchar(500)
		,@ddlKeyColumnName	varchar(50)
		,@ddlRefTableId		int
		,@ddlRefTableAbbr	varchar(10)
		,@ddlRefTableName	varchar(500)
		,@ddlRefColumnName	varchar(50)
		,@ddlAdnTableId		int
		,@ddlAdnTableAbbr	varchar(10)
		,@ddlAdnTableName	varchar(500)
		,@ddlAdnColumnName	varchar(50)
		,@ddlFtrTableId		int
		,@ddlFtrTableAbbr	varchar(10)
		,@ddlFtrTableName	varchar(500)
		,@ddlFtrColumnName	varchar(50)
		,@foundIndex		int
		,@prevIndex			int
		,@foundEnd			int
		,@foundLen			int
		,@criClause			varchar(4000)
		,@paramCriSql		varchar(4000)
		,@MasterTableId		int
		,@pullColumn		char(1)
		,@ii				int
		,@tableLen			int
		,@CultureId			smallint
		,@ScreenObjId		int
		,@tableDb			varchar(50)
		,@ddlKeyTableDb		varchar(50)
		,@ddlRefTableDb		varchar(50)
		,@DefaultValue		nvarchar(100)
SET NOCOUNT ON
SELECT @parameter1Names='', @parameter1Types='', @parameter1SByte='', @calling1Params='', @param1Sql='', @declare1Sql='', @pop1Sql=''
SELECT @select1Clause='', @fromClause='', @allClause='', @selfClause=''
SELECT @MasterTableId = MasterTableId FROM dbo.Screen WHERE ScreenId = @screenId
DECLARE objCursor CURSOR FOR
	SELECT	 a.ScreenObjId
		,b.TableId
		,'b' + convert(varchar,b.TableId)
		,CASE WHEN c.MultiDesignDb='N' THEN s.dbAppDatabase+'.dbo.'+c.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+c.TableName ELSE 'dbo.'+c.TableName END
		,a.columnId
		,a.ColumnName
		,b.ColumnName
		,e.DataTypeSqlName
		,d.TypeName
		,d.TypeDesc
		,b.AllowNulls
		,x1.TableId
		,CASE WHEN a.DdlKeyColumnId is null THEN null ELSE 'x' + convert(varchar,a.ColumnId) END
		,CASE WHEN x2.MultiDesignDb='N' THEN x3.dbAppDatabase+'.dbo.'+x2.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+x2.TableName ELSE 'dbo.'+x2.TableName END
		,x1.ColumnName
		,x4.TableId
		,'x' + convert(varchar,x4.ColumnId)
		,CASE WHEN x8.TableId is null AND x5.MultiDesignDb='N' THEN x6.dbAppDatabase+'.dbo.'+x5.TableName
			WHEN x8.TableId is null AND @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+x5.TableName
			WHEN x8.TableId is null THEN 'dbo.'+x5.TableName
			WHEN x8.TableId is not null AND x8.MultiDesignDb='N' THEN x9.dbAppDatabase+'.dbo.'+x8.TableName
			WHEN x8.TableId is not null AND @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+x8.TableName
			ELSE 'dbo.'+x8.TableName END
		,CASE WHEN x8.TableId is null THEN x4.ColumnName ELSE x7.ColumnName END
		,x11.TableId
		,CASE WHEN a.DdlAdnColumnId is null THEN null ELSE 'x' + convert(varchar,x11.ColumnId) END
		,CASE WHEN x12.MultiDesignDb='N' THEN x13.dbAppDatabase+'.dbo.'+x12.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+x12.TableName ELSE 'dbo.'+x12.TableName END
		,x11.ColumnName
		,x14.TableId
		,CASE WHEN a.DdlFtrColumnId is null THEN null ELSE 'x' + convert(varchar,x14.ColumnId) END
		,CASE WHEN x15.MultiDesignDb='N' THEN x16.dbAppDatabase+'.dbo.'+x15.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+x15.TableName ELSE 'dbo.'+x15.TableName END
		,CASE WHEN x17.ColumnName is NOT NULL THEN x17.ColumnName ELSE x14.ColumnName END	-- Column name of look up table may not be the same.
		,CASE WHEN EXISTS (SELECT 'true' FROM dbo.ScreenObj aa WHERE aa.ScreenId = a.ScreenId AND aa.ColumnId = a.DdlRefColumnId) AND x1.TableId <> x4.TableId THEN 'Y' ELSE 'N' END
		,CASE WHEN c.MultiDesignDb='N' THEN s.dbAppDatabase WHEN @multiDesignDb='N' THEN @sysDatabase ELSE '' END
		,CASE WHEN x2.MultiDesignDb='N' THEN x3.dbAppDatabase WHEN @multiDesignDb='N' THEN @sysDatabase ELSE '' END
		,CASE WHEN x8.TableId is null AND x5.MultiDesignDb='N' THEN x6.dbAppDatabase
			WHEN x8.TableId is null AND @multiDesignDb='N' THEN @sysDatabase
			WHEN x8.TableId is null THEN ''
			WHEN x8.TableId is not null AND x8.MultiDesignDb='N' THEN x9.dbAppDatabase
			WHEN x8.TableId is not null AND @multiDesignDb='N' THEN @sysDatabase
			ELSE '' END
		,replace(a.DefaultValue,'''',space(0))
	FROM dbo.ScreenObj a
		LEFT OUTER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
		LEFT OUTER JOIN dbo.DbTable c ON b.TableId = c.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems s ON c.SystemId = s.SystemId
		LEFT OUTER JOIN RODesign.dbo.CtDataType e ON b.DataType = e.DataTypeId
		LEFT OUTER JOIN RODesign.dbo.CtDisplayType d ON a.DisplayModeId = d.TypeId
		LEFT OUTER JOIN dbo.DbColumn x1 ON a.DdlKeyColumnId = x1.ColumnId
		LEFT OUTER JOIN dbo.DbTable x2 ON x1.TableId = x2.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems x3 ON x2.SystemId = x3.SystemId
		LEFT OUTER JOIN dbo.DbColumn x4 ON a.DdlRefColumnId = x4.ColumnId
		LEFT OUTER JOIN dbo.DbTable x5 ON x4.TableId = x5.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems x6 ON x5.SystemId = x6.SystemId
		LEFT OUTER JOIN dbo.ScreenObj x ON a.DdlRefColumnId = x.ColumnId AND a.ScreenId = x.ScreenId
		LEFT OUTER JOIN dbo.DbColumn x7 ON x.DdlKeyColumnId = x7.ColumnId
		LEFT OUTER JOIN dbo.DbTable x8 ON x7.TableId = x8.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems x9 ON x8.SystemId = x9.SystemId
		LEFT OUTER JOIN dbo.DbColumn x11 ON a.DdlAdnColumnId = x11.ColumnId
		LEFT OUTER JOIN dbo.DbTable x12 ON x11.TableId = x12.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems x13 ON x12.SystemId = x13.SystemId
		LEFT OUTER JOIN dbo.DbColumn x14 ON a.DdlFtrColumnId = x14.ColumnId
		LEFT OUTER JOIN dbo.DbTable x15 ON x14.TableId = x15.TableId
		LEFT OUTER JOIN RODesign.dbo.Systems x16 ON x15.SystemId = x16.SystemId
		LEFT OUTER JOIN (SELECT DISTINCT t1.ColumnId, t2.ColumnName FROM dbo.ScreenObj t1 LEFT OUTER JOIN dbo.DbColumn t2 ON t1.DdlKeyColumnId = t2.ColumnId) x17 ON a.DdlFtrColumnId = x17.ColumnId
	WHERE a.ScreenId = @ScreenId ORDER BY a.TabIndex
FOR READ ONLY
OPEN objCursor
FETCH NEXT FROM objCursor INTO @ScreenObjId, @tableId, @tableAbbr, @tableName, @columnId, @columnName, @dbColumnName, @DataTypeSqlName, @displayName, @displayMode, @allowNulls
	, @ddlKeyTableId, @ddlKeyTableAbbr, @ddlKeyTableName, @ddlKeyColumnName, @ddlRefTableId, @ddlRefTableAbbr, @ddlRefTableName, @ddlRefColumnName
	, @ddlAdnTableId, @ddlAdnTableAbbr, @ddlAdnTableName, @ddlAdnColumnName, @ddlFtrTableId, @ddlFtrTableAbbr, @ddlFtrTableName, @ddlFtrColumnName
	, @pullColumn, @tableDb, @ddlKeyTableDb, @ddlRefTableDb, @DefaultValue
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @CultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
	IF @tableId is NOT NULL
	BEGIN
		IF CHARINDEX(@tableName,@fromClause) = 0
		BEGIN
			EXEC dbo.GetScreenLisCri @screenId, @tableId, @tableAbbr, @criClause OUTPUT, @paramCriSql OUTPUT
			EXEC dbo.GetScreenLisParm @screenId, null, @tableId, @tableAbbr, '', @sysDatabase, @desDatabase, 'Usrs', @allClause OUTPUT, @selfClause OUTPUT, @parameter1Names OUTPUT, @parameter1Types OUTPUT, @parameter1SByte OUTPUT, @calling1Params OUTPUT, @param1Sql OUTPUT, @declare1Sql OUTPUT
			IF @fromClause = '' SELECT @fromClause = @tableName + ' ' + @tableAbbr + ' (NOLOCK)''''', @pKeyTableAbbr = @tableAbbr
		END
		IF @displayMode <> 'Currency' AND @ddlKeyTableName IS NOT NULL AND @ddlRefTableName IS NOT NULL AND CHARINDEX(@ddlKeyTableAbbr + space(1),@fromClause) = 0 AND NOT (@pullColumn = 'Y' AND @ddlKeyTableName = @ddlRefTableName)
		BEGIN
			SELECT @joinColumn1=d.ColumnName, @joinColumn2=e.ColumnName
			FROM dbo.DbKey a
				INNER JOIN dbo.DbTable b ON a.TableId = b.TableId
				INNER JOIN RODesign.dbo.Systems s1 ON b.SystemId = s1.SystemId AND CASE
					WHEN b.MultiDesignDb='N' THEN s1.dbAppDatabase+'.dbo.'+b.TableName
					WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+b.TableName
					ELSE 'dbo.'+b.TableName END = case when @ddlKeyTableName = @ddlRefTableName then @tableName else @ddlRefTableName end
				INNER JOIN dbo.DbColumn d ON a.ColumnId = d.ColumnId
				INNER JOIN dbo.DbTable c ON a.RefTableId = c.TableId
				INNER JOIN RODesign.dbo.Systems s2 ON c.SystemId = s2.SystemId AND CASE
					WHEN c.MultiDesignDb='N' THEN s2.dbAppDatabase+'.dbo.'+c.TableName
					WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+c.TableName
					ELSE 'dbo.'+c.TableName END = @ddlKeyTableName
				INNER JOIN dbo.DbColumn e ON a.RefColumnId = e.ColumnId
			IF @@ROWCOUNT <= 0 AND @tableName <> @ddlKeyTableName
				RAISERROR('Foreign key relationship has not been established for tables %s and %s.',18,2,@tableName,@ddlKeyTableName) WITH SETERROR
			IF @ddlKeyTableDb <> ''
			BEGIN
				-- The space before CHAR(13) is needed for @foundEnd evaluation:
				IF @ddlKeyTableDb <> '' AND @ddlKeyTableDb <> 'RODesign' AND @ddlKeyTableDb <> 'ROCmon'
				BEGIN
					SELECT @fromClause = @fromClause + ' ' + CHAR(13) + 'IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name=''''' + @ddlKeyTableDb + ''''')'
					IF @ddlKeyTableDb <> @ddlRefTableDb AND @ddlRefTableDb <> '' AND @ddlRefTableDb <> 'RODesign' AND @ddlRefTableDb <> 'ROCmon'
						SELECT @fromClause = @fromClause + ' AND EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name=''''' + @ddlRefTableDb + ''''')'
				END
			END
			SELECT @fromClause = @fromClause + ' ' + CHAR(13) + 'SELECT @fClause = @fClause + '''' '
			SELECT @fromClause = @fromClause + 'LEFT OUTER JOIN '	-- No inner join so rows will show up even when DDL not found.
			IF @ddlKeyTableName <> @ddlRefTableName AND SUBSTRING(@fromClause,CHARINDEX(@ddlRefTableName,@fromClause)+LEN(@ddlRefTableName)+9,1) = ')' AND CHARINDEX(@joinColumn1,@fromClause) <= 0
				SELECT @fromClause = REPLACE(@fromClause,' FROM ' + @ddlRefTableName,',' + @joinColumn1 + ' FROM ' + @ddlRefTableName)
			SELECT @fromClause = @fromClause + '(SELECT DISTINCT ' + @joinColumn2
			IF @joinColumn2 <> @ddlRefColumnName AND @ddlKeyTableName = @ddlRefTableName SELECT @fromClause = @fromClause + ',' + @ddlRefColumnName
			IF @joinColumn2 <> @ddlKeyColumnName SELECT @fromClause = @fromClause + ',' + @ddlKeyColumnName
			IF @ddlAdnColumnName IS NOT NULL AND @ddlFtrTableId = @TableId SELECT @fromClause = @fromClause + ',' + @ddlAdnColumnName
			SELECT @fromClause = @fromClause + ' FROM ' + @ddlKeyTableName + ' (NOLOCK))' + @ddlKeyTableAbbr + ' ON '
			+ case when @ddlKeyTableName = @ddlRefTableName then @tableAbbr + '.' + @dbColumnName else @ddlRefTableAbbr + '.' + @joinColumn1 end + ' = ' + @ddlKeyTableAbbr + '.' + @joinColumn2
			+ case when @ddlAdnColumnName IS NOT NULL AND @ddlFtrColumnName IS NOT NULL AND @ddlFtrTableId = @TableId then ' AND ' + @ddlFtrTableAbbr + '.' + @ddlFtrColumnName + ' = ' + @ddlKeyTableAbbr + '.' + @ddlAdnColumnName else '' end
			+ ''''''
		END
		-- Listbox and DataGrid are currently multiple selection and may return duplicate rows:
		IF lower(@displayName) IN ('combobox','dropdownlist','radiobuttonlist')
		BEGIN
			IF @ddlKeyTableName is NULL OR @ddlRefTableName is NULL RAISERROR('Reference column ID for Drop down column %s is missing.',18,2,@columnName) WITH SETERROR
			IF @select1Clause <> ''
			BEGIN
				IF right(@select1Clause,4) <> ' end' SELECT @select1Clause = @select1Clause + ''''''
				SELECT @select1Clause = @select1Clause + CHAR(13) + '+ '''', '
			END
			SELECT @select1Clause = @select1Clause + @columnName + CONVERT(VARCHAR,@tableId)
			IF @ddlKeyTableDb <> '' AND @ddlTableAbbr <> @pKeyTableAbbr AND @ddlKeyTableDb <> 'RODesign' AND @ddlKeyTableDb <> 'ROCmon'
				SELECT @select1Clause = @select1Clause + '='''' + case when charindex(''''' + @ddlKeyTableAbbr + ' '''',@fClause) > 0 then ''''' + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName + ''''' else ''''null'''' end'
			ELSE
				SELECT @select1Clause = @select1Clause + '=' + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName
			IF @select1Clause <> ''
			BEGIN
				IF right(@select1Clause,4) <> ' end' SELECT @select1Clause = @select1Clause + ''''''
				SELECT @select1Clause = @select1Clause + CHAR(13) + '+ '''', '
			END
			SELECT @select1Clause = @select1Clause + @columnName + CONVERT(VARCHAR,@tableId) + 'Text'
			IF @ddlKeyTableDb <> '' AND @ddlTableAbbr <> @pKeyTableAbbr AND @ddlKeyTableDb <> 'RODesign' AND @ddlKeyTableDb <> 'ROCmon'
				SELECT @select1Clause = @select1Clause  + '='''' + case when charindex(''''' + @ddlKeyTableAbbr + ' '''',@fClause) > 0 then ''''' + @ddlKeyTableAbbr + '.' + @ddlRefColumnName + ''''' else ''''null'''' end'
			ELSE
				SELECT @select1Clause = @select1Clause + '=' + @ddlKeyTableAbbr + '.' + @ddlRefColumnName
		END
		ELSE
		BEGIN
			SELECT @fr = replace(@fromClause,'''',space(0))
			IF @pullColumn = 'Y'
			BEGIN
				SELECT @ii = CHARINDEX(@tableName+' (NOLOCK))',@fr), @foundIndex = 0, @tableLen = 0
				WHILE @ii > 0
				BEGIN
					SELECT @prevIndex = @foundIndex, @foundIndex = @ii + @foundIndex + @tableLen + 9, @tableLen = LEN(@tableName)
					SELECT @ii = CHARINDEX(@tableName+' (NOLOCK))',RIGHT(@fr,LEN(@fr) - @foundIndex - @tableLen))
				END
			END
			ELSE SELECT @foundIndex = CHARINDEX(@tableName,@fr)
			IF @foundIndex <= 0 RAISERROR('Table %s needs to be from a Drop Down column of a smaller TabIndex.',18,2,@tableName) WITH SETERROR
			SELECT @foundEnd = CHARINDEX(' ',right(@fr,len(@fr)-(@foundIndex+LEN(@tableName)+1)+1))
			IF @foundEnd <= 0 SELECT @foundLen = LEN(@fr) - (@foundIndex + LEN(@tableName)) ELSE SELECT @foundLen = @foundEnd - 1
			SELECT @ddlTableAbbr = SUBSTRING(@fr,@foundIndex + LEN(@tableName) + 1,@foundLen)
			IF SUBSTRING(@fr,@foundIndex+LEN(@tableName),1) = ')' AND CHARINDEX(@dbColumnName,right(@fr,len(@fr)-@prevIndex+1)) <= 0
				SELECT @fromClause = REPLACE(@fromClause,' FROM ' + @tableName+' (NOLOCK))'+@ddlTableAbbr,',' + @dbColumnName + ' FROM ' + @tableName+' (NOLOCK))'+@ddlTableAbbr)
			IF @select1Clause <> ''
			BEGIN
				IF right(@select1Clause,4) <> ' end' SELECT @select1Clause = @select1Clause + ''''''
				SELECT @select1Clause = @select1Clause + CHAR(13) + '+ '''', '
			END
			SELECT @select1Clause = @select1Clause + @columnName + CONVERT(VARCHAR,@tableId)
			IF @ddlTableAbbr <> @pKeyTableAbbr AND @tableDb <> 'RODesign' AND @tableDb <> 'ROCmon'
				SELECT @select1Clause = @select1Clause + '='''' + case when charindex(''''' + @ddlTableAbbr + ' '''',@fClause) > 0 then ''''' + @ddlTableAbbr + '.' + @dbColumnName + ''''' else ''''null'''' end'
			ELSE
				SELECT @select1Clause = @select1Clause + '=' + @ddlTableAbbr + '.' + @dbColumnName
		END
	END
	ELSE
	BEGIN
		IF @select1Clause <> ''
		BEGIN
			IF right(@select1Clause,4) <> ' end' SELECT @select1Clause = @select1Clause + ''''''
			SELECT @select1Clause = @select1Clause + CHAR(13) + '+ '''', '
		END
		IF @displayName = 'TextBox'
			SELECT @select1Clause = @select1Clause + @columnName + '='''''''''''''''''
		ELSE	-- Get the label instead.
			SELECT @select1Clause = @select1Clause + @columnName + '=''''''''' + isnull(@DefaultValue,isnull(ColumnHeader,space(0))) + '''''''''' FROM dbo.ScreenObjHlp WHERE ScreenObjId = @ScreenObjId AND CultureId = @CultureId
	END
	/* The following takes care of dynamic hyperlinks. Don't forget to add " AND @masterTable = 'Y'" for GetScreenLis1ById */
	IF @displayName = 'HyperLink' AND @ddlKeyColumnName is not null AND @ddlKeyTableId is not null
	BEGIN
		IF @select1Clause <> ''
		BEGIN
			IF right(@select1Clause,4) <> ' end' SELECT @select1Clause = @select1Clause + ''''''
			SELECT @select1Clause = @select1Clause + CHAR(13) + '+ '''', '
		END
		SELECT @select1Clause = @select1Clause + @ddlKeyColumnName + CONVERT(VARCHAR,@ddlKeyTableId) + 'URL'
		IF @ddlKeyTableDb <> '' AND @ddlTableAbbr <> @pKeyTableAbbr AND @ddlKeyTableDb <> 'RODesign' AND @ddlKeyTableDb <> 'ROCmon'
			SELECT @select1Clause = @select1Clause + '='''' + case when charindex(''''' + @ddlKeyTableAbbr + ' '''',@fClause) > 0 then ''''' + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName + ''''' else ''''null'''' end'
		ELSE
			SELECT @select1Clause = @select1Clause + '=' + @ddlTableAbbr + '.' + @ddlKeyColumnName
	END
	FETCH NEXT FROM objCursor INTO @ScreenObjId, @tableId, @tableAbbr, @tableName, @columnId, @columnName, @dbColumnName, @DataTypeSqlName, @displayName, @displayMode, @allowNulls
		, @ddlKeyTableId, @ddlKeyTableAbbr, @ddlKeyTableName, @ddlKeyColumnName, @ddlRefTableId, @ddlRefTableAbbr, @ddlRefTableName, @ddlRefColumnName
		, @ddlAdnTableId, @ddlAdnTableAbbr, @ddlAdnTableName, @ddlAdnColumnName, @ddlFtrTableId, @ddlFtrTableAbbr, @ddlFtrTableName, @ddlFtrColumnName
		, @pullColumn, @tableDb, @ddlKeyTableDb, @ddlRefTableDb, @DefaultValue
END
CLOSE objCursor
DEALLOCATE objCursor
SELECT @proc1Name = 'GetLis' + @procedureName, @fromClause = left(@fromClause,len(@fromClause)-2)
IF @select1Clause <> '' AND right(@select1Clause,4) = ' end' SELECT @select1Clause = @select1Clause + ' + '''''
SELECT @select1Clause = @select1Clause + ', MatchCount=COUNT(1) OVER ()'
EXEC dbo.GetSortOrder @screenId,@fromClause,@sysDatabase,'Y',@orderClause OUTPUT
SELECT @fromClause = replace(@fromClause,' (NOLOCK)',space(0))	-- Ready for update.
EXEC dbo.GetScreenLis1Proc @proc1Name, @criClause, @paramCriSql, @param1Sql, @declare1Sql, @select1Clause, @fromClause, @orderClause, @allClause, @selfClause, @screenId, @pKeyTableAbbr, @sysDatabase, @desDatabase, @procedure1Sql1 OUTPUT, @procedure1Sql2 OUTPUT, @procedure1Sql3 OUTPUT
IF @procedure1Sql1 IS NULL OR @procedure1Sql2 IS NULL OR @procedure1Sql3 IS NULL
BEGIN
	RAISERROR('Stored Procedure %s not generated because of null.',18,2,@proc1Name) WITH SETERROR
	RETURN 1
END
SELECT @dropProcedure1Sql = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''' + @proc1Name + ''''') AND type = ''''P'''') DROP PROCEDURE ' + @proc1Name
IF @multiDesignDb = 'Y'
BEGIN
	DECLARE sysCursor CURSOR FOR SELECT dbDesDatabase FROM RODesign.dbo.Systems FOR READ ONLY
	OPEN sysCursor
	FETCH NEXT FROM sysCursor INTO @sysDatabase
	WHILE @@FETCH_STATUS = 0
	BEGIN
		EXEC (@sysDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure1Sql + '''')
		EXEC (@sysDatabase + '.dbo.MkStoredProcedure ''' + @procedure1Sql1 + ''',''' + @procedure1Sql2 + ''',''' + @procedure1Sql3 + '''')
		FETCH NEXT FROM sysCursor INTO @sysDatabase
	END
	CLOSE sysCursor
	DEALLOCATE sysCursor
END
ELSE IF @sysProgram <> 'Y'
BEGIN
	-- USE Database is not allowed!  Needs to be replaced by Dynamic EXECUTION.
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure1Sql + '''')
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @procedure1Sql1 + ''',''' + @procedure1Sql2 + ''',''' + @procedure1Sql3 + '''')
END
ELSE
BEGIN
	EXEC (@desDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedure1Sql + '''')
	EXEC (@desDatabase + '.dbo.MkStoredProcedure ''' + @procedure1Sql1 + ''',''' + @procedure1Sql2 + ''',''' + @procedure1Sql3 + '''')
END
SELECT parameter1Names='Usrs,RowAuthoritys'+@parameter1Names
	,parameter1Types='string,string'+@parameter1Types
	,parameter1SByte='VarChar,VarChar'+@parameter1SByte
RETURN 0

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenLisParm') AND type='P')
DROP PROCEDURE dbo.GetScreenLisParm
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[GetScreenLisParm]
 @screenId			int
,@reportId			int
,@tableId			int
,@tableAbbr			varchar(10)
,@fKeyColName		varchar(50)
,@sysDatabase		varchar(50)
,@desDatabase		varchar(50)
,@skipParam			varchar(50)
,@allClause			varchar(max) OUTPUT
,@selfClause		varchar(max) OUTPUT
,@parameter1Names	varchar(1000) OUTPUT
,@parameter1Types	varchar(1000) OUTPUT
,@parameter1SByte	varchar(1000) OUTPUT
,@calling1Params	varchar(1000) OUTPUT
,@param1Sql			varchar(4000) OUTPUT
,@declare1Sql		varchar(4000) OUTPUT
/* WITH ENCRYPTION */
AS
DECLARE	 @parameterName		varchar(50)
		,@paramColumnName	varchar(50)
		,@tableName			varchar(500)
		,@columnName		varchar(50)
		,@paramAllowNulls	char(1)
		,@paramDataTypeSql	varchar(50)
		,@ExternalTable		varchar(50)
		,@pKeyColName		varchar(50)
		,@AndCondition		char(1)
		,@MultiValue		char(1)
		,@MulCompany		char(1)
		,@MulProject		char(1)
		,@clause			varchar(max)
		,@ExtCompany		varchar(50)
		,@ExtProject		varchar(50)
		,@paramSql			varchar(4000)
SET NOCOUNT ON
SELECT @paramSql = '', @allClause = '', @selfClause = 'SELECT @tClause = ''''''''' + CHAR(13)
SELECT @pKeyColName = ColumnName FROM dbo.DbColumn WHERE TableId = @tableId AND PrimaryKey = 'Y'
IF @pKeyColName is null
BEGIN
	SELECT @tableName = TableName FROM dbo.DbTable WHERE TableId = @tableId
	RAISERROR('Table "%s (%d)" is missing primary key in data table definition.',18,2,@tableName,@tableId) WITH SETERROR
	RETURN 1
END
IF @tableAbbr is null OR rtrim(@tableAbbr) = '' SELECT @tableAbbr = '' ELSE SELECT @tableAbbr = @tableAbbr + '.'
DECLARE PCur CURSOR FOR
	SELECT p2.CtPermKeyParam,p2.CtPermKeyName,p2.TableName,P2.ColumnName,AndCondition = isnull(p4.AndCondition,P2.AndCondition)
		,P2.MultiValue,p1.AllowNulls,p3.DataTypeSqlName,p1.ExternalTable
	FROM dbo.DbColumn p1
	INNER JOIN RODesign.dbo.CtPermKey p2 ON p1.ColumnName = p2.CtPermKeyName
	INNER JOIN RODesign.dbo.CtDataType p3 ON p1.DataType = p3.DataTypeId
	LEFT OUTER JOIN dbo.RowOvrdPrm p4 ON p2.CtPermKeyId = p4.PermKeyId
		AND EXISTS (SELECT 1 FROM dbo.RowOvrd p5 WHERE p4.RowOvrdId = p5.RowOvrdId
		AND (p5.ScreenId = isnull(@screenId,0) OR p5.ReportId = isnull(@reportId,0)))
	WHERE p1.TableId = @tableId AND P2.ColumnName <> @fKeyColName
FOR READ ONLY
OPEN PCur
FETCH NEXT FROM PCur INTO @parameterName, @paramColumnName, @tableName, @columnName, @AndCondition, @MultiValue, @paramAllowNulls, @paramDataTypeSql, @ExternalTable
WHILE @@FETCH_STATUS = 0
BEGIN
	IF @paramColumnName in ('CompanyId','CompanyLs') SELECT @ExtCompany = @ExternalTable, @MulCompany = @MultiValue
	ELSE IF @paramColumnName in ('ProjectId','ProjectLs') SELECT @ExtProject = @ExternalTable, @MulProject = @MultiValue
	IF charindex(','+@parameterName,@parameter1Names) <= 0 AND @parameterName <> @skipParam
	BEGIN
		SELECT @parameter1Names = @parameter1Names + ',' + @parameterName
		SELECT @parameter1Types = @parameter1Types + ',string'
		SELECT @parameter1SByte = @parameter1SByte + ',VarChar'
		SELECT @calling1Params = @calling1Params + ',base.LImpr.' + @parameterName
		SELECT @paramSql = @paramSql + ',@' + @parameterName + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
		SELECT @declare1Sql = @declare1Sql + CHAR(9) + ',@' + @columnName + CHAR(9) + CHAR(9) + @paramDataTypeSql + CHAR(13)
	END
	SELECT @clause = 'EXEC ' + @sysDatabase + '.dbo.GetPermFilter '
		+ case when @reportId is not null then 'null,@reportId' else '@screenId,null' end
		+ ',@RowAuthoritys,@' + @parameterName + ',''''' + @paramColumnName
		+ ''''',''''' + @tableName + ''''',''''' + @tableAbbr + ''''',''''' + @AndCondition + ''''',''''' + @MultiValue + ''''','
		+ case when @ExternalTable is null then 'null' else '''''' + @ExternalTable + '''''' end + ',''''' + @paramAllowNulls + ''''',''''' + @pKeyColName
		+ ''''',' + case when @AndCondition = 'N' then '@tClause' else '@wClause' end + ' OUTPUT,@Usrs' + CHAR(13)
	IF @AndCondition = 'N' SELECT @selfClause = @selfClause + @clause ELSE SELECT @allClause = @allClause + @clause
	FETCH NEXT FROM PCur INTO @parameterName, @paramColumnName, @tableName, @columnName, @AndCondition, @MultiValue, @paramAllowNulls, @paramDataTypeSql, @ExternalTable
END
CLOSE PCur DEALLOCATE PCur
SELECT @selfClause = @selfClause + 'IF @tClause <> '''''''' SELECT @wClause = @wClause + '''' AND ('''' + right(@tClause,len(@tClause)-4) + '''')''''' + CHAR(13)
IF charindex('Companys',@paramSql) > 0
	SELECT @selfClause = @selfClause + 'EXEC ' + @sysDatabase + '.dbo.GetCurrFilter @currCompanyId,'''''
		+ case when @MulCompany = 'Y' then 'CompanyLs' else 'CompanyId' end + ''''',''''Company'''','''''
		+ @tableAbbr + ''''',''''' + @MulCompany + ''''',' + isnull('''''' + @ExtCompany + '''''','null') + ',''''' + @pKeyColName + ''''',@wClause OUTPUT' + CHAR(13)
IF charindex('Projects',@paramSql) > 0
	SELECT @selfClause = @selfClause + 'EXEC ' + @sysDatabase + '.dbo.GetCurrFilter @currProjectId,'''''
		+ case when @MulProject = 'Y' then 'ProjectLs' else 'ProjectId' end + ''''',''''Project'''','''''
		+ @tableAbbr + ''''',''''' + @MulProject + ''''',' + isnull('''''' + @ExtProject + '''''','null') + ',''''' + @pKeyColName + ''''',@wClause OUTPUT' + CHAR(13)
SELECT @param1Sql = @param1Sql + @paramSql
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenList') AND type='P')
DROP PROCEDURE dbo.GetScreenList
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[GetScreenList]
 @searchTxt		nvarchar(25)
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
	,@oClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.ScreenId, ScreenType = c.ScreenTypeName, b.GenerateSc, b.GenerateSr, b.ReactGenerated, b.ProgramName'
+ ', ScreenTitle = a.ScreenTitle + CASE'
+ ' WHEN b.GenerateSc = ''N'' AND b.GenerateSr = ''N'' THEN '' (no gen)'''
+ ' WHEN b.GenerateSc = ''Y'' AND b.GenerateSr = ''N'' THEN '' (cln gen)'''
+ ' WHEN b.GenerateSc = ''N'' AND b.GenerateSr = ''Y'' THEN '' (srv gen)'''
+ ' WHEN c.ScreenTypeName = ''I3'' THEN '' ( -- no react gen -- )'''
+ ' ELSE space(0) END'
SELECT @fClause = 'FROM dbo.ScreenHlp a'
+ ' INNER JOIN dbo.Screen b ON a.ScreenId = b.ScreenId'
+ ' INNER JOIN RODesign.dbo.CtScreenType c ON b.ScreenTypeId = c.ScreenTypeId'
+ ' INNER JOIN RODesign.dbo.VwCulture d ON a.CultureId = d.CultureId AND d.CultureDefault = ''Y'''
IF (@searchTxt IS NULL OR @searchTxt = '')
	SELECT @wClause = ''
ELSE
	SELECT @wClause = 'WHERE a.ScreenTitle + CASE'
	+ ' WHEN b.GenerateSc = ''N'' AND b.GenerateSr = ''N'' THEN '' (no gen)'''
	+ ' WHEN b.GenerateSc = ''Y'' AND b.GenerateSr = ''N'' THEN '' (cln gen)'''
	+ ' WHEN b.GenerateSc = ''N'' AND b.GenerateSr = ''Y'' THEN '' (srv gen)'''
	+ ' WHEN c.ScreenTypeName = ''I3'' THEN '' ( -- no react gen -- )'''
	+ ' ELSE space(0) END LIKE ''%' + LOWER(@searchTxt) + '%'''
SELECT @oClause = 'ORDER BY a.ScreenTitle'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenObjDdlById') AND type='P')
DROP PROCEDURE dbo.GetScreenObjDdlById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[GetScreenObjDdlById]
 @screenId		int
,@screenObjId		int
,@procedureName		varchar(200)
,@createProcedure	char(1)
,@appDatabase		varchar(50)
,@sysDatabase		varchar(50)
,@desDatabase		varchar(50)
,@pKey				varchar(50)
,@multiDesignDb		char(1)
/* WITH ENCRYPTION */
AS
DECLARE	 	 @procedureSql1		varchar(max)
		,@procedureSql2		varchar(max)
		,@procedureSql3		varchar(max)
		,@dropProcedureSql	varchar(max)
		,@select1Clause		varchar(max)
		,@select2Clause		varchar(max)
		,@fromClause		varchar(max)
		,@ifClause			varchar(max)
		,@whereClause		varchar(max)
		,@allClause		varchar(max)
		,@selfClause		varchar(max)
		,@orderClause		varchar(max)
		,@parameterName		varchar(50)
		,@paramColumnName	varchar(50)
		,@paramColumnPKey	char(1)
		,@paramAllowNulls	char(1)
		,@paramDataTypeSqlName	varchar(30)
		,@parameter1Names	varchar(1000)
		,@parameter1Types	varchar(1000)
		,@parameter1SByte	varchar(1000)
		,@calling1Params	varchar(1000)
		,@param1Sql		varchar(4000)
		,@declare1Sql		varchar(4000)
		,@tableId		int
		,@columnName		varchar(50)
		,@displayName		varchar(50)
		,@displayMode		varchar(50)
		,@ddlKeyTableId		int
		,@ddlKeyTableAbbr	varchar(10)
		,@ddlKeyTableName	varchar(500)
		,@ddlKeyDbName		varchar(50)
		,@ddlRefTableAbbr	varchar(10)
		,@ddlRefTableName	varchar(500)
		,@ddlKeyColumnName	varchar(50)
		,@ddlRefColumnName	varchar(50)
		,@ddlSrtColumnTableName		varchar(500)
		,@ddlSrtColumnName	varchar(50)
		,@ddlAdnColumnTableName		varchar(500)
		,@ddlAdnColumnName	varchar(50)
		,@mainTableAbbr		varchar(10)
		,@mainTable		varchar(50)
		,@joinColumn1		varchar(50)
		,@joinColumn2		varchar(50)
		,@ddlKeyDataType	varchar(50)
		,@ddlKeyNumeric		char(1)
		,@ddlKeySByte		varchar(50)
		,@ddlKeyDByte		varchar(50)
		,@paramKeySql		varchar(4000)
		,@paramKeySByte		varchar(50)
		,@paramKeyDByte		varchar(50)
SET NOCOUNT ON
SELECT @parameter1Names='', @parameter1Types='', @parameter1SByte='', @calling1Params='', @param1Sql='', @declare1Sql='', @select1Clause=''
, @select2Clause='', @fromClause='', @ifClause='', @allClause='', @selfClause='', @paramKeySql='', @paramKeySByte='', @paramKeyDByte=''
DECLARE objCursor CURSOR FOR
	SELECT   f.TableId
		,a.ColumnName
		,g.TypeName
		,g.Typedesc
		,c.TableId
		,'a' + convert(varchar,c.TableId)
		,CASE WHEN c.MultiDesignDb='N' THEN s1.dbAppDatabase+'.dbo.'+c.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+c.TableName ELSE 'dbo.'+c.TableName END
		,b.ColumnName
		,'a' + convert(varchar,e.TableId)
		,CASE WHEN e.MultiDesignDb='N' THEN s2.dbAppDatabase+'.dbo.'+e.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+e.TableName ELSE 'dbo.'+e.TableName END
		,d.ColumnName
		,k.ColumnName
		,j.ColumnName
		,DataTypeSqlName = ISNULL(t1.DataTypeSqlName,t2.DataTypeSqlName)
		,NumericData = ISNULL(t1.NumericData,t2.NumericData)
		,DataTypeSByteOle = ISNULL(t1.DataTypeSByteOle,t2.DataTypeSByteOle)
		,DataTypeDByteOle = ISNULL(t1.DataTypeDByteOle,t2.DataTypeDByteOle)
		,s1.dbAppDatabase
		,AdnColumnTableName= LTRIM(RTRIM(ISNULL(j.ExternalTable,'')))
		,SrtColumnTableName= LTRIM(RTRIM(ISNULL(k.ExternalTable,'')))
	FROM dbo.ScreenObj a
		INNER JOIN RODesign.dbo.CtDisplayType g ON a.DisplayModeId = g.TypeId
		INNER JOIN dbo.DbColumn b ON a.DdlKeyColumnId = b.ColumnId INNER JOIN dbo.DbTable c ON b.TableId = c.TableId INNER JOIN RODesign.dbo.Systems s1 ON c.SystemId = s1.SystemId
		INNER JOIN dbo.DbColumn d ON a.DdlRefColumnId = d.ColumnId INNER JOIN dbo.DbTable e ON d.TableId = e.TableId INNER JOIN RODesign.dbo.Systems s2 ON e.SystemId = s2.SystemId
		INNER JOIN RODesign.dbo.CtDataType t2 ON b.DataType = t2.DataTypeId
		LEFT OUTER JOIN dbo.DbColumn f ON a.ColumnId = f.ColumnId
		LEFT OUTER JOIN RODesign.dbo.CtDataType t1 ON f.DataType = t1.DataTypeId
		LEFT OUTER JOIN dbo.DbColumn k ON a.DdlSrtColumnId = k.ColumnId
		LEFT OUTER JOIN dbo.DbColumn j ON a.DdlAdnColumnId = j.ColumnId
	WHERE a.ScreenObjId = @ScreenObjId
		OR (g.TypeName NOT IN ('ComboBox','DropDownList','ListBox','RadioButtonList','DataGrid')
		AND g.Typedesc NOT IN ('Document','Currency')
		AND a.ScreenId = (SELECT ScreenId FROM dbo.ScreenObj WHERE ScreenObjId = @ScreenObjId)
		AND a.DdlRefColumnId = (SELECT ColumnId FROM dbo.ScreenObj WHERE ScreenObjId = @ScreenObjId))
		ORDER BY a.TabIndex
FOR READ ONLY
OPEN objCursor
FETCH NEXT FROM objCursor INTO @tableId, @columnName, @displayName, @displayMode, @ddlKeyTableId, @ddlKeyTableAbbr, @ddlKeyTableName, @ddlKeyColumnName, @ddlRefTableAbbr
	, @ddlRefTableName, @ddlRefColumnName, @ddlSrtColumnName, @ddlAdnColumnName, @ddlKeyDataType, @ddlKeyNumeric, @ddlKeySByte, @ddlKeyDByte, @ddlKeyDbName, @ddlAdnColumnTableName,@ddlSrtColumnTableName
WHILE @@FETCH_STATUS = 0
BEGIN
--	IF @tableId is NOT NULL
--	BEGIN
		IF CHARINDEX(@ddlKeyTableAbbr,@fromClause) = 0
		BEGIN
			EXEC dbo.GetScreenLisParm @screenId, null, @ddlKeyTableId, @ddlKeyTableAbbr, '', @sysDatabase, @desDatabase, '', @allClause OUTPUT, @selfClause OUTPUT, @parameter1Names OUTPUT, @parameter1Types OUTPUT, @parameter1SByte OUTPUT, @calling1Params OUTPUT, @param1Sql OUTPUT, @declare1Sql OUTPUT
			IF @fromClause = ''
				SELECT @mainTable = @ddlKeyTableName, @mainTableAbbr = @ddlKeyTableAbbr, @fromClause = @ddlKeyTableName + ' ' + @ddlKeyTableAbbr
					, @ifClause = 'EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name=''''' + @ddlKeyDbName + ''''')'
			ELSE
			BEGIN
				SELECT @joinColumn1=d.ColumnName, @joinColumn2=e.ColumnName
				FROM dbo.DbKey a
					INNER JOIN dbo.DbTable b ON a.TableId = b.TableId INNER JOIN RODesign.dbo.Systems s1 ON b.SystemId = s1.SystemId
					AND CASE WHEN b.MultiDesignDb='N' THEN s1.dbAppDatabase+'.dbo.'+b.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+b.TableName ELSE 'dbo.'+b.TableName END = @mainTable
					INNER JOIN dbo.DbTable c ON a.RefTableId = c.TableId INNER JOIN RODesign.dbo.Systems s2 ON c.SystemId = s2.SystemId
					AND CASE WHEN c.MultiDesignDb='N' THEN s2.dbAppDatabase+'.dbo.'+c.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+c.TableName ELSE 'dbo.'+c.TableName END = @ddlKeyTableName
						INNER JOIN dbo.DbColumn d ON a.ColumnId = d.ColumnId INNER JOIN dbo.DbColumn e ON a.RefColumnId = e.ColumnId
				IF @@ROWCOUNT <= 0 AND @mainTable <> @ddlKeyTableName
					RAISERROR('Foreign key relationship has not been established for tables %s and %s.',18,2,@mainTable,@ddlKeyTableName) WITH SETERROR
				SELECT @fromClause = @fromClause + ' INNER JOIN ' + @ddlKeyTableName + ' ' + @ddlKeyTableAbbr + ' ON ' + @mainTableAbbr + '.' + @joinColumn1 + ' = ' + @ddlKeyTableAbbr + '.' + @joinColumn2
					, @ifClause = @ifClause + ' AND EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name=''''' + @ddlKeyDbName + ''''')'
			END
			IF @displayName IN ('ComboBox','DropDownList','ListBox','RadioButtonList','DataGrid') OR @displayMode = 'Document'
			BEGIN
				SELECT @paramKeySql = ',@bAll' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
					+ ',@keyId' + CHAR(9) + CHAR(9) + CASE WHEN @displayName = 'ListBox' THEN 'VarChar(4000)'
					ELSE @ddlKeyDataType + CASE WHEN CHARINDEX('Char',@ddlKeyDataType) > 0 THEN '(100)' ELSE space(0) END END + CHAR(13)
				SELECT @paramKeySByte = @ddlKeySByte, @paramKeyDByte = @ddlKeyDByte
				SELECT @whereClause = 'IF @bAll = ''''Y'''' SELECT @wClause = ''''WHERE ((('
				IF EXISTS (SELECT 'true' FROM dbo.DbColumn WHERE TableId = @ddlKeyTableId AND ColumnName = 'Active') AND @displayMode <> 'DataGridLink'
					SELECT @whereClause = @whereClause + @ddlKeyTableAbbr + '.Active = ''''''''Y'''''''''
				ELSE
					SELECT @whereClause = @whereClause + '1=1'
				SELECT @whereClause = @whereClause + ') '''' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '''''''' THEN '''''''' ELSE '''' AND ' + @ddlKeyTableAbbr + '.' + @ddlRefColumnName + ' LIKE N''''''''%'''' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,''''['''',''''[[]''''),''''%'''',''''[%]''''),''''_'''',''''[_]''''), '''''''''''''''',''''''''''''''''''''''''),'''' '''',''''%'''') + ''''%'''''''''''' END + '''') '
					+ ' OR '''' ELSE SELECT @wClause = ''''WHERE (''''' + CHAR(13)
					+ 'IF @keyId is not null SELECT @wClause = @wClause + '''''
				IF @displayMode = 'Document'
					SELECT @whereClause = @whereClause + '(' + @ddlKeyTableAbbr + '.MasterId is null OR ' + @ddlKeyTableAbbr + '.MasterId'
				ELSE
					SELECT @whereClause = @whereClause + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName
				IF @displayName = 'ListBox'
					SELECT @whereClause = @whereClause + ' IN '''' + CASE WHEN left(@keyId,1) = ''''('''' THEN @keyId ELSE ''''('''' + @keyId + '''')'''' END + '''')'''''
				ELSE
				BEGIN
					SELECT @whereClause = @whereClause + ' = '
					IF @displayMode = 'Document' SELECT @whereClause = @whereClause + ''''' + convert(varchar,@keyId) + ''''))'''''
					ELSE
					BEGIN
						IF @ddlKeyNumeric = 'N' SELECT @whereClause = @whereClause + ''''''''''
						SELECT @whereClause = @whereClause + ''''' + convert(varchar,@keyId)'
						IF @ddlKeyNumeric = 'N' SELECT @whereClause = @whereClause + ' + '''''''''''')''''' ELSE SELECT @whereClause = @whereClause + ' + '''')'''''
					END
				END
				SELECT @whereClause = @whereClause + ' ELSE SELECT @wClause = @wClause + ''''1<>1)''''' + CHAR(13)
			END
		END
		IF @displayName IN ('ComboBox','DropDownList','ListBox','RadioButtonList','DataGrid')
		BEGIN
			SELECT @select1Clause = 'distinct '''' + CASE WHEN @topN IS NULL OR @topN <= 0 THEN '''''''' ELSE '''' TOP '''' + CONVERT(varchar(10),@topN) END + '''' ' + @columnName + ISNULL(CONVERT(VARCHAR(10),@tableId),'') + '=' + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName
				+ ', ' + @columnName + ISNULL(CONVERT(VARCHAR(10),@tableId),'') + 'Text=' + @ddlRefTableAbbr + '.' + @ddlRefColumnName
			SELECT @select2Clause = @columnName + ISNULL(CONVERT(VARCHAR(10),@tableId),'') + '=null, ' + @columnName + ISNULL(CONVERT(VARCHAR(10),@tableId),'') + 'Text=null'
			IF NOT EXISTS (SELECT 'true' FROM dbo.Screen WHERE ScreenId = @screenId AND MasterTableId = @ddlKeyTableId)
				AND EXISTS (SELECT 'true' FROM dbo.DbColumn WHERE TableId = @ddlKeyTableId AND ColumnName = @pKey)
				SELECT @select1Clause = @select1Clause + ', ' + @ddlRefTableAbbr + '.' + @pKey, @select2Clause = @select2Clause + ', ' + @pKey + '=null'
			IF EXISTS (SELECT 'true' FROM dbo.DbColumn WHERE TableId = @ddlKeyTableId AND ColumnName = 'Active')
				SELECT @select1Clause = @select1Clause + ', ' + @ddlKeyTableAbbr + '.Active', @select2Clause = @select2Clause + ', Active=null'
			IF @ddlSrtColumnName is not null
			BEGIN
				SELECT @select1Clause = @select1Clause + ', ' + @ddlRefTableAbbr + '.' + @ddlSrtColumnName
					, @select2Clause = @select2Clause + ', ' + @ddlSrtColumnName + '=null'
					, @orderClause = @ddlRefTableAbbr + '.' + @ddlSrtColumnName
				IF @ddlSrtColumnName = @ddlRefColumnName SELECT @orderClause = @orderClause + ' desc'
			END
			ELSE
				SELECT @orderClause = @ddlRefTableAbbr + '.' + @ddlRefColumnName

			IF @ddlAdnColumnName is not null AND (@ddlSrtColumnName is null OR @ddlAdnColumnName <> @ddlSrtColumnName)
				SELECT @select1Clause = @select1Clause + ', ' + CASE WHEN @ddlAdnColumnTableName <> '' THEN 'ex' ELSE @ddlRefTableAbbr END  + '.' + @ddlAdnColumnName, @select2Clause = @select2Clause + ', ' + @ddlAdnColumnName + '=null'
--				SELECT @select1Clause = @select1Clause + ', ' + @ddlRefTableAbbr + '.' + @ddlAdnColumnName, @select2Clause = @select2Clause + ', ' + @ddlAdnColumnName + '=null'
			IF @displayMode = 'ComboBoxNoPunc'
				SELECT @select1Clause = @select1Clause + ', NoPunc=' + @desDatabase + '.dbo.fRmPunc(' + @ddlRefTableAbbr + '.' + @ddlRefColumnName + ')'
					, @select2Clause = @select2Clause + ', NoPunc=null'
			IF @ddlAdnColumnTableName <> ''
			BEGIN
				SELECT @fromClause = @fromClause + ' LEFT OUTER JOIN ' + @ddlAdnColumnTableName + ' ex ON ' + @ddlRefTableAbbr + '.' + @ddlKeyColumnName + ' = ex.' + @ddlKeyColumnName
			END	
			IF EXISTS (select 'true' from dbo.DbColumn where TableId = @ddlKeyTableId AND ColumnName = 'OvrideId' AND PrimaryKey = 'N')
			BEGIN
				SELECT @select1Clause = @select1Clause + ', ' + @ddlKeyTableAbbr + '.OvrideId, ov.PromptAlways, ov.PromptModal'
					, @select2Clause = @select2Clause + ', OvrideId=null, PromptAlways=null, PromptModal=null'
					, @fromClause = @fromClause + ' LEFT OUTER JOIN ' + @desDatabase + '.dbo.Ovride ov ON ' + @ddlKeyTableAbbr + '.OvrideId = ov.OvrideId'
			END
		END
		ELSE IF @displayMode = 'Document'
		BEGIN
			SELECT @select1Clause = @ddlKeyTableAbbr + '.DocId, DocLink=''''''''~/DnLoad.aspx?tbl=' + @ddlRefTableName +'&key='''''''' + convert(varchar,' +@ddlKeyTableAbbr +'.DocId), ' + @ddlKeyTableAbbr + '.DocName, DocSize=convert(varchar,' + @ddlKeyTableAbbr + '.DocSize/1024) + ''''''''KB'''''''', ' + @ddlKeyTableAbbr + '.InputOn, LoginName=b.UsrName, ' + @pKey + '=' + @ddlKeyTableAbbr + '.MasterId'
				, @select2Clause = 'DocId=null, DocLink=null, DocName=null, DocSize=null, InputOn=null, LoginName=null, ' + @pKey + '=null'
				, @orderClause = @ddlKeyTableAbbr + '.InputOn desc'
				, @fromClause = @ddlKeyTableName + ' ' + @ddlKeyTableAbbr + ' INNER JOIN ' + @desDatabase + '.dbo.Usr b ON ' + @ddlKeyTableAbbr + '.InputBy = b.UsrId'
				, @ifClause = 'EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name=''''' + @ddlKeyDbName + ''''')'
		END
		ELSE
		BEGIN
			IF @select1Clause = '' RAISERROR('Drop down columns not defined or in bad order for ScreenObjId %d.',18,2,@ScreenObjId) WITH SETERROR
			IF CHARINDEX(@columnName + CONVERT(VARCHAR(10),@tableId) + '=',@select1Clause) = 0
				SELECT @select1Clause = @select1Clause + ', ' + @ddlKeyColumnName + CONVERT(VARCHAR(10),@tableId) + '=' + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName
					, @select2Clause = @select2Clause + ', ' + @ddlKeyColumnName + CONVERT(VARCHAR(10),@tableId) + '=null'
			/*
				pull in is using the 'raw' dbcolumn name 2016.7.21 gary
				SELECT @select1Clause = @select1Clause + ', ' + @columnName + CONVERT(VARCHAR(10),@tableId) + '=' + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName
					, @select2Clause = @select2Clause + ', ' + @columnName + CONVERT(VARCHAR(10),@tableId) + '=null'
			*/
		END
--	END
	FETCH NEXT FROM objCursor INTO @tableId, @columnName, @displayName, @displayMode, @ddlKeyTableId, @ddlKeyTableAbbr, @ddlKeyTableName, @ddlKeyColumnName, @ddlRefTableAbbr
		, @ddlRefTableName, @ddlRefColumnName, @ddlSrtColumnName, @ddlAdnColumnName, @ddlKeyDataType, @ddlKeyNumeric, @ddlKeySByte, @ddlKeyDByte, @ddlKeyDbName, @ddlAdnColumnTableName,@ddlSrtColumnTableName
END
CLOSE objCursor
DEALLOCATE objCursor
IF @createProcedure = 'Y'
BEGIN
	EXEC dbo.GetScreenObjDdlProc @procedureName, @paramKeySql, @param1Sql, @declare1Sql, @select1Clause, @select2Clause, @ifClause, @fromClause, @whereClause, @orderClause, @allClause, @selfClause, @multiDesignDb, @ddlKeyTableAbbr, @sysDatabase, @desDatabase, @procedureSql1 OUTPUT, @procedureSql2 OUTPUT, @procedureSql3 OUTPUT
	IF @procedureSql1 is null or @procedureSql2 is null or @procedureSql3 is null
	BEGIN
		RAISERROR('Stored Procedure %s not generated because of null.',18,2,@procedureName) WITH SETERROR
		RETURN 1
	END
	SELECT @dropProcedureSql = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''' + @procedureName + ''''') AND type = ''''P'''') DROP PROCEDURE ' + @procedureName
	IF @multiDesignDb = 'Y'
	BEGIN
		DECLARE sysCursor CURSOR FOR SELECT dbDesDatabase FROM RODesign.dbo.Systems FOR READ ONLY
		OPEN sysCursor
		FETCH NEXT FROM sysCursor INTO @sysDatabase
		WHILE @@FETCH_STATUS = 0
		BEGIN
			EXEC (@sysDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedureSql + '''')
			EXEC (@sysDatabase + '.dbo.MkStoredProcedure ''' + @procedureSql1 + ''',''' + @procedureSql2 + ''',''' + @procedureSql3 + '''')
			FETCH NEXT FROM sysCursor INTO @sysDatabase
		END
		CLOSE sysCursor
		DEALLOCATE sysCursor
	END
	ELSE	/* Always on the app database */
	BEGIN
		EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedureSql + '''')
		EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @procedureSql1 + ''',''' + @procedureSql2 + ''',''' + @procedureSql3 + '''')
	END
END
/*
SELECT 	 parameter1Names='RowAuthoritys'+@parameter1Names
	,parameter1Types='string'+@parameter1Types
	,parameter1SByte='VarChar'+@parameter1SByte
	,parameter2Names='keyId'
	,parameter2Types='string'
	,parameter2SByte=@paramKeySByte
	,parameter2DByte=@paramKeyDByte
	,calling2Params='keyId'
	,parameter3Names='filterTxt'
	,parameter3Types='string'
	,parameter3SByte='VarChar'
	,parameter3DByte='VarWChar'
	,calling3Params='filterTxt'
*/
RETURN 0

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenObjDdlProc') AND type='P')
DROP PROCEDURE dbo.GetScreenObjDdlProc
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

/* @param1Sql is replaced by all the parameters in UsrImpr */
CREATE PROCEDURE [dbo].[GetScreenObjDdlProc]
 @procedureName		varchar(200)
,@paramKeySql		varchar(4000)
,@param1Sql		varchar(4000)
,@declare1Sql		varchar(4000)
,@select1Clause		varchar(max)
,@select2Clause		varchar(max)
,@ifClause			varchar(max)
,@fromClause		varchar(max)
,@whereClause		varchar(max)
,@orderClause		varchar(max)
,@allClause		varchar(max)
,@selfClause		varchar(max)
,@multiDesignDb		char(1)
,@tableAbbr		varchar(10)
,@sysDatabase		varchar(50)
,@desDatabase		varchar(50)
,@procedureSql1		varchar(max) OUTPUT
,@procedureSql2		varchar(max) OUTPUT
,@procedureSql3		varchar(max) OUTPUT
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
SELECT @procedureSql1 = 'CREATE PROCEDURE ' + @procedureName + CHAR(13)
+ ' @screenId' + CHAR(9) + CHAR(9) + 'int' + CHAR(13) + @paramKeySql
+ ',@Usrs' + CHAR(9) + CHAR(9) + 'varchar(4000)' + CHAR(13)
+ ',@RowAuthoritys' + CHAR(9) + CHAR(9) + 'varchar(4000)' + CHAR(13)
+ ',@Customers' + CHAR(9) + CHAR(9) + 'varchar(4000)' + CHAR(13)
+ ',@Vendors' + CHAR(9) + CHAR(9) + 'varchar(4000)' + CHAR(13)
+ ',@Members' + CHAR(9) + CHAR(9) + 'varchar(4000)' + CHAR(13)
+ ',@Investors' + CHAR(9) + CHAR(9) + 'varchar(4000)' + CHAR(13)
+ ',@Agents' + CHAR(9) + CHAR(9) + 'varchar(4000)' + CHAR(13)
+ ',@Brokers' + CHAR(9) + CHAR(9) + 'varchar(4000)' + CHAR(13)
+ ',@UsrGroups' + CHAR(9) + CHAR(9) + 'varchar(4000)' + CHAR(13)
+ ',@Companys' + CHAR(9) + CHAR(9) + 'varchar(4000)' + CHAR(13)
+ ',@Projects' + CHAR(9) + CHAR(9) + 'varchar(4000)' + CHAR(13)
+ ',@Cultures' + CHAR(9) + CHAR(9) + 'varchar(4000)' + CHAR(13)
+ ',@Borrowers' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Guarantors' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Lenders' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@currCompanyId' + CHAR(9) + CHAR(9) + 'int' + CHAR(13) 
+ ',@currProjectId' + CHAR(9) + CHAR(9) + 'int' + CHAR(13) 
+ ',@FilterTxt' + CHAR(9) + CHAR(9) + 'nvarchar(1000) = null' + CHAR(13)
+ ',@TopN' + CHAR(9) + CHAR(9) + 'smallint=null' + CHAR(13)
+ CASE WHEN CHARINDEX('@bAll',@paramKeySql) <= 0 THEN
	',@bAll' + CHAR(9) + CHAR(9) + 'char(1)=null' + CHAR(13)
	+ ',@keyId' + CHAR(9) + CHAR(9) + 'varchar(max)=null' + CHAR(13)
  ELSE '' END
+ '/* WITH ENCRYPTION */' + CHAR(13) 
+ 'AS' + CHAR(13) + 'SET NOCOUNT ON' + CHAR(13) + 'DECLARE'
+ CHAR(9) + ' @sClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@fClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@wClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@oClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@tClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
/*
+ CHAR(9) + ',@cc' + CHAR(9) + CHAR(9) + 'varchar(max)' + CHAR(13)
+ CHAR(9) + ',@rr' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ CHAR(9) + ',@pp' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ CHAR(9) + ',@SelUsr' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelUsrGroup' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelCulture' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelCompany' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelAgent' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelBroker' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelCustomer' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelInvestor' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelMember' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelVendor' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@SelProject' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@RowAuthorityId' + CHAR(9) + 'smallint' + CHAR(13) + @declare1Sql
*/
SELECT @procedureSql1 = @procedureSql1 + 'IF ' + @ifClause + CHAR(13) + 'BEGIN' + CHAR(13)
+ 'SELECT @sClause = ''''SELECT ' + @select1Clause + '''''' + CHAR(13)
+ 'SELECT @fClause = ''''FROM ' + @fromClause + '''''' + CHAR(13)
+ 'SELECT @oClause = ''''ORDER BY ' + @orderClause + '''''' + CHAR(13)
SELECT @procedureSql2 = @whereClause + @allClause
SELECT @procedureSql3 = @selfClause
+ 'EXEC (@sClause + '''' '''' + @fClause + '''' '''' + @wClause + '''' '''' + @oClause)' + CHAR(13)
+ 'END' + CHAR(13)
+ 'ELSE' + CHAR(13)
+ CHAR(9) + 'SELECT ' + @select2Clause + ' WHERE 1<>1' + CHAR(13)
+ 'RETURN 0' + CHAR(13)
RETURN 0



 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScreenTab') AND type='P')
DROP PROCEDURE dbo.GetScreenTab
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetScreenTab]
 @ScreenId	int
,@CultureId	smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	@DefCultureId	smallint
IF object_id('tempdb.dbo.#hlp') is not null DROP TABLE dbo.#hlp
CREATE TABLE #hlp (tid smallint IDENTITY(1,1) not null, ScreenTabId int not null, TabFolderName nvarchar(30) not null)
INSERT #hlp (ScreenTabId, TabFolderName) SELECT ScreenTabId, TabFolderName FROM dbo.ScreenTabHlp WHERE CultureId = @CultureId
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF @CultureId <> @DefCultureId
	INSERT #hlp (ScreenTabId, TabFolderName) SELECT a.ScreenTabId, a.TabFolderName FROM dbo.ScreenTabHlp a WHERE a.CultureId = @DefCultureId
	AND NOT EXISTS (SELECT 'true' FROM dbo.ScreenTabHlp b WHERE a.ScreenTabId = b.ScreenTabId AND b.CultureId = @CultureId)
SELECT TabFolderId = a.ScreenTabId, b.TabFolderName, a.TabFolderOrder
	FROM dbo.ScreenTab a
	INNER JOIN #hlp b ON a.ScreenTabId = b.ScreenTabId
	WHERE a.ScreenId = @ScreenId ORDER BY a.TabFolderOrder
DROP TABLE dbo.#hlp
RETURN 0
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetScrImpTmpl') AND type='P')
DROP PROCEDURE dbo.GetScrImpTmpl
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[GetScrImpTmpl]
 @screenId	int
,@cultureId	smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE @xmlTable table (xid int primary key identity(1,1), xml varchar(max))
DECLARE	@DefCultureId		smallint
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'

INSERT INTO @xmlTable
SELECT '<?xml version="1.0"?>'
+'<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"'
+' xmlns:o="urn:schemas-microsoft-com:office:office"'
+' xmlns:x="urn:schemas-microsoft-com:office:excel"'
+' xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"'
+' xmlns:html="http://www.w3.org/TR/REC-html40">'
+ '<Styles>
 <Style ss:ID="Default" ss:Name="Normal">
   <Alignment ss:Vertical="Bottom"/>
   <Borders/>
   <Font ss:FontName="Calibri" x:Family="Swiss" ss:Size="11" ss:Color="#000000"/>
   <Interior/>
   <NumberFormat/>
   <Protection/>
  </Style>
 <Style ss:ID="s19">
   <Interior ss:Color="#FFFF00" ss:Pattern="Solid"/>
  </Style>
 <Style ss:ID="s20">
   <Interior ss:Color="#008000" ss:Pattern="Solid"/>
  </Style>  
 <Style ss:ID="s21">
   <Font ss:FontName="Calibri" x:Family="Swiss" ss:Size="11" ss:Color="#FF0000"/>
  </Style>
 <Style ss:ID="s22">
   <Font ss:FontName="Calibri" x:Family="Swiss" ss:Size="11" ss:Color="#FF0000"/>
   <NumberFormat ss:Format="Short Date"/>
  </Style>
 <Style ss:ID="s23">
   <Font ss:FontName="Calibri" x:Family="Swiss" ss:Size="11" ss:Color="#FF0000"/>
   <NumberFormat/>
  </Style>
 <Style ss:ID="s24">
   <NumberFormat ss:Format="Short Date"/>
  </Style>
 <Style ss:ID="s25">
   <NumberFormat/>
  </Style>
  
</Styles>'
INSERT INTO @xmlTable
SELECT '<Worksheet ss:Name="' + CASE WHEN LEN(ISNULL(s.ProgramName,'')) = 0 THEN 'Sheet1' ELSE s.ProgramName END +'">'
+ '<Table x:FullColumns="1" x:FullRows="1">'
FROM dbo.Screen s
WHERE s.ScreenId = @screenId

INSERT INTO @xmlTable
SELECT '<Column ' + CASE WHEN b.ColumnIdentity = 'Y' THEN 'ss:StyleID="s20"' 
WHEN d.TypeName IN ('DropDownList','ComboBox','ListBox','RadioButtonList') AND y.tag = 1 THEN 'ss:StyleID="s19"'
ELSE '' END  + '/>' 
	FROM dbo.ScreenObj a
		INNER JOIN dbo.Screen c ON a.ScreenId = c.ScreenId
		INNER JOIN dbo.ScreenObjHlp f ON a.ScreenObjId = f.ScreenObjId
		LEFT OUTER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
		LEFT OUTER JOIN RODesign.dbo.CtDataType e ON b.DataType = e.DataTypeId
		LEFT OUTER JOIN RODesign.dbo.CtDisplayType d ON a.DisplayModeId = d.TypeId
		LEFT OUTER JOIN dbo.DbColumn x4 ON a.DdlRefColumnId = x4.ColumnId
		LEFT OUTER JOIN dbo.ScreenObj x ON a.DdlRefColumnId = x.ColumnId AND a.ScreenId = x.ScreenId
		LEFT OUTER JOIN dbo.DbColumn x7 ON x.DdlKeyColumnId = x7.ColumnId
		LEFT OUTER JOIN dbo.DbTable x8 ON x7.TableId = x8.TableId
		OUTER APPLY
		(
		SELECT 1 UNION
		SELECT (CASE WHEN d.TypeName IN ('DropDownList','ComboBox','ListBox','RadioButtonList') THEN 2 ELSE NULL END )
		) Y (tag)	
	WHERE a.ScreenId = @screenId
	AND f.CultureId = CASE WHEN EXISTS (SELECT 1 FROM dbo.ScreenObjHlp x WHERE x.ScreenObjId = a.ScreenObjId AND CultureId = @cultureId) THEN @cultureId ELSE @DefCultureId END
	AND a.MasterTable = (SELECT CASE WHEN b.ScreenTypeName='I2' THEN 'N' ELSE 'Y' END FROM dbo.Screen a INNER JOIN RODesign.dbo.CtScreenType b ON a.ScreenTypeId = b.ScreenTypeId WHERE a.ScreenId = @screenId)
	AND y.tag IS NOT NULL
ORDER BY a.TabIndex

INSERT INTO @xmlTable
SELECT '<Row>'

INSERT INTO @xmlTable
SELECT '<Cell ' 
+ CASE WHEN b.ColumnIdentity='Y' THEN ''
WHEN (b.AllowNulls = 'N' OR a.RequiredValid ='Y') AND e.DataTypeName LIKE '%Date%' AND a.DefaultValue is null THEN 'ss:StyleID="s22"'
WHEN (b.AllowNulls = 'N' OR a.RequiredValid ='Y') AND e.DataTypeName LIKE '%Date%' THEN 'ss:StyleID="s24"'
WHEN (b.AllowNulls = 'N' OR a.RequiredValid ='Y') AND e.NumericData = 'Y' AND a.DefaultValue is null THEN 'ss:StyleID="s23"'
WHEN (b.AllowNulls = 'N' OR a.RequiredValid ='Y') AND a.DefaultValue is null THEN 'ss:StyleID="s21"'
ELSE '' END
+'><Data ss:Type="String">' + REPLACE(REPLACE(REPLACE(CASE WHEN d.TypeName IN ('DropDownList','ComboBox','ListBox','RadioButtonList') THEN b.ColumnName ELSE f.ColumnHeader END,'&','&amp;'),'>','&lt;'),'<','&gt;') + CASE WHEN d.TypeName='CheckBox' THEN '(Y/N)' ELSE '' END  + '</Data>' 
+ CASE WHEN d.TypeName IN ('DropDownList','ComboBox','ListBox','RadioButtonList') THEN '' 
ELSE CASE WHEN ISNULL(b.ColObjective,'') = '' THEN '' ELSE  '<Comment><ss:Data xmlns="http://www.w3.org/TR/REC-html40"><B><Font html:Face="Tahoma" x:CharSet="1" html:Size="9" html:Color="#000000">' + + REPLACE(REPLACE(REPLACE(ISNULL(b.ColObjective,''),'&','&amp;'),'>','&lt;'),'<','&gt;') + '</Font></B></ss:Data></Comment>' END
END         
           +'</Cell>'
+ CASE WHEN d.TypeName IN ('DropDownList','ComboBox','ListBox','RadioButtonList')
THEN
'<Cell ' 
+ CASE 
WHEN (b.AllowNulls = 'N' OR a.RequiredValid ='Y') AND e.DataTypeName LIKE '%Date%' AND a.DefaultValue is null THEN 'ss:StyleID="s22"'
WHEN (b.AllowNulls = 'N' OR a.RequiredValid ='Y') AND e.DataTypeName LIKE '%Date%' THEN 'ss:StyleID="s24"'
WHEN (b.AllowNulls = 'N' OR a.RequiredValid ='Y') AND e.NumericData = 'Y' AND a.DefaultValue is null THEN 'ss:StyleID="s23"'
WHEN (b.AllowNulls = 'N' OR a.RequiredValid ='Y') AND a.DefaultValue is null THEN 'ss:StyleID="s21"'
ELSE '' END
+'><Data ss:Type="String">' + REPLACE(REPLACE(REPLACE(f.ColumnHeader,'&','&amp;'),'>','&lt;'),'<','&gt;') + '</Data>' +
CASE WHEN ISNULL(b.ColObjective,'')='' THEN '' ELSE '<Comment><ss:Data xmlns="http://www.w3.org/TR/REC-html40"><B><Font html:Face="Tahoma" x:CharSet="1" html:Size="9" html:Color="#000000">' + + REPLACE(REPLACE(REPLACE(ISNULL(b.ColObjective,''),'&','&amp;'),'>','&lt;'),'<','&gt;') + '</Font></B></ss:Data></Comment>' END
	+'</Cell>'
ELSE '' END           
--SELECT	 f.ColumnHeader
--		,e.DataTypeSysName
--		,d.TypeDesc
--		,d.TypeName
--		,case when b.AllowNulls = 'Y' then 'YES' else 'NO' end
--		,case when b.ColumnIdentity = 'Y' then 'YES' else 'NO' end
--		,case when x8.TableId is null then x4.ColumnName else x7.ColumnName end
--		,case when b.ColumnIdentity = 'Y' then 'Please leave this column empty.' else f.ErrMessage end
	FROM dbo.ScreenObj a
		INNER JOIN dbo.Screen c ON a.ScreenId = c.ScreenId
		INNER JOIN dbo.ScreenObjHlp f ON a.ScreenObjId = f.ScreenObjId
		LEFT OUTER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
		LEFT OUTER JOIN RODesign.dbo.CtDataType e ON b.DataType = e.DataTypeId
		LEFT OUTER JOIN RODesign.dbo.CtDisplayType d ON a.DisplayModeId = d.TypeId
		LEFT OUTER JOIN dbo.DbColumn x4 ON a.DdlRefColumnId = x4.ColumnId
		LEFT OUTER JOIN dbo.ScreenObj x ON a.DdlRefColumnId = x.ColumnId AND a.ScreenId = x.ScreenId
		LEFT OUTER JOIN dbo.DbColumn x7 ON x.DdlKeyColumnId = x7.ColumnId
		LEFT OUTER JOIN dbo.DbTable x8 ON x7.TableId = x8.TableId
	WHERE a.ScreenId = @screenId
	AND f.CultureId = CASE WHEN EXISTS (SELECT 1 FROM dbo.ScreenObjHlp x WHERE x.ScreenObjId = a.ScreenObjId AND CultureId = @cultureId) THEN @cultureId ELSE @DefCultureId END
	AND a.MasterTable = (SELECT CASE WHEN b.ScreenTypeName='I2' THEN 'N' ELSE 'Y' END FROM dbo.Screen a INNER JOIN RODesign.dbo.CtScreenType b ON a.ScreenTypeId = b.ScreenTypeId WHERE a.ScreenId = @screenId)
ORDER BY a.TabIndex

INSERT INTO @xmlTable
select '</Row></Table></Worksheet></Workbook>'

SELECT xml FROM @xmlTable ORDER by xid
RETURN 0



 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetServerRule') AND type='P')
DROP PROCEDURE dbo.GetServerRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetServerRule]
 @screenId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
	,@oClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.BeforeCRUD,a.ProcedureName,a.MasterTable'
+ ',ParameterNames = (CASE WHEN a.ParameterNames IS NULL THEN '''' ELSE REPLACE(a.ParameterNames,SPACE(1),'''') END)'
+ ',ParameterTypes = (CASE WHEN a.ParameterTypes IS NULL THEN '''' ELSE REPLACE(a.ParameterTypes,SPACE(1),'''') END)'
+ ',CallingParams = (CASE WHEN a.CallingParams IS NULL THEN '''' ELSE REPLACE(a.CallingParams,SPACE(1),'''') END)'
+ ',a.OnAdd,a.OnUpd,a.OnDel'
SELECT @fClause = 'FROM dbo.ServerRule a'
SELECT @wClause = 'WHERE a.ScreenId = ' + CONVERT(varchar,@screenId)
SELECT @oClause = 'ORDER BY a.RuleOrder'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetSortOrder') AND type='P')
DROP PROCEDURE dbo.GetSortOrder
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetSortOrder]
 @screenId	int
,@fromClause	varchar(8000)
,@sysDatabase	varchar(50)
,@masterTable	char(1)
,@orderClause	varchar(8000) OUTPUT
/* WITH ENCRYPTION */
AS
BEGIN
	DECLARE	 @SortOrder		smallint
			,@DdlRefColumnId	int
			,@ColumnName		varchar(50)
			,@TableName		varchar(500)
			,@foundIndex		int
			,@sOrderBy		varchar(4000)
			,@pos			int
			,@end			int
			,@len			int
			,@MultiDb		char(1)
			,@Tbl			varchar(50)
			,@fClause		varchar(8000)
			,@MainTbl		char(1)
	SELECT @sOrderBy = ''
	EXEC RODesign.dbo.MultiDesignDb @screenId, @MultiDb OUTPUT
	DECLARE sort_cursor CURSOR FAST_FORWARD FOR
		SELECT CASE WHEN c.MultiDesignDb='N' THEN s.dbAppDatabase+'.dbo.'+c.TableName WHEN @MultiDb='N' THEN @sysDatabase+'.dbo.'+c.TableName ELSE 'dbo.'+c.TableName END
			, b.ColumnName, a.DdlRefColumnId, a.SortOrder
		FROM dbo.ScreenObj a
			INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
			INNER JOIN dbo.DbTable c ON b.TableId = c.TableId
			INNER JOIN RODesign.dbo.Systems s ON c.SystemId = s.SystemId
		WHERE a.ScreenId = @screenId AND a.SortOrder is not null AND MasterTable = @masterTable
		ORDER BY abs(a.SortOrder)
	FOR READ ONLY
	OPEN sort_cursor
	FETCH NEXT FROM sort_cursor INTO @TableName, @ColumnName, @DdlRefColumnId, @SortOrder
	WHILE @@FETCH_STATUS = 0
	BEGIN
		IF @sOrderBy <> '' SELECT @sOrderBy = @sOrderBy + ', '
		IF @DdlRefColumnId is not null		-- dropdown column take description instead
			SELECT @TableName = CASE
					WHEN b.MultiDesignDb='N' THEN s.dbAppDatabase+'.dbo.'+b.TableName
					WHEN @MultiDb='N' THEN @sysDatabase+'.dbo.'+b.TableName ELSE 'dbo.'+b.TableName END
				, @ColumnName = a.ColumnName
			FROM dbo.DbColumn a
				INNER JOIN dbo.DbTable b ON a.TableId = b.TableId
				INNER JOIN RODesign.dbo.Systems s ON b.SystemId = s.SystemId
				WHERE a.ColumnId = @DdlRefColumnId
		/* in case more than one column has the same dropdown */
		SELECT @fClause = replace(@fromClause,'''',space(0)), @Tbl = ''
		SELECT @MainTbl = 'Y'
		WHILE @Tbl = '' OR CHARINDEX(@Tbl + '.' + @ColumnName,@sOrderBy) > 0
		BEGIN
			SELECT @pos = CHARINDEX(@TableName + ' ',@fClause)
			IF @pos <= 0 OR SUBSTRING(@fClause, @pos + LEN(@TableName) + 1, 1) = '('
				SELECT @pos = CHARINDEX(@TableName + ' (NOLOCK))',@fClause), @MainTbl = 'N'
			IF @MainTbl = 'Y'
				SELECT @end = CHARINDEX(' ',right(@fClause,len(@fClause)-(@pos+LEN(@TableName)+1)+1))
			ELSE
				SELECT @end = CHARINDEX(' ',right(@fClause,len(@fClause)-(@pos+LEN(@TableName)+10)+1))
			IF @end <= 0 SELECT @len = LEN(@fClause) - (@pos + LEN(@TableName)) ELSE SELECT @len = @end - 1
			IF @MainTbl = 'Y'
				SELECT @Tbl = SUBSTRING(@fClause, @pos + LEN(@TableName) + 1, @len), @fClause = right(@fClause,len(@fClause)-(@pos+LEN(@TableName)+1)+1)
			ELSE
				SELECT @Tbl = SUBSTRING(@fClause, @pos + LEN(@TableName) + 10, @len), @fClause = right(@fClause,len(@fClause)-(@pos+LEN(@TableName)+10)+1)
		END
		SELECT @sOrderBy = @sOrderBy + @Tbl + '.' + @ColumnName
		IF @SortOrder < 0 SELECT @sOrderBy = @sOrderBy + ' DESC'
		FETCH NEXT FROM sort_cursor INTO @TableName, @ColumnName, @DdlRefColumnId, @SortOrder
	END
	CLOSE sort_cursor
	DEALLOCATE sort_cursor
	SELECT @orderClause = @sOrderBy
END
RETURN 0 
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetTableAbbr') AND type='P')
DROP PROCEDURE dbo.GetTableAbbr
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO









CREATE PROCEDURE [dbo].[GetTableAbbr]
 @tableIdx	 tinyint OUTPUT
,@tableAbbr	 varchar(3) OUTPUT	/* Cannot be char(3) here */
/* WITH ENCRYPTION */
AS
	IF @tableIdx > 99 RAISERROR('System is not designed to handle more than 99 table joins at the same time.',18,2) WITH SETERROR
	SELECT @tableAbbr = 'a'
	IF @tableIdx < 10 SELECT @tableAbbr = @tableAbbr + '0'
	SELECT @tableAbbr = @tableAbbr + CONVERT(VARCHAR(2),@tableIdx), @tableIdx = @tableIdx + 1
RETURN 0




 
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetWebRule') AND type='P')
DROP PROCEDURE dbo.GetWebRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[GetWebRule]
 @screenId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.RuleName,a.ScreenObjId,c.ColumnName,d.TableId,e.ButtonTypeName,e.ObjectType,b.EventCode,a.WebRuleProg'
SELECT @fClause = 'FROM dbo.WebRule a'
+ ' INNER JOIN RODesign.dbo.CtEvent b ON a.EventId = b.EventId'
+ ' LEFT OUTER JOIN dbo.ScreenObj c ON a.ScreenObjId = c.ScreenObjId'
+ ' LEFT OUTER JOIN dbo.DbColumn d ON c.ColumnId = d.ColumnId'
+ ' LEFT OUTER JOIN RODesign.dbo.CtButtonType e ON a.ButtonTypeId = e.ButtonTypeId'
SELECT @wClause = 'WHERE a.ScreenId = ' + CONVERT(varchar,@screenId)
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetWizardById') AND type='P')
DROP PROCEDURE dbo.GetWizardById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[GetWizardById]
 @desDatabase		varchar(50)
,@srcDatabase		varchar(50)
,@wizardId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT MasterTableName=c.TableName,a.ProgramName,b.SysProgram,b.dbAppDatabase,b.dbDesDatabase,a.DefWorkSheet,a.DefStartRow'
+ ',a.DefOverwrite,a.OvwrReadonly,a.AuthRequired'
SELECT @fClause = 'FROM dbo.Wizard a'
+ ' INNER JOIN RODesign.dbo.Systems b ON b.dbDesDatabase = ''' + @srcDatabase + ''''
+ ' INNER JOIN dbo.DbTable c ON a.MasterTableId = c.TableId'
SELECT @wClause = 'WHERE a.WizardId = ' + CONVERT(varchar,@wizardId)
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetWizardColumns') AND type='P')
DROP PROCEDURE dbo.GetWizardColumns
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[GetWizardColumns]
 @wizardId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
	,@oClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.WizardObjId,b.ColumnName,b.TableId,b.ColumnLength,b.AllowNulls,b.ColumnIdentity,PrimaryKey=ISNULL(b.PrimaryKey,''N'')'
+ ',DataTypeSysName = ISNULL(d.DataTypeSysName,''String'')'
+ ',DataTypeSByteOle = ISNULL(d.DataTypeSByteOle,''VarChar''),DataTypeDByteOle = ISNULL(d.DataTypeDByteOle,''VarWChar'')'
+ ',RequiredValid = ''N'''
SELECT @fClause = 'FROM dbo.WizardObj a'
+ ' INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId'
+ ' INNER JOIN RODesign.dbo.CtDataType d ON b.DataType = d.DataTypeId'
SELECT @wClause = 'WHERE a.WizardId = ' + CONVERT(varchar,@wizardId)
SELECT @oClause = 'ORDER BY b.PrimaryKey desc, a.TabIndex'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetWizardDel') AND type='P')
DROP PROCEDURE dbo.GetWizardDel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[GetWizardDel]
 @srcDatabase		varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	  @sClause	varchar(8000)
	, @fClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.WizardId, a.ProgramName, b.dbAppDatabase'
SELECT @fClause = 'FROM dbo.WizardDel a'
+ ' INNER JOIN RODesign.dbo.Systems b ON b.dbDesDatabase = ''' + @srcDatabase + ''''
EXEC (@sClause + ' ' + @fClause)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetWizardList') AND type='P')
DROP PROCEDURE dbo.GetWizardList
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[GetWizardList]
 @searchTxt		nvarchar(25)
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
	,@oClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.WizardId, a.WizardTitle, WizardType = c.WizardTypeName'
SELECT @fClause = 'FROM dbo.Wizard a'
+ ' INNER JOIN RODesign.dbo.CtWizardType c ON a.WizardTypeId = c.WizardTypeId'
IF (@searchTxt IS NULL OR @searchTxt = '')
	SELECT @wClause = ''
ELSE
	SELECT @wClause = 'WHERE a.WizardTitle LIKE ''%' + LOWER(@searchTxt) + '%'''
SELECT @oClause = 'ORDER BY a.WizardTitle'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetWizardRule') AND type='P')
DROP PROCEDURE dbo.GetWizardRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetWizardRule]
 @wizardId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @sClause	varchar(8000)
	,@fClause	varchar(8000)
	,@wClause	varchar(8000)
	,@oClause	varchar(8000)
SET NOCOUNT ON
SELECT @sClause = 'SELECT a.BeforeCRUD,a.ProcedureName'
SELECT @fClause = 'FROM dbo.WizardRule a'
SELECT @wClause = 'WHERE a.WizardId = ' + CONVERT(varchar,@wizardId)
SELECT @oClause = 'ORDER BY a.RuleOrder'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0

 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.GetWizImpTmpl') AND type='P')
DROP PROCEDURE dbo.GetWizImpTmpl
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[GetWizImpTmpl]
 @wizardId	int
,@cultureId	smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE @xmlTable table (xid int primary key identity(1,1), xml varchar(max))
INSERT INTO @xmlTable
SELECT '<?xml version="1.0"?>'
+'<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"'
+' xmlns:o="urn:schemas-microsoft-com:office:office"'
+' xmlns:x="urn:schemas-microsoft-com:office:excel"'
+' xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"'
+' xmlns:html="http://www.w3.org/TR/REC-html40">'
+ '<Styles>
 <Style ss:ID="Default" ss:Name="Normal">
   <Alignment ss:Vertical="Bottom"/>
   <Borders/>
   <Font ss:FontName="Calibri" x:Family="Swiss" ss:Size="11" ss:Color="#000000"/>
   <Interior/>
   <NumberFormat/>
   <Protection/>
  </Style>
 <Style ss:ID="s21">
   <Font ss:FontName="Calibri" x:Family="Swiss" ss:Size="11" ss:Color="#FF0000"/>
  </Style>
 <Style ss:ID="s22">
   <Font ss:FontName="Calibri" x:Family="Swiss" ss:Size="11" ss:Color="#FF0000"/>
   <NumberFormat ss:Format="Short Date"/>
  </Style>
 <Style ss:ID="s23">
   <Font ss:FontName="Calibri" x:Family="Swiss" ss:Size="11" ss:Color="#FF0000"/>
   <NumberFormat/>
  </Style>
 <Style ss:ID="s24">
   <NumberFormat ss:Format="Short Date"/>
  </Style>
 <Style ss:ID="s25">
   <NumberFormat/>
  </Style>
  
</Styles>'
INSERT INTO @xmlTable
SELECT '<Worksheet ss:Name="' + CASE WHEN LEN(ISNULL(w.DefWorkSheet,'')) = 0 THEN 'Sheet1' ELSE w.DefWorkSheet END +'">'
+ '<Table x:FullColumns="1" x:FullRows="1">'
+ '<Row>'
FROM dbo.Wizard w
WHERE w.WizardId = @wizardId

INSERT INTO @xmlTable
SELECT '<Cell ' 
+ CASE WHEN b.AllowNulls = 'N' AND e.DataTypeName LIKE '%Date%' THEN 'ss:StyleID="s22"'
WHEN b.AllowNulls = 'N' AND e.DataTypeName LIKE '%Date%' THEN 'ss:StyleID="s24"'
WHEN b.AllowNulls = 'N' AND e.NumericData = 'Y' THEN 'ss:StyleID="s23"'
WHEN b.AllowNulls = 'N' THEN 'ss:StyleID="s21"'
ELSE '' END
+'><Data ss:Type="String">' + REPLACE(REPLACE(REPLACE(b.ColumnName,'&','&amp;'),'>','&lt;'),'<','&gt;')  + '</Data>' +
CASE WHEN ISNULL(b.ColObjective,'')='' THEN '' ELSE '<Comment><ss:Data xmlns="http://www.w3.org/TR/REC-html40"><B><Font html:Face="Tahoma" x:CharSet="1" html:Size="9" html:Color="#000000">' + REPLACE(REPLACE(REPLACE(ISNULL(b.ColObjective,''),'&','&amp;'),'>','&lt;'),'<','&gt;') + '</Font></B></ss:Data></Comment>' END
+'</Cell>'
FROM dbo.WizardObj a
LEFT OUTER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
LEFT OUTER JOIN RODesign.dbo.CtDataType e ON b.DataType = e.DataTypeId
WHERE a.WizardId = @wizardId
ORDER BY a.TabIndex

INSERT INTO @xmlTable
select '</Row></Table></Worksheet></Workbook>'

SELECT xml FROM @xmlTable ORDER by xid
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.IniLastCriteria') AND type='P')
DROP PROCEDURE dbo.IniLastCriteria
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[IniLastCriteria]
 @ScreenId		int
,@ReportId		int
,@UsrId			int
/* WITH ENCRYPTION */
AS
DECLARE  @sql		varchar(8000)
	,@dbDesDatabase	varchar(50)
SET NOCOUNT ON
/* ScreenCriId = 0 is used to hide/show screen criteria only */
IF @ScreenId is not null AND @ScreenId <> 0
BEGIN
	INSERT dbo.ScreenLstCri (UsrId, ScreenId, ScreenCriId)
		SELECT u.UsrId, a.ScreenId, a.ScreenCriId
		FROM dbo.ScreenCri a INNER JOIN RODesign.dbo.Usr u ON a.ScreenId = @ScreenId AND u.Active = 'Y'
		WHERE NOT EXISTS (SELECT 'true' FROM dbo.ScreenLstCri b WHERE b.UsrId = u.UsrId AND b.ScreenId = @ScreenId AND a.ScreenCriId = b.ScreenCriId)
	INSERT dbo.ScreenLstCri (UsrId, ScreenId, ScreenCriId, LastCriteria)
		SELECT a.UsrId, @ScreenId, 0, 'Y' FROM RODesign.dbo.Usr a
		WHERE a.Active = 'Y'
		AND EXISTS (SELECT 'true' FROM dbo.ScreenLstCri b WHERE a.UsrId = b.UsrId AND b.ScreenId = @ScreenId AND b.ScreenCriId <> 0)
		AND NOT EXISTS (SELECT 'true' FROM dbo.ScreenLstCri b WHERE a.UsrId = b.UsrId AND b.ScreenId = @ScreenId AND b.ScreenCriId = 0)
END
ELSE
IF @ReportId is not null AND @ReportId <> 0
BEGIN
	INSERT dbo.ReportLstCri (UsrId, ReportId, ReportCriId)
		SELECT u.UsrId, a.ReportId, a.ReportCriId
		FROM dbo.ReportCri a INNER JOIN RODesign.dbo.Usr u ON a.ReportId = @ReportId AND u.Active = 'Y'
		WHERE NOT EXISTS (SELECT 'true' FROM dbo.ReportLstCri b WHERE b.UsrId = u.UsrId AND b.ReportId = @ReportId AND a.ReportCriId = b.ReportCriId)
END
ELSE
IF EXISTS (SELECT 'true' FROM RODesign.dbo.Usr WHERE UsrId = @UsrId AND Active = 'Y')
BEGIN
	DECLARE sysCursor CURSOR FOR SELECT dbDesDatabase FROM RODesign.dbo.Systems FOR READ ONLY
	OPEN sysCursor
	FETCH NEXT FROM sysCursor INTO @dbDesDatabase
	WHILE @@FETCH_STATUS = 0
	BEGIN
		SELECT @sql = ' DELETE FROM ' + @dbDesDatabase + '.dbo.ScreenLstCri WHERE NOT EXISTS (SELECT 1 FROM ' + @dbDesDatabase + '.dbo.Screen a'
		+ ' WHERE a.ScreenId = ' + @dbDesDatabase + '.dbo.ScreenLstCri.ScreenId)'
		+ ' UPDATE ' + @dbDesDatabase + '.dbo.ScreenLstCri SET ScreenId = a.ScreenId FROM ' + @dbDesDatabase + '.dbo.ScreenCri a'
		+ ' INNER JOIN ' + @dbDesDatabase + '.dbo.ScreenLstCri b ON a.ScreenCriId = b.ScreenCriId AND b.UsrId = ' + convert(varchar,@UsrId)
		+ ' INSERT ' + @dbDesDatabase + '.dbo.ScreenLstCri (UsrId, ScreenId, ScreenCriId)'
		+ ' SELECT ' + convert(varchar,@UsrId) + ', a.ScreenId, a.ScreenCriId FROM ' + @dbDesDatabase + '.dbo.ScreenCri a'
		+ ' WHERE NOT EXISTS (SELECT 1 FROM ' + @dbDesDatabase + '.dbo.ScreenLstCri b WHERE a.ScreenCriId = b.ScreenCriId AND b.UsrId = ' + convert(varchar,@UsrId) + ')'
		+ ' INSERT ' + @dbDesDatabase + '.dbo.ScreenLstCri (UsrId, ScreenId, ScreenCriId, LastCriteria)'
		+ ' SELECT DISTINCT ' + convert(varchar,@UsrId) + ', a.ScreenId, 0, ''Y'' FROM ' + @dbDesDatabase + '.dbo.ScreenCri a'
		+ ' WHERE EXISTS (SELECT 1 FROM ' + @dbDesDatabase + '.dbo.ScreenLstCri b WHERE b.UsrId = ' + convert(varchar,@UsrId) + ' AND a.ScreenId = b.ScreenId AND b.ScreenCriId <> 0)'
		+ ' AND NOT EXISTS (SELECT 1 FROM ' + @dbDesDatabase + '.dbo.ScreenLstCri b WHERE b.UsrId = ' + convert(varchar,@UsrId) + ' AND a.ScreenId = b.ScreenId AND b.ScreenCriId = 0)'
		+ ' DELETE FROM ' + @dbDesDatabase + '.dbo.ReportLstCri WHERE NOT EXISTS (SELECT 1 FROM ' + @dbDesDatabase + '.dbo.Report a'
		+ ' WHERE a.ReportId = ' + @dbDesDatabase + '.dbo.ReportLstCri.ReportId)'
		+ ' UPDATE ' + @dbDesDatabase + '.dbo.ReportLstCri SET ReportId = a.ReportId FROM ' + @dbDesDatabase + '.dbo.ReportCri a'
		+ ' INNER JOIN ' + @dbDesDatabase + '.dbo.ReportLstCri b ON a.ReportCriId = b.ReportCriId AND b.UsrId = ' + convert(varchar,@UsrId)
		+ ' INSERT ' + @dbDesDatabase + '.dbo.ReportLstCri (UsrId, ReportId, ReportCriId)'
		+ ' SELECT ' + convert(varchar,@UsrId) + ', a.ReportId, a.ReportCriId FROM ' + @dbDesDatabase + '.dbo.ReportCri a'
		+ ' WHERE NOT EXISTS (SELECT 1 FROM ' + @dbDesDatabase + '.dbo.ReportLstCri b WHERE a.ReportCriId = b.ReportCriId AND b.UsrId = ' + convert(varchar,@UsrId) + ')'
		EXEC (@sql)
		FETCH NEXT FROM sysCursor INTO @dbDesDatabase
	END
	CLOSE sysCursor
	DEALLOCATE sysCursor
END
ELSE EXEC dbo.DelLastCriteria null,null,@UsrId
RETURN 0
 
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.IniMemCri') AND type='P')
DROP PROCEDURE dbo.IniMemCri
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[IniMemCri]
 @GenPrefix		varchar(10)
,@ReportId		int
,@MemCriId		Int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF @GenPrefix = 'Ut'
	INSERT dbo.UtRptMemCriDtl (RptMemCriId, ReportCriId)
		SELECT @MemCriId, a.ReportCriId
		FROM dbo.UtReportCri a
		WHERE a.ReportId = @ReportId
		AND NOT EXISTS (SELECT 1 FROM dbo.UtRptMemCriDtl b WHERE b.RptMemCriId = @MemCriId AND a.ReportCriId = b.ReportCriId)
ELSE
	INSERT dbo.RptMemCriDtl (RptMemCriId, ReportCriId)
		SELECT @MemCriId, a.ReportCriId
		FROM dbo.ReportCri a
		WHERE a.ReportId = @ReportId
		AND NOT EXISTS (SELECT 1 FROM dbo.RptMemCriDtl b WHERE b.RptMemCriId = @MemCriId AND a.ReportCriId = b.ReportCriId)
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.IniRptCriteria') AND type='P')
DROP PROCEDURE dbo.IniRptCriteria
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[IniRptCriteria]
 @GenPrefix		varchar(10)
,@ReportId		int
,@UsrId			int
/* WITH ENCRYPTION */
AS
DECLARE  @sql			varchar(8000)
		,@dbDesDatabase	varchar(50)
SET NOCOUNT ON
IF @ReportId is not null AND @ReportId <> 0
BEGIN
	IF @GenPrefix = 'Ut'
		INSERT dbo.UtReportLstCri (UsrId, ReportId, ReportCriId)
			SELECT u.UsrId, a.ReportId, a.ReportCriId
			FROM dbo.UtReportCri a INNER JOIN RODesign.dbo.Usr u ON a.ReportId = @ReportId AND u.Active = 'Y'
			WHERE NOT EXISTS (SELECT 1 FROM dbo.UtReportLstCri b WHERE b.UsrId = u.UsrId AND b.ReportId = @ReportId AND a.ReportCriId = b.ReportCriId)
	ELSE
		INSERT dbo.ReportLstCri (UsrId, ReportId, ReportCriId)
		SELECT u.UsrId, a.ReportId, a.ReportCriId
		FROM dbo.ReportCri a INNER JOIN RODesign.dbo.Usr u ON a.ReportId = @ReportId AND u.Active = 'Y'
		WHERE NOT EXISTS (SELECT 1 FROM dbo.ReportLstCri b WHERE b.UsrId = u.UsrId AND b.ReportId = @ReportId AND a.ReportCriId = b.ReportCriId)
END
ELSE
	EXEC dbo.DelRptCriteria null,null,@UsrId
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_AssignPermUp') AND type='P')
DROP PROCEDURE dbo.Ir_AssignPermUp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_AssignPermUp]
 @MenuId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @PermKeyId	int
		,@PermId	int
		,@GrantDeny	char(1)
		,@ParentId	int
SET NOCOUNT ON
/* Temporary disable as per Gary Ng's request:
-- Do not push downward, the business rule can be difficult to define.
IF NOT EXISTS (SELECT 1 FROM dbo.MenuPrm WHERE MenuId = @MenuId)
BEGIN
	SELECT @ParentId = ParentId FROM dbo.Menu WHERE MenuId = @MenuId
	WHILE @ParentId is not null
	BEGIN
		IF EXISTS (SELECT 1 FROM dbo.MenuPrm WHERE MenuId = @ParentId)
			DELETE FROM dbo.MenuPrm WHERE MenuId = @ParentId
		SELECT @ParentId = ParentId FROM dbo.Menu WHERE MenuId = @ParentId
	END
END
ELSE
BEGIN
	DECLARE menu_cursor CURSOR FAST_FORWARD FOR
		SELECT GrantDeny,PermKeyId,PermId FROM dbo.MenuPrm WHERE MenuId = @MenuId FOR READ ONLY
	OPEN menu_cursor
	FETCH NEXT FROM menu_cursor INTO @GrantDeny,@PermKeyId,@PermId
	WHILE @@FETCH_STATUS = 0
	BEGIN
		SELECT @ParentId = ParentId FROM dbo.Menu WHERE MenuId = @MenuId
		WHILE @ParentId is not null
		BEGIN
			IF NOT EXISTS (SELECT 1 FROM dbo.MenuPrm WHERE MenuId = @ParentId
				AND GrantDeny = @GrantDeny AND PermKeyId = @PermKeyId AND PermId = @PermId)
				INSERT dbo.MenuPrm (MenuId, GrantDeny, PermKeyId, PermId)
				SELECT @ParentId, @GrantDeny, @PermKeyId, @PermId
			SELECT @ParentId = ParentId FROM dbo.Menu WHERE MenuId = @ParentId
		END
		FETCH NEXT FROM menu_cursor INTO @GrantDeny,@PermKeyId,@PermId
	END
	CLOSE menu_cursor
	DEALLOCATE menu_cursor
END
*/
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_ChgReportCriGrp') AND type='P')
DROP PROCEDURE dbo.Ir_ChgReportCriGrp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_ChgReportCriGrp]
 @ReportId		int
,@ReportCriId	Int
,@ReportGrpId	Int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @PReportGrpId	int
IF @ReportCriId is NULL		/* New criteria */
BEGIN
	SELECT @PReportGrpId = ReportGrpId FROM dbo.ReportCri WHERE ReportId = @ReportId GROUP BY ReportGrpId
	IF @@ROWCOUNT = 1 AND @PReportGrpId <> @ReportGrpId
	BEGIN
		UPDATE dbo.ReportCri SET ReportGrpId = @ReportGrpId WHERE ReportId = @ReportId
	END
END
ELSE
BEGIN
	SELECT @PReportGrpId = ReportGrpId FROM dbo.ReportCri WHERE ReportCriId = @ReportCriId
	IF @PReportGrpId <> @ReportGrpId
	BEGIN
		IF NOT EXISTS (SELECT 1 FROM dbo.ReportCri WHERE ReportId = @ReportId AND ReportGrpId <> @PReportGrpId)
			UPDATE dbo.ReportCri SET ReportGrpId = @ReportGrpId WHERE ReportId = @ReportId
	END
END
RETURN 0 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_DelAuthCol') AND type='P')
DROP PROCEDURE dbo.Ir_DelAuthCol
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_DelAuthCol]
@ScreenObjId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DELETE FROM dbo.ColOvrd WHERE ScreenObjId = @ScreenObjId
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_DelDbKey') AND type='P')
DROP PROCEDURE dbo.Ir_DelDbKey
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[Ir_DelDbKey]
 @ScreenObjId		int
,@ColumnId			int
,@DdlKeyColumnId	int
,@DdlRefColumnId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
/* Do not delete foreign key as it can be simultaneously serving more than one column:
DECLARE	 @TableId		int
		,@RefTableId	int
		,@DoDelete		char(1)
IF @ColumnId IS NOT NULL AND @DdlKeyColumnId IS NOT NULL
BEGIN
	SELECT @DoDelete = 'N'
	IF @ColumnId = @DdlKeyColumnId AND @DdlRefColumnId is not null	/* Pull up */
	BEGIN
		SELECT @TableId = TableId FROM dbo.DbColumn WHERE ColumnId = @DdlRefColumnId
		SELECT @RefTableId = TableId FROM dbo.DbColumn WHERE ColumnId = @ColumnId
		/* Before CRUD */
		IF NOT EXISTS (SELECT 1 FROM dbo.ScreenObj a
			INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
			INNER JOIN dbo.DbColumn c ON a.DdlRefColumnId = c.ColumnId
			WHERE a.ScreenObjId <> @ScreenObjId AND a.ColumnId = @ColumnId AND b.TableId = @TableId AND c.TableId = @RefTableId)
		SELECT @DoDelete = 'Y'
	END
	ELSE
	BEGIN
		SELECT @TableId = TableId FROM dbo.DbColumn WHERE ColumnId = @ColumnId
		SELECT @RefTableId = TableId FROM dbo.DbColumn WHERE ColumnId = @DdlKeyColumnId
		/* Before CRUD */
		IF NOT EXISTS (SELECT 1 FROM dbo.ScreenObj a
			INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
			INNER JOIN dbo.DbColumn c ON a.DdlKeyColumnId = c.ColumnId
			WHERE a.ScreenObjId <> @ScreenObjId AND a.ColumnId = @ColumnId AND b.TableId = @TableId AND c.TableId = @RefTableId)
		SELECT @DoDelete = 'Y'
	END
	IF @DoDelete = 'Y' DELETE FROM dbo.DbKey WHERE TableId = @TableId AND RefTableId = @RefTableId
END
*/
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_DelMenuHlp') AND type='P')
DROP PROCEDURE dbo.Ir_DelMenuHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_DelMenuHlp]
@MenuId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @MenuIndex	smallint
		,@ParentId	int
		,@ChildCnt	int

SELECT @MenuIndex = MenuIndex, @ParentId = ParentId FROM dbo.Menu WHERE MenuId = @MenuId

/* Reorder peer */
IF object_id('tempdb.dbo.#mnu') is not null DROP TABLE dbo.#mnu
CREATE TABLE #mnu (tid smallint IDENTITY(1,1) not null, MenuId int not null)
IF @ParentId is NULL
	INSERT INTO #mnu (MenuId) SELECT MenuId FROM dbo.Menu WHERE ParentId is NULL AND MenuIndex > @MenuIndex ORDER BY MenuIndex
ELSE
	INSERT INTO #mnu (MenuId) SELECT MenuId FROM dbo.Menu WHERE ParentId = @ParentId AND MenuIndex > @MenuIndex ORDER BY MenuIndex

/* Move the children up one level and Reorder */
IF object_id('tempdb.dbo.#chd') is not null DROP TABLE dbo.#chd
CREATE TABLE #chd (tid smallint IDENTITY(1,1) not null, MenuId int not null)
INSERT INTO #chd (MenuId) SELECT MenuId FROM dbo.Menu WHERE ParentId = @MenuId ORDER BY MenuIndex
SELECT @ChildCnt = COUNT(1) FROM #chd
UPDATE dbo.Menu SET MenuIndex = MenuIndex + ((@ChildCnt - 1) * 10) FROM dbo.Menu a INNER JOIN #mnu b ON a.MenuId = b.MenuId
UPDATE dbo.Menu SET MenuIndex = @MenuIndex + ((tid -1) * 10), ParentId = @ParentId FROM dbo.Menu a INNER JOIN #chd b ON a.MenuId = b.MenuId
DROP TABLE dbo.#chd
DROP TABLE dbo.#mnu

DELETE FROM dbo.MenuPrm WHERE MenuId = @MenuId
DELETE FROM dbo.MenuHlp WHERE MenuId = @MenuId
RETURN 0

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_DelOldRptonDel') AND type='P')
DROP PROCEDURE dbo.Ir_DelOldRptonDel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_DelOldRptonDel]
 @ReportId		int
,@ProgramName	varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @MenuId		int
SET NOCOUNT ON
-- Must do this first:
INSERT INTO dbo.ReportDel (ReportId, ProgramName) SELECT @ReportId, @ProgramName
-- Criteria:
DELETE FROM dbo.ClientRule WHERE ReportCriHlpId IN (SELECT b.ReportCriHlpId FROM dbo.ReportCriHlp b
	INNER JOIN dbo.ReportCri c ON b.ReportCriId = b.ReportCriId WHERE c.ReportId = @ReportId)
DELETE FROM dbo.ReportCriHlp WHERE ReportCriId IN (SELECT ReportCriId FROM dbo.ReportCri WHERE ReportId = @ReportId)
DELETE FROM dbo.ReportCri WHERE ReportId = @ReportId
EXEC dbo.DelLastCriteria 0, @ReportId, 0
-- Report Columns:
DELETE FROM dbo.ReportObjHlp WHERE ReportObjId IN (SELECT ReportObjId FROM dbo.ReportObj WHERE ReportId = @ReportId)
DELETE FROM dbo.ReportObj WHERE ReportId = @ReportId
-- Miscellaneous:
DELETE FROM dbo.RowOvrd WHERE ReportId = @ReportId
DELETE FROM dbo.RptMemCriDtl WHERE RptMemCriId IN (SELECT RptMemCriId FROM dbo.RptMemCri WHERE ReportId = @ReportId)
DELETE FROM dbo.RptMemCri WHERE ReportId = @ReportId
DELETE FROM dbo.RptCel WHERE RptTblId IN (SELECT RptTblId FROM dbo.RptTbl WHERE ReportId = @ReportId)
DELETE FROM dbo.RptTbl WHERE ReportId = @ReportId
DELETE FROM dbo.RptCha WHERE ReportId = @ReportId
DELETE FROM dbo.RptCtr WHERE ReportId = @ReportId
DELETE FROM dbo.RptElm WHERE ReportId = @ReportId
DELETE FROM dbo.ReportGrp WHERE ReportId = @ReportId
DELETE FROM dbo.ButtonHlp WHERE ReportId = @ReportId
SELECT @MenuId = MenuId FROM dbo.Menu WHERE ReportId = @ReportId
DELETE FROM dbo.MenuHlp WHERE MenuId = @MenuId
DELETE FROM dbo.MenuPrm WHERE MenuId = @MenuId
DELETE FROM dbo.Menu WHERE MenuId = @MenuId
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_DelOldRptonRen') AND type='P')
DROP PROCEDURE dbo.Ir_DelOldRptonRen
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[Ir_DelOldRptonRen]
 @ReportId		int
,@ProgramName	varchar(50)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @oProgramName		varchar(50)
SELECT @oProgramName = ProgramName FROM dbo.Report WHERE ReportId = @ReportId
IF @oProgramName <> @ProgramName
BEGIN
	INSERT INTO dbo.ReportDel (ReportId, ProgramName) SELECT @ReportId, @ProgramName
	UPDATE dbo.ReportObj
		SET ColumnDesc = REPLACE(ColumnDesc,@oProgramName,@ProgramName)
		WHERE ReportId = @ReportId
END
RETURN 0




 
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_DelOldScronDel') AND type='P')
DROP PROCEDURE dbo.Ir_DelOldScronDel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_DelOldScronDel]
 @ScreenId	int
,@ProgramName	varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @MultiDesignDb		char(1)
		,@MenuId			int
SET NOCOUNT ON
-- Must do this first:
EXEC RODesign.dbo.MultiDesignDb @ScreenId, @MultiDesignDb OUTPUT
INSERT INTO dbo.ScreenDel (ScreenId, ProgramName, MultiDesignDb) SELECT @ScreenId, @ProgramName, @MultiDesignDb
-- Criteria:
DELETE FROM dbo.ClientRule WHERE ScreenCriHlpId IN (SELECT b.ScreenCriHlpId FROM dbo.ScreenCriHlp b
	INNER JOIN dbo.ScreenCri c ON b.ScreenCriId = b.ScreenCriId WHERE c.ScreenId = @ScreenId)
DELETE FROM dbo.ScreenCriHlp WHERE ScreenCriId IN (SELECT ScreenCriId FROM dbo.ScreenCri WHERE ScreenId = @ScreenId)
DELETE FROM dbo.ScreenCri WHERE ScreenId = @ScreenId
EXEC dbo.DelLastCriteria @ScreenId, 0, 0
-- Screen Columns:
DELETE FROM dbo.ClientRule WHERE ScreenObjHlpId IN (SELECT b.ScreenObjHlpId FROM dbo.ScreenObjHlp b
	INNER JOIN dbo.ScreenObj c ON b.ScreenObjId = b.ScreenObjId WHERE c.ScreenId = @ScreenId)
DELETE FROM dbo.WebRule WHERE ScreenObjId IN (SELECT ScreenObjId FROM dbo.ScreenObj WHERE ScreenId = @ScreenId)
DELETE FROM dbo.ColOvrd WHERE ScreenObjId IN (SELECT ScreenObjId FROM dbo.ScreenObj WHERE ScreenId = @ScreenId)
DELETE dbo.DbKey FROM dbo.DbKey a
	INNER JOIN dbo.ScreenObj b ON a.ColumnId = b.ColumnId AND a.RefColumnId = b.DdlKeyColumnId
	WHERE b.ScreenId = @ScreenId
	AND NOT EXISTS (SELECT 1 FROM ScreenObj c WHERE (a.ColumnId = c.ColumnId AND a.RefColumnId = c.DdlKeyColumnId AND c.ScreenId <> @ScreenId))
	AND NOT EXISTS (SELECT 1 FROM ScreenCri d WHERE (a.ColumnId = d.ColumnId AND a.RefColumnId = d.DdlKeyColumnId AND d.ScreenId <> @ScreenId))
DELETE FROM dbo.ScreenObjHlp WHERE ScreenObjId IN (SELECT ScreenObjId FROM dbo.ScreenObj WHERE ScreenId = @ScreenId)
DELETE FROM dbo.ScreenObj WHERE ScreenId = @ScreenId
-- Miscellaneous:
DELETE FROM dbo.RowOvrd WHERE ScreenId = @ScreenId
DELETE FROM dbo.ScrMemCriDtl WHERE ScrMemCriId IN (SELECT ScrMemCriId FROM dbo.ScrMemCri WHERE ScreenId = @ScreenId)
DELETE FROM dbo.ScrMemCri WHERE ScreenId = @ScreenId
DELETE FROM dbo.ServerRule WHERE ScreenId = @ScreenId
DELETE FROM dbo.WebRule WHERE ScreenId = @ScreenId
DELETE FROM dbo.ScreenFilterHlp WHERE ScreenFilterId IN (SELECT ScreenFilterId FROM dbo.ScreenFilter WHERE ScreenId = @ScreenId)
DELETE FROM dbo.ScreenFilter WHERE ScreenId = @ScreenId
DELETE FROM dbo.ButtonHlp WHERE ScreenId = @ScreenId
SELECT @MenuId = MenuId FROM dbo.Menu WHERE ScreenId = @ScreenId
DELETE FROM dbo.MenuHlp WHERE MenuId = @MenuId
DELETE FROM dbo.MenuPrm WHERE MenuId = @MenuId
DELETE FROM dbo.Menu WHERE MenuId = @MenuId
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_DelOldScronRen') AND type='P')
DROP PROCEDURE dbo.Ir_DelOldScronRen
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_DelOldScronRen]
 @ScreenId	int
,@ProgramName	varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @oProgramName		varchar(50)
	,@MultiDesignDb		char(1)
SET NOCOUNT ON
SELECT @oProgramName = ProgramName FROM dbo.Screen WHERE ScreenId = @ScreenId
IF @oProgramName <> @ProgramName
BEGIN
	EXEC RODesign.dbo.MultiDesignDb @ScreenId, @MultiDesignDb OUTPUT
	INSERT INTO dbo.ScreenDel (ScreenId, ProgramName, MultiDesignDb) SELECT @ScreenId, @oProgramName, @MultiDesignDb
	UPDATE dbo.ScreenObj
		SET ColumnDesc = @ProgramName + ' [' + right(space(5) + convert(varchar,TabIndex),5) + '] ' + d.TabFolderName + ': ' + replace(a.ColumnName,space(1),space(0))
		FROM dbo.ScreenObj a
		INNER JOIN dbo.Screen b ON a.ScreenId = b.ScreenId
		INNER JOIN dbo.ScreenTab d ON a.TabFolderId = d.ScreenTabId
		LEFT OUTER JOIN dbo.DbColumn c ON a.ColumnId = c.ColumnId
		WHERE a.ScreenId = @ScreenId
END
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_DelOldWizonDel') AND type='P')
DROP PROCEDURE dbo.Ir_DelOldWizonDel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_DelOldWizonDel]
 @WizardId	int
,@ProgramName	varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @MenuId		int
SET NOCOUNT ON
-- Must do this first:
INSERT INTO dbo.WizardDel (WizardId, ProgramName) SELECT @WizardId, @ProgramName
-- Miscellaneous:
DELETE FROM dbo.WizardRule WHERE WizardId = @WizardId
DELETE FROM dbo.ButtonHlp WHERE WizardId = @WizardId
SELECT @MenuId = MenuId FROM dbo.Menu WHERE WizardId = @WizardId
DELETE FROM dbo.MenuHlp WHERE MenuId = @MenuId
DELETE FROM dbo.MenuPrm WHERE MenuId = @MenuId
DELETE FROM dbo.Menu WHERE MenuId = @MenuId
RETURN 0 
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_DelOldWizonRen') AND type='P')
DROP PROCEDURE dbo.Ir_DelOldWizonRen
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO









CREATE PROCEDURE [dbo].[Ir_DelOldWizonRen]
 @WizardId	int
,@ProgramName	varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @oProgramName	varchar(50)
SET NOCOUNT ON
SELECT @oProgramName = ProgramName FROM dbo.Wizard WHERE WizardId = @WizardId
IF @oProgramName <> @ProgramName INSERT INTO dbo.WizardDel (WizardId, ProgramName) SELECT @WizardId, @oProgramName
RETURN 0




 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_DelRefColumn') AND type='P')
DROP PROCEDURE dbo.Ir_DelRefColumn
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_DelRefColumn]
 @ColumnId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DELETE FROM dbo.DbKey WHERE ColumnId = @ColumnId OR RefColumnId = @ColumnId
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_DelReportObjHlp') AND type='P')
DROP PROCEDURE dbo.Ir_DelReportObjHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[Ir_DelReportObjHlp]
 @ReportObjId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DELETE FROM dbo.ReportObjHlp WHERE ReportObjId = @ReportObjId
RETURN 0

 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_DelRptCel') AND type='P')
DROP PROCEDURE dbo.Ir_DelRptCel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_DelRptCel]
 @RptCelId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DELETE FROM dbo.RptCtr WHERE RptCelId = @RptCelId
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_DelRptCtr') AND type='P')
DROP PROCEDURE dbo.Ir_DelRptCtr
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_DelRptCtr]
 @RptCtrId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF EXISTS (SELECT 1 FROM dbo.RptTbl WHERE RptCtrId = @RptCtrId)
BEGIN
	RAISERROR('Cannot delete this control as one or more table item is currently referencing it.',18,2) WITH SETERROR
	RETURN 1
END
IF EXISTS (SELECT 1 FROM dbo.RptCtr WHERE PRptCtrId = @RptCtrId)
BEGIN
	RAISERROR('Cannot delete this control as one or more other control is currently referencing it.',18,2) WITH SETERROR
	RETURN 1
END
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_DelRptTbl') AND type='P')
DROP PROCEDURE dbo.Ir_DelRptTbl
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_DelRptTbl]
 @RptTblId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF EXISTS (SELECT 1 FROM dbo.RptCel WHERE CelNum = @RptTblId)
BEGIN
	RAISERROR('Cannot delete this table item as one or more table cell is currently referencing it.',18,2) WITH SETERROR
	RETURN 1
END
DELETE FROM dbo.RptCtr WHERE EXISTS 
	(SELECT 1 FROM dbo.RptCel WHERE RptCel.RptTblId = @RptTblId AND RptCtr.RptCelId = RptCel.RptCelId)
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_DelRptTmpl') AND type='P')
DROP PROCEDURE dbo.Ir_DelRptTmpl
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_DelRptTmpl]
 @TemplateId	int
/* WITH ENCRYPTION */
AS
DECLARE	 @TmplPrefix	varchar(10)
		,@TmplDefault	char(10)
SET NOCOUNT ON
SELECT @TmplPrefix = TmplPrefix, @TmplDefault = TmplDefault FROM dbo.Template WHERE TemplateId = @TemplateId
IF @TmplDefault = 'Y' BEGIN RAISERROR('{39}',18,2) WITH SETERROR RETURN 1 END
IF @TmplPrefix <> '' DELETE FROM dbo.RptTemplate WHERE charindex(@TmplPrefix,DocName) = 1
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_InitAppInfo') AND type='P')
DROP PROCEDURE dbo.Ir_InitAppInfo
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_InitAppInfo]
 @AppInfoId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @VersionMa	smallint
	,@VersionMi	smallint
	,@VersionDt	datetime
	,@AppInfoDesc	varchar(50)
SET NOCOUNT ON
SELECT @VersionMa = VersionMa, @VersionMi = VersionMi, @VersionDt = VersionDt FROM dbo.AppInfo WHERE AppInfoId = @AppInfoId
SELECT @AppInfoDesc = right(space(3)+convert(varchar,@VersionMa),4) + '.' + right(space(3)+convert(varchar,@VersionMi),4)
	+ case when @VersionDt is null then space(0)
	else '.' + right(convert(varchar,datepart(yy,@VersionDt)),1) + right('0'+convert(varchar,datepart(mm,@VersionDt)),2)
	+ right('0'+convert(varchar,datepart(dd,@VersionDt)),2) end
UPDATE dbo.AppInfo SET AppInfoDesc = @AppInfoDesc WHERE AppInfoId = @AppInfoId
IF @VersionDt is not null
	UPDATE dbo.AppItem
	SET AppItemDesc =  @AppInfoDesc + ':' + ObjectTypeCd + ':' + right(space(4)+convert(varchar,ItemOrder),5) + ':' + isnull(LanguageCd,'*')
		+ ':' + isnull(FrameworkCd,'*') + ':' + isnull(DbProviderCd,'*') + ': ' + AppItemName
	WHERE AppInfoId = @AppInfoId
IF NOT EXISTS (SELECT 'true' FROM dbo.AppInfo WHERE VersionDt is null)
BEGIN
	-- AppInfo must have one row to start cause this is not called when no row is being updated.
	SELECT @VersionMa = max(VersionMa) FROM dbo.AppInfo
	SELECT @VersionMi = max(VersionMi) FROM dbo.AppInfo WHERE VersionMa = @VersionMa
	IF @VersionMi >= 9999 SELECT @VersionMa = @VersionMa + 1, @VersionMi = 0 ELSE SELECT @VersionMi = @VersionMi + 1
	IF @VersionMa > 9999
	BEGIN
		RAISERROR('Major Version Number may not exceed 9999, please try again.',18,2) WITH SETERROR
		RETURN 1
	END
	INSERT INTO dbo.AppInfo (AppInfoDesc, VersionMa, VersionMi)
	SELECT right(space(3)+convert(varchar,@VersionMa),4) + '.' + right(space(3)+convert(varchar,@VersionMi),4), @VersionMa, @VersionMi
END
RETURN 0

 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_InitCustom') AND type='P')
DROP PROCEDURE dbo.Ir_InitCustom
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_InitCustom]
 @CustomId int
/* WITH ENCRYPTION */
AS
DECLARE	 @CustomDesc	nvarchar(200)
SET NOCOUNT ON
SELECT @CustomDesc = GenerateCm + ':' + CustomName FROM dbo.Custom WHERE CustomId = @CustomId
UPDATE dbo.Custom SET CustomDesc = @CustomDesc WHERE CustomId = @CustomId
UPDATE dbo.CustomDtl SET CustomDtlDesc = @CustomDesc + ':' + ObjectTypeCd + ':' + isnull(LanguageCd,'*') + ':' + isnull(FrameworkCd,'*') + ':' + isnull(DbProviderCd,'*') + ':' + ProgramName WHERE CustomId = @CustomId
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_InitLabel') AND type='P')
DROP PROCEDURE dbo.Ir_InitLabel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[Ir_InitLabel]
 @LabelId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.Label SET
LabelDesc = LabelCat + ': ' + ISNULL(RIGHT('000'+CONVERT(varchar,SortOrder),4)+' ','') + LabelKey + ' (' + b.CultureTypeName + ')'
FROM dbo.Label a INNER JOIN RODesign.dbo.VwCulture b ON a.CultureId = b.CultureId
WHERE LabelId = @LabelId
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_InitMenuHlp') AND type='P')
DROP PROCEDURE dbo.Ir_InitMenuHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_InitMenuHlp]
 @MenuId	int
/* WITH ENCRYPTION */
AS
DECLARE	 @CultureId	smallint
		,@MenuText	nvarchar(50)
		,@PrevTxt1	nvarchar(50)
		,@PrevTxt2	nvarchar(50)
		,@PrevTxt3	nvarchar(50)
		,@ParentId1	int
		,@ParentId2	int
		,@ParentId3	int
		,@MenuIndex	smallint
SET NOCOUNT ON
SELECT @ParentId1 = ParentId, @MenuIndex = MenuIndex FROM dbo.Menu WHERE MenuId = @MenuId
SELECT @CultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF NOT EXISTS (SELECT 'true' from dbo.MenuHlp WHERE CultureId = @CultureId and MenuId = @MenuId)
BEGIN
	SELECT @MenuText = ''
	INSERT dbo.MenuHlp (MenuId,CultureId,MenuText) VALUES (@MenuId,@CultureId,'NEW ITEM')
END
ELSE
BEGIN
	SELECT @MenuText = MenuText FROM dbo.MenuHlp WHERE MenuId = @MenuId AND CultureId = @CultureId
END
SELECT @ParentId2 = ParentId FROM dbo.Menu WHERE MenuId = @ParentId1
SELECT @ParentId3 = ParentId FROM dbo.Menu WHERE MenuId = @ParentId2
SELECT @PrevTxt1 = MenuText FROM dbo.MenuHlp WHERE MenuId = @ParentId1 AND CultureId = @CultureId
SELECT @PrevTxt2 = MenuText FROM dbo.MenuHlp WHERE MenuId = @ParentId2 AND CultureId = @CultureId
SELECT @PrevTxt3 = MenuText FROM dbo.MenuHlp WHERE MenuId = @ParentId3 AND CultureId = @CultureId

/* Reorder if necessary ie. odd index order */
IF RIGHT(convert(varchar,@MenuIndex),1) <> '0'
BEGIN
	IF object_id('tempdb.dbo.#mnu') is not null DROP TABLE dbo.#mnu
	CREATE TABLE #mnu (tid smallint IDENTITY(1,1) not null, MenuId int not null)
	IF @ParentId1 is NULL
		INSERT INTO #mnu (MenuId) SELECT MenuId FROM dbo.Menu WHERE ParentId is NULL ORDER BY MenuIndex
	ELSE
		INSERT INTO #mnu (MenuId) SELECT MenuId FROM dbo.Menu WHERE ParentId = @ParentId1 ORDER BY MenuIndex
	UPDATE dbo.Menu SET MenuIndex = tid * 10 FROM dbo.Menu a INNER JOIN #mnu b ON a.MenuId = b.MenuId
	DROP TABLE dbo.#mnu
END
RETURN 0

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_InitReportClauses') AND type='P')
DROP PROCEDURE dbo.Ir_InitReportClauses
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_InitReportClauses]
 @ReportId	int
/* WITH ENCRYPTION */
AS
DECLARE	 @callingParm		varchar(4000)
		,@ProgramName		varchar(50)
		,@ReportTypeCd		char(1)
		,@RegClause			varchar(1000)
		,@ValClause			varchar(1000)
		,@UpdClause			varchar(1000)
		,@XlsClause			varchar(1000)
SET NOCOUNT ON
SELECT @callingParm = space(0)
SELECT	 @ProgramName = ProgramName
		,@ReportTypeCd = ReportTypeCd
		,@RegClause = RegClause
		,@ValClause = ValClause
		,@UpdClause = UpdClause
		,@XlsClause = XlsClause
		FROM dbo.Report WHERE ReportId = @ReportId
EXEC dbo.GetReportParm '', @reportId, '', '', '', '', '', @callingParm OUTPUT
IF @RegClause is null OR @RegClause = space(0)
	UPDATE dbo.Report SET RegClause = 'EXEC dbo._Get' + @ProgramName + 'R @Usrs, @RowAuthoritys, @UsrId, @usrName, @currCompanyId, @wClause' + @callingParm WHERE ReportId = @ReportId
IF (@ValClause is null OR @ValClause = space(0)) AND EXISTS (SELECT 1 FROM dbo.ReportObj WHERE ReportId = @ReportId AND RptObjTypeCd = 'P')
	UPDATE dbo.Report SET ValClause = 'EXEC dbo._Get' + @ProgramName + 'V @Usrs, @RowAuthoritys, @UsrId, @usrName, @currCompanyId, @wClause' + @callingParm WHERE ReportId = @ReportId
IF @ReportTypeCd = 'T' AND (@UpdClause is null OR @UpdClause = '')
	UPDATE dbo.Report SET UpdClause = 'EXEC dbo._Get' + @ProgramName + 'U @Usrs, @RowAuthoritys, @UsrId, @usrName, @currCompanyId, @wClause' + @callingParm WHERE ReportId = @ReportId
IF @ReportTypeCd = 'X' AND (@XlsClause is null OR @XlsClause = '')
	UPDATE dbo.Report SET XlsClause = 'EXEC dbo._Get' + @ProgramName + 'X @Usrs, @RowAuthoritys, @UsrId, @usrName, @currCompanyId, @wClause' + @callingParm WHERE ReportId = @ReportId

/* In case of a conversion from Crystal report to SQL Reporting */
EXEC dbo.WrRptConvSql @ReportId
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_InitReportCriClauses') AND type='P')
DROP PROCEDURE dbo.Ir_InitReportCriClauses
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_InitReportCriClauses]
 @ReportCriId	int
/* WITH ENCRYPTION */
AS
DECLARE	 @ColumnName		varchar(50)
	,@DisplayModeId		tinyint
	,@RegClause		varchar(1000)
	,@DisplayName		varchar(50)
SET NOCOUNT ON
SELECT	 @ColumnName = a.ColumnName
	,@DisplayModeId = a.DisplayModeId
	,@RegClause = a.RegClause
	,@DisplayName = b.TypeName
	FROM dbo.ReportCri a INNER JOIN RODesign.dbo.CtDisplayType b ON a.DisplayModeId = b.TypeId WHERE a.ReportCriId = @ReportCriId
IF @DisplayName IN ('ComboBox','DropDownList','ListBox','RadioButtonList')
BEGIN
	IF @RegClause is null OR @RegClause = space(0)
	UPDATE dbo.ReportCri SET RegClause = 'EXEC dbo._GetIn' + @ColumnName + ' @Usrs, @RowAuthoritys, @currCompanyId, @wClause' WHERE ReportCriId = @ReportCriId
END
ELSE
	UPDATE dbo.ReportCri SET RegClause = '' WHERE ReportCriId = @ReportCriId
RETURN 0

 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_InitReportObj') AND type='P')
DROP PROCEDURE dbo.Ir_InitReportObj
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




-- Enter @dbDesDatabase name when copying from another database:
CREATE PROCEDURE [dbo].[Ir_InitReportObj]
 @NReportId			int
,@CopyReportId		int
,@dbDesDatabase		varchar(50) = null		/* After CRUD */
/* WITH ENCRYPTION */
AS
DECLARE	 @x1Clause			varchar(max)
		,@x2Clause			varchar(max)
		,@x3Clause			varchar(max)
		,@x4Clause			varchar(max)
IF (SELECT COUNT(1) FROM dbo.RptStyle) <= 0 EXEC dbo.MkRptStyle
SELECT @dbDesDatabase = ISNULL(@dbDesDatabase+'.',SPACE(0)), @CopyReportId = ISNULL(@CopyReportId,0)
SELECT @x1Clause = '
DECLARE	 @CultureId			smallint
		,@NProgramName		varchar(50)
		,@NRptElmId			int
		,@NRptTblId			int
		,@NRptCelId			int
		,@NRptCtrId			int
		,@NRptChaId			int
		,@NReportObjId		int
		,@NReportCriId		int
		,@ProgramName		varchar(50)
		,@RegClause			varchar(400)
		,@ValClause			varchar(400)
		,@RptElmId			int
		,@RptTblId			int
		,@RptCelId			int
		,@RptCtrId			int
		,@RptChaId			int
		,@ReportObjId		int
		,@ReportCriId		int
SET NOCOUNT ON
UPDATE dbo.Report SET ReportDesc = b.ReportTitle
	FROM dbo.Report a
	INNER JOIN dbo.ReportHlp b ON a.ReportId = b.ReportId
	INNER JOIN RODesign.dbo.VwCulture c ON b.CultureId = c.CultureId
	WHERE a.ReportId = ' + CONVERT(varchar(10),@NReportId) + ' AND c.CultureDefault = ''Y''
IF ' + CONVERT(varchar(10),@CopyReportId) + ' <> 0
BEGIN
	SELECT @CultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = ''Y''
	SELECT @NProgramName = ProgramName FROM dbo.Report WHERE ReportId = ' + CONVERT(varchar(10),@NReportId)
+ ' SELECT @ProgramName = ProgramName, @RegClause = RegClause, @ValClause = ValClause FROM ' + @dbDesDatabase + 'dbo.Report WHERE ReportId = ' + CONVERT(varchar(10),@CopyReportId)
+ '	IF NOT EXISTS (SELECT 1 from dbo.ReportCri WHERE ReportId = ' + CONVERT(varchar(10),@NReportId) + ')
	BEGIN
		DECLARE cur1 CURSOR FAST_FORWARD FOR SELECT ReportCriId FROM ' + @dbDesDatabase + 'dbo.ReportCri WHERE ReportId = ' + CONVERT(varchar(10),@CopyReportId) + ' FOR READ ONLY
		OPEN cur1 FETCH NEXT FROM cur1 INTO @ReportCriId
		WHILE @@FETCH_STATUS = 0
		BEGIN
			INSERT dbo.ReportCri (ReportId, ReportCriDesc, ReportGrpId, LabelCss, ContentCss, TableId, TableAbbr, ColumnName
			, TabIndex, DataTypeId, DataTypeSize, DisplayModeId, ColumnSize, RowSize, DdlKeyColumnName, DdlRefColumnName
			, DdlSrtColumnName, RequiredValid, WhereClause, RegClause)
			SELECT ' + CONVERT(varchar(10),@NReportId) + ', REPLACE(ReportCriDesc,@ProgramName,@NProgramName), ReportGrpId, LabelCss, ContentCss, TableId, TableAbbr, ColumnName
			, TabIndex, DataTypeId, DataTypeSize, DisplayModeId, ColumnSize, RowSize, DdlKeyColumnName, DdlRefColumnName
			, DdlSrtColumnName, RequiredValid, WhereClause, RegClause
			FROM ' + @dbDesDatabase + 'dbo.ReportCri WHERE ReportCriId = @ReportCriId
			SELECT @NReportCriId = @@IDENTITY
			IF @@ERROR <> 0 BEGIN CLOSE cur1 DEALLOCATE cur1 ROLLBACK TRANSACTION END
			INSERT dbo.ReportCriHlp (ReportCriHlpDesc, ReportCriId, CultureId, ColumnHeader)
			SELECT ReportCriHlpDesc, @NReportCriId, @CultureId, ColumnHeader
			FROM ' + @dbDesDatabase + 'dbo.ReportCriHlp WHERE ReportCriId = @ReportCriId AND CultureId = @CultureId
			IF @@ERROR <> 0 BEGIN CLOSE cur1 DEALLOCATE cur1 ROLLBACK TRANSACTION END
			FETCH NEXT FROM cur1 INTO @ReportCriId
		END
		CLOSE cur1 DEALLOCATE cur1
	END
	IF NOT EXISTS (SELECT 1 from dbo.ReportObj WHERE ReportId = ' + CONVERT(varchar(10),@NReportId) + ')
	BEGIN
		UPDATE dbo.Report SET
			RegClause = REPLACE(@RegClause,@ProgramName,@NProgramName), ValClause = REPLACE(@ValClause,@ProgramName,@NProgramName)
			WHERE ReportId = ' + CONVERT(varchar(10),@NReportId)
SELECT @x2Clause = ' BEGIN TRANSACTION
		IF object_id(''tempdb.dbo.#obj'') is not null DROP TABLE dbo.#obj
		IF object_id(''tempdb.dbo.#elm'') is not null DROP TABLE dbo.#elm
		IF object_id(''tempdb.dbo.#tbl'') is not null DROP TABLE dbo.#tbl
		IF object_id(''tempdb.dbo.#cel'') is not null DROP TABLE dbo.#cel
		IF object_id(''tempdb.dbo.#ctr'') is not null DROP TABLE dbo.#ctr
		CREATE TABLE #obj (ReportObjId int, NReportObjId int)
		CREATE TABLE #elm (RptElmId int, NRptElmId int)
		CREATE TABLE #tbl (RptTblId int, NRptTblId int)
		CREATE TABLE #cel (RptCelId int, NRptCelId int)
		CREATE TABLE #ctr (RptCtrId int, NRptCtrId int)

		DELETE FROM dbo.ReportObj WHERE ReportId = ' + CONVERT(varchar(10),@NReportId)
+ '		DECLARE cur2 CURSOR FAST_FORWARD FOR SELECT ReportObjId FROM ' + @dbDesDatabase + 'dbo.ReportObj WHERE ReportId = ' + CONVERT(varchar(10),@CopyReportId) + ' FOR READ ONLY
		OPEN cur2 FETCH NEXT FROM cur2 INTO @ReportObjId
		WHILE @@FETCH_STATUS = 0
		BEGIN
			INSERT dbo.ReportObj (ReportId,RptObjTypeCd,ColumnName,ColumnDesc,TabIndex,ColumnFormat,PaddSize,PaddChar,DataTypeId,OperatorId,ReportCriId)
				SELECT ' + CONVERT(varchar(10),@NReportId) + ',RptObjTypeCd,ColumnName,REPLACE(ColumnDesc,@ProgramName,@NProgramName),TabIndex,ColumnFormat,PaddSize,PaddChar,DataTypeId,OperatorId,ReportCriId
				FROM ' + @dbDesDatabase + 'dbo.ReportObj WHERE ReportObjId = @ReportObjId
			SELECT @NReportObjId = @@IDENTITY
			IF @@ERROR <> 0 BEGIN CLOSE cur2 DEALLOCATE cur2 ROLLBACK TRANSACTION END
			INSERT dbo.ReportObjHlp (ReportObjHlpDesc,ReportObjId,CultureId,ColumnHeader,HeaderWidth)
				SELECT ReportObjHlpDesc,@NReportObjId,@CultureId,ColumnHeader,HeaderWidth
				FROM ' + @dbDesDatabase + 'dbo.ReportObjHlp WHERE ReportObjId = @ReportObjId AND CultureId = @CultureId
			IF @@ERROR <> 0 BEGIN CLOSE cur2 DEALLOCATE cur2 ROLLBACK TRANSACTION END
			INSERT #obj (ReportObjId, NReportObjId) SELECT @ReportObjId, @NReportObjId
			FETCH NEXT FROM cur2 INTO @ReportObjId
		END
		CLOSE cur2 DEALLOCATE cur2

		DELETE FROM dbo.RptElm WHERE ReportId = ' + CONVERT(varchar(10),@NReportId)
+ '		DECLARE cur3 CURSOR FAST_FORWARD FOR SELECT RptElmId FROM ' + @dbDesDatabase + 'dbo.RptElm WHERE ReportId = ' + CONVERT(varchar(10),@CopyReportId) + ' FOR READ ONLY
		OPEN cur3
		FETCH NEXT FROM cur3 INTO @RptElmId
		WHILE @@FETCH_STATUS = 0
		BEGIN
			INSERT dbo.RptElm (ReportId, RptElmTypeCd, RptStyleId, ElmHeight, ElmColumns, ElmColSpacing, ElmPrintFirst, ElmPrintLast)
				SELECT ' + CONVERT(varchar(10),@NReportId) + ', RptElmTypeCd, RptStyleId, ElmHeight, ElmColumns, ElmColSpacing, ElmPrintFirst, ElmPrintLast
				FROM ' + @dbDesDatabase + 'dbo.RptElm WHERE RptElmId = @RptElmId
			SELECT @NRptElmId = @@IDENTITY
			IF @@ERROR <> 0 BEGIN CLOSE cur3 DEALLOCATE cur3 ROLLBACK TRANSACTION END
			EXEC dbo.Ir_UpdRptElm @NRptElmId
			INSERT #elm (RptElmId, NRptElmId) SELECT @RptElmId, @NRptElmId
			FETCH NEXT FROM cur3 INTO @RptElmId
		END
		CLOSE cur3 DEALLOCATE cur3

		DELETE FROM dbo.RptTbl WHERE ReportId = ' + CONVERT(varchar(10),@NReportId)
SELECT @x3Clause = ' DECLARE cur4 CURSOR FAST_FORWARD FOR SELECT RptTblId FROM ' + @dbDesDatabase + 'dbo.RptTbl WHERE ReportId = ' + CONVERT(varchar(10),@CopyReportId) + ' FOR READ ONLY
		OPEN cur4 FETCH NEXT FROM cur4 INTO @RptTblId
		WHILE @@FETCH_STATUS = 0
		BEGIN
			INSERT dbo.RptTbl (RptTblDesc, ParentId, RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder, ColWidth, TblGrouping, TblVisibility, TblToggle)
			SELECT RptTblDesc, ParentId, RptCtrId, ' + CONVERT(varchar(10),@NReportId) + ', RptTblTypeCd, TblRepeatNew, TblOrder, ColWidth, TblGrouping, TblVisibility, TblToggle
				FROM ' + @dbDesDatabase + 'dbo.RptTbl WHERE RptTblId = @RptTblId
			SELECT @NRptTblId = @@IDENTITY
			IF @@ERROR <> 0 BEGIN CLOSE cur4 DEALLOCATE cur4 ROLLBACK TRANSACTION END
			INSERT #tbl (RptTblId, NRptTblId) SELECT @RptTblId, @NRptTblId
			DECLARE cur5 CURSOR FAST_FORWARD FOR SELECT RptCelId FROM ' + @dbDesDatabase + 'dbo.RptCel WHERE RptTblId = @RptTblId FOR READ ONLY
			OPEN cur5 FETCH NEXT FROM cur5 INTO @RptCelId
			WHILE @@FETCH_STATUS = 0
			BEGIN
				INSERT dbo.RptCel (RptCelDesc, RptTblId, RowNum, RowHeight, RowVisibility, CelNum, CelColSpan)
				SELECT RptCelDesc, @NRptTblId, RowNum, RowHeight, RowVisibility, CelNum, CelColSpan
					FROM ' + @dbDesDatabase + 'dbo.RptCel WHERE RptCelId = @RptCelId
				SELECT @NRptCelId = @@IDENTITY
				IF @@ERROR <> 0 BEGIN CLOSE cur5 DEALLOCATE cur5 ROLLBACK TRANSACTION END
				INSERT #cel (RptCelId, NRptCelId) SELECT @RptCelId, @NRptCelId
				FETCH NEXT FROM cur5 INTO @RptCelId
			END
			CLOSE cur5 DEALLOCATE cur5
			FETCH NEXT FROM cur4 INTO @RptTblId
		END
		CLOSE cur4 DEALLOCATE cur4
		UPDATE dbo.RptCel SET CelNum = c.NRptTblId
			FROM dbo.RptCel a
			INNER JOIN dbo.RptTbl b ON a.RptTblId = b.RptTblId
			INNER JOIN #tbl c ON a.CelNum = c.RptTblId
			WHERE b.ReportId = ' + CONVERT(varchar(10),@NReportId)
+ '		DELETE FROM dbo.RptCtr WHERE ReportId = ' + CONVERT(varchar(10),@NReportId)
SELECT @x4Clause = ' DELETE FROM dbo.RptCtr WHERE ReportId = ' + CONVERT(varchar(10),@NReportId)
+ '		DECLARE cur6 CURSOR FAST_FORWARD FOR SELECT RptCtrId FROM ' + @dbDesDatabase + 'dbo.RptCtr WHERE ReportId = ' + CONVERT(varchar(10),@CopyReportId) + ' FOR READ ONLY
		OPEN cur6 FETCH NEXT FROM cur6 INTO @RptCtrId
		WHILE @@FETCH_STATUS = 0
		BEGIN
			INSERT dbo.RptCtr (RptCtrDesc, PRptCtrId, RptElmId, RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrTop
				, CtrLeft, CtrHeight, CtrWidth, CtrZIndex, CtrAction, CtrGrouping, CtrVisibility, CtrToggle, CtrToolTip
				, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT RptCtrDesc, PRptCtrId, RptElmId, RptCelId, ' + CONVERT(varchar(10),@NReportId) + ', RptCtrTypeCd, RptCtrName, RptStyleId, CtrTop
				, CtrLeft, CtrHeight, CtrWidth, CtrZIndex, CtrAction, CtrGrouping, CtrVisibility, CtrToggle, CtrToolTip
				, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether
				FROM ' + @dbDesDatabase + 'dbo.RptCtr WHERE RptCtrId = @RptCtrId
			SELECT @NRptCtrId = @@IDENTITY
			IF @@ERROR <> 0 BEGIN CLOSE cur6 DEALLOCATE cur6 ROLLBACK TRANSACTION END
			EXEC dbo.Ir_UpdRptCtr @NRptCtrId
			INSERT #ctr (RptCtrId, NRptCtrId) SELECT @RptCtrId, @NRptCtrId
			FETCH NEXT FROM cur6 INTO @RptCtrId
		END
		CLOSE cur6 DEALLOCATE cur6

		DELETE FROM dbo.RptCha WHERE ReportId = ' + CONVERT(varchar(10),@NReportId)
+ '		DECLARE cur7 CURSOR FAST_FORWARD FOR SELECT RptChaId FROM ' + @dbDesDatabase + 'dbo.RptCha WHERE ReportId = ' + CONVERT(varchar(10),@CopyReportId) + ' FOR READ ONLY
		OPEN cur7 FETCH NEXT FROM cur7 INTO @RptChaId
		WHILE @@FETCH_STATUS = 0
		BEGIN
			INSERT dbo.RptCha (RptChaDesc, RptCtrId, ReportId, RptChaTypeCd, ThreeD, CategoryGrp, ChartData, SeriesGrp)
			SELECT RptChaDesc, RptCtrId, ' + CONVERT(varchar(10),@NReportId) + ', RptChaTypeCd, ThreeD, CategoryGrp, ChartData, SeriesGrp
				FROM ' + @dbDesDatabase + 'dbo.RptCha WHERE RptChaId = @RptChaId
			IF @@ERROR <> 0 BEGIN CLOSE cur7 DEALLOCATE cur7 ROLLBACK TRANSACTION END
			FETCH NEXT FROM cur7 INTO @RptChaId
		END
		CLOSE cur7 DEALLOCATE cur7

		UPDATE dbo.RptTbl SET ParentId = b.NRptTblId FROM dbo.RptTbl a INNER JOIN #tbl b ON a.ParentId = b.RptTblId WHERE ReportId = ' + CONVERT(varchar(10),@NReportId)
+ '		UPDATE dbo.RptTbl SET RptCtrId = b.NRptCtrId FROM dbo.RptTbl a INNER JOIN #ctr b ON a.RptCtrId = b.RptCtrId WHERE ReportId = ' + CONVERT(varchar(10),@NReportId)
+ '		UPDATE dbo.RptTbl SET TblGrouping = b.NReportObjId FROM dbo.RptTbl a INNER JOIN #obj b ON a.TblGrouping = b.ReportObjId WHERE ReportId = ' + CONVERT(varchar(10),@NReportId)
+ '		UPDATE dbo.RptCtr SET PRptCtrId = b.NRptCtrId FROM dbo.RptCtr a INNER JOIN #ctr b ON a.PRptCtrId = b.RptCtrId WHERE ReportId = ' + CONVERT(varchar(10),@NReportId)
+ '		UPDATE dbo.RptCtr SET RptElmId = b.NRptElmId FROM dbo.RptCtr a INNER JOIN #elm b ON a.RptElmId = b.RptElmId WHERE ReportId = ' + CONVERT(varchar(10),@NReportId)
+ '		UPDATE dbo.RptCtr SET RptCelId = b.NRptCelId FROM dbo.RptCtr a INNER JOIN #cel b ON a.RptCelId = b.RptCelId WHERE ReportId = ' + CONVERT(varchar(10),@NReportId)
+ '		UPDATE dbo.RptCha SET RptCtrId = b.NRptCtrId FROM dbo.RptCha a INNER JOIN #ctr b ON a.RptCtrId = b.RptCtrId WHERE ReportId = ' + CONVERT(varchar(10),@NReportId)
+ '		DROP TABLE #obj
		DROP TABLE #elm
		DROP TABLE #tbl
		DROP TABLE #cel
		DROP TABLE #ctr
		COMMIT TRANSACTION
	END
	UPDATE dbo.Report SET CopyReportId = null WHERE ReportId = ' + CONVERT(varchar(10),@NReportId)
+ ' END'
-- Bypass varchar(max) running as varchar(8000) issue on certain SQL server versions;
EXEC dbo.MkStoredProcedure @x1Clause, @x2Clause, @x3Clause, @x4Clause
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_InitReportObjHlp') AND type='P')
DROP PROCEDURE dbo.Ir_InitReportObjHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_InitReportObjHlp]
 @ReportObjId	int
/* WITH ENCRYPTION */
AS
DECLARE	 @CultureId		smallint
	,@CultureTypeName	varchar(10)
SET NOCOUNT ON
SELECT @CultureId = CultureId, @CultureTypeName = CultureTypeName FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF NOT EXISTS (SELECT 1 from dbo.ReportObjHlp WHERE CultureId = @CultureId and ReportObjId = @ReportObjId)
	INSERT dbo.ReportObjHlp (ReportObjHlpDesc,ReportObjId,CultureId,ColumnHeader)
	SELECT ColumnDesc + ' (' + @CultureTypeName + ')',@ReportObjId,@CultureId,ColumnName
	FROM dbo.ReportObj WHERE ReportObjId = @ReportObjId
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_InitScreenObj') AND type='P')
DROP PROCEDURE dbo.Ir_InitScreenObj
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[Ir_InitScreenObj]
 @ScreenId	int
,@DbId		tinyint
/* WITH ENCRYPTION */
AS
DECLARE	 @ProgramName		varchar(50)
		,@MasterTableId		int
		,@DetailTableId		int
		,@DefaultDisplay	tinyint
		,@Offset			int
		,@DefCultureId		smallint
		,@CultureTypeName	varchar(10)
		,@ScreenFilterId	int
		,@ScreenObjId		int
		,@ScreenTypeName	char(2)
		,@TabFolderId		int
		,@GridRows			tinyint
		,@MaxIndex			smallint
		,@ParentId			int
		,@ScreenTitle		nvarchar(50)
		,@SearchTableId		int
		,@SearchId			int
SET NOCOUNT ON
SELECT @ScreenTypeName = b.ScreenTypeName, @GridRows = a.GridRows
	, @SearchTableId = SearchTableId, @SearchId = a.SearchId, @ScreenTypeName = b.ScreenTypeName
	, @ProgramName = a.ProgramName, @MasterTableId = a.MasterTableId, @DetailTableId = a.DetailTableId
	FROM dbo.Screen a
	INNER JOIN RODesign.dbo.CtScreenType b ON a.ScreenTypeId = b.ScreenTypeId
	WHERE a.ScreenId = @ScreenId
IF EXISTS (SELECT 1 FROM dbo.Screen WHERE ProgramName = @ProgramName AND ScreenId <> @ScreenId)
BEGIN
	RAISERROR('Program name is unqiue and is already in use, please try another. Thank you.',18,2) WITH SETERROR
	RETURN 1
END
IF EXISTS (SELECT 1 FROM dbo.Screen WHERE ScreenId = @ScreenId AND GenerateSc = 'Y' AND GenerateSr = 'N')
BEGIN
	RAISERROR('Cannot generate just the front end for the time being, please check the generate SRV as well. Thank you.',18,2) WITH SETERROR
	RETURN 1
END
SELECT @DefCultureId = CultureId, @CultureTypeName = CultureTypeName FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF NOT EXISTS (SELECT 1 FROM dbo.ScreenHlp WHERE ScreenId = @ScreenId AND CultureId = @DefCultureId)
BEGIN
	INSERT dbo.ScreenHlp (ScreenId, CultureId, DefaultHlpMsg, ScreenTitle)
	SELECT @ScreenId, @DefCultureId, 'Please edit the content and click the Save button to add or save changes permanently.', @ProgramName
END
SELECT @ScreenTitle = ScreenTitle FROM dbo.ScreenHlp WHERE ScreenId = @ScreenId AND CultureId = @DefCultureId
IF @ScreenTypeName in ('I1','I2')
BEGIN
	IF @SearchTableId is NULL
	BEGIN RAISERROR('Please make sure Search table is defined and try again.',18,2) WITH SETERROR RETURN 1 END
	IF @SearchId is NULL
	BEGIN RAISERROR('Please make sure Search Title is defined and try again.',18,2) WITH SETERROR RETURN 1 END
END
ELSE UPDATE Screen SET SearchTableId = NULL, SearchId = NULL, SearchDtlId = NULL, SearchUrlId = NULL, SearchImgId = NULL WHERE ScreenId = @ScreenId

SELECT @TabFolderId = null
SELECT @TabFolderId = ScreenTabId FROM dbo.ScreenTab WHERE ScreenId = @ScreenId
IF @TabFolderId is null
BEGIN
	INSERT dbo.ScreenTab (ScreenId, TabFolderName, TabFolderOrder) SELECT @ScreenId, 'Main', 10
	SELECT @TabFolderId = @@IDENTITY
	INSERT dbo.ScreenTabHlp (ScreenTabId, CultureId, TabFolderName) SELECT @TabFolderId, 1, 'Main Info'
	EXEC dbo.Ir_UpdScreenTab @TabFolderId
END
ELSE
	UPDATE dbo.ScreenObj SET TabFolderId = @TabFolderId WHERE ScreenId = @ScreenId AND MasterTable = 'Y' AND TabFolderId is null
IF (@ScreenTypeName = 'I2' OR @ScreenTypeName = 'I3') AND @GridRows is null
BEGIN
	RAISERROR('{21}',18,2) WITH SETERROR
	RETURN 1
END
IF (@ScreenTypeName IN ('I1','I3') AND NOT EXISTS (SELECT 1 from dbo.ScreenObj WHERE ScreenId = @ScreenId)) OR
   (@ScreenTypeName = 'I2' AND (NOT EXISTS (SELECT 1 from dbo.ScreenObj WHERE ScreenId = @ScreenId AND MasterTable = 'Y') OR NOT EXISTS (SELECT 1 from dbo.ScreenObj WHERE ScreenId = @ScreenId AND MasterTable = 'N')))
BEGIN
	SELECT @DefaultDisplay = TypeId FROM RODesign.dbo.CtDisplayType WHERE DisplayDefault = 'Y'
	SELECT @Offset = isnull(max(ColumnIndex),1000) FROM dbo.DbColumn WHERE TableId = @MasterTableId
	/* Create ScreenObj */
	IF NOT EXISTS (SELECT 1 from dbo.ScreenObj WHERE ScreenId = @ScreenId AND MasterTable = 'Y')
	BEGIN
	INSERT dbo.ScreenObj (ScreenId,MasterTable,GroupRowId,GroupColId,ColumnId,ColumnName,ColumnWrap,GridGrpCd,ColumnJustify,DisplayModeId,GenerateSp,TabFolderId,TabIndex,RequiredValid,RefreshOnCUD)
		SELECT @ScreenId,'Y',78,851,a.ColumnId,a.ColumnName,'Y','N'
		,CASE WHEN b.NumericData='Y' THEN 'R' WHEN b.DataTypeName='Char' AND a.ColumnLength=1 THEN 'C' else 'L' END
		,ISNULL(b.DisplayModeId,@DefaultDisplay),'Y',@TabFolderId,isnull(a.ColumnIndex,a.ColumnId),CASE WHEN a.AllowNulls = 'N' THEN 'Y' ELSE 'N' END,'N'
		FROM dbo.DbColumn a
		INNER JOIN RODesign.dbo.CtDataType b ON a.DataType = b.DataTypeId
		WHERE TableId = @MasterTableId ORDER BY ColumnIndex
		INSERT dbo.ScreenObjHlp (ScreenObjHlpDesc,ScreenObjId,CultureId,ColumnHeader)
			SELECT ColumnDesc + ' (' + @CultureTypeName + ')',ScreenObjId,@DefCultureId,ColumnName
			FROM dbo.ScreenObj WHERE ScreenId = @ScreenId AND MasterTable = 'Y'
	END
	IF NOT EXISTS (SELECT 1 from dbo.ScreenObj WHERE ScreenId = @ScreenId AND MasterTable = 'N')
	BEGIN
	INSERT dbo.ScreenObj (ScreenId,MasterTable,GroupRowId,GroupColId,ColumnId,ColumnName,ColumnWrap,GridGrpCd,ColumnJustify,DisplayModeId,GenerateSp,TabFolderId,TabIndex,RequiredValid,RefreshOnCUD)
		SELECT @ScreenId,'N',78,857,a.ColumnId,a.ColumnName,'Y','N'
		,CASE WHEN b.NumericData='Y' THEN 'R' WHEN b.DataTypeName='Char' AND a.ColumnLength=1 THEN 'C' else 'L' END
		,ISNULL(b.DisplayModeId,@DefaultDisplay),'Y',@TabFolderId,isnull(a.ColumnIndex,a.ColumnId) + @Offset,CASE WHEN a.AllowNulls='N' THEN 'Y' ELSE 'N' END,'N'
		FROM dbo.DbColumn a
		INNER JOIN RODesign.dbo.CtDataType b ON a.DataType = b.DataTypeId
		WHERE TableId = @DetailTableId ORDER BY ColumnIndex
		INSERT dbo.ScreenObjHlp (ScreenObjHlpDesc,ScreenObjId,CultureId,ColumnHeader)
			SELECT ColumnDesc + ' (' + @CultureTypeName + ')',ScreenObjId,@DefCultureId,ColumnName
			FROM dbo.ScreenObj WHERE ScreenId = @ScreenId AND MasterTable = 'N'
	END
	/* Update ScreenObj */
	DECLARE objcur CURSOR FOR SELECT ScreenObjId FROM dbo.ScreenObj WHERE ScreenId = @ScreenId ORDER BY TabIndex FOR READ ONLY
	OPEN objcur
	FETCH NEXT FROM objcur INTO @ScreenObjId
	WHILE @@FETCH_STATUS = 0
	BEGIN
		EXEC dbo.Ir_UpdScreenObj @ScreenObjId
		FETCH NEXT FROM objcur INTO @ScreenObjId
	END
	CLOSE objcur DEALLOCATE objcur
END
ELSE IF @ScreenTypeName = 'I1' OR @ScreenTypeName = 'I3'
BEGIN
	IF EXISTS (SELECT 1 FROM dbo.ScreenObj WHERE ScreenId = @ScreenId AND MasterTable = 'N')
	BEGIN
		DECLARE objcur CURSOR FOR SELECT ScreenObjId FROM dbo.ScreenObj WHERE ScreenId = @ScreenId AND MasterTable = 'N' FOR READ ONLY
		OPEN objcur
		FETCH NEXT FROM objcur INTO @ScreenObjId
		WHILE @@FETCH_STATUS = 0
		BEGIN
			EXEC dbo.Cr_RmScrObjWRule @ScreenObjId
			EXEC dbo.Cr_RmScrObjCRule @ScreenObjId
			EXEC dbo.Ir_DelAuthCol @ScreenObjId
			-- DO NOT EXEC dbo.Ir_DelDbKey
			DELETE FROM dbo.ScreenObjHlp WHERE ScreenObjId = @ScreenObjId
			DELETE FROM dbo.ScreenObj WHERE ScreenObjId = @ScreenObjId
			FETCH NEXT FROM objcur INTO @ScreenObjId
		END
		CLOSE objcur
		DEALLOCATE objcur
	END
	IF @ScreenTypeName = 'I3'
		AND EXISTS (SELECT 1 FROM dbo.ScreenObj a INNER JOIN RODesign.dbo.CtDisplayType b ON a.DisplayModeId = b.TypeId
		AND lower(b.TypeDesc) in ('autolistbox','listbox','calendar','datagridlink','document','placeholder','htmleditor')
		WHERE a.ScreenId = @ScreenId)
	BEGIN
		RAISERROR('Display types listbox, calendar, datagridlink, document, placeholder, and htmleditor are currently unavailable for data grid, please rectify and try again.',18,2) WITH SETERROR
		RETURN 1
	END
END
-- Update popup
SET ROWCOUNT 1
SELECT @ScreenFilterId = ScreenFilterId FROM dbo.ScreenFilter WHERE ScreenId = @ScreenId ORDER BY ScreenFilterDesc
SELECT @ScreenObjId = a.ScreenObjId FROM dbo.ScreenObj a
	INNER JOIN DbColumn b ON a.ColumnId = b.ColumnId AND b.PrimaryKey = 'Y' AND a.MasterTable = 'Y' AND ScreenId = @ScreenId
SET ROWCOUNT 0
UPDATE dbo.Screen SET
	 ScreenDesc = @ScreenTitle
	,ScreenObj = 'AdmScreenObj.aspx?id=26&key=' + convert(varchar,isnull(@ScreenObjId,0)) + '&typ=N&sys=' + convert(varchar,@DbId)
	,ScreenFilter = 'AdmScreenFilter.aspx?id=181&cri1=' + convert(varchar,@ScreenId) + '&typ=N&sys=' + convert(varchar,@DbId)
	WHERE ScreenId = @ScreenId
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_InitScreenObjHlp') AND type='P')
DROP PROCEDURE dbo.Ir_InitScreenObjHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_InitScreenObjHlp]
 @ScreenObjId	int
/* WITH ENCRYPTION */
AS
DECLARE	 @CultureId		smallint
	,@CultureTypeName	varchar(10)
	,@ColumnId			int
	,@ToolTip			nvarchar(200)
	,@ColumnName		varchar(50)
	,@ColumnDesc		varchar(100)
SET NOCOUNT ON
SELECT @CultureId = CultureId, @CultureTypeName = CultureTypeName FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT @ColumnId = ColumnId, @ColumnName = ColumnName, @ColumnDesc = ColumnDesc FROM dbo.ScreenObj WHERE ScreenObjId = @ScreenObjId
IF NOT EXISTS (SELECT 'true' FROM dbo.ScreenObjHlp WHERE CultureId = @CultureId and ScreenObjId = @ScreenObjId)
BEGIN
	SELECT @ToolTip = convert(varchar(200),ColObjective) FROM dbo.DbColumn WHERE ColumnId = @ColumnId
	INSERT dbo.ScreenObjHlp (ScreenObjHlpDesc,ScreenObjId,CultureId,ColumnHeader,ToolTip)
		SELECT @ColumnDesc + ' (' + @CultureTypeName + ')',@ScreenObjId,@CultureId,'NEW OBJECT',@ToolTip
END
ELSE
BEGIN
	IF EXISTS (SELECT 'true' FROM dbo.DbColumn WHERE ColumnId = @ColumnId AND ColObjective is null)
	BEGIN
		SELECT @ToolTip = ToolTip FROM dbo.ScreenObjHlp WHERE CultureId = @CultureId and ScreenObjId = @ScreenObjId
		UPDATE dbo.DbColumn SET ColObjective = convert(varchar(200),@ToolTip) WHERE ColumnId = @ColumnId
	END
END
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_InitStaticPg') AND type='P')
DROP PROCEDURE dbo.Ir_InitStaticPg
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[Ir_InitStaticPg]
 @StaticPgId	int
,@StaticPgNm	varchar(50)
,@DbId			smallint
/* WITH ENCRYPTION */
AS
DECLARE	 @StaticPgTitle nvarchar(100)
		,@TitleFr		nvarchar(100)
		,@TitleTo		nvarchar(100)
		,@DefCultureId	smallint
SET NOCOUNT ON
IF (SELECT COUNT(1) FROM dbo.StaticPg WHERE StaticPgNm = @StaticPgNm) > 1
BEGIN
	RAISERROR('"%s" is already in use by other static page, please specify another name and try again.',18,2,@StaticPgNm) WITH SETERROR
	RETURN 1
END
SELECT @StaticPgTitle = StaticPgTitle FROM dbo.StaticPg WHERE StaticPgId = @StaticPgId
IF CHARINDEX('[[',@StaticPgTitle) > 0 AND CHARINDEX(']]',@StaticPgTitle) > 0
BEGIN
	SELECT @DefCultureId = CultureTypeId FROM RODesign.dbo.CtCulture WHERE CultureDefault = 'Y'
	SELECT @TitleFr = SUBSTRING(@StaticPgTitle,CHARINDEX('[[',@StaticPgTitle)+2,CHARINDEX(']]',@StaticPgTitle)-CHARINDEX('[[',@StaticPgTitle)-2)
	SELECT @TitleTo = LabelText FROM dbo.Label WHERE LabelCat = @StaticPgNm AND LabelKey = @TitleFr AND CultureId = @DefCultureId
	SELECT @StaticPgTitle = REPLACE(@StaticPgTitle,'[['+@TitleFr+']]',ISNULL(@TitleTo,''))
END
UPDATE dbo.StaticPg
	SET StaticPgUrl = 'showpage.aspx?pg=' + CONVERT(varchar,@StaticPgId) + '&csy=' + CONVERT(varchar,@DbId)
	, StaticPgDesc = @StaticPgTitle + ' (' + @StaticPgNm + ')'
	WHERE StaticPgId = @StaticPgId
RETURN 0 



 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_InitWizardObj') AND type='P')
DROP PROCEDURE dbo.Ir_InitWizardObj
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO







CREATE PROCEDURE [dbo].[Ir_InitWizardObj]
 @WizardId	int
,@MasterTableId	int
/* WITH ENCRYPTION */
AS
DECLARE	 @programName		varchar(50)
	,@offset		int
SET NOCOUNT ON
IF NOT EXISTS (SELECT 'true' from dbo.WizardObj WHERE WizardId = @WizardId)
BEGIN
	SELECT @programName = ProgramName FROM dbo.Wizard WHERE WizardId = @WizardId
	SELECT @offset = MIN(ColumnId)-1 FROM dbo.DbColumn WHERE TableId = @masterTableId
	INSERT dbo.WizardObj (WizardId,ColumnId,ColumnDesc,TabIndex)
		SELECT @WizardId,ColumnId,@programName + right(space(6) + convert(varchar,(ColumnId-@offset)*10),6) + ': ' + ColumnName,(ColumnId-@offset)*10
		FROM dbo.DbColumn WHERE TableId = @masterTableId
END
RETURN 0

 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_MemScreenObjHlp') AND type='P')
DROP PROCEDURE dbo.Ir_MemScreenObjHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_MemScreenObjHlp]
 @ScreenObjHlpId	int
,@ScreenObjId		int
,@CultureId			smallint
,@ColumnHeader		nvarchar(max)
,@ToolTip			nvarchar(200)
,@ErrMessage		nvarchar(300)
,@TbHint			nvarchar(200)
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId		smallint
		,@DefColumnHeader	nvarchar(max)
		,@DefToolTip		nvarchar(200)
		,@DefErrMessage		nvarchar(300)
		,@DefTbHint			nvarchar(200)
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
IF @CultureId <> @DefCultureId
BEGIN
	SELECT @DefColumnHeader = ColumnHeader, @DefToolTip = ToolTip, @DefErrMessage = ErrMessage, @DefTbHint = TbHint
		FROM dbo.ScreenObjHlp WHERE ScreenObjId = @ScreenObjId AND CultureId = @DefCultureId
	IF @ScreenObjHlpId is null
	BEGIN
		EXEC dbo.WrUpdMemTranslate @DefColumnHeader, @CultureId, @ColumnHeader
		EXEC dbo.WrUpdMemTranslate @DefToolTip, @CultureId, @ToolTip
		EXEC dbo.WrUpdMemTranslate @DefErrMessage, @CultureId, @ErrMessage
		EXEC dbo.WrUpdMemTranslate @DefTbHint, @CultureId, @TbHint
	END
	ELSE
	BEGIN
		IF NOT EXISTS (SELECT 1 FROM dbo.ScreenObjHlp WHERE ScreenObjHlpId = @ScreenObjHlpId AND CultureId = @CultureId AND ColumnHeader = @ColumnHeader)
			EXEC dbo.WrUpdMemTranslate @DefColumnHeader, @CultureId, @ColumnHeader
		IF NOT EXISTS (SELECT 1 FROM dbo.ScreenObjHlp WHERE ScreenObjHlpId = @ScreenObjHlpId AND CultureId = @CultureId AND ToolTip = @ToolTip)
			EXEC dbo.WrUpdMemTranslate @DefToolTip, @CultureId, @ToolTip
		IF NOT EXISTS (SELECT 1 FROM dbo.ScreenObjHlp WHERE ScreenObjHlpId = @ScreenObjHlpId AND CultureId = @CultureId AND ErrMessage = @ErrMessage)
			EXEC dbo.WrUpdMemTranslate @DefErrMessage, @CultureId, @ErrMessage
		IF NOT EXISTS (SELECT 1 FROM dbo.ScreenObjHlp WHERE ScreenObjHlpId = @ScreenObjHlpId AND CultureId = @CultureId AND TbHint = @TbHint)
			EXEC dbo.WrUpdMemTranslate @DefTbHint, @CultureId, @TbHint
	END
END
RETURN 0
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdAdvRule') AND type='P')
DROP PROCEDURE dbo.Ir_UpdAdvRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[Ir_UpdAdvRule]
 @AdvRuleId		int
,@CultureId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @DefCultureId		smallint
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
UPDATE dbo.AdvRule SET RuleDesc = isnull(b.ScreenTitle,space(0)) + ' [' + c.RuleLayerDesc + ']: ' + a.RuleName
	FROM dbo.AdvRule a
	INNER JOIN RODesign.dbo.CtRuleLayer c ON a.RuleLayerCd = c.RuleLayerCd
	INNER JOIN dbo.ScreenHlp b ON a.ScreenId = b.ScreenId
		AND b.CultureId = CASE WHEN EXISTS (SELECT 1 FROM dbo.ScreenHlp x WHERE x.ScreenId = a.ScreenId AND x.CultureId = @CultureId) THEN @CultureId ELSE @DefCultureId END
	WHERE a.AdvRuleId = @AdvRuleId
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdAppItem') AND type='P')
DROP PROCEDURE dbo.Ir_UpdAppItem
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdAppItem]
 @AppItemId	int
,@DbId		tinyint
/* WITH ENCRYPTION */
AS
DECLARE	 @AppInfoId	int
	,@ItemOrder	smallint
	,@ObjectTypeCd	char(1)
	,@AppInfoDesc	varchar(50)
	,@ii		int
	,@ItemId	int
SET NOCOUNT ON
SELECT @AppInfoId = AppInfoId, @ItemOrder = ItemOrder, @ObjectTypeCd = ObjectTypeCd FROM dbo.AppItem WHERE AppItemId = @AppItemId
SELECT @AppInfoDesc = AppInfoDesc FROM dbo.AppInfo WHERE AppInfoId = @AppInfoId
/* Reorder Execution order: Sybase do not have static cursor or create temp table in a transaction */
IF NOT (@ItemOrder is not null AND right(space(1)+convert(varchar,@ItemOrder),1) = '0')
BEGIN
	UPDATE dbo.AppItem SET ItemOrder = 32757 WHERE AppInfoId = @AppInfoId AND ObjectTypeCd = @ObjectTypeCd AND ItemOrder is null
	SELECT @ii = 1
	DECLARE cur CURSOR FOR SELECT AppItemId, ItemOrder FROM dbo.AppItem WHERE AppInfoId = @AppInfoId AND ObjectTypeCd = @ObjectTypeCd ORDER BY ItemOrder FOR READ ONLY
	OPEN cur
	FETCH NEXT FROM cur INTO @ItemId, @ItemOrder
	WHILE @@FETCH_STATUS = 0
	BEGIN
		UPDATE dbo.AppItem SET ItemOrder = @ii
			, AppItemDesc = @AppInfoDesc + ':' + ObjectTypeCd + ':' + right(space(4)+convert(varchar,@ii * 10),5) + ':' + isnull(LanguageCd,'*') + ':' + isnull(FrameworkCd,'*') + ':' + isnull(DbProviderCd,'*') + ': ' + AppItemName
			WHERE AppItemId = @ItemId
		IF @ii > 3275 SELECT @ii = 3276 ELSE SELECT @ii = @ii + 1
		FETCH NEXT FROM cur INTO @ItemId, @ItemOrder
	END
	CLOSE cur
	DEALLOCATE cur
	UPDATE dbo.AppItem SET ItemOrder = ItemOrder * 10 WHERE AppInfoId = @AppInfoId AND ObjectTypeCd = @ObjectTypeCd
END
UPDATE dbo.AppItem SET
	 AppItemDesc = @AppInfoDesc + ':' + ObjectTypeCd + ':' + right(space(4)+convert(varchar,ItemOrder),5) + ':' + isnull(LanguageCd,'*') + ':' + isnull(FrameworkCd,'*') + ':' + isnull(DbProviderCd,'*') + ': ' + AppItemName
	,AppItemLink = 'SearchLink("AdmAppItem.aspx?id=213&key=' + convert(varchar,@AppItemId) + '&typ=N&sys=' + convert(varchar,@DbId) + '","","",""); return false;'
WHERE AppItemId = @AppItemId
RETURN 0

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdAsmxRule') AND type='P')
DROP PROCEDURE dbo.Ir_UpdAsmxRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[Ir_UpdAsmxRule]
 @RuleAsmxId		int
,@CultureId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @DefCultureId		smallint
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
UPDATE dbo.RuleAsmx SET RuleAsmxDesc = isnull(b.ScreenTitle,space(0)) + ': ' + a.RuleAsmxName
	FROM dbo.RuleAsmx a
	LEFT OUTER JOIN dbo.ScreenHlp b ON a.ScreenId = b.ScreenId
	AND b.CultureId = CASE WHEN EXISTS (SELECT 1 FROM dbo.ScreenHlp x WHERE x.ScreenId = a.ScreenId AND x.CultureId = @CultureId) THEN @CultureId ELSE @DefCultureId END
	WHERE a.RuleAsmxId = @RuleAsmxId
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdClientRule') AND type='P')
DROP PROCEDURE dbo.Ir_UpdClientRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdClientRule]
 @ClientRuleId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @CultureId		smallint
		,@DefCultureId	smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT @CultureId = CASE 
	WHEN RuleMethodId = 1 THEN @DefCultureId
	WHEN a.ScreenObjHlpId is not null THEN b1.CultureId WHEN a.ScreenCriHlpId is not null THEN b2.CultureId ELSE b3.CultureId END
	FROM dbo.ClientRule a
	LEFT OUTER JOIN dbo.ScreenObjHlp b1 ON a.ScreenObjHlpId = b1.ScreenObjHlpId
	LEFT OUTER JOIN dbo.ScreenCriHlp b2 ON a.ScreenCriHlpId = b2.ScreenCriHlpId
	LEFT OUTER JOIN dbo.ReportCriHlp b3 ON a.ReportCriHlpId = b3.ReportCriHlpId
	WHERE a.ClientRuleId = @ClientRuleId
UPDATE dbo.ClientRule SET
	  ScreenId = CASE WHEN RuleMethodId = 1 THEN a.ScreenId ELSE isnull(c1.ScreenId,c2.ScreenId) END
	, ReportId = c3.ReportId, CultureId = isnull(@CultureId,@DefCultureId)
	, RuleDesc = CASE
		WHEN RuleMethodId = 1 THEN isnull(sh.ScreenTitle,space(0)) + ': ' + a.RuleName
		WHEN a.ScreenObjHlpId is not null THEN isnull(d1.ScreenTitle,space(0)) + ': ' + a.RuleName
		WHEN a.ScreenCriHlpId is not null THEN isnull(d2.ScreenTitle,space(0)) + ': ' + a.RuleName
		ELSE isnull(d3.ReportTitle,space(0)) + ': ' + a.RuleName END
	FROM dbo.ClientRule a
	LEFT OUTER JOIN dbo.ScreenObjHlp b1 ON a.ScreenObjHlpId = b1.ScreenObjHlpId
	LEFT OUTER JOIN dbo.ScreenObj c1 ON b1.ScreenObjId = c1.ScreenObjId
	LEFT OUTER JOIN dbo.ScreenHlp d1 ON c1.ScreenId = d1.ScreenId AND d1.CultureId = @CultureId
	LEFT OUTER JOIN dbo.ScreenCriHlp b2 ON a.ScreenCriHlpId = b2.ScreenCriHlpId
	LEFT OUTER JOIN dbo.ScreenCri c2 ON b2.ScreenCriId = c2.ScreenCriId
	LEFT OUTER JOIN dbo.ScreenHlp d2 ON c2.ScreenId = d2.ScreenId AND d2.CultureId = @CultureId
	LEFT OUTER JOIN dbo.ReportCriHlp b3 ON a.ReportCriHlpId = b3.ReportCriHlpId
	LEFT OUTER JOIN dbo.ReportCri c3 ON b3.ReportCriId = c3.ReportCriId
	LEFT OUTER JOIN dbo.ReportHlp d3 ON c3.ReportId = d3.ReportId AND d3.CultureId = @CultureId
	LEFT OUTER JOIN dbo.ScreenHlp sh ON sh.ScreenId = a.ScreenId AND sh.CultureId = @CultureId
	WHERE a.ClientRuleId = @ClientRuleId
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdColByCol') AND type='P')
DROP PROCEDURE dbo.Ir_UpdColByCol
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[Ir_UpdColByCol]
 @ColumnId		int
,@ColumnName	varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @PrevColName	varchar(50)
		,@ColName		varchar(50)
		,@TableId		int
		,@SystemId		tinyint
		,@TableName		varchar(500)
		,@AppDb			varchar(50)
		,@Oid			int
		,@sClause		varchar(8000)
SET NOCOUNT ON
SELECT @PrevColName = ltrim(PrevColName), @ColName = ltrim(ColumnName), @TableId = TableId
	FROM dbo.DbColumn WHERE ColumnId = @ColumnId
IF @PrevColName is null SELECT @PrevColName = ''
SELECT @SystemId = SystemId, @TableName = TableName FROM dbo.DbTable WHERE TableId = @TableId
SELECT @AppDb = dbAppDatabase FROM RODesign.dbo.Systems WHERE SystemId = @SystemId
SELECT @Oid = object_id(@AppDb + '.dbo.' + @TableName)
-- PrevColName is only meaningfull in the context of the existing column in the physical database:
IF @ColumnName <> @ColName AND @Oid is not null
BEGIN
	SELECT @sClause = 'DECLARE @PrevName varchar(50) SELECT @PrevName = ''' + @PrevColName + ''''
		+ ' IF @PrevName <> '''''
		+ '		AND NOT EXISTS (SELECT 1 FROM ' + @AppDb + '.dbo.syscolumns WHERE id = ' + CONVERT(varchar(50),@Oid) + ' AND name = @PrevName)'
		+ '	BEGIN'
		+ '		SELECT @PrevName = '''''
		+ '		UPDATE dbo.DbColumn SET PrevColName = null WHERE ColumnId = ' + CONVERT(varchar(50),@ColumnId)
		+ '	END'
		+ ' IF @PrevName = '''''
		+ '		AND EXISTS (SELECT 1 FROM ' + @AppDb + '.dbo.syscolumns WHERE id = ' + CONVERT(varchar(50),@Oid) + ' AND name=''' + @ColName + ''')'
		+ '		UPDATE dbo.DbColumn SET PrevColName = ''' + @ColName + ''' WHERE ColumnId = ' + CONVERT(varchar(50),@ColumnId)
	EXEC (@sClause)
END
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdCronJob') AND type='P')
DROP PROCEDURE dbo.Ir_UpdCronJob
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdCronJob]
 @CronJobId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.CronJob SET NextRun = null WHERE CronJobId = @CronJobId
RETURN 0  

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdDbColumn') AND type='P')
DROP PROCEDURE dbo.Ir_UpdDbColumn
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




-- Fire on master because TableName can change when columns have no activitiy:
CREATE PROCEDURE [dbo].[Ir_UpdDbColumn]
 @TableId	int
,@TableName	varchar(500)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
SELECT @TableName = LEFT(@TableName, CASE WHEN CHARINDEX('(',@TableName) > 0 THEN CHARINDEX('(',@TableName) - 1 ELSE LEN(@TableName) END)
UPDATE dbo.DbColumn SET ColumnDesc = @TableName + ' - ' + ColumnName WHERE TableId = @TableId
RETURN 0 
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdIndByCol') AND type='P')
DROP PROCEDURE dbo.Ir_UpdIndByCol
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdIndByCol]
 @ColumnId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @ii			int
		,@ColId			int
		,@ColumnIndex	smallint
		,@TableId		int
		,@DefaultValue	nvarchar(50)
		,@NumericData	char(1)
		,@ColumnIdentity char(1)
		,@AllowNulls	char(1)
		,@DataType		tinyint
		,@ColumnScale	tinyint
SET NOCOUNT ON
SELECT @ColumnIndex = a.ColumnIndex, @TableId = a.TableId, @DefaultValue = a.DefaultValue, @NumericData = b.NumericData
	, @ColumnIdentity = a.ColumnIdentity, @AllowNulls = a.AllowNulls, @DataType = a.DataType, @ColumnScale = a.ColumnScale
	FROM dbo.DbColumn a INNER JOIN RODesign.dbo.CtDataType b ON a.DataType = b.DataTypeId WHERE a.ColumnId = @ColumnId
IF @DataType = 6 AND @ColumnScale is NULL
BEGIN
	RAISERROR('Please specify decimal places for Floating Point data type and try again.',18,2) WITH SETERROR
	RETURN 1
END
/* Need to reorder Tab Index */
IF NOT (@ColumnIndex is not null AND right(space(1)+convert(varchar,@ColumnIndex),1) = '0')
BEGIN
	UPDATE dbo.DbColumn SET ColumnIndex = 32757 WHERE TableId = @TableId AND ColumnIndex is null
	SELECT @ii = 1
	DECLARE cur CURSOR FOR SELECT ColumnId, ColumnIndex FROM dbo.DbColumn WHERE TableId = @TableId ORDER BY ColumnIndex FOR READ ONLY
	OPEN cur
	FETCH NEXT FROM cur INTO @ColId, @ColumnIndex
	WHILE @@FETCH_STATUS = 0
	BEGIN
		UPDATE dbo.DbColumn SET ColumnIndex = @ii WHERE ColumnId = @ColId
		IF @ii > 3275 SELECT @ii = 3276 ELSE SELECT @ii = @ii + 1
		FETCH NEXT FROM cur INTO @ColId, @ColumnIndex
	END
	CLOSE cur
	DEALLOCATE cur
	UPDATE dbo.DbColumn SET ColumnIndex = ColumnIndex * 10 WHERE TableId = @TableId
END
-- Update Default:
IF @DefaultValue is not null
BEGIN
	IF @ColumnIdentity = 'Y'
	BEGIN
		RAISERROR('Please do not assign a default value to a column that is identity and try again.',18,2) WITH SETERROR
		RETURN 1
	END
	IF @AllowNulls = 'Y'
	BEGIN
		RAISERROR('Please do not assign a default value to a column that allows null and try again.',18,2) WITH SETERROR
		RETURN 1
	END
END
RETURN 0
 
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdMenuIndex') AND type='P')
DROP PROCEDURE dbo.Ir_UpdMenuIndex
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





-- Assuming 4 levels of menu but it is alright if more levels present:
CREATE PROCEDURE [dbo].[Ir_UpdMenuIndex]
/* WITH ENCRYPTION */
AS
DECLARE	 @ii1			int
		,@ii2			int
		,@ii3			int
		,@ii4			int
		,@mid1			int
		,@mid2			int
		,@mid3			int
		,@mid4			int
SET NOCOUNT ON
SELECT @ii1 = 1
DECLARE cur1 CURSOR FOR SELECT MenuId FROM dbo.Menu WHERE ParentId is null ORDER BY MenuIndex FOR READ ONLY
OPEN cur1
FETCH NEXT FROM cur1 INTO @mid1
WHILE @@FETCH_STATUS = 0
BEGIN
	UPDATE dbo.Menu SET MenuIndex = @ii1 * 10 WHERE MenuId = @mid1
	IF @ii1 > 3274 SELECT @ii1 = 3275 ELSE SELECT @ii1 = @ii1 + 1
	-- Take care of level 2, if any:
	SELECT @ii2 = 1
	DECLARE cur2 CURSOR FOR SELECT MenuId FROM dbo.Menu WHERE ParentId = @mid1 ORDER BY MenuIndex FOR READ ONLY
	OPEN cur2
	FETCH NEXT FROM cur2 INTO @mid2
	WHILE @@FETCH_STATUS = 0
	BEGIN
		UPDATE dbo.Menu SET MenuIndex = @ii2 * 10 WHERE MenuId = @mid2
		IF @ii2 > 3274 SELECT @ii2 = 3275 ELSE SELECT @ii2 = @ii2 + 1
		-- Take care of level 3, if any:
		SELECT @ii3 = 1
		DECLARE cur3 CURSOR FOR SELECT MenuId FROM dbo.Menu WHERE ParentId = @mid2 ORDER BY MenuIndex FOR READ ONLY
		OPEN cur3
		FETCH NEXT FROM cur3 INTO @mid3
		WHILE @@FETCH_STATUS = 0
		BEGIN
			UPDATE dbo.Menu SET MenuIndex = @ii3 * 10 WHERE MenuId = @mid3
			IF @ii3 > 3274 SELECT @ii3 = 3275 ELSE SELECT @ii3 = @ii3 + 1
			-- Take care of level 4, if any:
			SELECT @ii4 = 1
			DECLARE cur4 CURSOR FOR SELECT MenuId FROM dbo.Menu WHERE ParentId = @mid3 ORDER BY MenuIndex FOR READ ONLY
			OPEN cur4
			FETCH NEXT FROM cur4 INTO @mid4
			WHILE @@FETCH_STATUS = 0
			BEGIN
				UPDATE dbo.Menu SET MenuIndex = @ii4 * 10 WHERE MenuId = @mid4
				IF @ii4 > 3274 SELECT @ii4 = 3275 ELSE SELECT @ii4 = @ii4 + 1
				FETCH NEXT FROM cur4 INTO @mid4
			END
			CLOSE cur4 DEALLOCATE cur4
			FETCH NEXT FROM cur3 INTO @mid3
		END
		CLOSE cur3 DEALLOCATE cur3
		FETCH NEXT FROM cur2 INTO @mid2
	END
	CLOSE cur2 DEALLOCATE cur2
	FETCH NEXT FROM cur1 INTO @mid1
END
CLOSE cur1 DEALLOCATE cur1
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdMsg') AND type='P')
DROP PROCEDURE dbo.Ir_UpdMsg
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdMsg]
 @MsgId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId		smallint
		,@Msg				nvarchar(800)
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT @Msg = Msg FROM dbo.MsgCenter WHERE MsgId = @MsgId AND CultureId = @DefCultureId
UPDATE dbo.Msg SET MsgName = '{' + CONVERT(varchar(10),@MsgId) + '} ' + @Msg WHERE MsgId = @MsgId
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdReactNeedRegen') AND type='P')
DROP PROCEDURE dbo.Ir_UpdReactNeedRegen
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[Ir_UpdReactNeedRegen]
 @ScreenId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF @ScreenId is not null UPDATE dbo.Screen SET NeedReactRegen = 'Y' WHERE ScreenId = @ScreenId
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdReactRule') AND type='P')
DROP PROCEDURE dbo.Ir_UpdReactRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[Ir_UpdReactRule]
 @RuleReactId		int
,@CultureId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @DefCultureId		smallint
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
UPDATE dbo.RuleReact SET RuleReactDesc = isnull(b.ScreenTitle,space(0)) + ': ' + a.RuleReactName
	FROM dbo.RuleReact a
	LEFT OUTER JOIN dbo.ScreenHlp b ON a.ScreenId = b.ScreenId
	AND b.CultureId = CASE WHEN EXISTS (SELECT 1 FROM dbo.ScreenHlp x WHERE x.ScreenId = a.ScreenId AND x.CultureId = @CultureId) THEN @CultureId ELSE @DefCultureId END
	WHERE a.RuleReactId = @RuleReactId
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdReportCriDesc') AND type='P')
DROP PROCEDURE dbo.Ir_UpdReportCriDesc
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdReportCriDesc]
 @ReportCriId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @ReportId	int
SET NOCOUNT ON
UPDATE dbo.ReportCri SET ReportCriDesc = b.ProgramName + right(space(6) + convert(varchar,a.TabIndex),6) + ': ' + a.ColumnName
	FROM dbo.ReportCri a INNER JOIN dbo.Report b ON a.ReportId = b.ReportId
	WHERE ReportCriId = @ReportCriId
RETURN 0

 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdReportCriHlp') AND type='P')
DROP PROCEDURE dbo.Ir_UpdReportCriHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdReportCriHlp]
 @ReportCriHlpId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.ReportCriHlp SET ReportCriHlpDesc = b.ReportCriDesc + ' (' + c.CultureTypeName + ')'
	FROM dbo.ReportCriHlp a
	INNER JOIN dbo.ReportCri b ON a.ReportCriId = b.ReportCriId
	INNER JOIN RODesign.dbo.VwCulture c ON a.CultureId = c.CultureId
	WHERE a.ReportCriHlpId = @ReportCriHlpId
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdReportGrpIndex') AND type='P')
DROP PROCEDURE dbo.Ir_UpdReportGrpIndex
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdReportGrpIndex]
 @ReportId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @ParentGrpId		int
	,@ReportGrpId		int
	,@TabIndex		smallint
/* Establish cuurent TabIndex */
DECLARE curs CURSOR FAST_FORWARD FOR SELECT ReportGrpId FROM dbo.ReportGrp WHERE ReportId = @ReportId FOR READ ONLY
OPEN curs
FETCH NEXT FROM curs INTO @ReportGrpId
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @TabIndex = 0
	EXEC Ir_UpdReportGrpIndex1 @ReportId, @ReportGrpId, @TabIndex OUTPUT
	UPDATE dbo.ReportGrp SET TabIndex = @TabIndex WHERE ReportGrpId = @ReportGrpId
	FETCH NEXT FROM curs INTO @ReportGrpId
END
CLOSE curs
DEALLOCATE curs
/* Find root Ids */
DECLARE curs CURSOR FAST_FORWARD FOR
	SELECT DISTINCT ParentGrpId FROM dbo.ReportGrp
	WHERE ReportId = @ReportId AND ParentGrpId IN (SELECT ReportGrpId FROM dbo.ReportGrp WHERE ParentGrpId is null)
	FOR READ ONLY
OPEN curs
FETCH NEXT FROM curs INTO @ParentGrpId
WHILE @@FETCH_STATUS = 0
BEGIN
	EXEC dbo.Ir_UpdReportGrpIndex2 @ReportId, @ParentGrpId, '0'
	FETCH NEXT FROM curs INTO @ParentGrpId
END
CLOSE curs
DEALLOCATE curs
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdReportGrpIndex1') AND type='P')
DROP PROCEDURE dbo.Ir_UpdReportGrpIndex1
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdReportGrpIndex1]
 @ReportId		int
,@ParentGrpId		int
,@TabIndex		smallint OUTPUT
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @MaxIndex	smallint
	,@ReportGrpId	int
IF @@NESTLEVEL = 16 RETURN 0
SELECT @MaxIndex = isnull(max(TabIndex),0) FROM dbo.ReportCri WHERE ReportId = @ReportId AND ReportGrpId = @ParentGrpId
DECLARE curs CURSOR LOCAL FAST_FORWARD FOR SELECT ReportGrpId FROM dbo.ReportGrp WHERE ParentGrpId = @ParentGrpId FOR READ ONLY
OPEN curs
FETCH NEXT FROM curs INTO @ReportGrpId
WHILE @@FETCH_STATUS = 0
BEGIN
	EXEC Ir_UpdReportGrpIndex1 @ReportId, @ReportGrpId, @TabIndex OUTPUT
	IF @MaxIndex > @TabIndex SELECT @TabIndex = @MaxIndex
	FETCH NEXT FROM curs INTO @ReportGrpId
END
CLOSE curs
DEALLOCATE curs
IF @MaxIndex > @TabIndex SELECT @TabIndex = @MaxIndex
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdReportGrpIndex2') AND type='P')
DROP PROCEDURE dbo.Ir_UpdReportGrpIndex2
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdReportGrpIndex2]
 @ReportId		int
,@ParentGrpId		int
,@ParentCode		varchar(50) OUTPUT
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @ii 		int
	,@ReportGrpId	int
	,@GrpIndex	varchar(50)
IF @@NESTLEVEL = 16 RETURN 0
SELECT @ii = 0
DECLARE curs CURSOR LOCAL FAST_FORWARD FOR
	SELECT ParentGrpId, ReportGrpId FROM dbo.ReportGrp WHERE ParentGrpId = @ParentGrpId AND ReportId = @ReportId
	ORDER BY TabIndex FOR READ ONLY
OPEN curs
FETCH NEXT FROM curs INTO @ParentGrpId, @ReportGrpId
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @GrpIndex = @ParentCode + '.' + convert(varchar, @ii)
	SELECT @ParentGrpId, @ReportGrpId, @GrpIndex
	UPDATE dbo.ReportGrp SET ReportGrpIndex = @GrpIndex WHERE ReportGrpId = @ReportGrpId
	EXEC Ir_UpdReportGrpIndex2 @ReportId, @ReportGrpId, @GrpIndex
	SELECT @ii = @ii + 1
	FETCH NEXT FROM curs INTO @ParentGrpId, @ReportGrpId
END
CLOSE curs
DEALLOCATE curs
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdReportObj') AND type='P')
DROP PROCEDURE dbo.Ir_UpdReportObj
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdReportObj]
 @ReportObjId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @ReportId		int
	,@ProgramName		varchar(50)
	,@TabIndex		smallint
	,@ii			int
	,@ObjId			int
SET NOCOUNT ON
SELECT @TabIndex = TabIndex, @ReportId = ReportId FROM dbo.ReportObj WHERE ReportObjId = @ReportObjId
SELECT @ProgramName = ProgramName FROM dbo.Report WHERE ReportId = @ReportId
/* Need to reorder Tab Index */
IF NOT (@TabIndex is not null AND right(space(1)+convert(varchar,@TabIndex),1) = '0')
BEGIN
	UPDATE dbo.ReportObj SET TabIndex = 32757 WHERE ReportId = @ReportId AND TabIndex is null
	SELECT @ii = 1
	DECLARE cur CURSOR FOR SELECT ReportObjId, TabIndex FROM dbo.ReportObj WHERE ReportId = @ReportId ORDER BY TabIndex FOR READ ONLY
	OPEN cur
	FETCH NEXT FROM cur INTO @ObjId, @TabIndex
	WHILE @@FETCH_STATUS = 0
	BEGIN
		UPDATE dbo.ReportObj SET TabIndex = @ii
			, ColumnDesc = @ProgramName + right(space(6) + convert(varchar,@ii * 10),6) + ': ' + ColumnName
			WHERE ReportObjId = @ObjId
		IF @ii > 3275 SELECT @ii = 3276 ELSE SELECT @ii = @ii + 1
		FETCH NEXT FROM cur INTO @ObjId, @TabIndex
	END
	CLOSE cur
	DEALLOCATE cur
	UPDATE dbo.ReportObj SET TabIndex = TabIndex * 10 WHERE ReportId = @ReportId
END
UPDATE dbo.ReportObj SET ColumnDesc = @ProgramName + right(space(6) + convert(varchar,TabIndex),6) + ': ' + ColumnName WHERE ReportObjId = @ReportObjId
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdReportObjHlp') AND type='P')
DROP PROCEDURE dbo.Ir_UpdReportObjHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdReportObjHlp]
 @ReportObjHlpId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.ReportObjHlp SET ReportObjHlpDesc = b.ColumnDesc + ' (' + c.CultureTypeName + ')'
	FROM dbo.ReportObjHlp a
	INNER JOIN dbo.ReportObj b ON a.ReportObjId = b.ReportObjId
	INNER JOIN RODesign.dbo.VwCulture c ON a.CultureId = c.CultureId
	WHERE a.ReportObjHlpId = @ReportObjHlpId
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdRptCel') AND type='P')
DROP PROCEDURE dbo.Ir_UpdRptCel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdRptCel]
 @RptCelId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.RptCel SET
	RptCelDesc = b.RptTblDesc + ' #' + right('00' + convert(varchar,a.RowNum),3) + ' ' + right('00' + convert(varchar,c.TblOrder),3) + '[' + d.RptTblTypeName + ']'
	FROM dbo.RptCel a
	INNER JOIN dbo.RptTbl b ON a.RptTblId = b.RptTblId
	INNER JOIN dbo.RptTbl c ON a.CelNum = c.RptTblId
	INNER JOIN RODesign.dbo.CtRptTblType d ON c.RptTblTypeCd = d.RptTblTypeCd
WHERE a.RptCelId = @RptCelId
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdRptCha') AND type='P')
DROP PROCEDURE dbo.Ir_UpdRptCha
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdRptCha]
 @RptChaId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.RptCha SET
	RptChaDesc = b.RptCtrDesc + ' [' + c.RptChaTypeName + ']'
	FROM dbo.RptCha a
	INNER JOIN dbo.RptCtr b ON a.RptCtrId = b.RptCtrId
	INNER JOIN RODesign.dbo.CtRptChaType c ON a.RptChaTypeCd = c.RptChaTypeCd
WHERE a.RptChaId = @RptChaId
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdRptCtr') AND type='P')
DROP PROCEDURE dbo.Ir_UpdRptCtr
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdRptCtr]
 @RptCtrId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.RptCtr SET
	RptCtrDesc = case when e.RptElmDesc is not null then e.RptElmDesc when f.RptCelDesc is not null then f.RptCelDesc else b.ReportDesc end
		+ case when d.RptCtrTypeName is null then ' ' else ' [' + d.RptCtrTypeName + '] ' + d.RptCtrName + ': ' end
		+ right('00' + convert(varchar,convert(int,isnull(a.CtrLeft,0))),3) + '[' + c.RptCtrTypeName + '] ' + a.RptCtrName
	FROM dbo.RptCtr a
	INNER JOIN dbo.Report b ON a.ReportId = b.ReportId
	INNER JOIN RODesign.dbo.CtRptCtrType c ON a.RptCtrTypeCd = c.RptCtrTypeCd
	LEFT OUTER JOIN (SELECT x.RptCtrId, y.RptCtrTypeName, x.RptCtrName FROM dbo.RptCtr x
		INNER JOIN RODesign.dbo.CtRptCtrType y ON x.RptCtrTypeCd = y.RptCtrTypeCd) d ON a.PRptCtrId = d.RptCtrId
	LEFT OUTER JOIN dbo.RptElm e ON a.RptElmId = e.RptElmId
	LEFT OUTER JOIN dbo.RptCel f ON a.RptCelId = f.RptCelId
WHERE a.RptCtrId = @RptCtrId
RETURN 0

 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdRptElm') AND type='P')
DROP PROCEDURE dbo.Ir_UpdRptElm
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdRptElm]
 @RptElmId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.RptElm SET
	RptElmDesc = b.ReportDesc + ' [' + c.RptElmTypeName + ']'
	FROM dbo.RptElm a
	INNER JOIN dbo.Report b ON a.ReportId = b.ReportId
	INNER JOIN RODesign.dbo.CtRptElmType c ON a.RptElmTypeCd = c.RptElmTypeCd
WHERE a.RptElmId = @RptElmId
RETURN 0

 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdRptNeedRegen') AND type='P')
DROP PROCEDURE dbo.Ir_UpdRptNeedRegen
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdRptNeedRegen]
 @ReportId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF @ReportId is not null
	UPDATE dbo.Report SET NeedRegen = 'Y', ReportDesc = b.ReportTitle
	FROM dbo.Report a
	INNER JOIN dbo.ReportHlp b ON a.ReportId = b.ReportId
	INNER JOIN RODesign.dbo.VwCulture c ON b.CultureId = c.CultureId
	WHERE a.ReportId = @ReportId AND c.CultureDefault = 'Y'
RETURN 0

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdRptTbl') AND type='P')
DROP PROCEDURE dbo.Ir_UpdRptTbl
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdRptTbl]
 @RptTblId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @RptCelId	int
UPDATE dbo.RptTbl SET
	RptTblDesc = case when d.RptTblDesc is null then b.RptCtrDesc + ' ' else d.RptTblDesc + ': ' end + right('00' + convert(varchar,a.TblOrder),3) + '[' + c.RptTblTypeName + ']'
	FROM dbo.RptTbl a
	INNER JOIN dbo.RptCtr b ON a.RptCtrId = b.RptCtrId
	INNER JOIN RODesign.dbo.CtRptTblType c ON a.RptTblTypeCd = c.RptTblTypeCd
	LEFT OUTER JOIN (SELECT RptTblId, RptTblDesc FROM dbo.RptTbl) d ON a.ParentId = d.RptTblId
WHERE a.RptTblId = @RptTblId
DECLARE CelCur CURSOR FOR SELECT RptCelId FROM dbo.RptCel WHERE RptTblId = @RptTblId FOR READ ONLY
OPEN CelCur
FETCH NEXT FROM CelCur INTO @RptCelId
WHILE @@FETCH_STATUS = 0
BEGIN
	EXEC Ir_UpdRptCel @RptCelId
	FETCH NEXT FROM CelCur INTO @RptCelId
END
CLOSE CelCur
DEALLOCATE CelCur
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdRptTblWiz') AND type='P')
DROP PROCEDURE dbo.Ir_UpdRptTblWiz
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdRptTblWiz]
 @ReportId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdRptwizCat') AND type='P')
DROP PROCEDURE dbo.Ir_UpdRptwizCat
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdRptwizCat]
 @RptwizCatId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.RptwizCat
	SET RptwizCatDesc = b.RptwizTypName + ': ' + a.RptwizCatName
	FROM dbo.RptwizCat a
	INNER JOIN dbo.RptwizTyp b ON a.RptwizTypId = b.RptwizTypId
	WHERE a.RptwizCatId = @RptwizCatId
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdScreenCriDesc') AND type='P')
DROP PROCEDURE dbo.Ir_UpdScreenCriDesc
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdScreenCriDesc]
 @ScreenCriId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @ScreenId		int
		,@ColumnId		int
		,@TabIndex		int
		,@ProgramName	varchar(50)
		,@ColumnHeader	nvarchar(50)
		,@ii			int
		,@CriId			int
SET NOCOUNT ON
SELECT @ScreenId = ScreenId, @ColumnId = ColumnId FROM dbo.ScreenCri WHERE ScreenCriId = @ScreenCriId
/* Need to reorder Tab Index */
UPDATE dbo.ScreenCri SET TabIndex = 32757 WHERE ScreenId = @ScreenId AND TabIndex is null
SELECT @ii = 1
DECLARE cur CURSOR FOR SELECT a.ScreenCriId, a.TabIndex, b.ProgramName, c.ColumnHeader
	FROM dbo.ScreenCri a
		INNER JOIN dbo.Screen b ON a.ScreenId = b.ScreenId
		INNER JOIN dbo.ScreenCriHlp c ON a.ScreenCriId = c.ScreenCriId
		INNER JOIN RODesign.dbo.VwCulture d ON c.CultureId = d.CultureId AND d.CultureDefault = 'Y'
	WHERE a.ScreenId = @ScreenId ORDER BY a.TabIndex
FOR READ ONLY
OPEN cur
FETCH NEXT FROM cur INTO @CriId, @TabIndex, @ProgramName, @ColumnHeader
WHILE @@FETCH_STATUS = 0
BEGIN
	/* Update Tab Index and hidden description column */
	UPDATE dbo.ScreenCri SET TabIndex = @ii
		, ScreenCriDesc = @ProgramName + right(space(6) + convert(varchar(10),@ii*10),6) + ': ' + isnull(@ColumnHeader,'')
		WHERE ScreenCriId = @CriId
	SELECT @ii = @ii + 1	/* Cannot do 10 increment here to bypass a overflow problem */
	FETCH NEXT FROM cur INTO @CriId, @TabIndex, @ProgramName, @ColumnHeader
END
CLOSE cur
DEALLOCATE cur
UPDATE dbo.ScreenCri SET TabIndex = TabIndex * 10 WHERE ScreenId = @ScreenId
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdScreenCriHlp') AND type='P')
DROP PROCEDURE dbo.Ir_UpdScreenCriHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdScreenCriHlp]
 @ScreenCriHlpId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.ScreenCriHlp SET ScreenCriHlpDesc = b.ScreenCriDesc + ' (' + c.CultureTypeName + ')'
	FROM dbo.ScreenCriHlp a
	INNER JOIN dbo.ScreenCri b ON a.ScreenCriId = b.ScreenCriId
	INNER JOIN RODesign.dbo.VwCulture c ON a.CultureId = c.CultureId
	WHERE a.ScreenCriHlpId = @ScreenCriHlpId
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdScreenFilterDesc') AND type='P')
DROP PROCEDURE dbo.Ir_UpdScreenFilterDesc
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO








CREATE PROCEDURE [dbo].[Ir_UpdScreenFilterDesc]
 @ScreenId			int
,@ScreenFilterId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.ScreenFilter
	SET ScreenFilterDesc = b.ProgramName + ' ' + RIGHT('00'+convert(varchar,FilterOrder),3) + ' ' + a.ScreenFilterName
	FROM dbo.ScreenFilter a INNER JOIN dbo.Screen b ON a.ScreenId = b.ScreenId
	WHERE a.ScreenFilterId = @ScreenFilterId
UPDATE dbo.Screen SET ScreenFilter = 'AdmScreenFilter.aspx?id=181&key=' + convert(varchar,@ScreenFilterId)
	WHERE ScreenId = @screenId
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdScreenObj') AND type='P')
DROP PROCEDURE dbo.Ir_UpdScreenObj
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdScreenObj]
 @ScreenObjId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @ColumnId			int
	,@DdlKeyColumnId	int
	,@TableId			int
	,@TableName			nvarchar(500)
	,@RefTableId		int
	,@RefTableName		nvarchar(500)
	,@DisplayName		varchar(50)
SET NOCOUNT ON
SELECT @ColumnId = a.ColumnId, @DdlKeyColumnId = a.DdlKeyColumnId, @DisplayName = d.TypeName
	FROM dbo.ScreenObj a INNER JOIN RODesign.dbo.CtDisplayType d ON a.DisplayModeId = d.TypeId
	WHERE a.ScreenObjId = @ScreenObjId
UPDATE dbo.ScreenObj SET ColumnName = replace(a.ColumnName,space(1),space(0))
	, ColumnDesc = b.ProgramName + ' [' + right(space(5) + convert(varchar,TabIndex),5) + '] ' + d.TabFolderName + ': ' + replace(a.ColumnName,space(1),space(0))
	,RequiredValid = CASE WHEN c.ColumnIdentity IS NOT NULL AND c.ColumnIdentity = 'Y' THEN 'N' ELSE a.RequiredValid END
	FROM dbo.ScreenObj a
	INNER JOIN dbo.Screen b ON a.ScreenId = b.ScreenId
	INNER JOIN dbo.ScreenTab d ON a.TabFolderId = d.ScreenTabId
	LEFT OUTER JOIN dbo.DbColumn c ON a.ColumnId = c.ColumnId
	WHERE ScreenObjId = @ScreenObjId

/* Make sure the foreign key is there for auto-regeneration */
IF @ColumnId is not null AND @DdlKeyColumnId is not null AND @DisplayName <> 'HyperLink'
	AND NOT EXISTS (SELECT 1 FROM dbo.DbKey WHERE ColumnId = @ColumnId AND RefColumnId = @DdlKeyColumnId)
BEGIN
	SELECT @TableId = a.TableId, @TableName = b.TableName
		FROM dbo.DbColumn a INNER JOIN dbo.DbTable b ON a.TableId = b.TableId WHERE a.ColumnId = @ColumnId
	SELECT @RefTableId = a.TableId, @RefTableName = b.TableName
		FROM dbo.DbColumn a INNER JOIN dbo.DbTable b ON a.TableId = b.TableId WHERE a.ColumnId = @DdlKeyColumnId
	IF NOT EXISTS (SELECT 1 FROM dbo.DbKey WHERE KeyName = 'FK_' + @TableName + '_' + @RefTableName)
		INSERT dbo.DbKey (KeyName, TableId, ColumnId, RefTableId, RefColumnId)
		SELECT 'FK_' + @TableName + '_' + @RefTableName, @TableId, @ColumnId, @RefTableId, @DdlKeyColumnId
END
/* make sure screenobjhlp is revised and validated */
DECLARE @ScreenObjHlpId int, @ret int
DECLARE run_cursor CURSOR 
READ_ONLY FORWARD_ONLY STATIC 
FOR 
SELECT ScreenObjHlpId
FROM ScreenObjHlp h 
WHERE ScreenObjId = @ScreenObjId

OPEN run_cursor
FETCH NEXT FROM run_cursor INTO @ScreenObjHlpId
WHILE @@FETCH_STATUS = 0 
BEGIN
	EXEC @ret = dbo.Ir_UpdScreenObjHlp @ScreenObjHlpId, 'Y'
	IF @ret <> 0
	BEGIN
		RAISERROR('Error update Screen Obj Help.',18,2) WITH SETERROR
		RETURN 1
	END
	FETCH NEXT FROM run_cursor INTO @ScreenObjHlpId
END
CLOSE run_cursor
DEALLOCATE run_cursor
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdScreenObjHlp') AND type='P')
DROP PROCEDURE dbo.Ir_UpdScreenObjHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdScreenObjHlp]
 @ScreenObjHlpId	int
,@FromScreenObj		char(1)='N'
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
/* test for mandatory settings */

DECLARE @DisplayName varchar(50), @RequiredValid char(1), @MaskValid varchar(50), @RangeValidType varchar(50), @ErrMessage nvarchar(200)
SELECT @DisplayName = t.TypeName, @RequiredValid = s.RequiredValid, @MaskValid = MaskValid, @RangeValidType = RangeValidType, @ErrMessage = h.ErrMessage
FROM dbo.ScreenObjHlp h
INNER JOIN dbo.ScreenObj s on s.ScreenObjId = h.ScreenObjId
INNER JOIN RODesign.dbo.CtDisplayType t on t.TypeId = s.DisplayModeId
WHERE h.ScreenObjHlpId = @ScreenObjHlpId

IF @FromScreenObj = 'N'
BEGIN
	IF @DisplayName in ('TextBox','Editor','Calendar','DropDownList','ComboBox','ListBox','RadioButtonList')
	BEGIN
		IF @RequiredValid = 'Y' AND LTRIM(RTRIM(ISNULL(@ErrMessage,'')))=''
		BEGIN
			RAISERROR('Please specify an error message for this mandatory %s column and try again.',18,2,@DisplayName) WITH SETERROR
			RETURN 1
		END
	END
	ELSE
	BEGIN
		IF LTRIM(RTRIM(ISNULL(@ErrMessage,''))) <> ''
		BEGIN
			RAISERROR('Please do not specify any error message for this %s column and try again.',18,2,@DisplayName) WITH SETERROR
			RETURN 1
		END
	END
	IF (@MaskValid is not null or @RangeValidType is not null) AND LTRIM(RTRIM(ISNULL(@ErrMessage,'')))=''
	BEGIN
		RAISERROR('Please specify an error message for this %s column which has a mask and try again.',18,2,@DisplayName) WITH SETERROR
		RETURN 1
	END
END

UPDATE dbo.ScreenObjHlp SET ScreenObjHlpDesc = b.ColumnDesc + ' (' + c.CultureTypeName + ')'
	FROM dbo.ScreenObjHlp a
	INNER JOIN dbo.ScreenObj b ON a.ScreenObjId = b.ScreenObjId
	INNER JOIN RODesign.dbo.VwCulture c ON a.CultureId = c.CultureId
	WHERE a.ScreenObjHlpId = @ScreenObjHlpId

/* Populate column objective in Data Table & Column one time if empty */
UPDATE c SET ColObjective = convert(nvarchar(200),h.ToolTip) 
	FROM dbo.ScreenObjHlp h
	INNER JOIN dbo.ScreenObj o on h.ScreenObjId = o.ScreenObjId
	INNER JOIN dbo.DbColumn c on c.ColumnId = o.ColumnId
	WHERE h.ScreenObjHlpId = @ScreenObjHlpId AND c.ColObjective IS NULL AND h.ToolTip IS NOT NULL
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdScreenObjInd') AND type='P')
DROP PROCEDURE dbo.Ir_UpdScreenObjInd
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdScreenObjInd]
 @ScreenId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @ii				int
		,@ObjId				int
SET NOCOUNT ON
/* Need to reorder Tab Index */
--UPDATE dbo.ScreenObj SET TabIndex = 32757 WHERE ScreenId = @ScreenId AND TabIndex is null
SELECT @ii = 1
DECLARE cur CURSOR FOR
	SELECT a.ScreenObjId FROM dbo.ScreenObj a INNER JOIN dbo.ScreenTab b ON a.TabFolderId = b.ScreenTabId
	WHERE a.ScreenId = @ScreenId
	ORDER BY a.MasterTable DESC, b.TabFolderOrder, a.TabIndex
	FOR READ ONLY
OPEN cur
FETCH NEXT FROM cur INTO @ObjId
WHILE @@FETCH_STATUS = 0
BEGIN
	UPDATE dbo.ScreenObj SET TabIndex = @ii * 10 WHERE ScreenObjId = @ObjId
	EXEC dbo.Ir_UpdScreenObj @ObjId
	IF @ii > 3274 SELECT @ii = 3275 ELSE SELECT @ii = @ii + 1
	FETCH NEXT FROM cur INTO @ObjId
END
CLOSE cur
DEALLOCATE cur
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdScreenTab') AND type='P')
DROP PROCEDURE dbo.Ir_UpdScreenTab
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdScreenTab]
 @ScreenTabId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @ScreenId			int
		,@ScreenDesc		nvarchar(50)
		,@ii				int
		,@TabId				int
SELECT @ScreenId = ScreenId FROM dbo.ScreenTab WHERE ScreenTabId = @ScreenTabId
SELECT @ScreenDesc = ScreenDesc FROM dbo.Screen WHERE ScreenId = @ScreenId

/* Need to reorder Tab folder order */
SELECT @ii = 1
DECLARE cur CURSOR FOR SELECT ScreenTabId FROM dbo.ScreenTab WHERE ScreenId = @ScreenId ORDER BY TabFolderOrder FOR READ ONLY
OPEN cur
FETCH NEXT FROM cur INTO @TabId
WHILE @@FETCH_STATUS = 0
BEGIN
	UPDATE dbo.ScreenTab SET TabFolderOrder = @ii * 10
		, ScreenTabDesc = @ScreenDesc + ' [' + right(space(3) + convert(varchar,@ii * 10),3) + '] ' + TabFolderName
		WHERE ScreenTabId = @TabId
	IF @ii > 24 SELECT @ii = 25 ELSE SELECT @ii = @ii + 1
	FETCH NEXT FROM cur INTO @TabId
END
CLOSE cur
DEALLOCATE cur
RETURN 0  

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdScrNeedRegen') AND type='P')
DROP PROCEDURE dbo.Ir_UpdScrNeedRegen
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdScrNeedRegen]
 @ScreenId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF @ScreenId is not null UPDATE dbo.Screen SET NeedRegen = 'Y' WHERE ScreenId = @ScreenId
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdServerRule') AND type='P')
DROP PROCEDURE dbo.Ir_UpdServerRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[Ir_UpdServerRule]
 @ScreenId		int
,@CultureId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @ROrder		int
		,@ServerRuleId	int
		,@DefCultureId	smallint
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
/* Need to reorder Tab Index */
IF object_id('tempdb.dbo.#rule') is not null DROP TABLE dbo.#rule
CREATE TABLE dbo.#rule (ROrder int IDENTITY(1,1) not null, ServerRuleId int not null)
INSERT dbo.#rule (ServerRuleId) SELECT a.ServerRuleId
	FROM dbo.ServerRule a INNER JOIN RODesign.dbo.CtCrudType b ON a.BeforeCRUD = b.CrudTypeCd
	WHERE a.ScreenId = @ScreenId AND a.BeforeCRUD <> 'C'
	ORDER BY b.CrudTypeSort, a.MasterTable DESC, a.RuleOrder
/* Insert last rule */
INSERT dbo.#rule (ServerRuleId) SELECT a.ServerRuleId
	FROM dbo.ServerRule a INNER JOIN RODesign.dbo.CtCrudType b ON a.BeforeCRUD = b.CrudTypeCd
	WHERE a.ScreenId = @ScreenId AND a.BeforeCRUD = 'C'
DECLARE cur CURSOR FOR
	SELECT ROrder, ServerRuleId FROM dbo.#rule ORDER BY ROrder FOR READ ONLY
OPEN cur
FETCH NEXT FROM cur INTO @ROrder, @ServerRuleId
WHILE @@FETCH_STATUS = 0
BEGIN
	UPDATE dbo.ServerRule SET RuleOrder = @ROrder * 10
		, RuleDesc = isnull(b.ScreenTitle,space(0)) + right(space(5)+convert(varchar,@ROrder * 10),5)
		+ ' [' + CASE WHEN a.MasterTable = 'Y' THEN 'Master' ELSE 'Detail' END
		+ ': ' + CASE WHEN a.BeforeCRUD = 'Y' THEN 'Before CRUD' WHEN a.BeforeCRUD = 'S' THEN 'Skip CRUD' WHEN a.BeforeCRUD = 'N' THEN 'After CRUD' ELSE 'Last Rule' END
		+ '] ' + a.RuleName
		FROM dbo.ServerRule a
		INNER JOIN dbo.ScreenHlp b ON a.ScreenId = b.ScreenId
		AND b.CultureId = CASE WHEN EXISTS (SELECT 1 FROM dbo.ScreenHlp x WHERE x.ScreenId = a.ScreenId AND x.CultureId = @CultureId) THEN @CultureId ELSE @DefCultureId END
		WHERE a.ServerRuleId = @ServerRuleId
	IF @ROrder > 3274
	BEGIN
		CLOSE cur DEALLOCATE cur DROP TABLE dbo.#rule
		RAISERROR('There is no way we can have that many server rules; please contact the administrator ASAP.',18,2) WITH SETERROR
		RETURN 1
	END
	FETCH NEXT FROM cur INTO @ROrder, @ServerRuleId
END
CLOSE cur DEALLOCATE cur
DROP TABLE dbo.#rule
RETURN 0
 



 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdStaticPgNm') AND type='P')
DROP PROCEDURE dbo.Ir_UpdStaticPgNm
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdStaticPgNm]
 @StaticPgId	int
,@StaticPgNm	varchar(50)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @OStaticPgNm	varchar(50)
SELECT @OStaticPgNm = StaticPgNm FROM dbo.StaticPg WHERE StaticPgId = @StaticPgId
UPDATE dbo.Label SET LabelCat = @StaticPgNm
	,LabelDesc = @StaticPgNm + ': ' + ISNULL(RIGHT('000'+CONVERT(varchar,SortOrder),4)+' ','') + LabelKey + ' (' + b.CultureTypeName + ')'
	FROM dbo.Label a
	INNER JOIN RODesign.dbo.VwCulture b ON a.CultureId = b.CultureId
	WHERE LabelCat = @OStaticPgNm
RETURN 0 



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdUtRptCel') AND type='P')
DROP PROCEDURE dbo.Ir_UpdUtRptCel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdUtRptCel]
 @RptCelId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.UtRptCel SET
	RptCelDesc = b.RptTblDesc + ' #' + right('00' + convert(varchar,a.RowNum),3) + ' ' + right('00' + convert(varchar,c.TblOrder),3) + '[' + d.RptTblTypeName + ']'
	FROM dbo.UtRptCel a
	INNER JOIN dbo.UtRptTbl b ON a.RptTblId = b.RptTblId
	INNER JOIN dbo.UtRptTbl c ON a.CelNum = c.RptTblId
	INNER JOIN RODesign.dbo.CtRptTblType d ON c.RptTblTypeCd = d.RptTblTypeCd
WHERE a.RptCelId = @RptCelId
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdUtRptCha') AND type='P')
DROP PROCEDURE dbo.Ir_UpdUtRptCha
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdUtRptCha]
 @RptChaId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.UtRptCha SET
	RptChaDesc = b.RptCtrDesc + ' [' + c.RptChaTypeName + ']'
	FROM dbo.UtRptCha a
	INNER JOIN dbo.UtRptCtr b ON a.RptCtrId = b.RptCtrId
	INNER JOIN RODesign.dbo.CtRptChaType c ON a.RptChaTypeCd = c.RptChaTypeCd
WHERE a.RptChaId = @RptChaId
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdUtRptCtr') AND type='P')
DROP PROCEDURE dbo.Ir_UpdUtRptCtr
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdUtRptCtr]
 @RptCtrId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.UtRptCtr SET
	RptCtrDesc = case when e.RptElmDesc is not null then e.RptElmDesc when f.RptCelDesc is not null then f.RptCelDesc else b.ReportDesc end
		+ case when d.RptCtrTypeName is null then ' ' else ' [' + d.RptCtrTypeName + '] ' + d.RptCtrName + ': ' end
		+ right('00' + convert(varchar,convert(int,isnull(a.CtrLeft,0))),3) + '[' + c.RptCtrTypeName + '] ' + a.RptCtrName
	FROM dbo.UtRptCtr a
	INNER JOIN dbo.UtReport b ON a.ReportId = b.ReportId
	INNER JOIN RODesign.dbo.CtRptCtrType c ON a.RptCtrTypeCd = c.RptCtrTypeCd
	LEFT OUTER JOIN (SELECT x.RptCtrId, y.RptCtrTypeName, x.RptCtrName FROM dbo.UtRptCtr x
		INNER JOIN RODesign.dbo.CtRptCtrType y ON x.RptCtrTypeCd = y.RptCtrTypeCd) d ON a.PRptCtrId = d.RptCtrId
	LEFT OUTER JOIN dbo.UtRptElm e ON a.RptElmId = e.RptElmId
	LEFT OUTER JOIN dbo.UtRptCel f ON a.RptCelId = f.RptCelId
WHERE a.RptCtrId = @RptCtrId
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdUtRptTbl') AND type='P')
DROP PROCEDURE dbo.Ir_UpdUtRptTbl
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdUtRptTbl]
 @RptTblId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.UtRptTbl SET
	RptTblDesc = case when d.RptTblDesc is null then b.RptCtrDesc + ' ' else d.RptTblDesc + ': ' end + right('00' + convert(varchar,a.TblOrder),3) + '[' + c.RptTblTypeName + ']'
	FROM dbo.UtRptTbl a
	INNER JOIN dbo.UtRptCtr b ON a.RptCtrId = b.RptCtrId
	INNER JOIN RODesign.dbo.CtRptTblType c ON a.RptTblTypeCd = c.RptTblTypeCd
	LEFT OUTER JOIN (SELECT RptTblId, RptTblDesc FROM dbo.UtRptTbl) d ON a.ParentId = d.RptTblId
WHERE a.RptTblId = @RptTblId
UPDATE dbo.UtRptCel SET
	RptCelDesc = b.RptTblDesc + ' #' + right('00' + convert(varchar,a.RowNum),3) + ' ' + right('00' + convert(varchar,c.TblOrder),3) + '[' + d.RptTblTypeName + ']'
	FROM dbo.UtRptCel a
	INNER JOIN dbo.UtRptTbl b ON a.RptTblId = b.RptTblId
	INNER JOIN dbo.UtRptTbl c ON a.CelNum = c.RptTblId
	INNER JOIN RODesign.dbo.CtRptTblType d ON c.RptTblTypeCd = d.RptTblTypeCd
WHERE a.RptTblId = @RptTblId
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdWebRule') AND type='P')
DROP PROCEDURE dbo.Ir_UpdWebRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[Ir_UpdWebRule]
 @WebRuleId		int
,@CultureId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @DefCultureId		smallint
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
UPDATE dbo.WebRule SET RuleDesc = isnull(b.ScreenTitle,space(0)) + ': ' + a.RuleName
	FROM dbo.WebRule a
	LEFT OUTER JOIN dbo.ScreenHlp b ON a.ScreenId = b.ScreenId
	AND b.CultureId = CASE WHEN EXISTS (SELECT 1 FROM dbo.ScreenHlp x WHERE x.ScreenId = a.ScreenId AND x.CultureId = @CultureId) THEN @CultureId ELSE @DefCultureId END
	WHERE a.WebRuleId = @WebRuleId
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdWizardObjColumnDesc') AND type='P')
DROP PROCEDURE dbo.Ir_UpdWizardObjColumnDesc
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[Ir_UpdWizardObjColumnDesc]
 @WizardObjId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.WizardObj SET ColumnDesc = b.ProgramName + right(space(6) + convert(varchar,a.TabIndex),6) + ': ' + c.ColumnName
	FROM dbo.WizardObj a INNER JOIN dbo.Wizard b ON a.WizardId = b.WizardId INNER JOIN dbo.DbColumn c ON a.ColumnId = c.ColumnId
	WHERE a.WizardObjId = @WizardObjId
RETURN 0

 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdWizardRule') AND type='P')
DROP PROCEDURE dbo.Ir_UpdWizardRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdWizardRule]
 @WizardId		int
,@WizardRuleId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @ii		int
	,@RuleId	int
	,@RuleOrder	smallint
SET NOCOUNT ON
SELECT @RuleOrder = RuleOrder FROM dbo.WizardRule WHERE WizardRuleId = @WizardRuleId
/* Need to reorder Tab Index */
IF NOT (@RuleOrder is not null AND right(space(1)+convert(varchar,@RuleOrder),1) = '0')
BEGIN
	UPDATE dbo.WizardRule SET RuleOrder = 32757 WHERE WizardId = @WizardId AND RuleOrder is null
	SELECT @ii = 1
	DECLARE cur CURSOR FOR SELECT WizardRuleId, RuleOrder FROM dbo.WizardRule WHERE WizardId = @WizardId ORDER BY RuleOrder FOR READ ONLY
	OPEN cur
	FETCH NEXT FROM cur INTO @RuleId, @RuleOrder
	WHILE @@FETCH_STATUS = 0
	BEGIN
		UPDATE dbo.WizardRule SET RuleOrder = @ii
			, RuleDesc = isnull(b.WizardTitle,space(0)) + right(space(5)+convert(varchar,@ii * 10),5) + ': ' + a.RuleName
			FROM dbo.WizardRule a INNER JOIN dbo.Wizard b ON a.WizardId = b.WizardId
			WHERE WizardRuleId = @RuleId
		IF @ii > 3275 SELECT @ii = 3276 ELSE SELECT @ii = @ii + 1
		FETCH NEXT FROM cur INTO @RuleId, @RuleOrder
	END
	CLOSE cur
	DEALLOCATE cur
	UPDATE dbo.WizardRule SET RuleOrder = RuleOrder * 10 WHERE WizardId = @WizardId
END
UPDATE dbo.WizardRule SET RuleDesc = isnull(b.WizardTitle,space(0)) + right(space(5)+convert(varchar,a.RuleOrder),5) + ': ' + a.RuleName
	FROM dbo.WizardRule a INNER JOIN dbo.Wizard b ON a.WizardId = b.WizardId
	WHERE a.WizardRuleId = @WizardRuleId
RETURN 0

 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.Ir_UpdWizNeedRegen') AND type='P')
DROP PROCEDURE dbo.Ir_UpdWizNeedRegen
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[Ir_UpdWizNeedRegen]
 @WizardId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.Wizard SET NeedRegen = 'Y' WHERE WizardId = @WizardId
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.IsRegenNeeded') AND type='P')
DROP PROCEDURE dbo.IsRegenNeeded
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[IsRegenNeeded]
 @ProgramName	varchar(50)
,@ScreenId		int
,@ReportId		int
,@WizardId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF @ScreenId is not null AND @ScreenId <> 0
BEGIN
	IF EXISTS (SELECT 1 FROM dbo.Screen
		WHERE ScreenId = @ScreenId AND (GenerateSc = 'Y' OR GenerateSr = 'Y')
		AND (NeedRegen = 'Y' OR (@ProgramName is not null AND ProgramName <> @ProgramName)))
	SELECT 1 ELSE SELECT 0
END
ELSE IF @ReportId is not null AND @ReportId <> 0
BEGIN
	IF EXISTS (SELECT 1 FROM dbo.Report
		WHERE ReportId = @ReportId AND GenerateRp = 'Y'
		AND (NeedRegen = 'Y' OR (@ProgramName is not null AND ProgramName <> @ProgramName)))
	SELECT 1 ELSE SELECT 0
END
ELSE IF @WizardId is not null AND @WizardId <> 0
BEGIN
	IF EXISTS (SELECT 1 FROM dbo.Wizard
		WHERE WizardId = @WizardId
		AND (NeedRegen = 'Y' OR (@ProgramName is not null AND ProgramName <> @ProgramName)))
	SELECT 1 ELSE SELECT 0
END
ELSE IF EXISTS (SELECT 1 FROM dbo.CtSection WHERE LOWER(SectionName) = LOWER(@ProgramName) AND (NeedRegen = 'Y'))
	SELECT 1 ELSE SELECT 0
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.LogDelete') AND type='P')
DROP PROCEDURE dbo.LogDelete
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[LogDelete]
 @UsrId			int
,@ExecDb		varchar(50)
,@DesDatabase	varchar(50)
,@DbName		varchar(50)
,@TableName		varchar(500)
,@Where			varchar(4000)
,@Pkey			varchar(50)
,@PkeyVarName	varchar(50)
,@PkeyVar		varchar(50)
,@numericKey	varchar(1)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF ISNULL(@DbName,'')='' SELECT @DbName = @ExecDb
DECLARE @sql varchar(max)
SELECT @sql =
'DECLARE @dcontent nvarchar(max)' + 
'SELECT @dcontent= COALESCE(@dcontent + ''''+''''''''|''''''''+'''', '''''''') + ''''ISNULL(CONVERT(nvarchar,'''' + COLUMN_NAME + '''',127),space(0))''''
FROM (SELECT TOP 10000 COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS 
WHERE TABLE_NAME=''''' + REPLACE(REPLACE(@TableName,@DbName+'.dbo.',''),'dbo.','') + ''''' 
and DATA_TYPE NOT IN (''''varbinary'''',''''binary'''')
ORDER BY ORDINAL_POSITION) c'
+ ' '
+ ' EXEC('''''
+ 'DECLARE ' + @PkeyVarName + ' SELECT ' + @PkeyVar + ' = ' + CASE WHEN @numericKey='Y' THEN SPACE(0) ELSE '''''''''' END  + REPLACE(@Pkey,'''','''''''''') + CASE WHEN @numericKey='Y' THEN SPACE(0) ELSE '''''''''' END + ' INSERT INTO ' + @DesDatabase + '.dbo.Deleted '
+ 'SELECT ' + '''''''''' + @DbName + '''''''''' + ',' + '''''''''' + REPLACE(REPLACE(@TableName,@DbName+'.dbo.',''),'dbo.','') + '''''''''' + ',' + 'CONVERT(nvarchar,'+ @PkeyVar + '),' + 'dcontent=''''+@dcontent+''''' + 
+ ',' + CONVERT(nvarchar,@UsrId) + ',GETUTCDATE()'
+ ' FROM ' + @TableName
+ ' ' + REPLACE(@Where,'''''''','''''''''''')
+ ''''')'
EXEC (@DbName + '.dbo.MkStoredProcedure ''' + @sql + '''')
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.LogUsage') AND type='P')
DROP PROCEDURE dbo.LogUsage
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[LogUsage]
 @UsrId		int
,@UsageNote	nvarchar(200)
,@EntityTitle	nvarchar(50)
,@ScreenId	int
,@ReportId	int
,@WizardId	int
,@Miscellaneous	varchar(100)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF @ScreenId = 0 SELECT @ScreenId = null
IF @ReportId = 0 SELECT @ReportId = null
IF @WizardId = 0 SELECT @WizardId = null
INSERT dbo.Usage (UsageDt, UsrId, UsageNote, EntityTitle, ScreenId, ReportId, WizardId, Miscellaneous)
	SELECT getutcdate(), @UsrId, @UsageNote, @EntityTitle, @ScreenId, @ReportId, @WizardId, @Miscellaneous
RETURN 0




 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.MkGetScreenIn') AND type='P')
DROP PROCEDURE dbo.MkGetScreenIn
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[MkGetScreenIn]
 @screenId		int
,@screenCriId		int
,@procedureName		varchar(200)
,@appDatabase		varchar(50)
,@sysDatabase		varchar(50)
,@multiDesignDb		char(1)
/* WITH ENCRYPTION */
AS
DECLARE	 	 @procedureSql1		varchar(max)
		,@procedureSql2		varchar(max)
		,@procedureSql3		varchar(max)
		,@dropProcedureSql	varchar(max)
		,@select1Clause		varchar(max)
		,@select2Clause		varchar(max)
		,@fromClause		varchar(max)
		,@ifClause			varchar(max)
		,@whereClause		varchar(max)
		,@allClause			varchar(max)
		,@selfClause		varchar(max)
		,@orderClause		varchar(max)
		,@parameterName		varchar(50)
		,@paramColumnName	varchar(50)
		,@paramColumnPKey	char(1)
		,@paramAllowNulls	char(1)
		,@parameter1Names	varchar(1000)
		,@parameter1Types	varchar(1000)
		,@parameter1SByte	varchar(1000)
		,@calling1Params	varchar(1000)
		,@param1Sql			varchar(4000)
		,@declare1Sql		varchar(4000)
		,@tableId			int
		,@columnName		varchar(50)
		,@displayName		varchar(50)
		,@displayMode		varchar(50)
		,@ddlKeyTableId		int
		,@ddlKeyTableAbbr	varchar(10)
		,@ddlKeyTableName	varchar(500)
		,@ddlKeyDbName		varchar(50)
		,@ddlRefTableAbbr	varchar(10)
		,@ddlRefTableName	varchar(500)
		,@ddlKeyColumnName	varchar(50)
		,@ddlRefColumnName	varchar(50)
		,@ddlSrtColumnName	varchar(50)
		,@mainTableAbbr		varchar(10)
		,@mainTable			varchar(50)
		,@joinColumn1		varchar(50)
		,@joinColumn2		varchar(50)
		,@pKey				varchar(50)
		,@ddlFtrColumnName	varchar(50)
SET NOCOUNT ON
SELECT @pKey = b.ColumnName FROM dbo.ScreenObj a INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
	WHERE a.ScreenId = @screenId AND a.MasterTable = 'Y' AND b.PrimaryKey = 'Y'
IF @@ROWCOUNT <> 1 BEGIN RAISERROR('Primary key not present in master table.',18,2,@procedureName) WITH SETERROR RETURN 1 END
SELECT @parameter1Names='', @parameter1Types='', @parameter1SByte='', @calling1Params='', @param1Sql='', @declare1Sql='', @select1Clause=''
, @select2Clause='', @fromClause='', @ifClause='', @allClause='', @selfClause=''
DECLARE objCursor CURSOR FOR
	SELECT   f.TableId
		,f.ColumnName
		,g.TypeName
		,g.TypeDesc
		,c.TableId
		,'a' + convert(varchar,c.TableId)
		,CASE WHEN c.MultiDesignDb='N' THEN s1.dbAppDatabase+'.dbo.'+c.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+c.TableName ELSE 'dbo.'+c.TableName END
		,b.ColumnName
		,'a' + convert(varchar,e.TableId)
		,CASE WHEN e.MultiDesignDb='N' THEN s2.dbAppDatabase+'.dbo.'+e.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+e.TableName ELSE 'dbo.'+e.TableName END
		,d.ColumnName
		,k.ColumnName
		,s1.dbAppDatabase
		,DdlFtrColumnName=rf.ColumnName -- filter column
	FROM dbo.ScreenCri a
		INNER JOIN dbo.DbColumn f ON a.ColumnId = f.ColumnId INNER JOIN RODesign.dbo.CtDisplayType g ON a.DisplayModeId = g.TypeId
		INNER JOIN dbo.DbColumn b ON a.DdlKeyColumnId = b.ColumnId INNER JOIN dbo.DbTable c ON b.TableId = c.TableId INNER JOIN RODesign.dbo.Systems s1 ON c.SystemId = s1.SystemId
		INNER JOIN dbo.DbColumn d ON a.DdlRefColumnId = d.ColumnId INNER JOIN dbo.DbTable e ON d.TableId = e.TableId INNER JOIN RODesign.dbo.Systems s2 ON e.SystemId = s2.SystemId
		LEFT OUTER JOIN dbo.DbColumn k ON a.DdlSrtColumnId = k.ColumnId
		LEFT OUTER JOIN dbo.ScreenCri r on r.ScreenCriId = a.DdlFtrColumnId
		LEFT OUTER JOIN dbo.DbColumn rc on rc.ColumnId = r.ColumnId
		LEFT OUTER JOIN dbo.DbColumn rf on rf.TableId = b.TableId AND rf.ColumnName = rc.ColumnName
	WHERE a.ScreenCriId = @ScreenCriId ORDER BY a.TabIndex
FOR READ ONLY
OPEN objCursor
FETCH NEXT FROM objCursor INTO @tableId, @columnName, @displayName, @displayMode, @ddlKeyTableId, @ddlKeyTableAbbr, @ddlKeyTableName, @ddlKeyColumnName
	, @ddlRefTableAbbr, @ddlRefTableName, @ddlRefColumnName, @ddlSrtColumnName, @ddlKeyDbName, @ddlFtrColumnName
WHILE @@FETCH_STATUS = 0
BEGIN
	IF @tableId is NOT NULL
	BEGIN
		IF CHARINDEX(@ddlKeyTableAbbr,@fromClause) = 0
		BEGIN
			EXEC dbo.GetScreenLisParm @screenId, null, @ddlKeyTableId, @ddlKeyTableAbbr, '', @sysDatabase, 'RODesign', '', @allClause OUTPUT, @selfClause OUTPUT, @parameter1Names OUTPUT, @parameter1Types OUTPUT, @parameter1SByte OUTPUT, @calling1Params OUTPUT, @param1Sql OUTPUT, @declare1Sql OUTPUT
			IF @fromClause = ''
				SELECT @mainTable = @ddlKeyTableName, @mainTableAbbr = @ddlKeyTableAbbr, @fromClause = @ddlKeyTableName + ' ' + @ddlKeyTableAbbr
					, @ifClause = 'EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name=''''' + @ddlKeyDbName + ''''')'
			ELSE
			BEGIN
				SELECT @joinColumn1=d.ColumnName, @joinColumn2=e.ColumnName
				FROM dbo.DbKey a
					INNER JOIN dbo.DbTable b ON a.TableId = b.TableId INNER JOIN RODesign.dbo.Systems s1 ON b.SystemId = s1.SystemId
					AND CASE WHEN b.MultiDesignDb='N' THEN s1.dbAppDatabase+'.dbo.'+b.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+b.TableName ELSE 'dbo.'+b.TableName END = @mainTable
					INNER JOIN dbo.DbTable c ON a.RefTableId = c.TableId INNER JOIN RODesign.dbo.Systems s2 ON c.SystemId = s2.SystemId
					AND CASE WHEN c.MultiDesignDb='N' THEN s2.dbAppDatabase+'.dbo.'+c.TableName WHEN @multiDesignDb='N' THEN @sysDatabase+'.dbo.'+c.TableName ELSE 'dbo.'+c.TableName END = @ddlKeyTableName
					INNER JOIN dbo.DbColumn d ON a.ColumnId = d.ColumnId INNER JOIN dbo.DbColumn e ON a.RefColumnId = e.ColumnId
				IF @@ROWCOUNT <= 0 AND @mainTable <> @ddlKeyTableName
					RAISERROR('Foreign key relationship has not been established for tables %s and %s.',18,2,@mainTable,@ddlKeyTableName) WITH SETERROR
				SELECT @fromClause = @fromClause + ' INNER JOIN ' + @ddlKeyTableName + ' ' + @ddlKeyTableAbbr + ' ON ' + @mainTableAbbr + '.' + @joinColumn1 + ' = ' + @ddlKeyTableAbbr + '.' + @joinColumn2
					, @ifClause = @ifClause + ' AND EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name=''''' + @ddlKeyDbName + ''''')'
			END
			SELECT @whereClause = 'SELECT @wClause = ''''WHERE ( 1=1 '''' ' + CHAR(13)
			+ ' + CASE WHEN @FilterTxt IS NULL OR @filterTxt = '''''''' THEN '''''''' ELSE '''' AND ' + @ddlKeyTableAbbr + '.' + @ddlRefColumnName + ' LIKE ''''''''%'''' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@FilterTxt,''''['''',''''[[]''''),''''%'''',''''[%]''''),''''_'''',''''[_]''''), '''''''''''''''',''''''''''''''''''''''''),'''' '''',''''%'''') + ''''%'''''''''''' END + '''') '''' '	+ CHAR(13)
			+ CASE WHEN @displayName IN ('ComboBox','DropDownList','ListBox','RadioButtonList')  
				THEN ' + CASE WHEN @bAll = ''''N'''' THEN '''' AND (' + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName + ' IN ' + ''''' + CASE WHEN left(ISNULL(@keyId,''''-1''''),1) = ''''('''' THEN ISNULL(@keyId,''''-1'''') ELSE ''''('''' + ISNULL(@keyId,''''-1'''') + '''')'''' END + '''')''''' + ' ELSE '''''''' END '
				ELSE '' END
		END
		IF @displayName IN ('ComboBox','DropDownList','ListBox','RadioButtonList')
		BEGIN
			/*
			SELECT @select1Clause = 'distinct ' + @columnName + CONVERT(VARCHAR(10),@screenCriId) + '=' + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName
			SELECT @select1Clause = @select1Clause + ', ' + @columnName + CONVERT(VARCHAR(10),@screenCriId) + 'Text=' + @ddlRefTableAbbr + '.' + @ddlRefColumnName
			*/
			SELECT @select1Clause = 'distinct ' + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName + ', ' + @ddlRefTableAbbr + '.' + @ddlRefColumnName + ISNULL(', ' + @ddlRefTableAbbr + '.' + @ddlFtrColumnName,'')
			SELECT @select2Clause = @ddlKeyColumnName + '=null, ' + @ddlRefColumnName + '=null' + ISNULL(', ' + @ddlFtrColumnName + '=null','')
			IF NOT EXISTS (SELECT 'true' FROM dbo.Screen WHERE ScreenId = @screenId AND MasterTableId = @ddlKeyTableId)
				AND EXISTS (SELECT 'true' FROM dbo.DbColumn WHERE TableId = @ddlKeyTableId AND ColumnName = @pKey)
				SELECT @select1Clause = @select1Clause + ', ' + @ddlRefTableAbbr + '.' + @pKey, @select2Clause = @select2Clause + ', ' + @pKey + '=null'
			IF EXISTS (SELECT 'true' FROM dbo.DbColumn WHERE TableId = @ddlKeyTableId AND ColumnName = 'Active')
				SELECT @select1Clause = @select1Clause + ', ' + @ddlRefTableAbbr + '.Active', @select2Clause = @select2Clause + ', Active=null'
			IF @ddlSrtColumnName is not null
			BEGIN
				SELECT @select1Clause = @select1Clause + ', ' + @ddlRefTableAbbr + '.' + @ddlSrtColumnName
					, @select2Clause = @select2Clause + ', ' + @ddlSrtColumnName + '=null'
					, @orderClause = @ddlRefTableAbbr + '.' + @ddlSrtColumnName
				IF @ddlSrtColumnName = @ddlRefColumnName SELECT @orderClause = @orderClause + ' desc'
			END
			ELSE IF EXISTS (SELECT 'true' FROM dbo.DbColumn WHERE TableId = @ddlKeyTableId AND ColumnName = 'Active')
				SELECT @orderClause = @ddlRefTableAbbr + '.Active DESC,' + @ddlRefTableAbbr + '.' + @ddlRefColumnName
			ELSE
				SELECT @orderClause = @ddlRefTableAbbr + '.' + @ddlRefColumnName
			IF @displayMode = 'ComboBoxNoPunc'
				SELECT @select1Clause = @select1Clause + ', NoPunc=RODesign.dbo.fRmPunc(' + @ddlRefTableAbbr + '.' + @ddlRefColumnName + ')'
				, @select2Clause = @select2Clause + ', NoPunc=null'
		END
		ELSE
		BEGIN
			IF @select1Clause = '' RAISERROR('Drop down columns not defined or in bad order for ScreenCriId %d.',18,2,@ScreenCriId) WITH SETERROR
			SELECT @select1Clause = @select1Clause + ', ' + @columnName + CONVERT(VARCHAR(10),@screenCriId) + '=' + @ddlKeyTableAbbr + '.' + @ddlKeyColumnName
				, @select2Clause = @select2Clause + ', ' + @columnName + CONVERT(VARCHAR(10),@screenCriId) + '=null'
		END
	END
	FETCH NEXT FROM objCursor INTO @tableId, @columnName, @displayName, @displayMode, @ddlKeyTableId, @ddlKeyTableAbbr, @ddlKeyTableName, @ddlKeyColumnName
		, @ddlRefTableAbbr, @ddlRefTableName, @ddlRefColumnName, @ddlSrtColumnName, @ddlKeyDbName,@ddlFtrColumnName
END
CLOSE objCursor
DEALLOCATE objCursor
SELECT @param1Sql = ',@Usrs' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
	+ ',@UsrGroups' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
	+ ',@Cultures' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
	+ ',@Companys' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
	+ ',@Agents' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
	+ ',@Brokers' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
	+ ',@Customers' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
	+ ',@Investors' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
	+ ',@Members' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
	+ ',@Vendors' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
	+ ',@Projects' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
EXEC dbo.GetScreenObjDdlProc @procedureName, '', @param1Sql, @declare1Sql, @select1Clause, @select2Clause, @ifClause, @fromClause, @whereClause, @orderClause, @allClause, @selfClause, @multiDesignDb, @ddlKeyTableAbbr, @sysDatabase, 'RODesign', @procedureSql1 OUTPUT, @procedureSql2 OUTPUT, @procedureSql3 OUTPUT
IF @procedureSql1 is null or @procedureSql2 is null or @procedureSql3 is null
BEGIN
	RAISERROR('Stored Procedure %s not generated because of null.',18,2,@procedureName) WITH SETERROR
	RETURN 1
END
SELECT @dropProcedureSql = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''' + @procedureName + ''''') AND type = ''''P'''') DROP PROCEDURE ' + @procedureName
IF @multiDesignDb = 'Y'
BEGIN
	DECLARE sysCursor CURSOR FOR SELECT dbDesDatabase FROM RODesign.dbo.Systems FOR READ ONLY
	OPEN sysCursor
	FETCH NEXT FROM sysCursor INTO @sysDatabase
	WHILE @@FETCH_STATUS = 0
	BEGIN
		EXEC (@sysDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedureSql + '''')
		EXEC (@sysDatabase + '.dbo.MkStoredProcedure ''' + @procedureSql1 + ''',''' + @procedureSql2 + ''',''' + @procedureSql3 + '''')
		FETCH NEXT FROM sysCursor INTO @sysDatabase
	END
	CLOSE sysCursor
	DEALLOCATE sysCursor
END
ELSE	/* Always on the app database */
BEGIN
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedureSql + '''')
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @procedureSql1 + ''',''' + @procedureSql2 + ''',''' + @procedureSql3 + '''')
END
/*
SELECT 	 parameter1Names='RowAuthoritys'+@parameter1Names
	,parameter1Types='string'+@parameter1Types
	,parameter1SByte='VarChar'+@parameter1SByte
*/
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.MkReportCha') AND type='P')
DROP PROCEDURE dbo.MkReportCha
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[MkReportCha]
 @RptwizTypeCd	char(1)
,@RptwizId		int
,@RptElmId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @ReportId		int
		,@RptCtrId		int
		,@UnitCd		char(2)
		,@RptWidth		decimal(8,2)
		,@RptChaId		int
		,@ReportObjId	int
		,@RptChaTypeCd	char(2)
		,@ThreeD		char(1)
		,@CategoryGrp	int
		,@SeriesGrp		int
		,@ChartData		nvarchar(1000)
		,@ColHeader		nvarchar(50)
SET NOCOUNT ON
SELECT @ReportId = ReportId, @UnitCd = UnitCd, @RptChaTypeCd = RptChaTypeCd, @ThreeD = ThreeD
	, @RptWidth = case when OrientationCd = 'P' then
			(case when UnitCd = 'in' then 8.5
				when UnitCd = 'cm' then 21.59 else 215.9 end)
			else (case when UnitCd = 'in' then 11.0
				when UnitCd = 'cm' then 27.94 else 279.4 end) end - LeftMargin - RightMargin
	FROM dbo.Rptwiz WHERE RptwizId = @RptwizId
SELECT @CategoryGrp = a.ReportObjId
	FROM dbo.UtReportObj a
	INNER JOIN dbo.DbColumn b ON a.ColumnName = b.ColumnName
	INNER JOIN dbo.RptwizDtl c ON b.ColumnId = c.ColumnId
	WHERE a.ReportId = @ReportId AND c.RptwizId = @RptwizId AND c.ColSelect is not null AND c.RptChartCd = 'C'
If @@ROWCOUNT <> 1 BEGIN RAISERROR('{40}',18,2) WITH SETERROR RETURN 1 END
SELECT @SeriesGrp = a.ReportObjId
	FROM dbo.UtReportObj a
	INNER JOIN dbo.DbColumn b ON a.ColumnName = b.ColumnName
	INNER JOIN dbo.RptwizDtl c ON b.ColumnId = c.ColumnId
	WHERE a.ReportId = @ReportId AND c.RptwizId = @RptwizId AND c.ColSelect is not null AND c.RptChartCd = 'S'
SELECT @ColHeader = c.ColHeader, @ChartData = case
		when c.AggregateCd is null then '=Fields!' + b.ColumnName + '.Value'
		when c.AggregateCd = 'S' then '=SUM(Fields!' + b.ColumnName + '.Value)'
		when c.AggregateCd = 'M' then '=MAX(Fields!' + b.ColumnName + '.Value)'
		when c.AggregateCd = 'I' then '=MIN(Fields!' + b.ColumnName + '.Value)'
		when c.AggregateCd = 'C' then '=COUNT(Fields!' + b.ColumnName + '.Value)'
		else '=AVG(Fields!' + b.ColumnName + '.Value)' end
	FROM dbo.DbColumn b
	INNER JOIN dbo.RptwizDtl c ON b.ColumnId = c.ColumnId
	WHERE c.RptwizId = @RptwizId AND c.ColSelect is not null AND c.RptChartCd = 'V'
If @@ROWCOUNT <> 1 BEGIN RAISERROR('{41}',18,2) WITH SETERROR RETURN 1 END
/* Make Parent control */
INSERT dbo.UtRptCtr (RptElmId, ReportId, RptCtrTypeCd, RptCtrName, CtrTop, CtrWidth, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
	SELECT @RptElmId, @ReportId, 'C', 'CCha', 0.0, @RptWidth, 'N', 'N', '="' + @ColHeader + '"', 'N', 'N', 'Y'
SELECT @RptCtrId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCtr @RptCtrId
/* Define chart content */
INSERT dbo.UtRptCha (RptCtrId, ReportId, RptChaTypeCd, ThreeD, CategoryGrp, ChartData, SeriesGrp)
	SELECT @RptCtrId, @ReportId, @RptChaTypeCd, @ThreeD, @CategoryGrp, @ChartData, @SeriesGrp
SELECT @RptChaId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCha @RptChaId
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.MkReportGet') AND type='P')
DROP PROCEDURE dbo.MkReportGet
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[MkReportGet]
 @GenPrefix		varchar(10)
,@reportId		int
,@procedureName	varchar(200)
,@appDatabase	varchar(50)
,@sysDatabase	varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @procedureSql		varchar(max)
		,@dropProcedureSql	varchar(max)
		,@paramClause		varchar(max)
		,@WhereClause		varchar(4000)
		,@RegClause			varchar(1000)
		,@ValClause			varchar(1000)
		,@UpdClause			varchar(1000)
		,@XlsClause			varchar(1000)
		,@tc				varchar(4000)
		,@SelfColumns		varchar(2000)
		,@SelfColumn		varchar(50)
		,@SelfHeaders		varchar(2000)
		,@SelfHeader		varchar(50)
		,@allClause			varchar(max)
		,@selfClause		varchar(max)
		,@parameter1Names	varchar(1000)
		,@parameter1Types	varchar(1000)
		,@parameter1SByte	varchar(1000)
		,@calling1Params	varchar(1000)
		,@param1Sql			varchar(4000)
		,@declare1Sql		varchar(4000)
		,@TableId			int
		,@TableAbbr			varchar(10)
SET NOCOUNT ON
IF @GenPrefix = 'Ut'
	SELECT @WhereClause = WhereClause, @RegClause = RegClause, @ValClause = ValClause, @UpdClause = UpdClause, @XlsClause = XlsClause FROM dbo.UtReport WHERE ReportId = @reportId
ELSE
	SELECT @WhereClause = WhereClause, @RegClause = RegClause, @ValClause = ValClause, @UpdClause = UpdClause, @XlsClause = XlsClause FROM dbo.Report WHERE ReportId = @reportId
SELECT @paramClause = '', @tc = ''
EXEC dbo.GetReportParm @GenPrefix, @reportId, @WhereClause, @tc OUTPUT, @paramClause OUTPUT, @SelfColumns OUTPUT, @SelfHeaders OUTPUT, null
SELECT @procedureSql = 'CREATE PROCEDURE Get' + @procedureName + CHAR(13)
+ ' @reportId' + CHAR(9) + CHAR(9) + 'int' + CHAR(13)
+ ',@RowAuthoritys' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Usrs' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@UsrGroups' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Cultures' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Companys' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Projects' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Agents' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Brokers' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Customers' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Investors' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Members' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Vendors' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Borrowers' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Guarantors' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Lenders' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@currCompanyId' + CHAR(9) + CHAR(9) + 'int' + CHAR(13)
+ ',@currProjectId' + CHAR(9) + CHAR(9) + 'int' + @paramClause + CHAR(13)
+ ',@bUpd char(1)' + CHAR(13) + ',@bXls char(1)' + CHAR(13) + ',@bVal char(1)=''''N''''' + CHAR(13)
+ '/* WITH ENCRYPTION */' + CHAR(13) + 'AS' + CHAR(13)
+ 'DECLARE	 @usrName		nvarchar(50)' + CHAR(13)
+ '		,@UsrId			int' + CHAR(13)
+ '		,@wClause		varchar(max)' + CHAR(13)
+ '		,@tClause		varchar(max)' + CHAR(13)
+ 'EXEC RODesign.dbo.Pop1Int @Usrs, @UsrId OUTPUT' + CHAR(13)
+ 'SELECT @usrName = UsrName FROM RODesign.dbo.Usr WHERE UsrId = @UsrId' + CHAR(13)
IF @WhereClause is not null AND @WhereClause <> ''
	SELECT @procedureSql = @procedureSql + replace(@WhereClause,'''','''''') + CHAR(13) + @tc
ELSE
	SELECT @procedureSql = @procedureSql + 'SELECT @wClause = ''''WHERE 1=1''''' + CHAR(13) + @tc
SELECT @allClause = '', @selfClause = '', @parameter1Names='', @parameter1Types='', @parameter1SByte='', @calling1Params='', @param1Sql='', @declare1Sql=''
/* Only permission manage on the table specified on Report Generator */
/*
SELECT @TableId = a.TableId, @TableAbbr = 't' + convert(varchar,a.TableId)
	FROM dbo.RptwizCat a INNER JOIN dbo.Rptwiz b ON a.RptwizCatId = b.RptwizCatId
	WHERE b.ReportId = @reportId
IF @TableId is not null AND @TableAbbr is not null
	EXEC dbo.GetScreenLisParm @TableId, @TableAbbr, '', @sysDatabase, 'RODesign', '', @allClause OUTPUT, @selfClause OUTPUT, @parameter1Names OUTPUT, @parameter1Types OUTPUT, @parameter1SByte OUTPUT, @calling1Params OUTPUT, @param1Sql OUTPUT, @declare1Sql OUTPUT, 'Y'
*/
SELECT @procedureSql = @procedureSql + @allClause + @selfClause
IF @UpdClause is not null AND @UpdClause <> ''
BEGIN
	SELECT @procedureSql = @procedureSql + 'IF @bUpd = ''''Y'''' ' + @UpdClause + CHAR(13) + 'ELSE '
END
IF @XlsClause is not null AND @XlsClause <> ''
BEGIN
	SELECT @procedureSql = @procedureSql + 'IF @bXls = ''''Y'''' ' + @XlsClause + CHAR(13) + 'ELSE '
END
IF @RegClause is not null AND @RegClause <> ''
BEGIN
	IF @ValClause is not null AND @ValClause <> ''
		SELECT @procedureSql = @procedureSql + 'IF @bVal = ''''N'''' ' + @RegClause + CHAR(13) + 'ELSE ' + @ValClause + CHAR(13)
	ELSE
		SELECT @procedureSql = @procedureSql + @RegClause + CHAR(13)
END
ELSE
BEGIN
	RAISERROR('Stored Procedure Get%s not generated because Regular Execution Clause is not specified.',18,2,@procedureName) WITH SETERROR
	RETURN 1
END
SELECT @procedureSql = @procedureSql + 'RETURN 0' + CHAR(13)
IF @procedureSql IS NULL
BEGIN
	RAISERROR('Stored Procedure Get%s not generated.',18,2,@procedureName) WITH SETERROR
	RETURN 1
END
ELSE
BEGIN
	SELECT @dropProcedureSql = 'IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(''''Get' + @procedureName + ''''') AND type = ''''P'''') DROP PROCEDURE Get' + @procedureName
	-- USE Database is not allowed!  Needs to be replaced by Dynamic EXECUTION.
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedureSql + '''')
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @procedureSql + '''')
END
RETURN 0



 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.MkReportGetIn') AND type='P')
DROP PROCEDURE dbo.MkReportGetIn
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[MkReportGetIn]
 @GenPrefix			varchar(10)
,@reportCriId		int
,@procedureName		varchar(200)
,@appDatabase		varchar(50)
,@sysDatabase		varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @procedureSql1		varchar(max)
	,@procedureSql2		varchar(max)
	,@procedureSql3		varchar(max)
	,@dropProcedureSql	varchar(max)
	,@WhereClause		varchar(4000)
	,@RegClause		varchar(1000)
	,@TableId		int
	,@TableAbbr		varchar(10)
	,@allClause		varchar(max)
	,@selfClause		varchar(max)
	,@parameter1Names	varchar(1000)
	,@parameter1Types	varchar(1000)
	,@parameter1SByte	varchar(1000)
	,@calling1Params	varchar(1000)
	,@param1Sql		varchar(4000)
	,@declare1Sql		varchar(4000)
	,@reportId		int
SET NOCOUNT ON
SELECT @allClause = '', @selfClause = '', @parameter1Names='', @parameter1Types='', @parameter1SByte='', @calling1Params='', @param1Sql='', @declare1Sql=''
IF @GenPrefix = 'Ut'
	SELECT @WhereClause = WhereClause, @RegClause = RegClause, @TableId = TableId, @TableAbbr = TableAbbr FROM dbo.UtReportCri WHERE ReportCriId = @reportCriId
ELSE
	SELECT @WhereClause = WhereClause, @RegClause = RegClause, @TableId = TableId, @TableAbbr = TableAbbr FROM dbo.ReportCri WHERE ReportCriId = @reportCriId
IF @TableId is not null and @TableAbbr is not null
BEGIN
	SELECT @reportId = reportId FROM dbo.ReportCri WHERE ReportCriId = @reportCriId
	EXEC dbo.GetScreenLisParm null, @reportId, @TableId, @TableAbbr, '', @sysDatabase, 'RODesign', '', @allClause OUTPUT, @selfClause OUTPUT, @parameter1Names OUTPUT, @parameter1Types OUTPUT, @parameter1SByte OUTPUT, @calling1Params OUTPUT, @param1Sql OUTPUT, @declare1Sql OUTPUT
END
SELECT @procedureSql1 = 'CREATE PROCEDURE GetIn' + @procedureName + CHAR(13)
+ ' @reportId' + CHAR(9) + CHAR(9) + 'int' + CHAR(13)
+ ',@RowAuthoritys' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Usrs' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@UsrGroups' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Cultures' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Companys' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Projects' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Agents' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Brokers' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Customers' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Investors' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Members' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Vendors' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Borrowers' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Guarantors' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@Lenders' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ ',@currCompanyId' + CHAR(9) + CHAR(9) + 'int' + CHAR(13)
+ ',@currProjectId' + CHAR(9) + CHAR(9) + 'int' + CHAR(13)
+ ',@bAll' + CHAR(9) + CHAR(9) + 'char(1)=null' + CHAR(13)
+ ',@keyId' + CHAR(9) + CHAR(9) + 'varchar(max)=null' + CHAR(13)
+ '/* WITH ENCRYPTION */' + CHAR(13)
+ 'AS' + CHAR(13) + 'SET NOCOUNT ON' + CHAR(13) + 'DECLARE'
+ CHAR(9) + ' @wClause' + CHAR(9) + CHAR(9) + 'varchar(max)' + CHAR(13)
+ CHAR(9) + ',@tClause' + CHAR(9) + CHAR(9) + 'varchar(max)' + CHAR(13)
+ CHAR(9) + ',@cc' + CHAR(9) + CHAR(9) + 'varchar(max)' + CHAR(13)
+ CHAR(9) + ',@rr' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ CHAR(9) + ',@pp' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ CHAR(9) + ',@AllowSel' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ CHAR(9) + ',@RowAuthorityId' + CHAR(9) + 'smallint' + CHAR(13) + @declare1Sql
IF @WhereClause is not null AND @WhereClause <> ''
	SELECT @procedureSql1 = @procedureSql1 + replace(@WhereClause,'''','''''') + CHAR(13)
ELSE
	SELECT @procedureSql1 = @procedureSql1 + 'SELECT @wClause = ''''WHERE 1=1''''' + CHAR(13)
SELECT @procedureSql2 = @allClause
SELECT @procedureSql3 = @selfClause
IF @RegClause is not null AND @RegClause <> '' SELECT @procedureSql3 = @procedureSql3 + @RegClause + CHAR(13)
ELSE
BEGIN
	RAISERROR('Stored Procedure "GetIn%s" not generated because Regular Execution Clause is not specified.',18,2,@procedureName) WITH SETERROR
	RETURN 1
END
SELECT @procedureSql3 = @procedureSql3 + 'RETURN 0' + CHAR(13)
IF @procedureSql1 IS NULL
	BEGIN RAISERROR('Stored Procedure "GetIn%s" not generated (Sql1 is null).',18,2,@procedureName) WITH SETERROR RETURN 1 END
ELSE IF @procedureSql2 IS NULL
	BEGIN RAISERROR('Stored Procedure "GetIn%s" not generated (Sql2 is null).',18,2,@procedureName) WITH SETERROR RETURN 1 END
ELSE IF @procedureSql3 IS NULL
	BEGIN RAISERROR('Stored Procedure "GetIn%s" not generated (Sql3 is null).',18,2,@procedureName) WITH SETERROR RETURN 1 END
ELSE
BEGIN
	SELECT @dropProcedureSql = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''GetIn' + @procedureName + ''''') AND type = ''''P'''') DROP PROCEDURE GetIn' + @procedureName
	-- USE Database is not allowed!  Needs to be replaced by Dynamic EXECUTION.
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedureSql + '''')
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @procedureSql1 + ''',''' + @procedureSql2 + ''',''' + @procedureSql3 + '''')
END
RETURN 0



 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.MkReportLis') AND type='P')
DROP PROCEDURE dbo.MkReportLis
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[MkReportLis]
 @ColGroup		smallint
,@RptwizId		int
,@RptElmId		int
,@PRptCtrId		int OUTPUT
,@PIndent		decimal(8,2) OUTPUT
/* WITH ENCRYPTION */
AS
DECLARE	 @ReportId		int
		,@TotWidth		decimal(8,2)
		,@RptWidth		decimal(8,2)
		,@CtrWidth		decimal(8,2)
		,@LblWidth		decimal(8,2)
		,@RptHeight		decimal(8,2)
		,@PrevCtrWidth	decimal(8,2)
		,@RptStyleId	int
		,@ColumnId		int
		,@ColumnName	varchar(50)
		,@DefaultCd		char(2)
		,@LeftMargin	decimal(8,2)
		,@RightMargin	decimal(8,2)
		,@UnitCd		char(2)
		,@DefCultureId	smallint
		,@ReportObjId	int
		,@RptChaTypeCd	char(2)
		,@CtrHeight		decimal(8,2)
		,@CtrTop		decimal(8,2)
SET NOCOUNT ON
IF (SELECT COUNT(1) FROM dbo.RptStyle) <= 0 EXEC dbo.MkRptStyle
IF @ColGroup is not null AND NOT EXISTS (SELECT 1 FROM dbo.RptwizDtl WHERE RptwizId = @RptwizId AND ColSelect is not null AND ColGroup = @ColGroup)
	return 0
ELSE
	SELECT @ColumnName = b.ColumnName, @ReportObjId = r.ReportObjId
	FROM dbo.RptwizDtl a
	INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
	INNER JOIN dbo.RptWiz c ON a.RptWizId = c.RptWizId
	LEFT OUTER JOIN dbo.UtReportObj r ON b.ColumnName = r.ColumnName AND c.ReportId = r.ReportId
	WHERE a.RptwizId = @RptwizId AND a.ColSelect is not null AND a.ColGroup = @ColGroup
IF @ColGroup is null AND NOT EXISTS (SELECT 1 FROM dbo.RptwizDtl WHERE RptwizId = @RptwizId AND ColSelect is not null AND ColGroup is null)
	return 0
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT @ReportId = ReportId, @UnitCd = UnitCd, @RptChaTypeCd = RptChaTypeCd
	, @LeftMargin = LeftMargin, @RightMargin = RightMargin
	, @RptHeight = case when OrientationCd <> 'P' then (case when UnitCd = 'in' then 7.0 when UnitCd = 'cm' then 17.78 else 177.8 end)
		else (case when UnitCd = 'in' then 9.5 when UnitCd = 'cm' then 24.13 else 241.3 end) end - TopMargin - BottomMargin
	, @RptWidth = case when OrientationCd = 'P' then (case when @UnitCd = 'in' then 8.5 when @UnitCd = 'cm' then 21.59 else 215.9 end)
		else (case when @UnitCd = 'in' then 11.0 when @UnitCd = 'cm' then 27.94 else 279.4 end) end - LeftMargin - RightMargin
	FROM dbo.Rptwiz WHERE RptwizId = @RptwizId
SELECT @CtrHeight = case when @UnitCd = 'in' then 0.2 when @UnitCd = 'cm' then 0.51 else 5.08 end
IF @RptChaTypeCd is not null AND @PIndent = 0.0 SELECT @CtrTop = @RptHeight ELSE SELECT @CtrTop = @CtrHeight
INSERT dbo.UtRptCtr (PRptCtrId, RptElmId, ReportId, RptCtrTypeCd, RptCtrName, CtrTop, CtrLeft
	, CtrHeight, CtrWidth, CtrPgBrStart, CtrPgBrEnd, CtrCanGrow, CtrCanShrink, CtrTogether, CtrGrouping)
	SELECT @PRptCtrId, case when @PRptCtrId is null then @RptElmId else null end
	, @ReportId, 'L', 'LLis' + case when @ColGroup is null then 't' else convert(varchar,@ColGroup) end
	, @CtrTop, null, @CtrHeight, @RptWidth, 'N', 'N', 'Y', 'Y', 'Y'
	, case when @ColGroup is null then null else @ReportObjId end
SELECT @PRptCtrId = @@IDENTITY
EXEC dbo.Ir_UpdUtRptCtr @PRptCtrId
/* Get the total column width ahead of time */
SELECT @TotWidth = sum(case when a.ColGroup is null then isnull(c.ColWidth,case when @UnitCd = 'in' then 1.0 when @UnitCd = 'cm' then 2.54 else 25.4 end) else case when @UnitCd = 'in' then 0.2 when @UnitCd = 'cm' then 0.51 else 5.08 end end)
	FROM dbo.RptwizDtl a
	INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
	LEFT OUTER JOIN (SELECT x.ColumnId
		, ColWidth = round(avg(case when @UnitCd = 'in' then x.ColumnSize/150.0 when @UnitCd = 'cm' then x.ColumnSize/150.0*2.54 else x.ColumnSize/150.0*25.4 end),2)
		FROM dbo.ScreenObj x GROUP BY x.ColumnId) c ON b.ColumnId = c.ColumnId
	WHERE a.RptwizId = @RptwizId AND a.ColSelect is not null
IF @ColGroup is null
BEGIN
	DECLARE cur CURSOR FAST_FORWARD FOR
		SELECT a.ColumnId, b.ColumnName, DefaultCd = case when b.DataType in (12,16,21) then 'CD' when b.DataType = 7 then 'CM' when b.DataType in (1,2,3,4,5,6,18) then 'CN' else 'CS' end
			, CtrWidth = isnull(c.ColWidth,case when @UnitCd = 'in' then 1.0 when @UnitCd = 'cm' then 2.54 else 25.4 end)
			, LblWidth = case when @UnitCd = 'in' then 1.0 when @UnitCd = 'cm' then 2.54 else 25.4 end
		FROM dbo.RptwizDtl a
		INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
		LEFT OUTER JOIN (SELECT x.ColumnId
			, ColWidth = round(avg(case when @UnitCd = 'in' then x.ColumnSize/150.0 when @UnitCd = 'cm' then x.ColumnSize/150.0*2.54 else x.ColumnSize/150.0*25.4 end),2)
			FROM dbo.ScreenObj x GROUP BY x.ColumnId) c ON b.ColumnId = c.ColumnId
		WHERE a.RptwizId = @RptwizId AND a.ColSelect is not null AND ColGroup is null ORDER BY a.ColSelect
	FOR READ ONLY
END
ELSE
BEGIN
	DECLARE cur CURSOR FAST_FORWARD FOR
		SELECT a.ColumnId, b.ColumnName, DefaultCd = case when b.DataType in (12,16,21) then 'GD' when b.DataType = 7 then 'GM' when b.DataType in (1,2,3,4,5,6,18) then 'GN' else 'GS' end
			, CtrWidth = isnull(c.ColWidth,case when @UnitCd = 'in' then 1.0 when @UnitCd = 'cm' then 2.54 else 25.4 end)
			, LblWidth = case when @UnitCd = 'in' then 1.0 when @UnitCd = 'cm' then 2.54 else 25.4 end
		FROM dbo.RptwizDtl a
		INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
		LEFT OUTER JOIN (SELECT x.ColumnId
			, ColWidth = round(avg(case when @UnitCd = 'in' then x.ColumnSize/150.0 when @UnitCd = 'cm' then x.ColumnSize/150.0*2.54 else x.ColumnSize/150.0*25.4 end),2)
			FROM dbo.ScreenObj x GROUP BY x.ColumnId) c ON b.ColumnId = c.ColumnId
		WHERE a.RptwizId = @RptwizId AND a.ColSelect is not null AND ColGroup = @ColGroup ORDER BY a.ColSelect
	FOR READ ONLY
END
SELECT @PrevCtrWidth = @PIndent
OPEN cur
FETCH NEXT FROM cur INTO @ColumnId, @ColumnName, @DefaultCd, @CtrWidth, @LblWidth
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @RptStyleId = RptStyleId FROM dbo.RptStyle WHERE DefaultCd = @DefaultCd
	IF @ColGroup is not null
	BEGIN
		INSERT dbo.UtRptCtr (PRptCtrId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrTop, CtrLeft
			, CtrHeight, CtrWidth, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @PRptCtrId, @ReportId, 'X', 'P' + @ColumnName, @RptStyleId
			, 0.0, @PrevCtrWidth
			, case when @UnitCd = 'in' then 0.2 when @UnitCd = 'cm' then 0.51 else 5.08 end
			, round(@LblWidth/@TotWidth*@RptWidth,2), 'N', 'N', '=Parameters!L_' + @ColumnName + '.Value &amp; ":"', 'Y', 'Y', 'Y'
		EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
		SELECT @PrevCtrWidth = @PrevCtrWidth + round(@LblWidth/@TotWidth*@RptWidth,2)
		INSERT dbo.UtRptCtr (PRptCtrId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrTop, CtrLeft
			, CtrHeight, CtrWidth, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @PRptCtrId, @ReportId, 'X', 'F' + @ColumnName, @RptStyleId
			, 0.0, @PrevCtrWidth
			, case when @UnitCd = 'in' then 0.2 when @UnitCd = 'cm' then 0.51 else 5.08 end
			, round(@CtrWidth/@TotWidth*@RptWidth,2), 'N', 'N', '=Fields!' + @ColumnName + '.Value', 'Y', 'Y', 'Y'
		EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
		SELECT @PrevCtrWidth = @PrevCtrWidth + round(@CtrWidth/@TotWidth*@RptWidth,2)
		SELECT @PIndent = @PrevCtrWidth
	END
	ELSE
	BEGIN
		INSERT dbo.UtRptCtr (PRptCtrId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrTop, CtrLeft
			, CtrHeight, CtrWidth, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @PRptCtrId, @ReportId, 'X', 'F' + @ColumnName, @RptStyleId
			, 0.0, @PrevCtrWidth
			, case when @UnitCd = 'in' then 0.2 when @UnitCd = 'cm' then 0.51 else 5.08 end
			, round(@CtrWidth/@TotWidth*@RptWidth,2), 'N', 'N', '=Fields!' + @ColumnName + '.Value', 'Y', 'Y', 'Y'
		EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
		SELECT @PrevCtrWidth = @PrevCtrWidth + round(@CtrWidth/@TotWidth*@RptWidth,2)
	END
	FETCH NEXT FROM cur INTO @ColumnId, @ColumnName, @DefaultCd, @CtrWidth, @LblWidth
END
CLOSE cur DEALLOCATE cur
IF @ColGroup is not null SELECT @PIndent = round(@ColGroup * (case when @UnitCd = 'in' then 0.2 when @UnitCd = 'cm' then 0.51 else 5.08 end) /@TotWidth * @RptWidth,2)
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.MkReportReg') AND type='P')
DROP PROCEDURE dbo.MkReportReg
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




-- Called by WrRptwizGen:
CREATE PROCEDURE [dbo].[MkReportReg]
 @RptwizId		int
,@ProgramName	varchar(50)
,@AppDatabase	varchar(50)
,@RegCode		varchar(8000) OUTPUT
/* WITH ENCRYPTION */
AS
DECLARE	 @ProcDel		varchar(8000)
		,@CriParams		varchar(4000)
		,@CriClause		varchar(4000)
		,@SelClause		varchar(4000)
		,@FrmClause		varchar(4000)
		,@OrdClause		varchar(4000)
		,@DbName		varchar(50)
		,@TableId		int
		,@TableName		varchar(500)
		,@VirtualTbl	char(1)
		,@ColumnName	varchar(50)
		,@RefColName	varchar(50)
		,@AllowNulls	char(1)
		,@CriSelect		smallint
		,@DataTypeId	tinyint
		,@NumericData	char(1)
		,@DataTypeName	varchar(50)
		,@DataTypeSize	smallint
		,@ColumnScale	tinyint
		,@TableAbbr		varchar(10)
		,@ColSort		smallint
		,@OperatorName	varchar(10)
		,@RptWizTypeCd	char(1)
		,@AggregateCd	char(1)
		,@AggregateWd	varchar(10)
		,@GNeedleId		int
		,@ColumnId		int
SET NOCOUNT ON
SELECT @RptwizTypeCd = RptwizTypeCd, @GNeedleId = GNeedleId FROM dbo.Rptwiz WHERE RptwizId = @RptwizId
/* Prepare table abbreviation */
SELECT @DbName = d.dbAppDatabase, @TableId = a.TableId, @TableName = c.TableName, @VirtualTbl = c.VirtualTbl
	FROM dbo.RptwizCat a
	INNER JOIN dbo.Rptwiz b ON a.RptwizCatId = b.RptwizCatId
	INNER JOIN dbo.DbTable c ON a.TableId = c.TableId
	INNER JOIN RODesign.dbo.Systems d ON c.SystemId = d.SystemId
	WHERE b.RptwizId = @RptwizId
SELECT @TableAbbr = 't' + convert(varchar,@TableId)

/* function parameters substitution */
DECLARE @fp table (paraName varchar(30), paraType varchar(30), paraVal nvarchar(4000))
insert into @fp (paraName) select RTRIM(LTRIM(Token)) from RODesign.dbo.BreakString(1,replace(replace(@TableName,'(',','),')',''),NULL,',') p WHERE RTRIM(LTRIM(Token)) like '@%'

/* Prepare criteria parameters */
SELECT @CriParams = '', @CriClause = ''
DECLARE cur1 CURSOR FAST_FORWARD FOR
	SELECT b.ColumnName, a.CriSelect, c.DataTypeId, c.NumericData, c.DataTypeSqlName, b.ColumnLength, b.ColumnScale, d.OperatorName
	FROM dbo.RptwizDtl a
	INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
	INNER JOIN RODesign.dbo.CtDataType c ON b.DataType = c.DataTypeId
	INNER JOIN RODesign.dbo.CtOperator d ON a.CriOperatorId = d.OperatorId
	WHERE a.RptwizId = @RptwizId AND a.CriSelect is not null ORDER BY a.CriSelect
	FOR READ ONLY
OPEN cur1 FETCH NEXT FROM cur1 INTO @ColumnName, @CriSelect, @DataTypeId, @NumericData, @DataTypeName, @DataTypeSize, @ColumnScale, @OperatorName
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @CriParams = @CriParams + ',@' + @ColumnName + convert(varchar,@CriSelect) + CHAR(9) + @DataTypeName
		+ case when charindex('char',lower(@DataTypeName)) > 0 then '(' + case when @DataTypeSize > 0 then convert(varchar,@DataTypeSize) else 'max' end + ')'
			when @DataTypeName = 'Decimal' then '(' + convert(varchar,@DataTypeSize) + ',' + convert(varchar,@ColumnScale) + ')'
			else '' end + CHAR(13)
	SELECT @CriClause = @CriClause + 'IF @' + @ColumnName + convert(varchar,@CriSelect)
		+ ' is not null SELECT @wClause = @wClause + '' AND '
		+ @TableAbbr + '.' + @ColumnName + ' ' + @OperatorName + ' ' + case
		when @DataTypeId in (12,16,21) then ''''''' + convert(varchar,@' + @ColumnName + convert(varchar,@CriSelect) + ',102) + '''''''''
		when @NumericData = 'Y' then ''' + convert(varchar,@' + @ColumnName + convert(varchar,@CriSelect) + ')'
		when @OperatorName = 'like' then '''''%'' + @' + @ColumnName + convert(varchar,@CriSelect) + ' + ''%'''''''
		when @OperatorName = 'in' OR @OperatorName = 'not in' then ''' + @' + @ColumnName + convert(varchar,@CriSelect)
		else ''''''' + @' + @ColumnName + convert(varchar,@CriSelect) + ' + ''''''''' end + CHAR(13)
	/* update function parameter */
	UPDATE fp set paraType = @DataTypeName
		+ case when charindex('char',lower(@DataTypeName)) > 0 then '(' + case when @DataTypeSize > 0 then convert(varchar,@DataTypeSize) else 'max' end + ')'
			when @DataTypeName = 'Decimal' then '(' + convert(varchar,@DataTypeSize) + ',' + convert(varchar,@ColumnScale) + ')'
			else '' end
	,paraVal = + case
		when @DataTypeId in (12,16,21) then ''' + ISNULL('''''''' + convert(varchar,@' + @ColumnName + convert(varchar,@CriSelect) + ',102) + '''''''',''NULL'')'
		when @NumericData = 'Y' then ''' + ISNULL(convert(varchar,@' + @ColumnName + convert(varchar,@CriSelect) + '),''NULL'')'
		else ''' + ISNULL('''''''' + REPLACE(@' + @ColumnName + convert(varchar,@CriSelect) + ','''''''','''''''''''') + '''''''',''NULL'')' end
	FROM @fp fp WHERE fp.paraName = '@' + @ColumnName
	FETCH NEXT FROM cur1 INTO @ColumnName, @CriSelect, @DataTypeId, @NumericData, @DataTypeName, @DataTypeSize, @ColumnScale, @OperatorName
END
CLOSE cur1 DEALLOCATE cur1

/* replace function parameter with actual on invocation */
select @TableName = REPLACE(@TableName,paraname,CASE WHEN paraVal IS NOT NULL THEN paraname ELSE 'NULL' END) from @fp

declare @dec varchar(max), @val nvarchar(max)
select @dec = '', @val=''

select @dec = @dec + CASE WHEN LEN(@dec) > 0 THEN ',' ELSE '' END + paraName + ' ' + paraType from @fp WHERE paraVal IS NOT NULL
select @dec = CASE WHEN LEN(@dec) > 0 THEN 'DECLARE ' + @dec ELSE '' END

select @val = @val + CASE WHEN LEN(@val) > 0 THEN '+ '', ' ELSE '' END + paraName + ' = ' + paraVal from @fp WHERE paraVal IS NOT NULL
select @val = CASE WHEN LEN(@val) > 0 THEN 'SELECT ' + @val ELSE '' END

/* Prepare select clause */
SELECT @SelClause = ''
DECLARE cur2 CURSOR FAST_FORWARD FOR
	SELECT a.ColumnId, b.ColumnName, a.AggregateCd
	FROM dbo.RptwizDtl a
	INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
	WHERE a.RptwizId = @RptwizId AND a.ColSelect is not null
	ORDER BY a.ColSelect
FOR READ ONLY
OPEN cur2 FETCH NEXT FROM cur2 INTO @ColumnId, @ColumnName, @AggregateCd
WHILE @@FETCH_STATUS = 0
BEGIN
	IF @RptwizTypeCd = 'B'	-- Gauge
	BEGIN
		IF @ColumnId = @GNeedleId
		BEGIN
			IF @AggregateCd is null OR @AggregateCd = 'S' SELECT @AggregateWd = 'SUM('
			ELSE IF @AggregateCd = 'A' SELECT @AggregateWd = 'AVG('
			ELSE IF @AggregateCd = 'C' SELECT @AggregateWd = 'CNT('
			ELSE IF @AggregateCd = 'I' SELECT @AggregateWd = 'MIN('
			ELSE SELECT @AggregateWd = 'MAX('		-- @AggregateCd = 'M'
			IF @SelClause <> '' SELECT @SelClause = @SelClause + ', '
			SELECT @SelClause = @SelClause + @ColumnName + '=ISNULL(' + @AggregateWd + @TableAbbr + '.' + @ColumnName + '),0)'
		END
	END
	ELSE
	BEGIN
		IF @SelClause <> '' SELECT @SelClause = @SelClause + ', '
		SELECT @SelClause = @SelClause + @TableAbbr + '.' + @ColumnName
	END
	FETCH NEXT FROM cur2 INTO @ColumnId, @ColumnName, @AggregateCd
END
CLOSE cur2 DEALLOCATE cur2

/* Prepare from clause */
SELECT @FrmClause = case when @AppDatabase = @DbName then '' else @DbName + '.' end + 'dbo.' + @TableName + ' ' + @TableAbbr

/* Prepare order clause */
SELECT @OrdClause = ''
DECLARE cur4 CURSOR FAST_FORWARD FOR
	SELECT b.TableId, b.ColumnName, a.ColSort
	FROM dbo.RptwizDtl a
	INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
	WHERE a.RptwizId = @RptwizId AND a.ColSort is not null ORDER BY abs(a.ColSort)
FOR READ ONLY
OPEN cur4 FETCH NEXT FROM cur4 INTO @TableId, @ColumnName, @ColSort
WHILE @@FETCH_STATUS = 0
BEGIN
	IF @RptwizTypeCd <> 'B'
	BEGIN
		IF @OrdClause <> '' SELECT @OrdClause = @OrdClause + ', '
		SELECT @OrdClause = @OrdClause + @TableAbbr + '.' + @ColumnName + case when @ColSort < 0 then ' desc' else '' end
	END
	FETCH NEXT FROM cur4 INTO @TableId, @ColumnName, @ColSort
END
CLOSE cur4 DEALLOCATE cur4
SELECT @RegCode = 'CREATE PROCEDURE dbo._Get' + @ProgramName + 'R' + CHAR(13)
+ ' @wClause' + CHAR(9) + 'nvarchar(max)' + CHAR(13) + @CriParams
+ '/* WITH ENCRYPTION */' + CHAR(13)
+ 'AS' + CHAR(13) + 'DECLARE'
+ CHAR(9) + ' @sClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@fClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@oClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
/* function parameter declaration and init */
+ CHAR(9) + ',@dfClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ CHAR(9) + ',@sfClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ 'SET NOCOUNT ON' + CHAR(13)
+ CASE WHEN LEN(@dec) > 0 THEN 'SELECT @dfClause = ''' + @dec +  ''''  ELSE 'SELECT @dfClause = ''''' END + CHAR(13)
+ CASE WHEN LEN(@val) > 0 THEN 'SELECT @sfClause = ''' + @val  ELSE 'SELECT @sfClause = ''''' END + CHAR(13)
+ 'SELECT @sClause = ''SELECT ' + @SelClause + '''' + CHAR(13)
+ 'SELECT @fClause = ''FROM ' + @FrmClause + '''' + CHAR(13)
+ @CriClause
+ case when @OrdClause = '' then 'SELECT @oClause = ''''' else 'SELECT @oClause = ''ORDER BY ' + @OrdClause + '''' end + CHAR(13)
+ 'EXEC (@dfClause+ '' ''  + @sfClause + '' '' + @sClause + '' '' + @fClause + '' '' + @wClause + '' '' + @oClause)' + CHAR(13)
+ 'RETURN 0' + CHAR(13)
/* Convert does not work inside EXEC */
SELECT @ProcDel = 'IF exists (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(''''dbo._Get' + @ProgramName + 'R'''') AND type = ''''P'''') DROP PROCEDURE dbo._Get' + @ProgramName + 'R'
EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @ProcDel + '''')
IF @RegCode is null BEGIN RAISERROR('Cannot create _Get stored procedure, please verify data category and try again.',18,2) WITH SETERROR RETURN 1 END
SELECT @RegCode = replace(@RegCode,'''','''''')
EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @RegCode + '''')
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.MkReportTbl') AND type='P')
DROP PROCEDURE dbo.MkReportTbl
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[MkReportTbl]
 @RptwizId		int
,@RptElmId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @ReportId		int
		,@PRptCtrId		int
		,@G1RptCtrId	int
		,@G2RptCtrId	int
		,@G3RptCtrId	int
		,@GrpWidth		decimal(8,2)
		,@CtrWidth		decimal(8,2)
		,@TotWidth		decimal(8,2)
		,@ColumnId		int
		,@ColumnName	varchar(50)
		,@UnitCd		char(2)
		,@RptHeight		decimal(8,2)
		,@RptWidth		decimal(8,2)
		,@CtrTop		decimal(8,2)
		,@ii			smallint
		,@jj			smallint
		,@ColGroup		smallint
		,@HdRptTblId	int
		,@DtRptTblId	int
		,@FtRptTblId	int
		,@RptTblId		int
		,@AggregateCd	char(1)
		,@RptCelId		int
		,@HRptCelId		int
		,@GRptCelId		int
		,@PRptCelId		int
		,@G1ColSpan		smallint
		,@G2ColSpan		smallint
		,@G3ColSpan		smallint
		,@FtColSpan		smallint
		,@TotColSpan	smallint
		,@FirstAggr		smallint
		,@ColSelect		smallint
		,@RptStyleId	int
		,@DataType		tinyint
		,@GrpPr1		int
		,@GrpPr2		int
		,@GrpPr3		int
		,@GrpHd1		int
		,@GrpHd2		int
		,@GrpHd3		int
		,@GrpFt1		int
		,@GrpFt2		int
		,@GrpFt3		int
		,@ReportObjId	int
		,@RptChaTypeCd	char(2)
SET NOCOUNT ON
IF (SELECT COUNT(1) FROM dbo.RptStyle) <= 0 EXEC dbo.MkRptStyle
SELECT @ReportId = ReportId, @UnitCd = UnitCd, @RptChaTypeCd = RptChaTypeCd
	, @RptHeight = case when OrientationCd <> 'P' then (case when UnitCd = 'in' then 7.0 when UnitCd = 'cm' then 17.78 else 177.8 end)
		else (case when UnitCd = 'in' then 9.5 when UnitCd = 'cm' then 24.13 else 241.3 end) end - TopMargin - BottomMargin
	, @RptWidth = case when OrientationCd = 'P' then (case when UnitCd = 'in' then 8.5 when UnitCd = 'cm' then 21.59 else 215.9 end)
		else (case when UnitCd = 'in' then 11.0 when UnitCd = 'cm' then 27.94 else 279.4 end) end - LeftMargin - RightMargin
	FROM dbo.Rptwiz WHERE RptwizId = @RptwizId
/* Make Parent control */
IF @RptChaTypeCd is null SELECT @CtrTop = 0.0 ELSE SELECT @CtrTop = @RptHeight
INSERT dbo.UtRptCtr (RptElmId, ReportId, RptCtrTypeCd, RptCtrName, CtrTop, CtrLeft, CtrHeight, CtrWidth, CtrPgBrStart, CtrPgBrEnd, CtrCanGrow, CtrCanShrink, CtrTogether)
	SELECT @RptElmId, @ReportId, 'T', 'TTbl', @CtrTop, 0.00, @RptHeight, @RptWidth, 'N', 'N', 'N', 'N', 'N'
SELECT @PRptCtrId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCtr @PRptCtrId
/* Define table header */
INSERT dbo.UtRptTbl (RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder) SELECT @PRptCtrId, @ReportId, 'H', 'Y', 10
SELECT @HdRptTblId = @@IDENTITY EXEC dbo.Ir_UpdUtRptTbl @HdRptTblId
/* Define table detail */
INSERT dbo.UtRptTbl (RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder) SELECT @PRptCtrId, @ReportId, 'D', 'N', 20
SELECT @DtRptTblId = @@IDENTITY EXEC dbo.Ir_UpdUtRptTbl @DtRptTblId
/* Define table footer */
INSERT dbo.UtRptTbl (RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder) SELECT @PRptCtrId, @ReportId, 'F', 'N', 30
SELECT @FtRptTblId = @@IDENTITY EXEC dbo.Ir_UpdUtRptTbl @FtRptTblId
SELECT @GrpWidth = case when @UnitCd = 'in' then 0.2 when @UnitCd = 'cm' then 0.51 else 5.08 end
/* Get the total column width ahead of time */
SELECT @TotWidth = sum(case when a.ColGroup is null then isnull(c.ColWidth,case when @UnitCd = 'in' then 1.0 when @UnitCd = 'cm' then 2.54 else 25.4 end) else @GrpWidth end)
FROM dbo.RptwizDtl a
INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
LEFT OUTER JOIN (SELECT x.ColumnId
	, ColWidth = round(avg(case when @UnitCd = 'in' then x.ColumnSize/150.0 when @UnitCd = 'cm' then x.ColumnSize/150.0*2.54 else x.ColumnSize/150.0*25.4 end),2)
	FROM dbo.ScreenObj x GROUP BY x.ColumnId) c ON b.ColumnId = c.ColumnId
WHERE a.RptwizId = @RptwizId AND a.ColSelect is not null
SELECT @ii = 200, @jj = 100, @PRptCelId = null
SELECT @GrpPr1 = null, @GrpPr2 = null, @GrpPr3 = null, @GrpHd1 = null, @GrpHd2 = null, @GrpHd3 = null, @GrpFt1 = null, @GrpFt2 = null, @GrpFt3 = null
SELECT @G1RptCtrId = null, @G2RptCtrId = null, @G3RptCtrId = null
SELECT @G1ColSpan = count(1) FROM dbo.RptwizDtl WHERE RptwizId = @RptwizId AND ColSelect is not null AND ColGroup = 1
SELECT @G2ColSpan = count(1) FROM dbo.RptwizDtl WHERE RptwizId = @RptwizId AND ColSelect is not null AND ColGroup = 2
SELECT @G3ColSpan = count(1) FROM dbo.RptwizDtl WHERE RptwizId = @RptwizId AND ColSelect is not null AND ColGroup = 3
SELECT @FirstAggr = min(ColSelect) FROM dbo.RptwizDtl WHERE RptwizId = @RptwizId AND ColSelect is not null AND ColGroup is null AND AggregateCd is not null
IF @FirstAggr is null
	SELECT @FirstAggr = min(ColSelect) FROM dbo.RptwizDtl WHERE RptwizId = @RptwizId AND ColSelect is not null AND ColGroup is null
SELECT @FtColSpan = count(1) FROM dbo.RptwizDtl WHERE RptwizId = @RptwizId AND ColSelect is not null AND ColGroup is null AND ColSelect < @FirstAggr
SELECT @TotColSpan = count(1) FROM dbo.RptwizDtl WHERE RptwizId = @RptwizId AND ColSelect is not null
DECLARE cur2 CURSOR FAST_FORWARD FOR
	SELECT a.ColGroup, a.ColSelect, a.ColumnId, b.ColumnName, b.DataType, r.ReportObjId, a.AggregateCd
		, CtrWidth = case when a.ColGroup is not null then @GrpWidth else isnull(d.ColWidth,case when @UnitCd = 'in' then 1.0 when @UnitCd = 'cm' then 2.54 else 25.4 end) end
	FROM dbo.RptwizDtl a
	INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
	INNER JOIN dbo.Rptwiz c ON a.RptwizId = c.RptwizId
	LEFT OUTER JOIN dbo.UtReportObj r ON b.ColumnName = r.ColumnName AND c.ReportId = r.ReportId
	LEFT OUTER JOIN (SELECT x.ColumnId
		, ColWidth = round(avg(case when @UnitCd = 'in' then x.ColumnSize/150.0 when @UnitCd = 'cm' then x.ColumnSize/150.0*2.54 else x.ColumnSize/150.0*25.4 end),2)
		FROM dbo.ScreenObj x GROUP BY x.ColumnId) d ON b.ColumnId = d.ColumnId
	WHERE a.RptwizId = @RptwizId AND a.ColSelect is not null ORDER BY a.ColSelect
FOR READ ONLY
OPEN cur2 FETCH NEXT FROM cur2 INTO @ColGroup, @ColSelect, @ColumnId, @ColumnName, @DataType, @ReportObjId, @AggregateCd, @CtrWidth
WHILE @@FETCH_STATUS = 0
BEGIN
	/* Table column */
	INSERT dbo.UtRptTbl (RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder, ColWidth) SELECT @PRptCtrId, @ReportId, 'C', 'N', @ii, round(@CtrWidth/@TotWidth*@RptWidth,2)
	SELECT @RptTblId = @@IDENTITY
	EXEC dbo.Ir_UpdUtRptTbl @RptTblId
	SELECT @RptStyleId = RptStyleId FROM dbo.RptStyle WHERE DefaultCd = case when @DataType in (12,16,21) then 'GD' when @DataType = 7 then 'GM' when @DataType in (1,2,3,4,5,6,18) then 'GN' else 'GS' end
	IF @ColGroup = 1
	BEGIN
		IF @GrpPr1 is null
		BEGIN
			INSERT dbo.UtRptTbl (RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder, TblGrouping) SELECT @PRptCtrId, @ReportId, 'G', 'N', @jj, @ReportObjId
			SELECT @GrpPr1 = @@IDENTITY EXEC dbo.Ir_UpdUtRptTbl @GrpPr1
		END
		IF @GrpHd1 is null
		BEGIN
			INSERT dbo.UtRptTbl (ParentId, RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder) SELECT @GrpPr1, @PRptCtrId, @ReportId, 'H', 'N', @jj
			SELECT @GrpHd1 = @@IDENTITY EXEC dbo.Ir_UpdUtRptTbl @GrpHd1
		END
		IF @GrpFt1 is null
		BEGIN
			INSERT dbo.UtRptTbl (ParentId, RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder) SELECT @GrpPr1, @PRptCtrId, @ReportId, 'F', 'N', @jj
			SELECT @GrpFt1 = @@IDENTITY EXEC dbo.Ir_UpdUtRptTbl @GrpFt1
		END
		IF @G1RptCtrId is null
		BEGIN
			INSERT dbo.UtRptCel (RptTblId, RowNum, RowHeight, CelNum, CelColSpan) SELECT @GrpHd1, 1, case when @UnitCd = 'in' then 0.22 when @UnitCd = 'cm' then 0.56 else 5.59 end, @RptTblId, @TotColSpan
			SELECT @HRptCelId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCel @HRptCelId
			INSERT dbo.UtRptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @HRptCelId, @ReportId, 'X', 'G1h' + right('00' + convert(varchar,@jj),3), @RptStyleId, 'N', 'N', '=Parameters!L_' + @ColumnName + '.Value &amp; ": " &amp; Fields!' + @ColumnName + '.Value', 'N', 'N', 'N'
			SELECT @G1RptCtrId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCtr @G1RptCtrId
			INSERT dbo.UtRptCel (RptTblId, RowNum, RowHeight, CelNum, CelColSpan) SELECT @GrpFt1, 1, case when @UnitCd = 'in' then 0.35 when @UnitCd = 'cm' then 0.89 else 8.89 end, @RptTblId, @G1ColSpan + @G2ColSpan + @G3ColSpan + @FtColSpan
			SELECT @GRptCelId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCel @GRptCelId
			INSERT dbo.UtRptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @GRptCelId, @ReportId, 'X', 'G1f' + right('00' + convert(varchar,@jj),3), @RptStyleId, 'N', 'N'
				, case when (SELECT count(1) FROM dbo.RptwizDtl WHERE RptwizId = @RptwizId AND ColSelect is not null AND AggregateCd is not null) > 0 then '="Total " &amp; Fields!' else null end + @ColumnName + '.Value', 'N', 'N', 'N'
			EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
		END
		ELSE UPDATE dbo.UtRptCtr SET CtrValue = CtrValue + ' &amp; " | " &amp; Parameters!L_' + @ColumnName + '.Value &amp; ": " &amp; Fields!' + @ColumnName + '.Value' WHERE RptCtrId = @G1RptCtrId
	END
	ELSE IF @ColGroup = 2
	BEGIN
		IF @GrpPr2 is null
		BEGIN
			INSERT dbo.UtRptTbl (RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder, TblGrouping) SELECT @PRptCtrId, @ReportId, 'G', 'N', @jj, @ReportObjId
			SELECT @GrpPr2 = @@IDENTITY EXEC dbo.Ir_UpdUtRptTbl @GrpPr2
		END
		IF @GrpHd2 is null
		BEGIN
			INSERT dbo.UtRptTbl (ParentId, RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder) SELECT @GrpPr2, @PRptCtrId, @ReportId, 'H', 'N', @jj
			SELECT @GrpHd2 = @@IDENTITY EXEC dbo.Ir_UpdUtRptTbl @GrpHd2
		END
		IF @GrpFt2 is null
		BEGIN
			INSERT dbo.UtRptTbl (ParentId, RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder) SELECT @GrpPr2, @PRptCtrId, @ReportId, 'F', 'N', @jj
			SELECT @GrpFt2 = @@IDENTITY EXEC dbo.Ir_UpdUtRptTbl @GrpFt2
		END
		IF @G2RptCtrId is null
		BEGIN
			/* Indent */
			INSERT dbo.UtRptCel (RptTblId, RowNum, RowHeight, CelNum, CelColSpan) SELECT @GrpHd2, 1, case when @UnitCd = 'in' then 0.22 when @UnitCd = 'cm' then 0.56 else 5.59 end, @RptTblId, @G1ColSpan
			SELECT @HRptCelId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCel @HRptCelId
			INSERT dbo.UtRptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrVisibility, CtrPgBrStart, CtrPgBrEnd, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @HRptCelId, @ReportId, 'X', 'G2h' + right('00' + convert(varchar,@jj-1),3), @RptStyleId, 'Y', 'N', 'N', 'N', 'N', 'N'
			EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
			INSERT dbo.UtRptCel (RptTblId, RowNum, RowHeight, CelNum, CelColSpan) SELECT @GrpHd2, 1, case when @UnitCd = 'in' then 0.22 when @UnitCd = 'cm' then 0.56 else 5.59 end, @RptTblId, @TotColSpan - @G1ColSpan
			SELECT @HRptCelId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCel @HRptCelId
			INSERT dbo.UtRptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @HRptCelId, @ReportId, 'X', 'G2h' + right('00' + convert(varchar,@jj),3), @RptStyleId, 'N', 'N', '=Parameters!L_' + @ColumnName + '.Value &amp; ": " &amp; Fields!' + @ColumnName + '.Value', 'N', 'N', 'N'
			SELECT @G2RptCtrId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCtr @G2RptCtrId
			/* Indent */
			INSERT dbo.UtRptCel (RptTblId, RowNum, RowHeight, CelNum, CelColSpan) SELECT @GrpFt2, 1, case when @UnitCd = 'in' then 0.35 when @UnitCd = 'cm' then 0.89 else 8.89 end, @RptTblId, @G1ColSpan
			SELECT @GRptCelId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCel @GRptCelId
			INSERT dbo.UtRptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrVisibility, CtrPgBrStart, CtrPgBrEnd, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @GRptCelId, @ReportId, 'X', 'G2f' + right('00' + convert(varchar,@jj-1),3), @RptStyleId, 'Y', 'N', 'N', 'N', 'N', 'N'
			EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
			INSERT dbo.UtRptCel (RptTblId, RowNum, RowHeight, CelNum, CelColSpan) SELECT @GrpFt2, 1, case when @UnitCd = 'in' then 0.35 when @UnitCd = 'cm' then 0.89 else 8.89 end, @RptTblId, @G2ColSpan + @G3ColSpan + @FtColSpan
			SELECT @GRptCelId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCel @GRptCelId
			INSERT dbo.UtRptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @GRptCelId, @ReportId, 'X', 'G2f' + right('00' + convert(varchar,@jj),3), @RptStyleId, 'N', 'N'
				, case when (SELECT count(1) FROM dbo.RptwizDtl WHERE RptwizId = @RptwizId AND ColSelect is not null AND AggregateCd is not null) > 0 then '="Total " &amp; Fields!' else null end + @ColumnName + '.Value', 'N', 'N', 'N'
			EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
		END
		ELSE UPDATE dbo.UtRptCtr SET CtrValue = CtrValue + ' &amp; " | " &amp; Parameters!L_' + @ColumnName + '.Value &amp; ": " &amp; Fields!' + @ColumnName + '.Value' WHERE RptCtrId = @G2RptCtrId
	END
	ELSE IF @ColGroup = 3
	BEGIN
		IF @GrpPr3 is null
		BEGIN
			INSERT dbo.UtRptTbl (RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder, TblGrouping) SELECT @PRptCtrId, @ReportId, 'G', 'N', @jj, @ReportObjId
			SELECT @GrpPr3 = @@IDENTITY EXEC dbo.Ir_UpdUtRptTbl @GrpPr3
		END
		IF @GrpHd3 is null
		BEGIN
			INSERT dbo.UtRptTbl (ParentId, RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder) SELECT @GrpPr3, @PRptCtrId, @ReportId, 'H', 'N', @jj
			SELECT @GrpHd3 = @@IDENTITY EXEC dbo.Ir_UpdUtRptTbl @GrpHd3
		END
		IF @GrpFt3 is null
		BEGIN
			INSERT dbo.UtRptTbl (ParentId, RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder) SELECT @GrpPr3, @PRptCtrId, @ReportId, 'F', 'N', @jj
			SELECT @GrpFt3 = @@IDENTITY EXEC dbo.Ir_UpdUtRptTbl @GrpFt3
		END
		IF @G3RptCtrId is null
		BEGIN
			/* indent */
			INSERT dbo.UtRptCel (RptTblId, RowNum, RowHeight, CelNum, CelColSpan) SELECT @GrpHd3, 1, case when @UnitCd = 'in' then 0.22 when @UnitCd = 'cm' then 0.56 else 5.59 end, @RptTblId, @G1ColSpan + @G2ColSpan
			SELECT @HRptCelId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCel @HRptCelId
			INSERT dbo.UtRptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrVisibility, CtrPgBrStart, CtrPgBrEnd, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @HRptCelId, @ReportId, 'X', 'G3h' + right('00' + convert(varchar,@jj-1),3), @RptStyleId, 'Y', 'N', 'N', 'N', 'N', 'N'
			EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
			INSERT dbo.UtRptCel (RptTblId, RowNum, RowHeight, CelNum, CelColSpan) SELECT @GrpHd3, 1, case when @UnitCd = 'in' then 0.22 when @UnitCd = 'cm' then 0.56 else 5.59 end, @RptTblId, @TotColSpan - @G1ColSpan - @G2ColSpan
			SELECT @HRptCelId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCel @HRptCelId
			INSERT dbo.UtRptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @HRptCelId, @ReportId, 'X', 'G3h' + right('00' + convert(varchar,@jj),3), @RptStyleId, 'N', 'N', '=Parameters!L_' + @ColumnName + '.Value &amp; ": " &amp; Fields!' + @ColumnName + '.Value', 'N', 'N', 'N'
			SELECT @G3RptCtrId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCtr @G3RptCtrId
			/* indent */
			INSERT dbo.UtRptCel (RptTblId, RowNum, RowHeight, CelNum, CelColSpan) SELECT @GrpFt3, 1, case when @UnitCd = 'in' then 0.35 when @UnitCd = 'cm' then 0.89 else 8.89 end, @RptTblId, @G1ColSpan + @G2ColSpan
			SELECT @GRptCelId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCel @GRptCelId
			INSERT dbo.UtRptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrVisibility, CtrPgBrStart, CtrPgBrEnd, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @GRptCelId, @ReportId, 'X', 'G3' + right('00' + convert(varchar,@jj-1),3), @RptStyleId, 'Y', 'N', 'N', 'N', 'N', 'N'
			EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
			INSERT dbo.UtRptCel (RptTblId, RowNum, RowHeight, CelNum, CelColSpan) SELECT @GrpFt3, 1, case when @UnitCd = 'in' then 0.35 when @UnitCd = 'cm' then 0.89 else 8.89 end, @RptTblId, @G3ColSpan + @FtColSpan
			SELECT @GRptCelId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCel @GRptCelId
			INSERT dbo.UtRptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @GRptCelId, @ReportId, 'X', 'G3' + right('00' + convert(varchar,@jj),3), @RptStyleId, 'N', 'N'
				, case when (SELECT count(1) FROM dbo.RptwizDtl WHERE RptwizId = @RptwizId AND ColSelect is not null AND AggregateCd is not null) > 0 then '="Total " &amp; Fields!' else null end + @ColumnName + '.Value', 'N', 'N', 'N'
			EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
		END
		ELSE UPDATE dbo.UtRptCtr SET CtrValue = CtrValue + ' &amp; " | " &amp; Parameters!L_' + @ColumnName + '.Value &amp; ": " &amp; Fields!' + @ColumnName + '.Value' WHERE RptCtrId = @G3RptCtrId
	END
	/* Define table header cell */
	INSERT dbo.UtRptCel (RptTblId, RowNum, RowHeight, CelNum) SELECT @HdRptTblId, 1, case when @UnitCd = 'in' then 0.25 when @UnitCd = 'cm' then 0.64 else 6.35 end, @RptTblId
	SELECT @RptCelId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCel @RptCelId
	/* Define table header control */
	SELECT @RptStyleId = RptStyleId FROM dbo.RptStyle WHERE DefaultCd = 'CH'
	INSERT dbo.UtRptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrVisibility, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
		SELECT @RptCelId, @ReportId, 'X', 'Hd' + right('00' + convert(varchar,@ii),3), @RptStyleId, case when @ColGroup is null then 'N' else 'Y' end, 'N', 'N', case when @ColGroup is null then '=Parameters!L_' + @ColumnName + '.Value' else null end, 'N', 'N', 'N'
	EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
	/* Define table detail cell */
	INSERT dbo.UtRptCel (RptTblId, RowNum, RowHeight, CelNum) SELECT @DtRptTblId, 1, case when @UnitCd = 'in' then 0.2 when @UnitCd = 'cm' then 0.51 else 5.08 end, @RptTblId
	SELECT @RptCelId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCel @RptCelId
	/* Define table detail control */
	SELECT @RptStyleId = RptStyleId FROM dbo.RptStyle WHERE DefaultCd = case when @DataType in (12,16,21) then 'CD' when @DataType = 7 then 'CM' when @DataType in (1,2,3,4,5,6,18) then 'CN' else 'CS' end
	INSERT dbo.UtRptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrVisibility, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
		SELECT @RptCelId, @ReportId, 'X', 'Dt' + right('00' + convert(varchar,@ii),3), @RptStyleId, case when @ColGroup is null then 'N' else 'Y' end, 'N', 'N', case when @ColGroup is null then '=Fields!' + @ColumnName + '.Value' else null end, 'N', 'N', 'N'
	EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
	/* Define first table footer */
	SELECT @RptStyleId = RptStyleId FROM dbo.RptStyle WHERE DefaultCd = case when @DataType in (12,16,21) then 'GD' when @DataType = 7 then 'GM' when @DataType in (1,2,3,4,5,6,18) then 'GN' else 'GS' end
	IF @PRptCelId is null AND @G1ColSpan + @G2ColSpan + @G3ColSpan + @FtColSpan > 0
	BEGIN
		INSERT dbo.UtRptCel (RptTblId, RowNum, RowHeight, CelNum, CelColSpan) SELECT @FtRptTblId, 1, case when @UnitCd = 'in' then 0.35 when @UnitCd = 'cm' then 0.89 else 8.89 end, @RptTblId, @G1ColSpan + @G2ColSpan + @G3ColSpan + @FtColSpan
		SELECT @PRptCelId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCel @PRptCelId
		INSERT dbo.UtRptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
		SELECT @PRptCelId, @ReportId, 'X', 'Ft' + right('00' + convert(varchar,@ii),3), @RptStyleId, 'N', 'N'
			, case when (SELECT count(1) FROM dbo.RptwizDtl WHERE RptwizId = @RptwizId AND ColSelect is not null AND AggregateCd is not null) > 0 then '="GRAND TOTAL"' else null end, 'N', 'N', 'N'
		EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
	END
	IF @ColGroup is null AND @ColSelect >= @FirstAggr
	BEGIN
		/* Define the rest of table footer */
		INSERT dbo.UtRptCel (RptTblId, RowNum, RowHeight, CelNum) SELECT @FtRptTblId, 1, case when @UnitCd = 'in' then 0.35 when @UnitCd = 'cm' then 0.89 else 8.89 end, @RptTblId
		SELECT @PRptCelId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCel @PRptCelId
		INSERT dbo.UtRptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
		SELECT @PRptCelId, @ReportId, 'X', 'Ft' + right('00' + convert(varchar,@ii),3), @RptStyleId, 'N', 'N'
			, case when @AggregateCd is null then null when @AggregateCd = 'S' then '=SUM' when @AggregateCd = 'M' then '=MAX' when @AggregateCd = 'I' then '=MIN' when @AggregateCd = 'C' then '=COUNT' else '=AVG' end + '(Fields!' + @ColumnName + '.Value)', 'N', 'N', 'N'
		EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
		/* Define group footer controls */
		IF @GrpFt1 is not null
		BEGIN
			INSERT dbo.UtRptCel (RptTblId, RowNum, RowHeight, CelNum) SELECT @GrpFt1, 1, case when @UnitCd = 'in' then 0.35 when @UnitCd = 'cm' then 0.89 else 8.89 end, @RptTblId
			SELECT @GRptCelId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCel @GRptCelId
			INSERT dbo.UtRptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @GRptCelId, @ReportId, 'X', 'G1' + right('00' + convert(varchar,@ii),3), @RptStyleId, 'N', 'N'
				, case when @AggregateCd is null then null when @AggregateCd = 'S' then '=SUM' when @AggregateCd = 'M' then '=MAX' when @AggregateCd = 'I' then '=MIN' when @AggregateCd = 'C' then '=COUNT' else '=AVG' end + '(Fields!' + @ColumnName + '.Value)', 'N', 'N', 'N'
			EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
		END
		IF @GrpFt2 is not null
		BEGIN
			INSERT dbo.UtRptCel (RptTblId, RowNum, RowHeight, CelNum) SELECT @GrpFt2, 1, case when @UnitCd = 'in' then 0.35 when @UnitCd = 'cm' then 0.89 else 8.89 end, @RptTblId
			SELECT @GRptCelId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCel @GRptCelId
			INSERT dbo.UtRptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @GRptCelId, @ReportId, 'X', 'G2' + right('00' + convert(varchar,@ii),3), @RptStyleId, 'N', 'N'
				, case when @AggregateCd is null then null when @AggregateCd = 'S' then '=SUM' when @AggregateCd = 'M' then '=MAX' when @AggregateCd = 'I' then '=MIN' when @AggregateCd = 'C' then '=COUNT' else '=AVG' end + '(Fields!' + @ColumnName + '.Value)', 'N', 'N', 'N'
			EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
		END
		IF @GrpFt3 is not null
		BEGIN
			INSERT dbo.UtRptCel (RptTblId, RowNum, RowHeight, CelNum) SELECT @GrpFt3, 1, case when @UnitCd = 'in' then 0.35 when @UnitCd = 'cm' then 0.89 else 8.89 end, @RptTblId
			SELECT @GRptCelId = @@IDENTITY EXEC dbo.Ir_UpdUtRptCel @GRptCelId
			INSERT dbo.UtRptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @GRptCelId, @ReportId, 'X', 'G3' + right('00' + convert(varchar,@ii),3), @RptStyleId, 'N', 'N'
				, case when @AggregateCd is null then null when @AggregateCd = 'S' then '=SUM' when @AggregateCd = 'M' then '=MAX' when @AggregateCd = 'I' then '=MIN' when @AggregateCd = 'C' then '=COUNT' else '=AVG' end + '(Fields!' + @ColumnName + '.Value)', 'N', 'N', 'N'
			EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
		END
	END
	SELECT @ii = @ii + 10, @jj = @jj + 5
	FETCH NEXT FROM cur2 INTO @ColGroup, @ColSelect, @ColumnId, @ColumnName, @DataType, @ReportObjId, @AggregateCd, @CtrWidth
END
CLOSE cur2 DEALLOCATE cur2
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.MkReportUpd') AND type='P')
DROP PROCEDURE dbo.MkReportUpd
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[MkReportUpd]
 @GenPrefix		varchar(10)
,@reportId		int
,@procedureName	varchar(200)
,@appDatabase	varchar(50)
,@sysDatabase	varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @DeclareClause		varchar(8000)
		,@ProcUpdSql		varchar(8000)
		,@DropUpdSql		varchar(8000)
		,@ExeUpdClause		varchar(8000)
		,@ProcMemSql		varchar(8000)
		,@DropMemSql		varchar(8000)
		,@ExeMemClause		varchar(8000)
		,@ColumnName		varchar(50)
		,@DataTypeSqlName	varchar(50)
		,@DataTypeSize		smallint
SET NOCOUNT ON
SELECT @DeclareClause = '', @ExeUpdClause = ''
SELECT @ExeMemClause = CHAR(13) + 'IF @RptMemCriId is null'
	+ CHAR(13) +'BEGIN'
	+ CHAR(13) + CHAR(9) + 'INSERT ' + @sysDatabase + '.dbo.' + @GenPrefix + 'RptMemCri (ReportId, RptMemFldId, RptMemCriName, RptMemCriDesc, RptMemCriLink, UsrId, InputBy, InputOn)'
	+ CHAR(13) + CHAR(9) + CHAR(9) + 'SELECT @ReportId, @RptMemFldId, @RptMemCriName, @RptMemCriDesc, @RptMemCriLink, CASE WHEN @PublicAccess = ''''P'''' THEN null ELSE @UsrId END, @UsrId, getdate()'
	+ CHAR(13) + CHAR(9) + 'SELECT @RptMemCriId = @@IDENTITY'
	+ CHAR(13) + 'END'
	+ CHAR(13) + 'ELSE UPDATE ' + @sysDatabase + '.dbo.' + @GenPrefix + 'RptMemCri SET'
	+ CHAR(13) + CHAR(9) + ' RptMemFldId = @RptMemFldId, RptMemCriName = @RptMemCriName'
	+ CHAR(13) + CHAR(9) + ',RptMemCriDesc = @RptMemCriDesc, RptMemCriLink = @RptMemCriLink'
	+ CHAR(13) + CHAR(9) + ',UsrId = CASE WHEN @PublicAccess = ''''P'''' THEN null ELSE @UsrId END'
	+ CHAR(13) + CHAR(9) + ',ModifiedOn = getdate() WHERE RptMemCriId = @RptMemCriId'
IF @GenPrefix = 'Ut'
BEGIN
	DECLARE objCursor CURSOR FOR SELECT a.ColumnName, b.DataTypeSqlName, a.DataTypeSize
	FROM dbo.UtReportCri a INNER JOIN RODesign.dbo.CtDataType b ON a.DataTypeId = b.DataTypeId
	WHERE a.ReportId = @reportId
	ORDER BY a.TabIndex FOR READ ONLY
END
ELSE
BEGIN
	DECLARE objCursor CURSOR FOR SELECT a.ColumnName, b.DataTypeSqlName, a.DataTypeSize
	FROM dbo.ReportCri a INNER JOIN RODesign.dbo.CtDataType b ON a.DataTypeId = b.DataTypeId
	WHERE a.ReportId = @reportId
	ORDER BY a.TabIndex FOR READ ONLY
END
OPEN objCursor
FETCH NEXT FROM objCursor INTO @ColumnName, @DataTypeSqlName, @DataTypeSize
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @DeclareClause = @DeclareClause + CHAR(13) + ',@' + @ColumnName + ' ' + @DataTypeSqlName
	IF charindex('char',lower(@DataTypeSqlName)) > 0
	BEGIN
		IF @DataTypeSize is not null SELECT @DeclareClause = @DeclareClause + '(' + case when @DataTypeSize > 0 then convert(varchar,@DataTypeSize) else 'max' end + ')'
		ELSE
		BEGIN
			RAISERROR('Please specify character size for column "%s".',18,2,@ColumnName) WITH SETERROR
			RETURN 1
		END
	END
	IF charindex('datetime',lower(@DataTypeSqlName)) > 0
	BEGIN
		SELECT @ExeUpdClause = @ExeUpdClause + CHAR(13) + 'SELECT @cri = convert(nvarchar,convert(datetime,@' + @ColumnName + '),102)'
		+ CHAR(13) + 'EXEC ' + @sysDatabase + '.dbo.Upd' + @GenPrefix + 'ReportLstCri @reportId, ''''' + @ColumnName + ''''', @usrId, @cri'
		SELECT @ExeMemClause = @ExeMemClause + CHAR(13) + 'SELECT @cri = convert(nvarchar,convert(datetime,@' + @ColumnName + '),102)'
		+ CHAR(13) + 'EXEC ' + @sysDatabase + '.dbo.Upd' + @GenPrefix + 'RptMemCri @RptMemCriId, @reportId, ''''' + @ColumnName + ''''', @cri'
	END
	ELSE IF charindex('char',lower(@DataTypeSqlName)) <= 0
	BEGIN
		SELECT @ExeUpdClause = @ExeUpdClause + CHAR(13) + 'SELECT @cri = convert(nvarchar,@' + @ColumnName + ')'
		+ CHAR(13) + 'EXEC ' + @sysDatabase + '.dbo.Upd' + @GenPrefix + 'ReportLstCri @reportId, ''''' + @ColumnName + ''''', @usrId, @cri'
		SELECT @ExeMemClause = @ExeMemClause + CHAR(13) + 'SELECT @cri = convert(nvarchar,@' + @ColumnName + ')'
		+ CHAR(13) + 'EXEC ' + @sysDatabase + '.dbo.Upd' + @GenPrefix + 'RptMemCri @RptMemCriId, @reportId, ''''' + @ColumnName + ''''', @cri'
	END
	ELSE
	BEGIN
		SELECT @ExeUpdClause = @ExeUpdClause + CHAR(13) + 'EXEC ' + @sysDatabase + '.dbo.Upd' + @GenPrefix + 'ReportLstCri @reportId, ''''' + @ColumnName + ''''', @usrId, @' + @ColumnName
		SELECT @ExeMemClause = @ExeMemClause + CHAR(13) + 'EXEC ' + @sysDatabase + '.dbo.Upd' + @GenPrefix + 'RptMemCri @RptMemCriId, @reportId, ''''' + @ColumnName + ''''', @' + @ColumnName
	END
	FETCH NEXT FROM objCursor INTO @ColumnName, @DataTypeSqlName, @DataTypeSize
END
CLOSE objCursor
DEALLOCATE objCursor
SELECT @ProcUpdSql = 'CREATE PROCEDURE Upd' + @procedureName + CHAR(13)
+ ' @reportId int' + CHAR(13) + ',@usrId int' + @DeclareClause + CHAR(13)
+ '/* WITH ENCRYPTION */' + CHAR(13) + 'AS' + CHAR(13)
+ 'DECLARE @cri nvarchar(900)' + CHAR(13)
+ 'SET NOCOUNT ON' + @ExeUpdClause + CHAR(13)
+ 'SELECT 0' + CHAR(13) + 'RETURN 0' + CHAR(13)
IF @ProcUpdSql IS NULL
	RAISERROR('Stored Procedure Upd%s not generated.',18,2,@procedureName) WITH SETERROR
ELSE
BEGIN
	SELECT @DropUpdSql = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''Upd' + @procedureName + ''''') AND type = ''''P'''') DROP PROCEDURE Upd' + @procedureName
	-- USE Database is not allowed!  Needs to be replaced by Dynamic EXECUTION.
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @DropUpdSql + '''')
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @ProcUpdSql + '''')
END
SELECT @ProcMemSql = 'CREATE PROCEDURE Mem' + @procedureName + CHAR(13)
+ ' @PublicAccess char(1)' + CHAR(13)
+ ',@RptMemCriId int' + CHAR(13)
+ ',@RptMemFldId int' + CHAR(13)
+ ',@RptMemCriName nvarchar(200)' + CHAR(13)
+ ',@RptMemCriDesc nvarchar(500)' + CHAR(13)
+ ',@RptMemCriLink varchar(200)' + CHAR(13)
+ ',@reportId int' + CHAR(13) + ',@usrId int' + @DeclareClause + CHAR(13)
+ '/* WITH ENCRYPTION */' + CHAR(13) + 'AS' + CHAR(13)
+ 'DECLARE @cri nvarchar(900)' + CHAR(13)
+ 'SET NOCOUNT ON' + @ExeMemClause + CHAR(13)
+ 'SELECT @RptMemCriId' + CHAR(13) + 'RETURN 0' + CHAR(13)
IF @ProcMemSql IS NULL
	RAISERROR('Stored Procedure Mem%s not generated.',18,2,@procedureName) WITH SETERROR
ELSE
BEGIN
	SELECT @DropMemSql = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''Mem' + @procedureName + ''''') AND type = ''''P'''') DROP PROCEDURE Mem' + @procedureName
	-- USE Database is not allowed!  Needs to be replaced by Dynamic EXECUTION.
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @DropMemSql + '''')
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @ProcMemSql + '''')
END
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.MkReportVal') AND type='P')
DROP PROCEDURE dbo.MkReportVal
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





-- Called by WrRptwizGen:
CREATE PROCEDURE [dbo].[MkReportVal]
 @RptwizId		int
,@ProgramName	varchar(50)
,@AppDatabase	varchar(50)
,@ValCode		varchar(8000) OUTPUT
/* WITH ENCRYPTION */
AS
DECLARE	 @ProcDel		varchar(8000)
		,@CriParams		varchar(4000)
		,@SelClause		varchar(4000)
		,@ColumnName	varchar(50)
		,@CriSelect		smallint
		,@DataTypeName	varchar(50)
		,@DataTypeSize	smallint
		,@ColumnScale	tinyint
SET NOCOUNT ON
/* Prepare criteria parameters */
SELECT @CriParams = ''
DECLARE cur1 CURSOR FAST_FORWARD FOR
	SELECT b.ColumnName, a.CriSelect, c.DataTypeSqlName, b.ColumnLength, b.ColumnScale
	FROM dbo.RptwizDtl a
	INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
	INNER JOIN RODesign.dbo.CtDataType c ON b.DataType = c.DataTypeId
	INNER JOIN RODesign.dbo.CtOperator d ON a.CriOperatorId = d.OperatorId
	WHERE a.RptwizId = @RptwizId AND a.CriSelect is not null ORDER BY a.CriSelect
FOR READ ONLY
OPEN cur1 FETCH NEXT FROM cur1 INTO @ColumnName, @CriSelect, @DataTypeName, @DataTypeSize, @ColumnScale
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @CriParams = @CriParams + ',@' + @ColumnName + convert(varchar,@CriSelect) + CHAR(9) + @DataTypeName + case
		when charindex('char',lower(@DataTypeName)) > 0 then '(' + case when @DataTypeSize > 0 then convert(varchar,@DataTypeSize) else 'max' end + ')'
		when @DataTypeName = 'Decimal' then '(' + convert(varchar,@DataTypeSize) + ',' + convert(varchar,@ColumnScale) + ')'
		else '' end + CHAR(13)
	FETCH NEXT FROM cur1 INTO @ColumnName, @CriSelect, @DataTypeName, @DataTypeSize, @ColumnScale
END
CLOSE cur1 DEALLOCATE cur1
SELECT @SelClause = 'ReportName=''''' + replace(RptwizName,' ','') + '_''''' FROM dbo.Rptwiz WHERE RptwizId = @RptwizId
SELECT @ValCode = 'CREATE PROCEDURE dbo._Get' + @ProgramName + 'V' + CHAR(13)
+ ' @wClause' + CHAR(9) + 'nvarchar(max)' + CHAR(13) + @CriParams
+ '/* WITH ENCRYPTION */' + CHAR(13)
+ 'AS' + CHAR(13) + 'DECLARE'
+ CHAR(9) + ' @sClause' + CHAR(9) + CHAR(9) + 'nvarchar(max)' + CHAR(13)
+ 'SET NOCOUNT ON' + CHAR(13)
+ '/* It is mandatory for this procedure to return at least one row */' + CHAR(13)
+ 'SELECT @sClause = ''SELECT ' + @SelClause + '''' + CHAR(13)
+ 'EXEC (@sClause)' + CHAR(13)
+ 'RETURN 0' + CHAR(13)
/* Convert does not work inside EXEC */
SELECT @ProcDel = 'IF exists (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(''''dbo._Get' + @ProgramName + 'V'''') AND type = ''''P'''') DROP PROCEDURE dbo._Get' + @ProgramName + 'V'
EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @ProcDel + '''')
IF @ValCode is null BEGIN RAISERROR('Cannot create _Get stored procedure, please verify foreign keys in data category and try again.',18,2) WITH SETERROR RETURN 1 END
SELECT @ValCode = replace(@ValCode,'''','''''')
EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @ValCode + '''')
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.MkRptStyle') AND type='P')
DROP PROCEDURE dbo.MkRptStyle
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[MkRptStyle]
/* WITH ENCRYPTION */
AS
-- Initialize style table for report generator:
INSERT dbo.RptStyle (RptStyleDesc, BorderStyleD, BorderWidthD, BgColor, FontStyle, FontFamily, FontSize
	, FontWeight, Format, TextAlign, PadLeft, PadRight, PadTop, PadBottom, DefaultCd)
SELECT RptStyleDesc, BorderStyleD, BorderWidthD, BgColor, FontStyle, FontFamily, FontSize
	, FontWeight, Format, TextAlign, PadLeft, PadRight, PadTop, PadBottom, DefaultCd FROM RODesign.dbo.RptStyle
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.MkScrAudit') AND type='P')
DROP PROCEDURE dbo.MkScrAudit
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[MkScrAudit]
 @CudAction		char(1)
,@ScreenId		int
,@MasterTable	char(1)
,@Gen			char(1)
,@MultiDesignDb	char(1)
,@appDatabase	varchar(50)
,@sysDatabase	varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @ProcedureSql		varchar(max)
		,@DropProcedureSql	varchar(max)
		,@ProcedureName		varchar(100)
		,@SearchSql			nvarchar(2000)
		,@TableId			int
		,@TableName			varchar(500)
		,@PkeyCol			varchar(50)
		,@PkeyTyp			varchar(20)
		,@ColumnId			int
		,@ColumnName		varchar(50)
		,@ObjCol			varchar(50)
		,@SqlCol			varchar(50)
		,@SqlTyp			varchar(20)
		,@SqlLen			varchar(10)
		,@SqlScl			varchar(10)
		,@ParamUpd			varchar(max)
		,@ParamSql			varchar(max)
		,@ParamDtl			varchar(max)
		,@ParamNam			varchar(max)
		,@ParamTyp			varchar(max)
		,@ParamCal			varchar(max)
		,@ScreenObjId		int
		,@ColumnHeader		nvarchar(max)
		,@DefCultureId		smallint
		,@UpdTest			varchar(max)
		,@UpdTemp			varchar(max)
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT @PkeyCol = b.ColumnName, @PKeyTyp = c.DataTypeSqlName, @TableId = d.TableId, @TableName = d.TableName
	FROM dbo.Screen a
	INNER JOIN dbo.DbColumn b ON b.TableId = CASE WHEN @MasterTable = 'Y' THEN a.MasterTableId ELSE a.DetailTableId END
	INNER JOIN RODesign.dbo.CtDataType c ON b.DataType = c.DataTypeId
	INNER JOIN dbo.DbTable d ON b.TableId = d.TableId
	WHERE a.ScreenId = @ScreenId AND b.PrimaryKey = 'Y'
IF @PkeyCol is null OR @PkeyCol = ''
BEGIN
	RAISERROR('Stored Procedure Audit_??? not generated because primary key column is not available.',18,2) WITH SETERROR
	RETURN 1
END

SELECT @ParamUpd='', @ParamSql='', @ParamDtl='', @ProcedureSql='', @ParamNam='', @ParamTyp='', @ParamCal='', @UpdTest=''
DECLARE ObjCur CURSOR FOR
	SELECT DISTINCT a.ColumnId, a.ColumnName, b.ColumnName, c.DataTypeSqlName
	, CASE WHEN b.ColumnLength=0 THEN 'max' ELSE convert(varchar(10),b.ColumnLength) END
	, isnull(convert(varchar(10),b.ColumnScale),'0'), a.ScreenObjId, d.ColumnHeader
		FROM dbo.ScreenObj a
		INNER JOIN dbo.Screen e ON a.ScreenId = e.ScreenId
		INNER JOIN dbo.ScreenObjHlp d ON a.ScreenObjId = d.ScreenObjId AND d.CultureId = @DefCultureId
		INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
		INNER JOIN RODesign.dbo.CtDataType c ON b.DataType = c.DataTypeId
		WHERE a.ScreenId = @ScreenId and a.MasterTable = @MasterTable AND a.ColumnId is not null
		AND b.PrimaryKey <> 'Y' AND a.DefAlways <> 'Y' AND CHARINDEX('binary',LOWER(c.DataTypeSqlName)) <= 0
		AND a.DisplayModeId NOT IN (23,24,25,26,27,28,29,36,37,49,50)
		AND b.TableId = CASE WHEN @MasterTable = 'Y' THEN e.MasterTableId ELSE e.DetailTableId END
		ORDER BY a.ScreenObjId
FOR READ ONLY
OPEN ObjCur
FETCH NEXT FROM ObjCur INTO @ColumnId, @ObjCol, @SqlCol, @SqlTyp, @SqlLen, @SqlScl, @ScreenObjId, @ColumnHeader
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @UpdTemp = '(@O' + @SqlCol + ' IS NOT NULL AND @' + @SqlCol + ' IS NULL) OR (@O' + @SqlCol + ' IS NULL AND @' + @SqlCol + ' IS NOT NULL) OR (@O' + @SqlCol + ' <> ' + '@' + @SqlCol + ')'
	SELECT @UpdTest = @UpdTest + ' OR (' + @UpdTemp + ')'
	SELECT @ProcedureSql = @ProcedureSql + CHAR(9) + CHAR(9) + ',@O' + @SqlCol + CHAR(9) + CHAR(9) + @SqlTyp + CASE WHEN CHARINDEX('char',LOWER(@SqlTyp)) > 0 THEN '(' + @SqlLen + ')' WHEN CHARINDEX('decimal',LOWER(@SqlTyp)) > 0 THEN '(' + @SqlLen + ',' + @SqlScl + ')' ELSE '' END + CHAR(13)
	SELECT @ParamNam = @ParamNam + ',' + @SqlCol, @ParamTyp = @ParamTyp + ',' + @SqlTyp, @ParamCal = @ParamCal + ',' + @ObjCol + CONVERT(varchar(10),@TableId)
	SELECT @ParamUpd = @ParamUpd + ',@' + @SqlCol + CHAR(9) + CHAR(9) + @SqlTyp + CASE WHEN CHARINDEX('char',LOWER(@SqlTyp)) > 0 THEN '(' + @SqlLen + ')' WHEN CHARINDEX('decimal',LOWER(@SqlTyp)) > 0 THEN '(' + @SqlLen + ',' + @SqlScl + ')' ELSE '' END + CHAR(13)
	SELECT @ParamSql = @ParamSql + ',@O' + @SqlCol + '=' + @SqlCol
	IF @CudAction='U'
		SELECT @ParamDtl = @ParamDtl + 'IF ' + @UpdTemp + CHAR(13)
	ELSE
		SELECT @ParamDtl = @ParamDtl + 'IF @O' + @SqlCol + ' IS NOT NULL' + CHAR(13)
	SELECT @ParamDtl = @ParamDtl + 'INSERT ' + @sysDatabase + '.dbo.ScrAuditDtl (ScrAuditId,ScreenObjId,ScreenObjDesc,ColumnId,ColumnDesc,Changed' + CASE WHEN @CudAction='A' THEN 'To,ChangedFr)' ELSE 'Fr,ChangedTo)' END + CHAR(13)
	+ CHAR(9) + 'SELECT @ScrAuditId,' + CONVERT(varchar(10),@ScreenObjId) + ',''''' + ISNULL(@ColumnHeader,'') + ''''',' + CONVERT(varchar(10),@ColumnId) + ',''''' + @SqlCol + ''''','
	+ CASE WHEN CHARINDEX('char',LOWER(@SqlTyp)) > 0 THEN '@O' + @SqlCol WHEN CHARINDEX('date',LOWER(@SqlTyp)) > 0 THEN 'CONVERT(varchar(10),@O' + @SqlCol + ',102)' ELSE 'CONVERT(varchar(10),@O' + @SqlCol + ')' END
	+ ',' + CASE WHEN @CudAction='U' THEN CASE WHEN CHARINDEX('char',LOWER(@SqlTyp)) > 0 THEN '@' + @SqlCol WHEN CHARINDEX('date',LOWER(@SqlTyp)) > 0 THEN 'CONVERT(varchar(10),@' + @SqlCol + ',102)' ELSE 'CONVERT(varchar(10),@' + @SqlCol + ')' END ELSE 'NULL' END + CHAR(13)
	FETCH NEXT FROM ObjCur INTO @ColumnId, @ObjCol, @SqlCol, @SqlTyp, @SqlLen, @SqlScl, @ScreenObjId, @ColumnHeader
END
CLOSE ObjCur DEALLOCATE ObjCur
/*
IF @MasterTable = 'Y'
BEGIN
	SELECT @SearchSql = CASE WHEN c.ScreenTypeName='I3' THEN @PkeyCol ELSE b.ColumnName END
	FROM dbo.Screen a
	INNER JOIN RODesign.dbo.CtScreenType c ON a.ScreenTypeId = c.ScreenTypeId
	LEFT OUTER JOIN dbo.DbColumn b ON a.SearchId = b.ColumnId
	WHERE a.ScreenId = @ScreenId
END
ELSE
*/
	SELECT @SearchSql = @PkeyCol
SELECT @ProcedureSql = @ProcedureSql + 'SELECT @SearchCol=' + @SearchSql + @ParamSql + ' FROM dbo.' + @TableName + ' WHERE ' + @PkeyCol + '=@' + @PkeyCol + CHAR(13)
IF @UpdTest <> '' AND @CudAction='U' SELECT @ProcedureSql = @ProcedureSql + 'IF ' + RIGHT(@UpdTest,LEN(@UpdTest)-4) + CHAR(13) + 'BEGIN' + CHAR(13)
SELECT @ProcedureSql = @ProcedureSql + 'INSERT ' + @sysDatabase + '.dbo.ScrAudit (CudAction,ScreenId,MasterTable,TableId,RowId,RowDesc,ChangedBy,ChangedOn)' + CHAR(13)
+ CHAR(9) + 'SELECT ''''' + @CudAction + ''''',' + CONVERT(varchar(10),@ScreenId) + ',''''' + @MasterTable + ''''',' + CONVERT(varchar(10),@TableId) + ',@' + @PkeyCol + ',ISNULL(@SearchCol,''''''''),@UserId,getutcdate()' + CHAR(13)
+ 'SELECT @ScrAuditId = @@IDENTITY' + CHAR(13) + @ParamDtl
IF @UpdTest <> '' AND @CudAction='U' SELECT @ProcedureSql = @ProcedureSql + 'END' + CHAR(13)
SELECT @ProcedureSql = @ProcedureSql + 'RETURN 0' + CHAR(13)

/* Prepare S.proc. */
SELECT @ProcedureName = 'Audit_' + CASE WHEN @CudAction='D' THEN 'Del' WHEN @CudAction='A' THEN 'Add' ELSE 'Upd' END + CONVERT(varchar(10),@ScreenId) + CASE WHEN @MasterTable='Y' THEN 'M' ELSE 'D' END
SELECT @DropProcedureSql = 'IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(''''dbo.' + @ProcedureName + ''''') AND type = ''''P'''') DROP PROCEDURE dbo.' + @ProcedureName

IF @Gen = 'Y'
BEGIN
	SELECT @ProcedureSql = 'CREATE PROCEDURE dbo.' + @ProcedureName + CHAR(13)
	+ ' @' + @PkeyCol + CHAR(9) + CHAR(9) + @PKeyTyp + CHAR(13)
	+ CASE WHEN @CudAction='U' THEN @ParamUpd ELSE '' END
	+ ',@UserId' + CHAR(9) + CHAR(9) + 'int' + CHAR(13)
	+ '/* WITH ENCRYPTION */' + CHAR(13) + 'AS' + CHAR(13) + 'SET NOCOUNT ON' + CHAR(13)
	+ 'DECLARE	 @ScrAuditId' + CHAR(9) + CHAR(9) + 'bigint' + CHAR(13)
	 + CHAR(9) + CHAR(9) + ',@SearchCol' + CHAR(9) + CHAR(9) + 'nvarchar(2000)' + CHAR(13) + @ProcedureSql
	IF @ProcedureSql IS NULL
	BEGIN
		RAISERROR('Stored Procedure Audit_??? not generated because of NULL.',18,2) WITH SETERROR
		RETURN 1
	END
END

/* Execute S.proc. */
IF @MultiDesignDb <> 'Y'
BEGIN
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @DropProcedureSql + '''')
	IF @Gen = 'Y' AND @ProcedureSql IS NOT NULL EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @ProcedureSql + '''')
END
ELSE
BEGIN
	DECLARE syscur CURSOR FAST_FORWARD FOR
		SELECT dbDesDatabase FROM RODesign.dbo.Systems FOR READ ONLY
	OPEN syscur FETCH NEXT FROM syscur INTO @appDatabase
	WHILE @@FETCH_STATUS = 0
	BEGIN
		EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @DropProcedureSql + '''')
		IF @Gen = 'Y' AND @ProcedureSql IS NOT NULL EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @ProcedureSql + '''')
		FETCH NEXT FROM syscur INTO @appDatabase
	END
	CLOSE syscur DEALLOCATE syscur
END

/* Prepare Server Rule */
DELETE FROM dbo.ServerRule WHERE ProcedureName = @ProcedureName

IF @Gen = 'Y'
BEGIN
	INSERT dbo.ServerRule (ScreenId,RuleTypeId,MasterTable,RuleName,RuleDesc,RuleOrder,ProcedureName,ParameterNames,ParameterTypes,CallingParams,OnAdd,OnUpd,OnDel,BeforeCRUD)
		SELECT @ScreenId,4,@MasterTable,'Automated audit trail - ' + CASE WHEN @CudAction='D' THEN 'Del' WHEN @CudAction='A' THEN 'Add' ELSE 'Upd' END
		,isnull(ScreenTitle,space(0)) + ' [' + CASE WHEN @MasterTable = 'Y' THEN 'Master' ELSE 'Detail' END + ': ' + CASE WHEN @CudAction='A' THEN 'After' ELSE 'Before' END + ' CRUD' + '] Automated audit trail - ' + CASE WHEN @CudAction='D' THEN 'Del' WHEN @CudAction='A' THEN 'Add' ELSE 'Upd' END
		,0,@ProcedureName
		,@PkeyCol + CASE WHEN @CudAction='U' THEN @ParamNam ELSE '' END + ',UsrId'
		,@PKeyTyp + CASE WHEN @CudAction='U' THEN @ParamTyp ELSE '' END + ',Int'
		,@PkeyCol + CONVERT(varchar(10),@TableId) + CASE WHEN @CudAction='U' THEN @ParamCal ELSE '' END + ',LUser.UsrId'
		,CASE WHEN @CudAction='A' THEN 'Y' ELSE 'N' END,CASE WHEN @CudAction='U' THEN 'Y' ELSE 'N' END,CASE WHEN @CudAction='D' THEN 'Y' ELSE 'N' END
		,CASE WHEN @CudAction='A' THEN 'N' ELSE 'Y' END
		FROM dbo.ScreenHlp WHERE ScreenId = @ScreenId AND CultureId = @DefCultureId
END
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.MkScreenUpdIn') AND type='P')
DROP PROCEDURE dbo.MkScreenUpdIn
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[MkScreenUpdIn]
 @screenId		int
,@procedureName		varchar(200)
,@appDatabase		varchar(50)
,@sysDatabase		varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @procedureUpdSql	varchar(8000)
	,@dropProcedureSql	varchar(8000)
	,@declareClause		varchar(8000)
	,@execClause		varchar(8000)
	,@ScreenCriId		int
	,@ColumnName		varchar(50)
	,@DataTypeSqlName	varchar(50)
	,@DataTypeSize		smallint
SET NOCOUNT ON
SELECT @declareClause = ''
SELECT @execClause = CHAR(13) + 'EXEC ' + @sysDatabase + '.dbo.UpdScreenLstCri @usrId, @screenId, 0, @isCriVisible'
DECLARE objCursor CURSOR FOR
	SELECT	 a.ScreenCriId, f.ColumnName
		,CASE WHEN c.TypeName='ListBox' THEN 'VarChar' ELSE d.DataTypeSqlName END
		,CASE WHEN c.TypeName='ListBox' THEN 1000 ELSE f.ColumnLength END
	FROM dbo.ScreenCri a
	INNER JOIN dbo.DbColumn f ON a.ColumnId = f.ColumnId
	INNER JOIN RODesign.dbo.CtDataType d ON f.DataType = d.DataTypeId
	INNER JOIN RODesign.dbo.CtDisplayType c ON a.DisplayModeId = c.TypeId
	WHERE a.ScreenId = @screenId ORDER BY a.TabIndex FOR READ ONLY
OPEN objCursor
FETCH NEXT FROM objCursor INTO @ScreenCriId, @ColumnName, @DataTypeSqlName, @DataTypeSize
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @declareClause = @declareClause + CHAR(13) + ',@' + @ColumnName + convert(varchar,@ScreenCriId) + ' ' + @DataTypeSqlName
	IF charindex('char',lower(@DataTypeSqlName)) > 0
	BEGIN
		IF @DataTypeSize is not null SELECT @declareClause = @declareClause + '(' + case when @DataTypeSize > 0 then convert(varchar,@DataTypeSize) else 'max' end + ')'
		ELSE
		BEGIN
			RAISERROR('Please specify character size for column "%s".',18,2,@ColumnName) WITH SETERROR
			RETURN 1
		END
	END
	IF charindex('datetime',lower(@DataTypeSqlName)) > 0
	BEGIN
		SELECT @execClause = @execClause + CHAR(13) + 'SELECT @cri = convert(nvarchar,convert(datetime,@' + @ColumnName + convert(varchar,@ScreenCriId) + '),102)'
		+ CHAR(13) + 'EXEC ' + @sysDatabase + '.dbo.UpdScreenLstCri @usrId, @screenId, ' + convert(varchar,@ScreenCriId) + ', @cri'
	END
	ELSE IF charindex('char',lower(@DataTypeSqlName)) <= 0
	BEGIN
		SELECT @execClause = @execClause + CHAR(13) + 'SELECT @cri = convert(nvarchar,@' + @ColumnName + convert(varchar,@ScreenCriId) + ')'
		+ CHAR(13) + 'EXEC ' + @sysDatabase + '.dbo.UpdScreenLstCri @usrId, @screenId, ' + convert(varchar,@ScreenCriId) + ', @cri'
	END
	ELSE
		SELECT @execClause = @execClause + CHAR(13) + 'EXEC ' + @sysDatabase + '.dbo.UpdScreenLstCri @usrId, @screenId, ' + convert(varchar,@ScreenCriId) + ', @' + @ColumnName + convert(varchar,@ScreenCriId)
	FETCH NEXT FROM objCursor INTO @ScreenCriId, @ColumnName, @DataTypeSqlName, @DataTypeSize
END
CLOSE objCursor
DEALLOCATE objCursor
SELECT @procedureUpdSql = 'CREATE PROCEDURE Upd' + @procedureName + CHAR(13)
+ ' @screenId int' + CHAR(13) + ',@usrId int' + CHAR(13) + ',@isCriVisible char(1)' + @declareClause + CHAR(13)
+ '/* WITH ENCRYPTION */' + CHAR(13) + 'AS' + CHAR(13) + 'DECLARE @cri nvarchar(900)' + CHAR(13)
+ 'SET NOCOUNT ON' + @execClause + CHAR(13)
+ 'RETURN 0' + CHAR(13)
IF @procedureUpdSql IS NULL
BEGIN
	RAISERROR('Stored Procedure Upd%s not generated.',18,2,@procedureName) WITH SETERROR
	RETURN 1
END
ELSE
BEGIN
	SELECT @dropProcedureSql = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''Upd' + @procedureName + ''''') AND type = ''''P'''') DROP PROCEDURE Upd' + @procedureName
	-- USE Database is not allowed!  Needs to be replaced by Dynamic EXECUTION.
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedureSql + '''')
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @procedureUpdSql + '''')
END
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.MkStoredProcedure') AND type='P')
DROP PROCEDURE dbo.MkStoredProcedure
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[MkStoredProcedure]
  @spString1	varchar(max)
, @spString2	varchar(max) = ''
, @spString3	varchar(max) = ''
, @spString4	varchar(max) = ''
, @spString5	varchar(max) = ''
, @spString6	varchar(max) = ''
, @spString7	varchar(max) = ''
, @spString8	varchar(max) = ''
, @spString9	varchar(max) = ''
/* WITH ENCRYPTION */
AS
declare @nl varchar(1) select @nl = CHAR(13)
-- Although PRINT will only print a maximum of max characters, EXEC will execute more than max characters if concatenated as follow.
EXEC ('SET QUOTED_IDENTIFIER ON SET ANSI_NULLS ON' + @nl)
EXEC (@spString1 + @spString2 + @spString3 + @spString4 + @spString5 + @spString6 + @spString7 + @spString8 + @spString9)
EXEC ('SET QUOTED_IDENTIFIER OFF')
RETURN 0
 
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.MkWfStatus') AND type='P')
DROP PROCEDURE dbo.MkWfStatus
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[MkWfStatus]
 @ScreenObjId	int
,@MasterTable	char(1)
,@appDatabase	varchar(50)
,@sysDatabase	varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @ProcedureSql		varchar(max)
		,@DropProcedureSql	varchar(max)
		,@ProcedureName		varchar(100)
		,@ScreenId			int
		,@PkeyCol			varchar(50)
		,@PkeyTyp			varchar(20)
		,@TableId			int
		,@TableName			varchar(50)
		,@ColumnName		varchar(50)
		,@DefCultureId		smallint
		,@IsChar			char(1)
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT @ScreenId = a.ScreenId, @ColumnName = a.ColumnName, @IsChar = CASE WHEN charindex('Char',c.DataTypeSqlName) > 0 THEN 'Y' ELSE 'N' END
	FROM dbo.ScreenObj a
	INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
	INNER JOIN RODesign.dbo.CtDataType c ON b.DataType = c.DataTypeId
	WHERE a.ScreenObjId = @ScreenObjId
SELECT @PkeyCol = b.ColumnName, @PKeyTyp = c.DataTypeSqlName, @TableId = d.TableId, @TableName = d.TableName
	FROM dbo.Screen a
	INNER JOIN dbo.DbColumn b ON b.TableId = CASE WHEN @MasterTable = 'Y' THEN a.MasterTableId ELSE a.DetailTableId END
	INNER JOIN RODesign.dbo.CtDataType c ON b.DataType = c.DataTypeId
	INNER JOIN dbo.DbTable d ON b.TableId = d.TableId
	WHERE a.ScreenId = @ScreenId AND b.PrimaryKey = 'Y'
IF @PkeyCol is null OR @PkeyCol = ''
BEGIN
	RAISERROR('Stored Procedures Wf_Upd??? and Wf_Add??? not generated because primary key column is not available.',18,2) WITH SETERROR
	RETURN 1
END

/* Prepare S.proc Wf_Upd???. */
SELECT @ProcedureName = 'Wf_Upd' + @ColumnName + CONVERT(varchar(10),@ScreenObjId)
SELECT @DropProcedureSql = 'IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(''''dbo.' + @ProcedureName + ''''') AND type = ''''P'''') DROP PROCEDURE dbo.' + @ProcedureName

SELECT @ProcedureSql = 'CREATE PROCEDURE dbo.' + @ProcedureName + CHAR(13)
+ ' @' + @PkeyCol + CHAR(9) + CHAR(9) + @PKeyTyp + CHAR(13)
+ ',@StatusCd' +  + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ ',@UsrId' + CHAR(9) + CHAR(9) + 'int' + CHAR(13)
+ '/* WITH ENCRYPTION */' + CHAR(13) + 'AS' + CHAR(13) + 'SET NOCOUNT ON' + CHAR(13)
+ 'DECLARE	 @OStatusCd' + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13) + CHAR(9) + CHAR(9) + ',@ONStatusLs' + CHAR(9) + CHAR(9) + 'varchar(1000)' + CHAR(13)
+ 'SELECT @OStatusCd = ' + @ColumnName + ' FROM dbo.' + @TableName + ' WHERE ' + @PkeyCol + ' = @' + @PkeyCol + CHAR(13)
+ 'SELECT @ONStatusLs = NStatusLs FROM dbo.' + @ColumnName + ' WHERE StatusCd = @OStatusCd' + CHAR(13)
+ 'IF @ONStatusLs IS NOT NULL AND @OStatusCd <> @StatusCd AND charindex('
+ CASE WHEN @IsChar = 'Y' THEN '''''''''''''''''+@StatusCd+''''''''''''''''' ELSE '@StatusCd' END + ',@ONStatusLs) <= 0' + CHAR(13)
+ 'BEGIN' + CHAR(13)
+ ' RAISERROR(''''Please select the current status in the order of workflow %s and try again.'''',18,2,@ONStatusLs) WITH SETERROR' + CHAR(13)
+ '	RETURN 1' + CHAR(13)
+ 'END' + CHAR(13)
+ 'IF NOT EXISTS (SELECT 1 FROM dbo.' + @ColumnName + 'H WHERE EntityId = @' + @PkeyCol + ' AND StatusCd = @StatusCd)' + CHAR(13)
+ 'BEGIN' + CHAR(13)
+ ' UPDATE dbo.' + @ColumnName + 'H SET IsDone = ''''Y'''' FROM dbo.' + @ColumnName + 'H a INNER JOIN dbo.' + @ColumnName + ' b ON a.EntityId = @' + @PkeyCol + CHAR(13)
+ ' INSERT dbo.' + @ColumnName + 'H (UserId,EntityId,StatusCd,IsDone,StatusDt)' + CHAR(13)
+ ' SELECT @UsrId,@' + @PkeyCol + ',@StatusCd,CASE WHEN NStatusLs IS NOT NULL AND charindex('
+ CASE WHEN @IsChar = 'Y' THEN '''''''''''''''''+@StatusCd+''''''''''''''''' ELSE '@StatusCd' END + ',NStatusLs) > 0'
+ ' THEN ''''Y'''' ELSE ''''N'''' END,getdate() FROM dbo.' + @ColumnName + ' WHERE StatusCd = @StatusCd' + CHAR(13)
+ 'END' + CHAR(13)
+ 'RETURN 0' + CHAR(13)

IF @ProcedureSql IS NULL
BEGIN
	RAISERROR('Stored Procedure Wf_Upd??? not generated because of NULL.',18,2) WITH SETERROR
	RETURN 1
END

/* Execute S.proc. */
EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @DropProcedureSql + '''')
IF @ProcedureSql IS NOT NULL EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @ProcedureSql + '''')

/* Prepare Server Rule for Wf_Upd??? */
DELETE FROM dbo.ServerRule WHERE ProcedureName = @ProcedureName

INSERT dbo.ServerRule (ScreenId,RuleTypeId,MasterTable,RuleName,RuleDesc,RuleOrder,ProcedureName,ParameterNames,ParameterTypes,CallingParams,OnAdd,OnUpd,OnDel,BeforeCRUD)
	SELECT @ScreenId,4,@MasterTable,'Automated workflow status - upd'
	,isnull(ScreenTitle,space(0)) + ' [' + CASE WHEN @MasterTable = 'Y' THEN 'Master' ELSE 'Detail' END + ': Before CRUD' + '] Automated workflow status - upd'
	,0,@ProcedureName
	,@PkeyCol + ',StatusCd,UsrId'
	,@PKeyTyp + ',Char,Int'
	,@PkeyCol + CONVERT(varchar(10),@TableId) + ',' + @ColumnName + CONVERT(varchar(10),@TableId) + ',LUser.UsrId'
	,'N','Y','N','Y'
	FROM dbo.ScreenHlp WHERE ScreenId = @ScreenId AND CultureId = @DefCultureId

/* Prepare S.proc Wf_Add???. */
SELECT @ProcedureName = 'Wf_Add' + @ColumnName + CONVERT(varchar(10),@ScreenObjId)
SELECT @DropProcedureSql = 'IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(''''dbo.' + @ProcedureName + ''''') AND type = ''''P'''') DROP PROCEDURE dbo.' + @ProcedureName

SELECT @ProcedureSql = 'CREATE PROCEDURE dbo.' + @ProcedureName + CHAR(13)
+ ' @' + @PkeyCol + CHAR(9) + CHAR(9) + @PKeyTyp + CHAR(13)
+ ',@StatusCd' +  + CHAR(9) + CHAR(9) + 'char(1)' + CHAR(13)
+ ',@UsrId' + CHAR(9) + CHAR(9) + 'int' + CHAR(13)
+ '/* WITH ENCRYPTION */' + CHAR(13) + 'AS' + CHAR(13) + 'SET NOCOUNT ON' + CHAR(13)
+ 'INSERT dbo.' + @ColumnName + 'H (UserId,EntityId,StatusCd,IsDone,StatusDt)' + CHAR(13)
+ ' SELECT @UsrId,@' + @PkeyCol + ',@StatusCd,CASE WHEN NStatusLs IS NOT NULL AND charindex('
+ CASE WHEN @IsChar = 'Y' THEN '''''''''''''''''+@StatusCd+''''''''''''''''' ELSE '@StatusCd' END + ',NStatusLs) > 0'
+ ' THEN ''''Y'''' ELSE ''''N'''' END,getdate() FROM dbo.' + @ColumnName + ' WHERE StatusCd = @StatusCd' + CHAR(13)
+ 'RETURN 0' + CHAR(13)

IF @ProcedureSql IS NULL
BEGIN
	RAISERROR('Stored Procedure Wf_Add??? not generated because of NULL.',18,2) WITH SETERROR
	RETURN 1
END

/* Execute S.proc. */
EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @DropProcedureSql + '''')
IF @ProcedureSql IS NOT NULL EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @ProcedureSql + '''')

/* Prepare Server Rule for Wf_Add??? */
DELETE FROM dbo.ServerRule WHERE ProcedureName = @ProcedureName

INSERT dbo.ServerRule (ScreenId,RuleTypeId,MasterTable,RuleName,RuleDesc,RuleOrder,ProcedureName,ParameterNames,ParameterTypes,CallingParams,OnAdd,OnUpd,OnDel,BeforeCRUD)
	SELECT @ScreenId,4,@MasterTable,'Automated workflow status - add'
	,isnull(ScreenTitle,space(0)) + ' [' + CASE WHEN @MasterTable = 'Y' THEN 'Master' ELSE 'Detail' END + ': After CRUD' + '] Automated workflow status - add'
	,0,@ProcedureName
	,@PkeyCol + ',StatusCd,UsrId'
	,@PKeyTyp + ',Char,Int'
	,@PkeyCol + CONVERT(varchar(10),@TableId) + ',' + @ColumnName + CONVERT(varchar(10),@TableId) + ',LUser.UsrId'
	,'Y','N','N','N'
	FROM dbo.ScreenHlp WHERE ScreenId = @ScreenId AND CultureId = @DefCultureId
RETURN 0

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.MkWizardW1Upd') AND type='P')
DROP PROCEDURE dbo.MkWizardW1Upd
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[MkWizardW1Upd]
 @wizardId		int
,@procedureName		varchar(200)
,@appDatabase		varchar(50)
,@sysDatabase		varchar(50)
/* WITH ENCRYPTION */
AS
DECLARE	 @procedureAddSql	varchar(max)
		,@dropProcedureSql	varchar(max)
		,@ins1Clause		varchar(max)
		,@ins2Clause		varchar(max)
		,@tableId			int
		,@columnName		varchar(50)
		,@columnLength		smallint
		,@DataTypeSqlName	varchar(50)
		,@varName			varchar(100)
		,@masterTable		varchar(100)
		,@masterTableId		int
SET NOCOUNT ON
SELECT @ins1Clause = '', @ins2Clause = '', @masterTable = ''
SELECT @procedureAddSql = 'CREATE PROCEDURE Wiz' + @procedureName + CHAR(13) + ' @ImportFileName	nvarchar(30)' + CHAR(13)
SELECT @masterTable = c.dbAppDatabase + '.dbo.' + b.TableName, @masterTableId = a.MasterTableId
	FROM dbo.Wizard a
	INNER JOIN dbo.DbTable b ON a.MasterTableId = b.TableId
	INNER JOIN RODesign.dbo.Systems c ON b.SystemId = c.SystemId
	WHERE a.WizardId = @wizardId
DECLARE objCursor CURSOR
FOR SELECT b.TableId, b.ColumnName, b.ColumnLength, DataTypeSqlName = CASE WHEN d.DataTypeSqlName = 'Decimal' THEN 'Float' ELSE d.DataTypeSqlName END
	FROM dbo.WizardObj a
		INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
		INNER JOIN RODesign.dbo.CtDataType d ON b.DataType = d.DataTypeId
	WHERE a.WizardId = @wizardId AND a.ColumnId is not null
	ORDER BY a.TabIndex
FOR READ ONLY
OPEN objCursor
FETCH NEXT FROM objCursor INTO @tableId, @columnName, @columnLength, @DataTypeSqlName
WHILE @@FETCH_STATUS = 0
BEGIN
	IF @tableId <> @masterTableId
	BEGIN
		CLOSE objCursor
		DEALLOCATE objCursor
		RAISERROR('Please make sure all columns are from the same master table "%s" and try again.',18,2) WITH SETERROR
		RETURN 0
	END
	SELECT @varName =  '@' + @columnName + CONVERT(VARCHAR,@tableId) + CHAR(9) + @DataTypeSqlName
	IF CHARINDEX(lower(@DataTypeSqlName),'binary,varbinary,nchar,nvarchar,char,varchar') > 0
		SELECT @varName = @varName + '(' + case when @columnLength > 0 then convert(varchar,@columnLength) else 'max' end + ')'
	SELECT @procedureAddSql = @procedureAddSql + ',' + @varName + CHAR(13)
	IF @ins1Clause <> '' SELECT @ins1Clause = @ins1Clause + ','
	SELECT @ins1Clause = @ins1Clause + @columnName
	IF @ins2Clause <> '' SELECT @ins2Clause = @ins2Clause + ','
	SELECT @ins2Clause = @ins2Clause + '@' + @columnName + CONVERT(VARCHAR,@tableId)
	FETCH NEXT FROM objCursor INTO @tableId, @columnName, @columnLength, @DataTypeSqlName
END
CLOSE objCursor
DEALLOCATE objCursor
SELECT @procedureAddSql = @procedureAddSql + '/* WITH ENCRYPTION */' + CHAR(13) + 'AS' + CHAR(13)
+ 'SET NOCOUNT ON' + CHAR(13)
+ 'INSERT ' + @masterTable + ' (' + @ins1Clause + ',ImportFileName)' + CHAR(13)
+ 'SELECT ' + @ins2Clause + ',@ImportFileName' + CHAR(13)
+ 'RETURN 0' + CHAR(13)
IF @procedureAddSql IS NULL
	RAISERROR('Stored Procedure Wiz% not generated.',18,2,@procedureName) WITH SETERROR
ELSE
BEGIN
	SELECT @dropProcedureSql = 'IF exists (SELECT * FROM dbo.sysobjects WHERE id = object_id(''''Wiz' + @procedureName + ''''') AND type = ''''P'''') DROP PROCEDURE Wiz' + @procedureName
	-- USE Database is not allowed!  Needs to be replaced by Dynamic EXECUTION.
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @dropProcedureSql + '''')
	EXEC (@appDatabase + '.dbo.MkStoredProcedure ''' + @procedureAddSql + '''')
END
RETURN 0
 
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.NewMenuItem') AND type='P')
DROP PROCEDURE dbo.NewMenuItem
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[NewMenuItem]
 @ScreenId		int
,@ReportId		int
,@WizardId		int
,@ItemTitle		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @MenuId	int
		,@CultureId	smallint
IF @ScreenId is not null AND @ScreenId <> 0
BEGIN
	IF NOT EXISTS (SELECT 1 FROM dbo.Menu WHERE ScreenId = @ScreenId)
		INSERT dbo.Menu (MenuIndex,ScreenId) SELECT 0, @ScreenId
END
ELSE IF @ReportId is not null AND @ReportId <> 0
BEGIN
	IF NOT EXISTS (SELECT 1 FROM dbo.Menu WHERE ReportId = @ReportId)
	INSERT dbo.Menu (MenuIndex,ReportId) SELECT 0, @ReportId
END
ELSE
BEGIN
	IF NOT EXISTS (SELECT 1 FROM dbo.Menu WHERE WizardId = @WizardId)
	INSERT dbo.Menu (MenuIndex,WizardId) SELECT 0, @WizardId
END
SELECT @MenuId = @@IDENTITY
IF @MenuId is not null
BEGIN
	SELECT @CultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
	INSERT dbo.MenuHlp (MenuId,CultureId,MenuText) VALUES (@MenuId,@CultureId,@ItemTitle)
END
RETURN 0

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.PurgeScrAudit') AND type='P')
DROP PROCEDURE dbo.PurgeScrAudit
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[PurgeScrAudit]
 @YearOld		SmallInt
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DELETE FROM dbo.ScrAuditDtl WHERE EXISTS (SELECT 1 FROM dbo.ScrAudit b WHERE dbo.ScrAuditDtl.ScrAuditId = b.ScrAuditId AND b.ChangedOn < dateadd(yyyy,-@YearOld,getutcdate()))
DELETE FROM dbo.ScrAudit WHERE ChangedOn < dateadd(yyyy,-@YearOld,getutcdate())
RETURN 0

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.SetRptGrp') AND type='P')
DROP PROCEDURE dbo.SetRptGrp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[SetRptGrp]
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF (SELECT count(1) FROM dbo.ReportGrp WHERE ReportId is null AND ReportId is null AND ParentGrpId is null) <= 0
BEGIN
	TRUNCATE TABLE dbo.ReportGrp	/* Starts all over */
	SET IDENTITY_INSERT dbo.ReportGrp ON
	INSERT dbo.ReportGrp (ReportGrpId, ReportGrpName, ReportGrpIndex, ContentVertical, LabelVertical, BorderWidth)
		VALUES (1, '*C-Horizontal L-Vertical', '0', 'N', 'Y', 0)
	INSERT dbo.ReportGrp (ReportGrpId, ReportGrpName, ReportGrpIndex, ContentVertical, LabelVertical, BorderWidth)
		VALUES (2, '*C&L-Horizontal', '0', 'N', 'N', 0)
	INSERT dbo.ReportGrp (ReportGrpId, ReportGrpName, ReportGrpIndex, ContentVertical, LabelVertical, BorderWidth)
		VALUES (3, '*C-Vertical L-Horizontal', '0', 'Y', 'N', 0)
	INSERT dbo.ReportGrp (ReportGrpId, ReportGrpName, ReportGrpIndex, ContentVertical, LabelVertical, BorderWidth)
		VALUES (4, '*C&L-Vertical', '0', 'Y', 'Y', 0)
	SET IDENTITY_INSERT dbo.ReportGrp OFF
END
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.SetRptNeedRegen') AND type='P')
DROP PROCEDURE dbo.SetRptNeedRegen
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[SetRptNeedRegen]
 @reportId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.Report SET NeedRegen = 'N' WHERE ReportId = @reportId
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.SetScrNeedRegen') AND type='P')
DROP PROCEDURE dbo.SetScrNeedRegen
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[SetScrNeedRegen]
 @screenId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.Screen SET NeedRegen = 'N' WHERE ScreenId = @screenId
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.SetScrTab') AND type='P')
DROP PROCEDURE dbo.SetScrTab
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




/* Called by GenScreensRules */
CREATE PROCEDURE [dbo].[SetScrTab]
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF NOT EXISTS (SELECT 1 FROM AppInfo) 
BEGIN
	INSERT INTO dbo.AppInfo (AppInfoDesc, VersionMa, VersionMi) SELECT '1.0', 1, 0
END
RETURN 0

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.SetWizNeedRegen') AND type='P')
DROP PROCEDURE dbo.SetWizNeedRegen
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[SetWizNeedRegen]
 @wizardId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.Wizard SET NeedRegen = 'N' WHERE WizardId = @wizardId
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.UpdCronJob') AND type='P')
DROP PROCEDURE dbo.UpdCronJob
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[UpdCronJob]
 @cronJobId	int
,@lastRun	datetime
,@nextRun	datetime
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE CronJob
set LastRun = @lastRun, NextRun = @nextRun
WHERE CronJobId = @cronJobId
RETURN 0 



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.UpdCronJobStatus') AND type='P')
DROP PROCEDURE dbo.UpdCronJobStatus
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[UpdCronJobStatus]
 @cronJobId	int
,@status	varchar(500)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE CronJob
set LastStatus = LEFT(@status,500)
WHERE CronJobId = @cronJobId
RETURN 0 



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.UpdLastCriteria') AND type='P')
DROP PROCEDURE dbo.UpdLastCriteria
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[UpdLastCriteria]
 @ScreenId	int
,@ReportId	int
,@UsrId		int
,@CriId		int
,@LastCriteria	nvarchar(900)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
SET XACT_ABORT ON
IF @ScreenId is not null AND @ScreenId <> 0
	UPDATE dbo.ScreenLstCri SET LastCriteria = @LastCriteria WHERE ScreenId = @ScreenId AND UsrId = @UsrId AND ScreenCriId = @CriId
ELSE
	UPDATE dbo.ReportLstCri SET LastCriteria = @LastCriteria WHERE ReportId = @ReportId AND UsrId = @UsrId AND ReportCriId = @CriId
RETURN 0

 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.UpdLastPageInfo') AND type='P')
DROP PROCEDURE dbo.UpdLastPageInfo
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[UpdLastPageInfo]
 @ScreenId	int
,@UsrId		int
,@LastPageInfo	nvarchar(900)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
SET XACT_ABORT ON
UPDATE dbo.ScreenLstInf SET LastPageInfo = @LastPageInfo WHERE ScreenId = @ScreenId AND UsrId = @UsrId
RETURN 0

 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.UpdMemFld') AND type='P')
DROP PROCEDURE dbo.UpdMemFld
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[UpdMemFld]
 @GenPrefix		varchar(10)
,@PublicAccess	char(1)
,@RptMemFldId	int
,@RptMemFldName	nvarchar(200)
,@UsrId			int
/* WITH ENCRYPTION */
AS
DECLARE	 @CompanyLs	varchar(1000)
SET NOCOUNT ON
SELECT @CompanyLs = CompanyLs FROM RODesign.dbo.Usr WHERE UsrId = @UsrId
IF @GenPrefix = 'Ut'
BEGIN
	IF @RptMemFldId is null
	BEGIN
		INSERT dbo.UtRptMemFld (RptMemFldName, UsrId, InputBy, CompanyLs, AccessCd)
			SELECT @RptMemFldName, CASE WHEN @PublicAccess = 'P' THEN null ELSE @UsrId END, @UsrId, @CompanyLs, @PublicAccess
		SELECT @RptMemFldId = @@IDENTITY
	END
	ELSE UPDATE dbo.UtRptMemFld SET RptMemFldName = @RptMemFldName
		,UsrId = CASE WHEN @PublicAccess = 'P' THEN null ELSE @UsrId END
		,CompanyLs = @CompanyLs
		,AccessCd = @PublicAccess
		WHERE RptMemFldId = @RptMemFldId
END
ELSE
BEGIN
	IF @RptMemFldId is null
	BEGIN
		INSERT dbo.RptMemFld (RptMemFldName, UsrId, InputBy, CompanyLs, AccessCd)
			SELECT @RptMemFldName, CASE WHEN @PublicAccess = 'P' THEN null ELSE @UsrId END, @UsrId, @CompanyLs, @PublicAccess
		SELECT @RptMemFldId = @@IDENTITY
	END
	ELSE UPDATE dbo.RptMemFld SET RptMemFldName = @RptMemFldName
		,UsrId = CASE WHEN @PublicAccess = 'P' THEN null ELSE @UsrId END
		,CompanyLs = @CompanyLs
		,AccessCd = @PublicAccess
		WHERE RptMemFldId = @RptMemFldId
END
SELECT @RptMemFldId
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.UpdMemViewdt') AND type='P')
DROP PROCEDURE dbo.UpdMemViewdt
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[UpdMemViewdt]
 @GenPrefix			varchar(10)
,@RptMemCriId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF @GenPrefix = 'Ut'
	UPDATE dbo.UtRptMemCri SET ViewedOn = getdate() WHERE RptMemCriId = @RptMemCriId
ELSE
	UPDATE dbo.RptMemCri SET ViewedOn = getdate() WHERE RptMemCriId = @RptMemCriId
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.UpdReportLstCri') AND type='P')
DROP PROCEDURE dbo.UpdReportLstCri
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[UpdReportLstCri]
 @reportId		int
,@ColumnName		varchar(50)
,@usrId			int
,@LastCriteria		nvarchar(4000)
/* WITH ENCRYPTION */
AS
DECLARE	@ReportCriId	int
SET NOCOUNT ON
SELECT @ReportCriId = ReportCriId FROM dbo.ReportCri WHERE ReportId = @reportId AND ColumnName = @ColumnName
UPDATE dbo.ReportLstCri SET LastCriteria = @LastCriteria WHERE UsrId = @usrId AND ReportId = @reportId AND ReportCriId = @ReportCriId
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.UpdRptMemCri') AND type='P')
DROP PROCEDURE dbo.UpdRptMemCri
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[UpdRptMemCri]
 @RptMemCriId	int
,@ReportId		int
,@ColumnName	varchar(50)
,@MemCriteria	nvarchar(900)
/* WITH ENCRYPTION */
AS
DECLARE	@ReportCriId	int
SET NOCOUNT ON
SELECT @ReportCriId = ReportCriId FROM dbo.ReportCri WHERE ReportId = @ReportId AND ColumnName = @ColumnName
IF EXISTS (SELECT 1 FROM dbo.RptMemCriDtl WHERE RptMemCriId = @RptMemCriId AND ReportCriId = @ReportCriId)
	UPDATE dbo.RptMemCriDtl SET MemCriteria = @MemCriteria WHERE RptMemCriId = @RptMemCriId AND ReportCriId = @ReportCriId
ELSE
	INSERT dbo.RptMemCriDtl (RptMemCriId, ReportCriId, MemCriteria) SELECT @RptMemCriId, @ReportCriId, @MemCriteria
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.UpdScreenLstCri') AND type='P')
DROP PROCEDURE dbo.UpdScreenLstCri
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[UpdScreenLstCri]
 @usrId			int
,@screenId		int
,@ScreenCriId		int
,@LastCriteria		nvarchar(4000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.ScreenLstCri SET LastCriteria = @LastCriteria WHERE UsrId = @usrId AND ScreenId = @screenId AND ScreenCriId = @ScreenCriId
RETURN 0
 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.UpdUtReportLstCri') AND type='P')
DROP PROCEDURE dbo.UpdUtReportLstCri
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[UpdUtReportLstCri]
 @reportId		int
,@ColumnName		varchar(50)
,@usrId			int
,@LastCriteria		nvarchar(4000)
/* WITH ENCRYPTION */
AS
DECLARE	@ReportCriId	int
SET NOCOUNT ON
SELECT @ReportCriId = ReportCriId FROM dbo.UtReportCri WHERE ReportId = @reportId AND ColumnName = @ColumnName
UPDATE dbo.UtReportLstCri SET LastCriteria = @LastCriteria WHERE UsrId = @usrId AND ReportId = @reportId AND ReportCriId = @ReportCriId
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.UpdUtRptMemCri') AND type='P')
DROP PROCEDURE dbo.UpdUtRptMemCri
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[UpdUtRptMemCri]
 @RptMemCriId	int
,@ReportId		int
,@ColumnName	varchar(50)
,@MemCriteria	nvarchar(900)
/* WITH ENCRYPTION */
AS
DECLARE	@ReportCriId	int
SET NOCOUNT ON
SELECT @ReportCriId = ReportCriId FROM dbo.UtReportCri WHERE ReportId = @ReportId AND ColumnName = @ColumnName
IF EXISTS (SELECT 1 FROM dbo.UtRptMemCriDtl WHERE RptMemCriId = @RptMemCriId AND ReportCriId = @ReportCriId)
	UPDATE dbo.UtRptMemCriDtl SET MemCriteria = @MemCriteria WHERE RptMemCriId = @RptMemCriId AND ReportCriId = @ReportCriId
ELSE
	INSERT dbo.UtRptMemCriDtl (RptMemCriId, ReportCriId, MemCriteria) SELECT @RptMemCriId, @ReportCriId, @MemCriteria
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrAddDocTbl') AND type='P')
DROP PROCEDURE dbo.WrAddDocTbl
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[WrAddDocTbl]
 @SystemId		smallint
,@TableName		varchar(500)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @SystemName	nvarchar(50)
		,@TableId		int
IF NOT EXISTS (SELECT 1 FROM dbo.DbTable WHERE TableName = @TableName)
BEGIN
	SELECT @SystemName = SystemName FROM RODesign.dbo.Systems WHERE SystemId = @SystemId
	INSERT dbo.DbTable (SystemId, TableName, TableDesc, MultiDesignDb, VirtualTbl, TblObjective, ModifiedOn)
		SELECT @SystemId, @TableName, @SystemName + ' - ' + @TableName + ' Doc', 'N', 'N', 'This table captures upload of all document types.', getdate()
	SELECT @TableId = @@IDENTITY
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'DocId',@TableName + ' - DocId',4,8,'N','Y','Y','N','This internal identity uniquely represents this document.',10
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'DocName',@TableName + ' - DocName',11,100,'N','N','N','N','This is the filename of the imported document.',40
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'MimeType',@TableName + ' - MimeType',15,100,'N','N','N','N','This MIME type indicates the type of this docuemnt.',50
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'DocImage',@TableName + ' - DocImage',9,0,'N','N','N','N','This is the binary representation of the document.',70
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'MasterId',@TableName + ' - MasterId',4,8,'N','N','N','N','This is the previous version of this document, if applicable.',20
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'InputBy',@TableName + ' - InputBy',3,4,'Y','N','N','N','This document was imported by this user.',80
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'InputOn',@TableName + ' - InputOn',12,8,'Y','N','N','N','This document was imported on this date and time.',90
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'DocSize',@TableName + ' - DocSize',4,8,'N','N','N','N','This is the size of the document in bytes.',60
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'Active',@TableName + ' - Active',14,1,'N','N','N','N','This is used internally to provide workflow capability on delete approval.',100
	IF NOT EXISTS (SELECT 1 FROM dbo.sysobjects WHERE name = @TableName)
	BEGIN
		/* Create the physical table and update the release script */
		EXEC dbo.WrSyncToDb @SystemId, @TableId, @TableName, 'N'
	END
	SELECT ColumnId FROM dbo.DbColumn WHERE TableId = @TableId ORDER BY ColumnIndex
END
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrAddMenu') AND type='P')
DROP PROCEDURE dbo.WrAddMenu
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[WrAddMenu]
 @PMenuId		smallint
,@ParentId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @MenuIndex	smallint
DECLARE	 @MenuId	int
IF @PMenuId is NULL OR @PMenuId = 0
	SELECT @MenuIndex = 0
ELSE
	SELECT @MenuIndex = MenuIndex + 1 FROM dbo.Menu WHERE MenuId = @PMenuId
INSERT dbo.Menu (MenuIndex, ParentId) SELECT @MenuIndex, @ParentId
SELECT @MenuId = @@IDENTITY
EXEC dbo.Ir_UpdMenuIndex
EXEC dbo.Ir_InitMenuHlp @MenuId
SELECT MenuId, MenuText FROM dbo.MenuHlp WHERE MenuId = @MenuId AND CultureId = 1
RETURN 0


 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrAddScreenObj') AND type='P')
DROP PROCEDURE dbo.WrAddScreenObj
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrAddScreenObj]
 @ScreenId			int
,@PScreenObjId		int
,@TabFolderId		int
,@IsTab				char(1)
,@NewRow			char(1)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @ScreenObjId	int
		,@TabIndex		smallint
		,@IsMasterTable char(1)
		,@Ret			int
		
IF @PScreenObjId is NULL
	/* find the last tab folder object in case this is for first grid item of master detail screen */
	SELECT TOP 1 
		@TabIndex = CASE WHEN st.ScreenTypeName IN ('I1','I3') OR @IsTab = 'Y' THEN 0 ELSE TabIndex + 1 END 
		,@IsMasterTable = CASE WHEN @IsTab = 'Y' OR st.ScreenTypeName = 'I3' THEN 'Y' ELSE 'N' END
		,@TabFolderId = ISNULL(@TabFolderId,TabFolderId)
	FROM ScreenObj o
	INNER JOIN Screen s on o.ScreenId = s.ScreenId
	INNER JOIN CtScreenType st on st.ScreenTypeId = s.ScreenTypeId
	WHERE o.ScreenId = @ScreenId
	AND (@IsTab = 'Y' OR st.ScreenTypeName = 'I3' OR o.MasterTable = 'Y')
	ORDER BY TabIndex DESC
ELSE
	SELECT @TabIndex = TabIndex + 1, @IsMasterTable = MasterTable, @TabFolderId = ISNULL(@TabFolderId,TabFolderId) FROM dbo.ScreenObj WHERE ScreenObjId = @PScreenObjId
	
INSERT dbo.ScreenObj (ScreenId, MasterTable, GroupRowId, GroupColId, LabelVertical, ColumnName, DefAfter, DefAlways, ColumnWrap, GridGrpCd
	, HideOnTablet, HideOnMobile, ColumnJustify, DisplayModeId, GenerateSp, TabFolderId, TabIndex, RequiredValid, RefreshOnCUD, TrimOnEntry, IgnoreConfirm, NewGroupRow)
	SELECT @ScreenId, @IsMasterTable, 78, 851, 'N', 'C'+CONVERT(varchar(10),@TabIndex), 'N', 'N', 'N', 'N', 'N', 'N', 'L', 1, 'Y', @TabFolderId, @TabIndex, 'N', 'N', 'Y', 'Y', @NewRow
SELECT @ScreenObjId = @@IDENTITY
EXEC @Ret = dbo.Cr_ChkScreenObj @ScreenObjId
EXEC @Ret = dbo.Ir_UpdScreenObjInd @ScreenId
EXEC @Ret = dbo.Ir_InitScreenObjHlp @ScreenObjId
UPDATE dbo.Screen SET NeedRegen = 'Y' WHERE ScreenId = @ScreenId
SELECT ScreenObjId, ColumnHeader FROM dbo.ScreenObjHlp WHERE ScreenObjId = @ScreenObjId AND CultureId = 1

RETURN 0  

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrAddScreenTab') AND type='P')
DROP PROCEDURE dbo.WrAddScreenTab
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[WrAddScreenTab]
 @TabFolderOrder	tinyint
,@ScreenId			int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @ScreenTabId	int
INSERT dbo.ScreenTab (ScreenId, TabFolderName, TabFolderOrder) SELECT @ScreenId, 'T'+CONVERT(varchar(10),@TabFolderOrder), @TabFolderOrder
SELECT @ScreenTabId = @@IDENTITY
EXEC dbo.Ir_UpdScreenTab @ScreenTabId
INSERT dbo.ScreenTabHlp (ScreenTabId, CultureId, TabFolderName) SELECT @ScreenTabId, 1, 'NEW TAB'
SELECT ScreenTabId, TabFolderName FROM dbo.ScreenTabHlp WHERE ScreenTabId = @ScreenTabId AND CultureId = 1
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrAddWfsTbl') AND type='P')
DROP PROCEDURE dbo.WrAddWfsTbl
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[WrAddWfsTbl]
 @SystemId		smallint
,@TableName		varchar(50)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @MenuId			int
		,@CultureId			smallint
		,@SystemAbbr		varchar(4)
		,@TableId			int
		,@TblId				int
		,@Tbl				varchar(50)
		,@ScreenId			int
		,@ScreenTabId		int
		,@ScreenObjId		int
		,@ColId10 int, @ColId20 int, @ColId40 int, @ColId50 int, @ColId60 int, @ColId70 int
		,@KeyId int, @RefId int
SELECT @SystemAbbr = SystemAbbr FROM RODesign.dbo.Systems WHERE SystemId = @SystemId
IF NOT EXISTS (SELECT 1 FROM dbo.DbTable WHERE TableName = @TableName) AND
   NOT EXISTS (SELECT 1 FROM dbo.Screen WHERE ProgramName = @SystemAbbr + @TableName)
BEGIN
	/* Create Workflow status history */
	SELECT @Tbl = @TableName + 'H'
	INSERT dbo.DbTable (SystemId, TableName, TableDesc, MultiDesignDb, VirtualTbl, TblObjective, ModifiedOn)
		SELECT @SystemId, @Tbl, @SystemAbbr + ' - ' + @Tbl + ' Workflow History', 'N', 'N', 'This table captures workflow status history.', getdate()
	SELECT @TableId = @@IDENTITY
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'StatusHId',@Tbl + ' - StatusHId',4,8,'N','Y','Y','N','This ID uniquely represents this workflow status history.',10
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'UserId',@Tbl + ' - UserId',3,4,'N','N','N','N','This is the user owner of this workflow status history.',40
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'EntityId',@Tbl + ' - EntityId',3,4,'N','N','N','N','This is the entity changed to the following status.',50
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'StatusCd',@Tbl + ' - StatusCd',14,1,'N','N','N','N','This is the status being changed to.',50
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'IsDone',@Tbl + ' - IsDone',14,1,'N','N','N','N','This is checked when the above status is done, otherwise in-progress.',50
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'StatusDt',@Tbl + ' - StatusDt',12,8,'N','N','N','N','This is the time and date the above status is changed to.',100
	IF NOT EXISTS (SELECT 1 FROM dbo.sysobjects WHERE name = @Tbl)
	BEGIN
		/* Create the physical table and update the release script */
		EXEC dbo.WrSyncToDb @SystemId, @TableId, @Tbl, 'N'
	END
	/* Create Workflow status table */
	SELECT @Tbl = @TableName
	INSERT dbo.DbTable (SystemId, TableName, TableDesc, MultiDesignDb, VirtualTbl, TblObjective, ModifiedOn)
		SELECT @SystemId, @Tbl, @SystemAbbr + ' - ' + @Tbl + ' Workflow', 'N', 'N', 'This table captures workflow statuses.', getdate()
	SELECT @TableId = @@IDENTITY
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'StatusCd',@Tbl + ' - StatusCd',14,1,'N','N','Y','N','This code uniquely represents this workflow status.',10
	SELECT @ColId10 = @@IDENTITY
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'StatusName',@Tbl + ' - StatusName',11,100,'N','N','N','N','This is the status name of this workflow.',20
	SELECT @ColId20 = @@IDENTITY
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'NStatusLs',@Tbl + ' - NStatusLs',15,1000,'N','Y','N','N','Current status can only switch to these statuses; empty means this status can switch to any status.',40
	SELECT @ColId40 = @@IDENTITY
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'UsrGroupLs',@Tbl + ' - UsrGroupLs',15,1000,'N','Y','N','N','Only user from these user groups can access this status; empty means anyone can access.',50
	SELECT @ColId50 = @@IDENTITY
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'StatusOrd',@Tbl + ' - StatusOrd',2,2,'N','N','N','N','This indicates natural order of this workflow.',60
	SELECT @ColId60 = @@IDENTITY
	INSERT dbo.DbColumn (TableId,ColumnName,ColumnDesc,DataType,ColumnLength,AllowNulls,ColumnIdentity,PrimaryKey,IsIndex,ColObjective,ColumnIndex)
		SELECT @TableId,'Active',@Tbl + ' - Active',14,1,'N','N','N','N','Obsolete status cannot be deleted but it can be inactivated.',70
	SELECT @ColId70 = @@IDENTITY
	IF NOT EXISTS (SELECT 1 FROM dbo.sysobjects WHERE name = @Tbl)
	BEGIN
		/* Create the physical table and update the release script */
		EXEC dbo.WrSyncToDb @SystemId, @TableId, @Tbl, 'N'
	END

	/* Workflow status Screen */
	INSERT dbo.Screen (ProgramName,ScreenDesc,ScreenTypeId,MasterTableId,DetailTableId,SearchTableId,SearchId,SearchAscending,GridRows,GenerateSc,GenerateSr,HasDeleteAll,ShowGridHead,ValidateReq,DeferError,AuthRequired,ViewOnly,NeedRegen)
	SELECT @SystemAbbr + @TableName,'Workflow Status',5,@TableId,NULL,@TableId,@ColId20,'Y',12,'Y','Y','Y','Y','Y','N','Y','N','N'
	SELECT @ScreenId=@@IDENTITY
	/* Menu */
	INSERT dbo.Menu (MenuIndex,ScreenId) SELECT 0, @ScreenId
	SELECT @MenuId = @@IDENTITY
	IF @MenuId is not null
	BEGIN
		SELECT @CultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
		INSERT dbo.MenuHlp (MenuId,CultureId,MenuText) VALUES (@MenuId,@CultureId,@Tbl)
	END
	/* ScreenHlp */
	INSERT dbo.ScreenHlp (ScreenId,CultureId,DefaultHlpMsg,FootNote,ScreenTitle,AddMsg,UpdMsg,DelMsg)
	SELECT @ScreenId,1,'OK',NULL,'Workflow Status','Workflow status added successfully.','Workflow status updated successfully.','Workflow status deleted successfully.'
	INSERT dbo.ScreenTab (ScreenId,ScreenTabDesc,TabFolderName,TabFolderOrder)
	SELECT @ScreenId,NULL,'Main',10
	SELECT @ScreenTabId=@@IDENTITY
	INSERT dbo.ScreenTabHlp (ScreenTabId,CultureId,TabFolderName)
	SELECT @ScreenTabId,1,'Main Info'

	/* ScreenObj */
	INSERT dbo.ScreenObj (ScreenId,MasterTable,NewGroupRow,GroupRowId,GroupColId,LabelVertical,LabelCss,ContentCss,ColumnId,ColumnName,ColumnDesc,DefaultValue,HyperLinkUrl,DefAfter,SystemValue,DefAlways,ColumnWrap,GridGrpCd,HideOnTablet,HideOnMobile,ColumnJustify,ColumnSize,ColumnHeight,DisplayModeId,DdlKeyColumnId,DdlRefColumnId,DdlSrtColumnId,DdlAdnColumnId,DdlFtrColumnId,AggregateCd,GenerateSp,TabFolderId,TabIndex,SortOrder,RequiredValid,MaskValid,RangeValidType,RangeValidMax,RangeValidMin,ColumnLink,RefreshOnCUD,TrimOnEntry,MatchCd,IgnoreConfirm)
	SELECT @ScreenId,'Y','Y',78,834,'Y',NULL,NULL,@ColId10,'StatusCd',@SystemAbbr + @TableName + ' [   10] Main: StatusCd',NULL,NULL,'N',NULL,'N','Y','N','N','N','L',NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,'Y',@ScreenTabId,10,NULL,'Y',NULL,NULL,NULL,NULL,NULL,'N','Y',NULL,'Y'
	SELECT @ScreenObjId=@@IDENTITY
	INSERT dbo.ScreenObjHlp (ScreenObjId,CultureId,ScreenObjHlpDesc,ColumnHeader,ToolTip,ErrMessage,TbHint)
	SELECT @ScreenObjId,1,@SystemAbbr + @TableName + ' [   10] Main: StatusCd (en-US)','Status Code','This code uniquely represents this status.','Please enter a code to uniquely represent this status.',NULL

	INSERT dbo.ScreenObj (ScreenId,MasterTable,NewGroupRow,GroupRowId,GroupColId,LabelVertical,LabelCss,ContentCss,ColumnId,ColumnName,ColumnDesc,DefaultValue,HyperLinkUrl,DefAfter,SystemValue,DefAlways,ColumnWrap,GridGrpCd,HideOnTablet,HideOnMobile,ColumnJustify,ColumnSize,ColumnHeight,DisplayModeId,DdlKeyColumnId,DdlRefColumnId,DdlSrtColumnId,DdlAdnColumnId,DdlFtrColumnId,AggregateCd,GenerateSp,TabFolderId,TabIndex,SortOrder,RequiredValid,MaskValid,RangeValidType,RangeValidMax,RangeValidMin,ColumnLink,RefreshOnCUD,TrimOnEntry,MatchCd,IgnoreConfirm)
	SELECT @ScreenId,'Y','N',78,834,'Y',NULL,NULL,@ColId20,'StatusName',@SystemAbbr + @TableName + ' [   20] Main: StatusName',NULL,NULL,'N',NULL,'N','Y','N','N','N','L',NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,'Y',@ScreenTabId,20,NULL,'Y',NULL,NULL,NULL,NULL,NULL,'N','Y',NULL,'Y'
	SELECT @ScreenObjId=@@IDENTITY
	INSERT dbo.ScreenObjHlp (ScreenObjId,CultureId,ScreenObjHlpDesc,ColumnHeader,ToolTip,ErrMessage,TbHint)
	SELECT @ScreenObjId,1,@SystemAbbr + @TableName + ' [   20] Main: StatusName (en-US)','Status Name','This is the name of this status.','Please enter the name of this status.',NULL

	INSERT dbo.ScreenObj (ScreenId,MasterTable,NewGroupRow,GroupRowId,GroupColId,LabelVertical,LabelCss,ContentCss,ColumnId,ColumnName,ColumnDesc,DefaultValue,HyperLinkUrl,DefAfter,SystemValue,DefAlways,ColumnWrap,GridGrpCd,HideOnTablet,HideOnMobile,ColumnJustify,ColumnSize,ColumnHeight,DisplayModeId,DdlKeyColumnId,DdlRefColumnId,DdlSrtColumnId,DdlAdnColumnId,DdlFtrColumnId,AggregateCd,GenerateSp,TabFolderId,TabIndex,SortOrder,RequiredValid,MaskValid,RangeValidType,RangeValidMax,RangeValidMin,ColumnLink,RefreshOnCUD,TrimOnEntry,MatchCd,IgnoreConfirm)
	SELECT @ScreenId,'Y','N',78,842,'Y',NULL,NULL,@ColId40,'NStatusLs',@SystemAbbr + @TableName + ' [   70] Main: NStatusLs',NULL,NULL,'N',NULL,'N','Y','N','N','N','L',NULL,13,5,@ColId10,@ColId20,NULL,NULL,NULL,NULL,'Y',@ScreenTabId,40,NULL,'N',NULL,NULL,NULL,NULL,NULL,'N','Y',NULL,'Y'
	SELECT @ScreenObjId=@@IDENTITY
	INSERT dbo.ScreenObjHlp (ScreenObjId,CultureId,ScreenObjHlpDesc,ColumnHeader,ToolTip,ErrMessage,TbHint)
	SELECT @ScreenObjId,1,@SystemAbbr + @TableName + ' [   70] Main: NStatusLs (en-US)','Next Statuses','Current status can only switch to these statuses; empty means this status can switch to any status. When the next status is itself, it is considered DONE, otherwise WIP.',NULL,NULL

	IF EXISTS (SELECT 1 FROM dbo.DbTable WHERE TableName='UsrGroup')
	BEGIN
		SELECT @KeyId = a.ColumnId FROM dbo.DbColumn a INNER JOIN dbo.DbTable b ON a.TableId = b.TableId WHERE b.TableName='UsrGroup' AND a.ColumnName='UsrGroupId'
		SELECT @RefId = a.ColumnId FROM dbo.DbColumn a INNER JOIN dbo.DbTable b ON a.TableId = b.TableId WHERE b.TableName='UsrGroup' AND a.ColumnName='UsrGroupName'
	END
	ELSE
	BEGIN
		INSERT dbo.DbTable (SystemId,TableName,TableDesc,MultiDesignDb,VirtualTbl,VirtualSql,TblObjective)
		SELECT 3,'UsrGroup','Adm - User Group','N','N',NULL,NULL
		SELECT @TblId=@@IDENTITY
		INSERT dbo.DbColumn (TableId,ColumnIndex,ExternalTable,ColumnName,ColumnDesc,DataType,ColumnLength,ColumnScale,DefaultValue,AllowNulls,ColumnIdentity,PrimaryKey,IsIndexU,IsIndex,ColObjective)
		SELECT @TblId,10,NULL,'UsrGroupId','UsrGroup - UsrGroupId',2,2,NULL,NULL,'N','Y','Y','N','N',NULL
		SELECT @KeyId=@@IDENTITY
		INSERT dbo.DbColumn (TableId,ColumnIndex,ExternalTable,ColumnName,ColumnDesc,DataType,ColumnLength,ColumnScale,DefaultValue,AllowNulls,ColumnIdentity,PrimaryKey,IsIndexU,IsIndex,ColObjective)
		SELECT @TblId,20,NULL,'UsrGroupName','UsrGroup - UsrGroupName',11,50,NULL,NULL,'N','N','N','N','N',NULL
		SELECT @RefId=@@IDENTITY
	END
	INSERT dbo.ScreenObj (ScreenId,MasterTable,NewGroupRow,GroupRowId,GroupColId,LabelVertical,LabelCss,ContentCss,ColumnId,ColumnName,ColumnDesc,DefaultValue,HyperLinkUrl,DefAfter,SystemValue,DefAlways,ColumnWrap,GridGrpCd,HideOnTablet,HideOnMobile,ColumnJustify,ColumnSize,ColumnHeight,DisplayModeId,DdlKeyColumnId,DdlRefColumnId,DdlSrtColumnId,DdlAdnColumnId,DdlFtrColumnId,AggregateCd,GenerateSp,TabFolderId,TabIndex,SortOrder,RequiredValid,MaskValid,RangeValidType,RangeValidMax,RangeValidMin,ColumnLink,RefreshOnCUD,TrimOnEntry,MatchCd,IgnoreConfirm)
	SELECT @ScreenId,'Y','N',78,834,'Y',NULL,NULL,@ColId50,'UsrGroupLs',@SystemAbbr + @TableName + ' [   40] Main: UsrGroupLs',NULL,NULL,'N',NULL,'N','Y','N','N','N','L',NULL,NULL,52,@KeyId,@RefId,NULL,NULL,NULL,NULL,'Y',@ScreenTabId,50,NULL,'N',NULL,NULL,NULL,NULL,NULL,'N','Y',NULL,'Y'
	SELECT @ScreenObjId=@@IDENTITY
	INSERT dbo.ScreenObjHlp (ScreenObjId,CultureId,ScreenObjHlpDesc,ColumnHeader,ToolTip,ErrMessage,TbHint)
	SELECT @ScreenObjId,1,@SystemAbbr + @TableName + ' [   40] Main: UsrGroupLs (en-US)','User Groups','Only user from these user groups can access this status; empty means anyone can access.',NULL,NULL

	INSERT dbo.ScreenObj (ScreenId,MasterTable,NewGroupRow,GroupRowId,GroupColId,LabelVertical,LabelCss,ContentCss,ColumnId,ColumnName,ColumnDesc,DefaultValue,HyperLinkUrl,DefAfter,SystemValue,DefAlways,ColumnWrap,GridGrpCd,HideOnTablet,HideOnMobile,ColumnJustify,ColumnSize,ColumnHeight,DisplayModeId,DdlKeyColumnId,DdlRefColumnId,DdlSrtColumnId,DdlAdnColumnId,DdlFtrColumnId,AggregateCd,GenerateSp,TabFolderId,TabIndex,SortOrder,RequiredValid,MaskValid,RangeValidType,RangeValidMax,RangeValidMin,ColumnLink,RefreshOnCUD,TrimOnEntry,MatchCd,IgnoreConfirm)
	SELECT @ScreenId,'Y','N',78,834,'Y',NULL,NULL,@ColId60,'StatusOrd',@SystemAbbr + @TableName + ' [   30] Main: StatusOrd',NULL,NULL,'N',NULL,'N','Y','N','N','N','R',NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL,'Y',@ScreenTabId,60,NULL,'Y',NULL,NULL,NULL,NULL,NULL,'N','Y',NULL,'Y'
	SELECT @ScreenObjId=@@IDENTITY
	INSERT dbo.ScreenObjHlp (ScreenObjId,CultureId,ScreenObjHlpDesc,ColumnHeader,ToolTip,ErrMessage,TbHint)
	SELECT @ScreenObjId,1,@SystemAbbr + @TableName + ' [   30] Main: StatusOrd (en-US)','Status Order','This is the listing order of this status.','Please enter the listing order of this status.',NULL

	INSERT dbo.ScreenObj (ScreenId,MasterTable,NewGroupRow,GroupRowId,GroupColId,LabelVertical,LabelCss,ContentCss,ColumnId,ColumnName,ColumnDesc,DefaultValue,HyperLinkUrl,DefAfter,SystemValue,DefAlways,ColumnWrap,GridGrpCd,HideOnTablet,HideOnMobile,ColumnJustify,ColumnSize,ColumnHeight,DisplayModeId,DdlKeyColumnId,DdlRefColumnId,DdlSrtColumnId,DdlAdnColumnId,DdlFtrColumnId,AggregateCd,GenerateSp,TabFolderId,TabIndex,SortOrder,RequiredValid,MaskValid,RangeValidType,RangeValidMax,RangeValidMin,ColumnLink,RefreshOnCUD,TrimOnEntry,MatchCd,IgnoreConfirm)
	SELECT @ScreenId,'Y','N',78,834,'Y',NULL,NULL,@ColId70,'Active',@SystemAbbr + @TableName + ' [   50] Main: Active','Y',NULL,'N',NULL,'N','Y','N','N','N','C',NULL,NULL,4,NULL,NULL,NULL,NULL,NULL,NULL,'Y',@ScreenTabId,70,NULL,'N',NULL,NULL,NULL,NULL,NULL,'N','Y',NULL,'Y'
	SELECT @ScreenObjId=@@IDENTITY
	INSERT dbo.ScreenObjHlp (ScreenObjId,CultureId,ScreenObjHlpDesc,ColumnHeader,ToolTip,ErrMessage,TbHint)
	SELECT @ScreenObjId,1,@SystemAbbr + @TableName + ' [   50] Main: Active (en-US)','Active','This is unchecked when no longer active.',NULL,NULL

	SELECT ColumnId FROM dbo.DbColumn WHERE TableId = @TableId ORDER BY ColumnIndex		/* Do not change ColumnIndex without changing ScreenObj webrule */
END
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrCloneScreen') AND type='P')
DROP PROCEDURE dbo.WrCloneScreen
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[WrCloneScreen]
 @ScreenId		int
/* WITH ENCRYPTION */
AS
-- DSearchId, DSearchIdR, DSearchDtlId and DSearchDtlIdR may need to be added:
DECLARE	 @iClause nvarchar(max), @rClause nvarchar(max), @HasRule char(1), @NewCSS nvarchar(max)
		,@ScreenFilterId int, @ScreenCriId int, @ScreenTabId int, @ScreenObjId int
		,@i01 int, @i02 int, @i03 int, @i04 int, @i05 int, @i06 int, @i07 int, @i08 int, @i09 int, @i10 int
		,@i11 int, @i12 int, @i13 int, @i14 int, @i15 int, @i16 int, @i17 int, @i18 int, @i19 int, @i20 int
		,@i21 int, @i22 int, @i23 int, @i24 int, @i25 int, @i26 int, @i27 int, @i28 int, @i29 int, @i30 int
		,@i31 int, @i32 int, @i33 int, @i34 int, @i35 int, @i36 int, @i37 int, @i38 int, @i39 int, @i40 int
		,@i41 int, @i42 int, @i43 int, @i44 int, @i45 int, @i46 int, @i47 int, @i48 int, @i49 int, @i50 int
		,@c01 nvarchar(max), @c02 nvarchar(max), @c03 nvarchar(max), @c04 nvarchar(max), @c05 nvarchar(max), @c06 nvarchar(max), @c07 nvarchar(max), @c08 nvarchar(max), @c09 nvarchar(max), @c10 nvarchar(max)
		,@c11 nvarchar(max), @c12 nvarchar(max), @c13 nvarchar(max), @c14 nvarchar(max), @c15 nvarchar(max), @c16 nvarchar(max), @c17 nvarchar(max), @c18 nvarchar(max), @c19 nvarchar(max), @c20 nvarchar(max)
		,@c21 nvarchar(max), @c22 nvarchar(max), @c23 nvarchar(max), @c24 nvarchar(max), @c25 nvarchar(max), @c26 nvarchar(max), @c27 nvarchar(max), @c28 nvarchar(max), @c29 nvarchar(max), @c30 nvarchar(max)
		,@c31 nvarchar(max), @c32 nvarchar(max), @c33 nvarchar(max), @c34 nvarchar(max), @c35 nvarchar(max), @c36 nvarchar(max), @c37 nvarchar(max), @c38 nvarchar(max), @c39 nvarchar(max), @c40 nvarchar(max)
		,@c41 nvarchar(max), @c42 nvarchar(max), @c43 nvarchar(max), @c44 nvarchar(max), @c45 nvarchar(max), @c46 nvarchar(max), @c47 nvarchar(max), @c48 nvarchar(max), @c49 nvarchar(max), @c50 nvarchar(max)
SET NOCOUNT ON
SELECT @rClause = ''
SELECT @iClause = 'DECLARE @ScreenId int, @ScreenFilterId int, @ScreenCriId int, @ScreenTabId int, @ScreenObjId int, @TableId int, @ColumnId int, @DdlKeyColumnId int, @DdlRefColumnId int, @DdlSrtColumnId int, @DdlAdnColumnId int, @DdlFtrColumnId int, @ScreenObjHlpId int, @ScreenCriHlpId int'
SELECT @c01=ProgramName, @c02=ScreenDesc, @i03=ScreenTypeId, @i04=MasterTableId, @i05=DetailTableId, @i06=SearchTableId, @i07=SearchId, @c07=SearchAscending, @i08=SearchDtlId, @i09=SearchUrlId, @i10=SearchImgId, @i11=GridRows, @c10=GenerateSc, @c11=GenerateSr, @c12=HasDeleteAll, @c13=ShowGridHead, @c14=ValidateReq, @c15=DeferError, @c16=AuthRequired, @c17=ViewOnly, @c18=NeedRegen
	FROM dbo.Screen WHERE ScreenId=@ScreenId
SELECT @iClause = @iClause + char(13) + char(10) + char(13) + char(10) + '/* Screen */'
+ char(13) + char(10) + 'INSERT dbo.Screen (ProgramName,ScreenDesc,ScreenTypeId,MasterTableId,DetailTableId,SearchTableId,SearchId,SearchAscending,SearchDtlId,SearchUrlId,SearchImgId,GridRows,GenerateSc,GenerateSr,HasDeleteAll,ShowGridHead,ValidateReq,DeferError,AuthRequired,ViewOnly,NeedRegen)'
+ char(13) + char(10) + 'SELECT'
+ ' ' + RODesign.dbo.fNullCha(@c01)
+ ',' + RODesign.dbo.fNullCha(@c02)
+ ',' + RODesign.dbo.fNullInt(@i03)
+ ',' + RODesign.dbo.fNullInt(@i04)
+ ',' + RODesign.dbo.fNullInt(@i05)
+ ',' + RODesign.dbo.fNullInt(@i06)
+ ',' + RODesign.dbo.fNullInt(@i07)
+ ',' + RODesign.dbo.fNullCha(@c07)
+ ',' + RODesign.dbo.fNullInt(@i08)
+ ',' + RODesign.dbo.fNullInt(@i09)
+ ',' + RODesign.dbo.fNullInt(@i10)
+ ',' + RODesign.dbo.fNullInt(@i11)
+ ',' + RODesign.dbo.fNullCha(@c10)
+ ',' + RODesign.dbo.fNullCha(@c11)
+ ',' + RODesign.dbo.fNullCha(@c12)
+ ',' + RODesign.dbo.fNullCha(@c13)
+ ',' + RODesign.dbo.fNullCha(@c14)
+ ',' + RODesign.dbo.fNullCha(@c15)
+ ',' + RODesign.dbo.fNullCha(@c16)
+ ',' + RODesign.dbo.fNullCha(@c17)
+ ',' + RODesign.dbo.fNullCha(@c18)
+ char(13) + char(10) + 'SELECT @ScreenId=@@IDENTITY'
IF @i04 IS NOT NULL SELECT @iClause = @iClause + char(13) + char(10) + '/* MasterTableId */' + dbo.fTable(@i04,'UPDATE dbo.Screen SET MasterTableId=@TableId WHERE ScreenId=@ScreenId')
IF @i05 IS NOT NULL SELECT @iClause = @iClause + char(13) + char(10) + '/* DetailTableId */' + dbo.fTable(@i05,'UPDATE dbo.Screen SET DetailTableId=@TableId WHERE ScreenId=@ScreenId')
IF @i06 IS NOT NULL SELECT @iClause = @iClause + char(13) + char(10) + '/* SearchId */' + dbo.fColumn(@i07,'UPDATE dbo.Screen SET SearchId=@ColumnId WHERE ScreenId=@ScreenId')

SELECT @c01=DefaultHlpMsg, @c02=FootNote, @c03=ScreenTitle, @c04=AddMsg, @c05=UpdMsg, @c06=DelMsg, @c07=IncrementMsg, @c08=MasterLstTitle
	, @c09=MasterLstSubtitle, @c10=MasterRecTitle, @c11=MasterRecSubtitle, @c12=DetailLstTitle, @c13=DetailLstSubtitle, @c14=DetailRecTitle
	, @c15=DetailRecSubtitle, @c16=NoMasterMsg, @c17=NoDetailMsg, @c18=AddMasterMsg, @c19=AddDetailMsg, @c20=MasterFoundMsg, @c21=DetailFoundMsg
	FROM dbo.ScreenHlp WHERE ScreenId=@ScreenId AND CultureId=1
SELECT @iClause = @iClause + char(13) + char(10) + char(13) + char(10) + '/* ScreenHlp */'
+ char(13) + char(10) + 'INSERT dbo.ScreenHlp (ScreenId,CultureId,DefaultHlpMsg,FootNote,ScreenTitle,AddMsg,UpdMsg,DelMsg,IncrementMsg,MasterLstTitle,MasterLstSubtitle,MasterRecTitle,MasterRecSubtitle,DetailLstTitle,DetailLstSubtitle,DetailRecTitle,DetailRecSubtitle,NoMasterMsg,NoDetailMsg,AddMasterMsg,AddDetailMsg,MasterFoundMsg,DetailFoundMsg)'
+ char(13) + char(10) + 'SELECT @ScreenId,1'
+ ',' + RODesign.dbo.fNullCha(@c01)
+ ',' + RODesign.dbo.fNullCha(@c02)
+ ',' + RODesign.dbo.fNullCha(@c03)
+ ',' + RODesign.dbo.fNullCha(@c04)
+ ',' + RODesign.dbo.fNullCha(@c05)
+ ',' + RODesign.dbo.fNullCha(@c06)
+ ',' + RODesign.dbo.fNullCha(@c07)
+ ',' + RODesign.dbo.fNullCha(@c08)
+ ',' + RODesign.dbo.fNullCha(@c09)
+ ',' + RODesign.dbo.fNullCha(@c10)
+ ',' + RODesign.dbo.fNullCha(@c11)
+ ',' + RODesign.dbo.fNullCha(@c12)
+ ',' + RODesign.dbo.fNullCha(@c13)
+ ',' + RODesign.dbo.fNullCha(@c14)
+ ',' + RODesign.dbo.fNullCha(@c15)
+ ',' + RODesign.dbo.fNullCha(@c16)
+ ',' + RODesign.dbo.fNullCha(@c17)
+ ',' + RODesign.dbo.fNullCha(@c18)
+ ',' + RODesign.dbo.fNullCha(@c19)
+ ',' + RODesign.dbo.fNullCha(@c20)
+ ',' + RODesign.dbo.fNullCha(@c21)

SELECT @iClause = @iClause + char(13) + char(10) + char(13) + char(10) + '/* ScreenFilter */'
DECLARE cur01 CURSOR FAST_FORWARD FOR
	SELECT ScreenFilterId,ScreenFilterName,ScreenFilterDesc,FilterClause,FilterOrder,ApplyToMst
	FROM dbo.ScreenFilter
	WHERE ScreenId=@ScreenId
	FOR READ ONLY
OPEN cur01 FETCH NEXT FROM cur01 INTO @ScreenFilterId,@c01,@c02,@c03,@i04,@c05
WHILE @@FETCH_STATUS=0
BEGIN
	SELECT @iClause = @iClause + char(13) + char(10)
		+ 'INSERT dbo.ScreenFilter (ScreenId,ScreenFilterName,ScreenFilterDesc,FilterClause,FilterOrder,ApplyToMst)'
		+ char(13) + char(10) + 'SELECT @ScreenId'
		+ ',' + RODesign.dbo.fNullCha(@c01)
		+ ',' + RODesign.dbo.fNullCha(@c02)
		+ ',' + RODesign.dbo.fNullCha(@c03)
		+ ',' + RODesign.dbo.fNullInt(@i04)
		+ ',' + RODesign.dbo.fNullCha(@c05)
		+ char(13) + char(10) + 'SELECT @ScreenFilterId=@@IDENTITY'
	SELECT @c01=FilterName FROM dbo.ScreenFilterHlp WHERE ScreenFilterId=@ScreenFilterId AND CultureId=1
	SELECT @iClause = @iClause + char(13) + char(10) + 'INSERT dbo.ScreenFilterHlp (ScreenFilterId,CultureId,FilterName)'
	+ char(13) + char(10) + 'SELECT @ScreenFilterId,1' + ',' + RODesign.dbo.fNullCha(@c01)
	FETCH NEXT FROM cur01 INTO @ScreenFilterId,@c01,@c02,@c03,@i04,@c05
END
CLOSE cur01 DEALLOCATE cur01

SELECT @iClause = @iClause + char(13) + char(10) + char(13) + char(10) + '/* ScreenCri */'
+ char(13) + char(10) + 'IF object_id(''tempdb.dbo.#crihlp'') is not null DROP TABLE dbo.#crihlp'
+ char(13) + char(10) + 'CREATE TABLE #crihlp (OCriHlpId int NOT NULL, NCriHlpId int NOT NULL)'
DECLARE cur02 CURSOR FAST_FORWARD FOR
	SELECT ScreenCriId,ScreenCriDesc,LabelCss,ContentCss,ColumnId,OperatorId,TabIndex,DisplayModeId,ColumnJustify,ColumnSize,RowSize,DdlKeyColumnId,DdlRefColumnId,DdlSrtColumnId,DdlFtrColumnId,RequiredValid
	FROM dbo.ScreenCri
	WHERE ScreenId=@ScreenId
	FOR READ ONLY
OPEN cur02 FETCH NEXT FROM cur02 INTO @ScreenCriId,@c01,@c02,@c03,@i04,@i05,@i06,@i07,@c08,@i09,@i10,@i11,@i12,@i13,@i14,@c15
WHILE @@FETCH_STATUS=0
BEGIN
	SELECT @iClause = @iClause + char(13) + char(10)
		+ 'INSERT dbo.ScreenCri (ScreenId,ScreenCriDesc,LabelCss,ContentCss,ColumnId,OperatorId,TabIndex,DisplayModeId,ColumnJustify,ColumnSize,RowSize,DdlKeyColumnId,DdlRefColumnId,DdlSrtColumnId,DdlFtrColumnId,RequiredValid)'
		+ char(13) + char(10) + 'SELECT @ScreenId'
		+ ',' + RODesign.dbo.fNullCha(@c01)
		+ ',' + RODesign.dbo.fNullCha(@c02)
		+ ',' + RODesign.dbo.fNullCha(@c03)
		+ ',' + RODesign.dbo.fNullInt(@i04)
		+ ',' + RODesign.dbo.fNullInt(@i05)
		+ ',' + RODesign.dbo.fNullInt(@i06)
		+ ',' + RODesign.dbo.fNullInt(@i07)
		+ ',' + RODesign.dbo.fNullCha(@c08)
		+ ',' + RODesign.dbo.fNullInt(@i09)
		+ ',' + RODesign.dbo.fNullInt(@i10)
		+ ',' + RODesign.dbo.fNullInt(@i11)
		+ ',' + RODesign.dbo.fNullInt(@i12)
		+ ',' + RODesign.dbo.fNullInt(@i13)
		+ ',' + RODesign.dbo.fNullInt(@i14)
		+ ',' + RODesign.dbo.fNullCha(@c15)
		+ char(13) + char(10) + 'SELECT @ScreenCriId=@@IDENTITY'
	SELECT @i01=ScreenCriHlpId FROM dbo.ScreenCriHlp WHERE ScreenCriId=@ScreenCriId AND CultureId=1
	SELECT @iClause = @iClause + char(13) + char(10) + 'INSERT dbo.ScreenCriHlp (ScreenCriHlpDesc,ScreenCriId,CultureId,ColumnHeader)'
	+ char(13) + char(10) + 'SELECT ' + RODesign.dbo.fNullCha(@c01) + ',@ScreenCriId,1,' + RODesign.dbo.fNullCha(@c02)
	+ char(13) + char(10) + 'SELECT @ScreenCriHlpId=@@IDENTITY'
	+ char(13) + char(10) + 'INSERT INTO #crihlp (OCriHlpId,NCriHlpId) SELECT ' + CONVERT(varchar(10),@i01) + ',@ScreenCriHlpId'
	FETCH NEXT FROM cur02 INTO @ScreenCriId,@c01,@c02,@c03,@i04,@i05,@i06,@i07,@c08,@i09,@i10,@i11,@i12,@i13,@i14,@c15
END
CLOSE cur02 DEALLOCATE cur02

SELECT @iClause = @iClause + char(13) + char(10) + char(13) + char(10) + '/* ScreenTab */'
+ char(13) + char(10) + 'IF object_id(''tempdb.dbo.#tab'') is not null DROP TABLE dbo.#tab'
+ char(13) + char(10) + 'CREATE TABLE #tab (OTabId int NOT NULL, NTabId int NOT NULL)'
DECLARE cur03 CURSOR FAST_FORWARD FOR
	SELECT ScreenTabId,ScreenTabDesc,TabFolderName,TabFolderOrder
	FROM dbo.ScreenTab
	WHERE ScreenId=@ScreenId
	FOR READ ONLY
OPEN cur03 FETCH NEXT FROM cur03 INTO @ScreenTabId,@c01,@c02,@i03
WHILE @@FETCH_STATUS=0
BEGIN
	SELECT @iClause = @iClause + char(13) + char(10)
		+ 'INSERT dbo.ScreenTab (ScreenId,ScreenTabDesc,TabFolderName,TabFolderOrder)'
		+ char(13) + char(10) + 'SELECT @ScreenId'
		+ ',' + RODesign.dbo.fNullCha(@c01)
		+ ',' + RODesign.dbo.fNullCha(@c02)
		+ ',' + RODesign.dbo.fNullInt(@i03)
		+ char(13) + char(10) + 'SELECT @ScreenTabId=@@IDENTITY'
	+ char(13) + char(10) + 'INSERT INTO #tab (OTabId,NTabId) SELECT ' + CONVERT(varchar(10),@ScreenTabId) + ',@ScreenTabId'
	SELECT @c01=TabFolderName FROM dbo.ScreenTabHlp WHERE ScreenTabId=@ScreenTabId AND CultureId=1
	SELECT @iClause = @iClause + char(13) + char(10) + 'INSERT dbo.ScreenTabHlp (ScreenTabId,CultureId,TabFolderName)'
	+ char(13) + char(10) + 'SELECT @ScreenTabId,1,' + RODesign.dbo.fNullCha(@c01)
	FETCH NEXT FROM cur03 INTO @ScreenTabId,@c01,@c02,@i03
END
CLOSE cur03 DEALLOCATE cur03

SELECT @NewCSS = ''
SELECT @iClause = @iClause + char(13) + char(10) + char(13) + char(10) + '/* ScreenObj */'
+ char(13) + char(10) + 'IF object_id(''tempdb.dbo.#obj'') is not null DROP TABLE dbo.#obj'
+ char(13) + char(10) + 'CREATE TABLE #obj (OObjId int NOT NULL, NObjId int NOT NULL)'
+ char(13) + char(10) + 'IF object_id(''tempdb.dbo.#objhlp'') is not null DROP TABLE dbo.#objhlp'
+ char(13) + char(10) + 'CREATE TABLE #objhlp (OObjHlpId int NOT NULL, NObjHlpId int NOT NULL)'
DECLARE cur04 CURSOR FAST_FORWARD FOR
	SELECT ScreenObjId,MasterTable,NewGroupRow,GroupRowId,GroupColId,LabelVertical,LabelCss,ContentCss,ColumnId,ColumnName,ColumnDesc
		,DefaultValue,HyperLinkUrl,DefAfter,SystemValue,DefAlways,ColumnWrap,GridGrpCd,HideOnTablet,HideOnMobile,ColumnJustify
		,ColumnSize,ColumnHeight,DisplayModeId,DdlKeyColumnId,DdlRefColumnId,DdlSrtColumnId,DdlAdnColumnId,DdlFtrColumnId,AggregateCd,GenerateSp
		,TabFolderId,TabIndex,SortOrder,RequiredValid,MaskValid,RangeValidType,RangeValidMax,RangeValidMin,ColumnLink,RefreshOnCUD
		,TrimOnEntry,MatchCd,IgnoreConfirm
	FROM dbo.ScreenObj
	WHERE ScreenId=@ScreenId ORDER BY TabIndex
	FOR READ ONLY
OPEN cur04 FETCH NEXT FROM cur04 INTO @ScreenObjId,@c01,@c02,@i03,@i04,@c05,@c06,@c07,@i08,@c09,@c10,@c11,@c12,@c13,@c14,@c15,@c16,@c17,@c18,@c19,@c20,@i21,@i22,@i23,@i24,@i25,@i26,@i27,@i28,@c29,@c30,@i31,@i32,@i33,@c34,@c35,@c36,@c37,@c38,@c39,@c40,@c41,@c42,@c43
WHILE @@FETCH_STATUS=0
BEGIN
	IF @c06 is not null SELECT @NewCSS = @NewCSS + '; ' + @c06
	IF @c07 is not null SELECT @NewCSS = @NewCSS + '; ' + @c07
	IF @i31 IS NOT NULL	-- ScreenTabId map
		SELECT @iClause = @iClause + char(13) + char(10) + 'SELECT @ScreenTabId=NTabId FROM #tab WHERE OTabId=' + CONVERT(varchar(10),@i31)
	ELSE
		SELECT @iClause = @iClause + char(13) + char(10) + 'SELECT @ScreenTabId=NULL'
	SELECT @iClause = @iClause + char(13) + char(10)
		+ 'INSERT dbo.ScreenObj (ScreenId,MasterTable,NewGroupRow,GroupRowId,GroupColId,LabelVertical,LabelCss,ContentCss,ColumnId,ColumnName,ColumnDesc,DefaultValue,HyperLinkUrl,DefAfter,SystemValue,DefAlways,ColumnWrap,GridGrpCd,HideOnTablet,HideOnMobile,ColumnJustify,ColumnSize,ColumnHeight,DisplayModeId,DdlKeyColumnId,DdlRefColumnId,DdlSrtColumnId,DdlAdnColumnId,DdlFtrColumnId,AggregateCd,GenerateSp,TabFolderId,TabIndex,SortOrder,RequiredValid,MaskValid,RangeValidType,RangeValidMax,RangeValidMin,ColumnLink,RefreshOnCUD,TrimOnEntry,MatchCd,IgnoreConfirm)'
		+ char(13) + char(10) + 'SELECT @ScreenId'
		+ ',' + RODesign.dbo.fNullCha(@c01)
		+ ',' + RODesign.dbo.fNullCha(@c02)
		+ ',' + RODesign.dbo.fNullInt(@i03)
		+ ',' + RODesign.dbo.fNullInt(@i04)
		+ ',' + RODesign.dbo.fNullCha(@c05)
		+ ',' + RODesign.dbo.fNullCha(@c06)
		+ ',' + RODesign.dbo.fNullCha(@c07)
		+ ',' + RODesign.dbo.fNullInt(@i08)
		+ ',' + RODesign.dbo.fNullCha(@c09)
		+ ',' + RODesign.dbo.fNullCha(@c10)
		+ ',' + RODesign.dbo.fNullCha(@c11)
		+ ',' + RODesign.dbo.fNullCha(@c12)
		+ ',' + RODesign.dbo.fNullCha(@c13)
		+ ',' + RODesign.dbo.fNullCha(@c14)
		+ ',' + RODesign.dbo.fNullCha(@c15)
		+ ',' + RODesign.dbo.fNullCha(@c16)
		+ ',' + RODesign.dbo.fNullCha(@c17)
		+ ',' + RODesign.dbo.fNullCha(@c18)
		+ ',' + RODesign.dbo.fNullCha(@c19)
		+ ',' + RODesign.dbo.fNullCha(@c20)
		+ ',' + RODesign.dbo.fNullInt(@i21)
		+ ',' + RODesign.dbo.fNullInt(@i22)
		+ ',' + RODesign.dbo.fNullInt(@i23)
		+ ',' + RODesign.dbo.fNullInt(@i24)
		+ ',' + RODesign.dbo.fNullInt(@i25)
		+ ',' + RODesign.dbo.fNullInt(@i26)
		+ ',' + RODesign.dbo.fNullInt(@i27)
		+ ',' + RODesign.dbo.fNullInt(@i28)
		+ ',' + RODesign.dbo.fNullCha(@c29)
		+ ',' + RODesign.dbo.fNullCha(@c30)
		+ ',@ScreenTabId'
		+ ',' + RODesign.dbo.fNullInt(@i32)
		+ ',' + RODesign.dbo.fNullInt(@i33)
		+ ',' + RODesign.dbo.fNullCha(@c34)
		+ ',' + RODesign.dbo.fNullCha(@c35)
		+ ',' + RODesign.dbo.fNullCha(@c36)
		+ ',' + RODesign.dbo.fNullCha(@c37)
		+ ',' + RODesign.dbo.fNullCha(@c38)
		+ ',' + RODesign.dbo.fNullCha(@c39)
		+ ',' + RODesign.dbo.fNullCha(@c40)
		+ ',' + RODesign.dbo.fNullCha(@c41)
		+ ',' + RODesign.dbo.fNullCha(@c42)
		+ ',' + RODesign.dbo.fNullCha(@c43)
		+ char(13) + char(10) + 'SELECT @ScreenObjId=@@IDENTITY'
	+ char(13) + char(10) + 'INSERT INTO #obj (OObjId,NObjId) SELECT ' + CONVERT(varchar(10),@ScreenObjId) + ',@ScreenObjId'
	IF @i08 IS NOT NULL SELECT @iClause = @iClause + char(13) + char(10) + '/* ColumnId */' + dbo.fColumn(@i08,'UPDATE dbo.ScreenObj SET ColumnId=@ColumnId WHERE ScreenObjId=@ScreenObjId')
	IF @i24 IS NOT NULL SELECT @iClause = @iClause + char(13) + char(10) + '/* DdlKeyColumnId */' + dbo.fColumn(@i24,'UPDATE dbo.ScreenObj SET DdlKeyColumnId=@ColumnId WHERE ScreenObjId=@ScreenObjId')
	IF @i25 IS NOT NULL SELECT @iClause = @iClause + char(13) + char(10) + '/* DdlRefColumnId */' + dbo.fColumn(@i25,'UPDATE dbo.ScreenObj SET DdlRefColumnId=@ColumnId WHERE ScreenObjId=@ScreenObjId')
	IF @i26 IS NOT NULL SELECT @iClause = @iClause + char(13) + char(10) + '/* DdlSrtColumnId */' + dbo.fColumn(@i26,'UPDATE dbo.ScreenObj SET DdlSrtColumnId=@ColumnId WHERE ScreenObjId=@ScreenObjId')
	IF @i27 IS NOT NULL SELECT @iClause = @iClause + char(13) + char(10) + '/* DdlAdnColumnId */' + dbo.fColumn(@i27,'UPDATE dbo.ScreenObj SET DdlAdnColumnId=@ColumnId WHERE ScreenObjId=@ScreenObjId')
	IF @i28 IS NOT NULL SELECT @iClause = @iClause + char(13) + char(10) + '/* DdlFtrColumnId */' + dbo.fColumn(@i28,'UPDATE dbo.ScreenObj SET DdlFtrColumnId=@ColumnId WHERE ScreenObjId=@ScreenObjId')
	SELECT @i01=ScreenObjHlpId, @c01=ScreenObjHlpDesc, @c02=ColumnHeader, @c03=ToolTip, @c04=ErrMessage, @c05=TbHint FROM dbo.ScreenObjHlp WHERE ScreenObjId=@ScreenObjId AND CultureId=1
	SELECT @iClause = @iClause + char(13) + char(10) + 'INSERT dbo.ScreenObjHlp (ScreenObjId,CultureId,ScreenObjHlpDesc,ColumnHeader,ToolTip,ErrMessage,TbHint)'
	+ char(13) + char(10) + 'SELECT @ScreenObjId,1,' + RODesign.dbo.fNullCha(@c01) + ',' + RODesign.dbo.fNullCha(@c02) + ',' + RODesign.dbo.fNullCha(@c03) + ',' + RODesign.dbo.fNullCha(@c04) + ',' + RODesign.dbo.fNullCha(@c05)
	+ char(13) + char(10) + 'SELECT @ScreenObjHlpId=@@IDENTITY'
	+ char(13) + char(10) + 'INSERT INTO #objhlp (OObjHlpId,NObjHlpId) SELECT ' + CONVERT(varchar(10),@i01) + ',@ScreenObjHlpId'
	FETCH NEXT FROM cur04 INTO @ScreenObjId,@c01,@c02,@i03,@i04,@c05,@c06,@c07,@i08,@c09,@c10,@c11,@c12,@c13,@c14,@c15,@c16,@c17,@c18,@c19,@c20,@i21,@i22,@i23,@i24,@i25,@i26,@i27,@i28,@c29,@c30,@i31,@i32,@i33,@c34,@c35,@c36,@c37,@c38,@c39,@c40,@c41,@c42,@c43
END
CLOSE cur04 DEALLOCATE cur04
IF @NewCSS <> '' SELECT @rClause = @rClause + char(13) + char(10) + '/* Please pay attention to CSS: ' + RIGHT(@NewCSS,LEN(@NewCSS)-2) + '; */'

SELECT @iClause = @iClause + char(13) + char(10) + char(13) + char(10) + '/* ColOvrd */'
DECLARE cur08 CURSOR FAST_FORWARD FOR
	SELECT ColOvrdDesc,ScreenObjId,ColVisible,ColReadOnly,ColExport,ToolTip,ColumnHeader,ErrMessage,Priority
	FROM dbo.ColOvrd
	WHERE ScreenId=@ScreenId
	FOR READ ONLY
OPEN cur08 FETCH NEXT FROM cur08 INTO @c01,@i02,@c03,@c04,@c05,@c06,@c07,@c08,@i09
WHILE @@FETCH_STATUS=0
BEGIN
	IF @i02 IS NOT NULL	-- ScreenObjId map
		SELECT @iClause = @iClause + char(13) + char(10) + 'SELECT @ScreenObjId=NObjId FROM #obj WHERE OObjId=' + CONVERT(varchar(10),@i02)
	ELSE
		SELECT @iClause = @iClause + char(13) + char(10) + 'SELECT @ScreenObjId=NULL'
	SELECT @iClause = @iClause + char(13) + char(10)
		+ 'INSERT dbo.ColOvrd (ScreenId,ColOvrdDesc,ScreenObjId,ColVisible,ColReadOnly,ColExport,ToolTip,ColumnHeader,ErrMessage,Priority)'
		+ char(13) + char(10) + 'SELECT @ScreenId'
		+ ',' + RODesign.dbo.fNullCha(@c01)
		+ ',@ScreenObjId'
		+ ',' + RODesign.dbo.fNullCha(@c03)
		+ ',' + RODesign.dbo.fNullCha(@c04)
		+ ',' + RODesign.dbo.fNullCha(@c05)
		+ ',' + RODesign.dbo.fNullCha(@c06)
		+ ',' + RODesign.dbo.fNullCha(@c07)
		+ ',' + RODesign.dbo.fNullCha(@c08)
		+ ',' + RODesign.dbo.fNullInt(@i09)
	FETCH NEXT FROM cur08 INTO @c01,@i02,@c03,@c04,@c05,@c06,@c07,@c08,@i09
END
CLOSE cur08 DEALLOCATE cur08

SELECT @HasRule = 'N'
SELECT @iClause = @iClause + char(13) + char(10) + char(13) + char(10) + '/* ServerRule */'
DECLARE cur06 CURSOR FAST_FORWARD FOR
	SELECT RuleTypeId,MasterTable,RuleName,RuleDesc,RuleDescription,RuleOrder,ProcedureName,ParameterNames,ParameterTypes,CallingParams,OnAdd,OnUpd,OnDel,BeforeCRUD,RuleCode
	FROM dbo.ServerRule
	WHERE ScreenId=@ScreenId
	FOR READ ONLY
OPEN cur06 FETCH NEXT FROM cur06 INTO @i01,@c02,@c03,@c04,@c05,@i06,@c07,@c08,@c09,@c10,@c11,@c12,@c13,@c14,@c15
WHILE @@FETCH_STATUS=0
BEGIN
	SELECT @HasRule = 'Y'
	IF @c15 is null OR @c15 = '' SELECT @rClause = @rClause + char(13) + char(10) + '/** Please make sure content of Server Rule "' + @c03 + '" is not empty and clone again; **/'
	IF @i05 IS NOT NULL	-- ScreenObjId transformation
		SELECT @iClause = @iClause + char(13) + char(10) + 'SELECT @ScreenObjId=NObjId FROM #obj WHERE OObjId=' + CONVERT(varchar(10),@i05)
	ELSE
		SELECT @iClause = @iClause + char(13) + char(10) + 'SELECT @ScreenObjId=NULL'
	SELECT @iClause = @iClause + char(13) + char(10)
		+ 'INSERT dbo.ServerRule (ScreenId,RuleTypeId,MasterTable,RuleName,RuleDesc,RuleDescription,RuleOrder,ProcedureName,ParameterNames,ParameterTypes,CallingParams,OnAdd,OnUpd,OnDel,BeforeCRUD,RuleCode)'
		+ char(13) + char(10) + 'SELECT @ScreenId'
		+ ',' + RODesign.dbo.fNullInt(@i01)
		+ ',' + RODesign.dbo.fNullCha(@c02)
		+ ',' + RODesign.dbo.fNullCha(@c03)
		+ ',' + RODesign.dbo.fNullCha(@c04)
		+ ',' + RODesign.dbo.fNullCha(@c05)
		+ ',' + RODesign.dbo.fNullInt(@i06)
		+ ',' + RODesign.dbo.fNullCha(@c07)
		+ ',' + RODesign.dbo.fNullCha(@c08)
		+ ',' + RODesign.dbo.fNullCha(@c09)
		+ ',' + RODesign.dbo.fNullCha(@c10)
		+ ',' + RODesign.dbo.fNullCha(@c11)
		+ ',' + RODesign.dbo.fNullCha(@c12)
		+ ',' + RODesign.dbo.fNullCha(@c13)
		+ ',' + RODesign.dbo.fNullCha(@c14)
		+ ',' + RODesign.dbo.fNullCha(@c15)
	FETCH NEXT FROM cur06 INTO @i01,@c02,@c03,@c04,@c05,@i06,@c07,@c08,@c09,@c10,@c11,@c12,@c13,@c14,@c15
END
CLOSE cur06 DEALLOCATE cur06
IF @HasRule = 'Y' SELECT @rClause = @rClause + char(13) + char(10) + '/* Use SQL server to check all Server Rule s.proc. for correctness; Then create them on the physical database; */'

SELECT @HasRule = 'N'
SELECT @iClause = @iClause + char(13) + char(10) + char(13) + char(10) + '/* WebRule */'
DECLARE cur05 CURSOR FAST_FORWARD FOR
	SELECT RuleTypeId,RuleName,RuleDesc,RuleDescription,ScreenObjId,ButtonTypeId,EventId,WebRuleProg
	FROM dbo.WebRule
	WHERE ScreenId=@ScreenId
	FOR READ ONLY
OPEN cur05 FETCH NEXT FROM cur05 INTO @i01,@c02,@c03,@c04,@i05,@i06,@i07,@c08
WHILE @@FETCH_STATUS=0
BEGIN
	SELECT @HasRule = 'Y'
	IF @i05 IS NOT NULL	-- ScreenObjId transformation
		SELECT @iClause = @iClause + char(13) + char(10) + 'SELECT @ScreenObjId=NObjId FROM #obj WHERE OObjId=' + CONVERT(varchar(10),@i05)
	ELSE
		SELECT @iClause = @iClause + char(13) + char(10) + 'SELECT @ScreenObjId=NULL'
	SELECT @iClause = @iClause + char(13) + char(10)
		+ 'INSERT dbo.WebRule (ScreenId,RuleTypeId,RuleName,RuleDesc,RuleDescription,ScreenObjId,ButtonTypeId,EventId,WebRuleProg)'
		+ char(13) + char(10) + 'SELECT @ScreenId'
		+ ',' + RODesign.dbo.fNullInt(@i01)
		+ ',' + RODesign.dbo.fNullCha(@c02)
		+ ',' + RODesign.dbo.fNullCha(@c03)
		+ ',' + RODesign.dbo.fNullCha(@c04)
		+ ',@ScreenObjId'
		+ ',' + RODesign.dbo.fNullInt(@i06)
		+ ',' + RODesign.dbo.fNullInt(@i07)
		+ ',' + RODesign.dbo.fNullCha(@c08)
	FETCH NEXT FROM cur05 INTO @i01,@c02,@c03,@c04,@i05,@i06,@i07,@c08
END
CLOSE cur05 DEALLOCATE cur05
IF @HasRule = 'Y' SELECT @rClause = @rClause + char(13) + char(10) + '/* After generation of new screen, use Visual Studio to verify all Web Rules for correctness; */'

SELECT @HasRule = 'N'
SELECT @iClause = @iClause + char(13) + char(10) + char(13) + char(10) + '/* ClientRule (CultureId=1 Only) */'
DECLARE cur07 CURSOR FAST_FORWARD FOR
	SELECT RuleTypeId,RuleName,RuleDesc,RuleDescription,RuleMethodId,CultureId,ScreenObjHlpId,ScreenCriHlpId,ClientScript,UserScriptEvent,UserScriptName,ScriptParam,RuleCntTypeId,ClientRuleProg
	FROM dbo.ClientRule
	WHERE ScreenId=@ScreenId AND CultureId = 1
	FOR READ ONLY
OPEN cur07 FETCH NEXT FROM cur07 INTO @i01,@c02,@c03,@c04,@i05,@i06,@i07,@i08,@i09,@c10,@c11,@c12,@i13,@c14
WHILE @@FETCH_STATUS=0
BEGIN
	SELECT @HasRule = 'Y'
	IF @i07 IS NOT NULL	-- ScreenObjHlpId map
		SELECT @iClause = @iClause + char(13) + char(10) + 'SELECT @ScreenObjHlpId=NObjHlpId FROM #objhlp WHERE OObjHlpId=' + CONVERT(varchar(10),@i07)
	ELSE
		SELECT @iClause = @iClause + char(13) + char(10) + 'SELECT @ScreenObjHlpId=NULL'
	IF @i08 IS NOT NULL	-- ScreenCriHlpId map
		SELECT @iClause = @iClause + char(13) + char(10) + 'SELECT @ScreenCriHlpId=NCriHlpId FROM #crihlp WHERE OCriHlpId=' + CONVERT(varchar(10),@i08)
	ELSE
		SELECT @iClause = @iClause + char(13) + char(10) + 'SELECT @ScreenCriHlpId=NULL'
	SELECT @iClause = @iClause + char(13) + char(10)
		+ 'INSERT dbo.ClientRule (ScreenId,RuleTypeId,RuleName,RuleDesc,RuleDescription,RuleMethodId,CultureId,ScreenObjHlpId,ScreenCriHlpId,ClientScript,UserScriptEvent,UserScriptName,ScriptParam,RuleCntTypeId,ClientRuleProg)'
		+ char(13) + char(10) + 'SELECT @ScreenId'
		+ ',' + RODesign.dbo.fNullInt(@i01)
		+ ',' + RODesign.dbo.fNullCha(@c02)
		+ ',' + RODesign.dbo.fNullCha(@c03)
		+ ',' + RODesign.dbo.fNullCha(@c04)
		+ ',' + RODesign.dbo.fNullInt(@i05)
		+ ',' + RODesign.dbo.fNullInt(@i06)
		+ ',@ScreenObjHlpId,@ScreenCriHlpId'
		+ ',' + RODesign.dbo.fNullInt(@i09)
		+ ',' + RODesign.dbo.fNullCha(@c10)
		+ ',' + RODesign.dbo.fNullCha(@c11)
		+ ',' + RODesign.dbo.fNullCha(@c12)
		+ ',' + RODesign.dbo.fNullInt(@i13)
		+ ',' + RODesign.dbo.fNullCha(@c14)
	FETCH NEXT FROM cur07 INTO @i01,@c02,@c03,@c04,@i05,@i06,@i07,@i08,@i09,@c10,@c11,@c12,@i13,@c14
END
CLOSE cur07 DEALLOCATE cur07
IF @HasRule = 'Y' SELECT @rClause = @rClause + char(13) + char(10) + '/* After generation of new screen, use Visual Studio to verify all Client Rules for correctness; */'

SELECT @iClause = @iClause + char(13) + char(10)
+ char(13) + char(10) + 'DROP TABLE dbo.#tab'
+ char(13) + char(10) + 'DROP TABLE dbo.#crihlp'
+ char(13) + char(10) + 'DROP TABLE dbo.#obj'
+ char(13) + char(10) + 'DROP TABLE dbo.#objhlp'
+ char(13) + char(10) + char(13) + char(10) + '/* WARNINGS */'
+ @rClause
+ char(13) + char(10) + '/* Please search and change screen ProgramName if necessary before running this script; */'
+ char(13) + char(10) + '/* Check to see if Data Column has been added; get ready to push to physical database if yes; */'
+ char(13) + char(10) + '/* Check to see if Data Table has been added; if yes (ModifiedBy is null), verify SystemId and content of function/view and get ready to push to physical database; */'
SELECT (@iClause)
RETURN 0 
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrDelMenu') AND type='P')
DROP PROCEDURE dbo.WrDelMenu
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[WrDelMenu]
 @MenuId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
EXEC dbo.Ir_DelMenuHlp @MenuId
DELETE FROM dbo.Menu WHERE MenuId = @MenuId
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrDelScreenObj') AND type='P')
DROP PROCEDURE dbo.WrDelScreenObj
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[WrDelScreenObj]
 @ScreenObjId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @ScreenId int
SELECT @ScreenId = ScreenId FROM dbo.ScreenObj WHERE ScreenObjId = @ScreenObjId
EXEC dbo.Cr_RmScrObjWRule @ScreenObjId
EXEC dbo.Cr_RmScrObjCRule @ScreenObjId
EXEC dbo.Ir_DelAuthCol @ScreenObjId
DELETE FROM dbo.ScreenObjHlp WHERE ScreenObjId = @ScreenObjId
DELETE FROM dbo.ScreenObj WHERE ScreenObjId = @ScreenObjId
UPDATE dbo.Screen SET NeedRegen = 'Y' WHERE ScreenId = @ScreenId
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrDelScreenTab') AND type='P')
DROP PROCEDURE dbo.WrDelScreenTab
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[WrDelScreenTab]
 @ScreenTabId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
EXEC dbo.Cr_DelScreenTab @ScreenTabId
DELETE FROM dbo.ScreenTabHlp WHERE ScreenTabId = @ScreenTabId
DELETE FROM dbo.ScreenTab WHERE ScreenTabId = @ScreenTabId
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetAdmMenuPerm') AND type='P')
DROP PROCEDURE dbo.WrGetAdmMenuPerm
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[WrGetAdmMenuPerm]
 @screenId		int
,@keyId58		Int
,@RowAuthoritys		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
	,@fClause		varchar(max)
	,@wClause		varchar(max)
	,@oClause		varchar(max)
	,@tClause		varchar(max)
	,@filterClause		varchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
SELECT @fClause = 'FROM dbo.MenuPrm b231' 
SELECT @fClause = @fClause + ' INNER JOIN (SELECT DISTINCT EveryoneCd,EveryoneName FROM RODesign.dbo.CtEveryone)x1892 ON b231.GrantDeny = x1892.EveryoneCd' 
+ ' INNER JOIN (SELECT DISTINCT PermKeyId,PermKeyDesc FROM RODesign.dbo.VwPermKey)x1887 ON b231.PermKeyId = x1887.PermKeyId' 
+ ' LEFT OUTER JOIN (SELECT DISTINCT UsrId,UsrName FROM RODesign.dbo.Usr)Z12 ON b231.PermId = z12.UsrId'
+ ' LEFT OUTER JOIN (SELECT DISTINCT UsrGroupId,UsrGroupName FROM RODesign.dbo.UsrGroup)Z8 ON b231.PermId = z8.UsrGroupId'
+ ' LEFT OUTER JOIN (SELECT DISTINCT AgentId,AgentName FROM ROCmon.dbo.Agent)z1 ON b231.PermId = z1.AgentId'
+ ' LEFT OUTER JOIN (SELECT DISTINCT BrokerId,BrokerName FROM ROCmon.dbo.Broker)z2 ON b231.PermId = z2.BrokerId'
+ ' LEFT OUTER JOIN (SELECT DISTINCT CustomerId,CustomerName FROM ROCmon.dbo.Customer)z4 ON b231.PermId = z4.CustomerId'
+ ' LEFT OUTER JOIN (SELECT DISTINCT InvestorId,InvestorName FROM ROCmon.dbo.Investor)z6 ON b231.PermId = z6.InvestorId'
+ ' LEFT OUTER JOIN (SELECT DISTINCT MemberId,MemberName FROM ROCmon.dbo.Member)z7 ON b231.PermId = z7.MemberId'
+ ' LEFT OUTER JOIN (SELECT DISTINCT VendorId,VendorName FROM ROCmon.dbo.Vendor)z9 ON b231.PermId = z9.VendorId'
+ ' LEFT OUTER JOIN (SELECT DISTINCT CompanyId,CompanyDesc FROM ROCmon.dbo.Company)z10 ON b231.PermId = z10.CompanyId'
+ ' LEFT OUTER JOIN (SELECT DISTINCT ProjectId,ProjectDesc FROM ROCmon.dbo.Project)z11 ON b231.PermId = z11.ProjectId'
SELECT @sClause = 'SELECT MenuPrmId231=b231.MenuPrmId'
+ ', GrantDeny231=x1892.EveryoneCd'
+ ', GrantDeny231Text=x1892.EveryoneName'
+ ', PermKeyId231=x1887.PermKeyId'
+ ', PermKeyId231Text=x1887.PermKeyDesc'
+ ', PermId231=case when x1887.PermKeyId=12 then z12.UsrId'
	+ ' when x1887.PermKeyId=8 then z8.UsrGroupId'
	+ ' when x1887.PermKeyId=1 then z1.AgentId'
	+ ' when x1887.PermKeyId=2 then z2.BrokerId'
	+ ' when x1887.PermKeyId=4 then z4.CustomerId'
	+ ' when x1887.PermKeyId=6 then z6.InvestorId'
	+ ' when x1887.PermKeyId=7 then z7.MemberId'
	+ ' when x1887.PermKeyId=9 then z9.VendorId'
	+ ' when x1887.PermKeyId=10 then z10.CompanyId'
	+ ' when x1887.PermKeyId=11 then z11.ProjectId else null end'
+ ', PermId231Text=case when x1887.PermKeyId=12 then z12.UsrName'
	+ ' when x1887.PermKeyId=8 then z8.UsrGroupName'
	+ ' when x1887.PermKeyId=1 then z1.AgentName'
	+ ' when x1887.PermKeyId=2 then z2.BrokerName'
	+ ' when x1887.PermKeyId=4 then z4.CustomerName'
	+ ' when x1887.PermKeyId=6 then z6.InvestorName'
	+ ' when x1887.PermKeyId=7 then z7.MemberName'
	+ ' when x1887.PermKeyId=9 then z9.VendorName'
	+ ' when x1887.PermKeyId=10 then z10.CompanyDesc'
	+ ' when x1887.PermKeyId=11 then z11.ProjectDesc else null end'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b231.MenuId' + case when @KeyId58 is null then ' is null' else '=' + convert(varchar,@KeyId58) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetButtonHlp') AND type='P')
DROP PROCEDURE dbo.WrGetButtonHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[WrGetButtonHlp]
 @CultureId	smallint
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId	smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT a.ButtonHlpId, a.ButtonName, a.ButtonLongNm, a.ButtonToolTip
	FROM dbo.ButtonHlp a WHERE a.CultureId = @DefCultureId
	AND ((a.ButtonName is not null AND a.ButtonName <> '') OR (a.ButtonLongNm is not null AND a.ButtonLongNm <> '') OR (a.ButtonToolTip is not null AND a.ButtonToolTip <> ''))
	AND NOT EXISTS (SELECT 1 FROM dbo.ButtonHlp
	WHERE ((ScreenId is not null AND a.ScreenId is not null AND ScreenId = a.ScreenId)
	OR (ReportId is not null AND a.ReportId is not null AND ReportId = a.ReportId)
	OR (WizardId is not null AND a.WizardId is not null AND WizardId = a.WizardId))
	AND ButtonTypeId = a.ButtonTypeId AND CultureId = @CultureId)
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetCatCol') AND type='P')
DROP PROCEDURE dbo.WrGetCatCol
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetCatCol]
 @RptwizCatId	smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
/*
SELECT RptwizDtlId184 = null, ColumnId184 = b.ColumnId, ColumnId184Text = b.ColumnDesc
	, ColObjective5 = b.ColObjective, CriOperatorId184 = null, CriOperatorId184Text = null
	, CriSelect184 = null, ColSelect184 = null, ColGroup1184 = null, ColGroup2184 = null
	, ColGroup3184 = null, ColSort184 = null, AggregateCd184 = null, AggregateCd184Text = null
	FROM dbo.RptwizCatDtl a
	INNER JOIN dbo.DbColumn b ON a.TableId = b.TableId
	WHERE a.RptwizCatId = @RptwizCatId
	ORDER BY a.TableId, b.ColumnIndex
*/
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetCustomSp') AND type='P')
DROP PROCEDURE dbo.WrGetCustomSp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetCustomSp]
 @CustomDtlId	int
,@DbId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @ProcedureName	varchar(28)
	,@dbAppDatabase	varchar(50)
SET NOCOUNT ON
SELECT @ProcedureName = ProgramName FROM dbo.CustomDtl WHERE CustomDtlId = @CustomDtlId
SELECT @dbAppDatabase = dbAppDatabase FROM RODesign.dbo.Systems WHERE SystemId = @DbId
EXEC (@dbAppDatabase + '.dbo.MkStoredProcedure '' sp_helptext ' + @ProcedureName + '''')
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetDbTableSys') AND type='P')
DROP PROCEDURE dbo.WrGetDbTableSys
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetDbTableSys]
 @TableId	int
,@DbId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @MultiDesignDb	char(1)
SET NOCOUNT ON
SELECT @MultiDesignDb = MultiDesignDb FROM dbo.DbTable WHERE TableId = @TableId
IF @MultiDesignDb = 'Y'
	SELECT dbProvider = dbAppProvider, dbServer = dbAppServer, dbDatabase = dbDesDatabase, dbUserId = dbAppUserId
	FROM RODesign.dbo.Systems
ELSE
	SELECT dbProvider = dbAppProvider, dbServer = dbAppServer, dbDatabase = dbAppDatabase, dbUserId = dbAppUserId
	FROM RODesign.dbo.Systems WHERE SystemId = @DbId
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetDdlPermId') AND type='P')
DROP PROCEDURE dbo.WrGetDdlPermId
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[WrGetDdlPermId]
 @PermKeyId		int
,@ScreenId		int
,@TableId		int
,@bAll			char(1)
,@keyId			Int
,@RowAuthoritys		varchar(1000)
,@Usrs				varchar(1000)
,@UsrGroups			varchar(1000)
,@Agents			varchar(1000)
,@Brokers			varchar(1000)
,@Customers			varchar(1000)
,@Investors			varchar(1000)
,@Members			varchar(1000)
,@Vendors			varchar(1000)
,@Companys			varchar(1000)
,@Projects			varchar(1000)
,@Cultures			varchar(1000)
,@Borrowers			varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders			varchar(1000)
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		varchar(max)
		,@fClause		varchar(max)
		,@wClause		varchar(max)
		,@oClause		varchar(max)
		,@PermKeydesc	varchar(50)
IF EXISTS (SELECT 1 FROM master.dbo.sysdatabases WHERE name='ROCmon') AND @PermKeyId is not null
BEGIN
	SELECT @PermKeydesc = PermKeydesc FROM RODesign.dbo.VwPermKey WHERE PermKeyId = @PermKeyId
	IF @PermKeydesc = 'Usr'
	BEGIN
		SELECT @sClause = 'SELECT PermId' + convert(varchar,@TableId) + '=a132.UsrId, PermId' + convert(varchar,@TableId) + 'Text=a132.UsrName, a132.Active'
		SELECT @fClause = 'FROM RODesign.dbo.Usr a132'
		SELECT @oClause = 'ORDER BY a132.UsrName'
		IF @bAll = 'Y' SELECT @wClause = 'WHERE (a132.Active = ''Y'' OR ' ELSE SELECT @wClause = 'WHERE ('
		IF @keyId is not null SELECT @wClause = @wClause + 'a132.UsrId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
		EXEC RODesign.dbo.GetPermFilter @ScreenId,null,@RowAuthoritys,@Usrs,'UsrId','Usr','a132.','Y','N',null,'N','UsrId',@wClause OUTPUT
		EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyLs','Company','a132.','Y',null,'UsrId',@wClause OUTPUT
		EXEC RODesign.dbo.GetCurrFilter @currProjectId,'ProjectLs','Project','a132.','Y',null,'UsrId',@wClause OUTPUT
	END
	ELSE IF @PermKeydesc = 'UsrGroup'
	BEGIN
		SELECT @sClause = 'SELECT PermId' + convert(varchar,@TableId) + '=a132.UsrGroupId, PermId' + convert(varchar,@TableId) + 'Text=a132.UsrGroupName, Active=''Y'''
		SELECT @fClause = 'FROM RODesign.dbo.UsrGroup a132'
		SELECT @oClause = 'ORDER BY a132.UsrGroupName'
		IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
		IF @keyId is not null SELECT @wClause = @wClause + 'a132.UsrGroupId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
		EXEC RODesign.dbo.GetPermFilter @ScreenId,null,@RowAuthoritys,@UsrGroups,'UsrGroupId','UsrGroup','a132.','Y','N',null,'N','UsrGroupId',@wClause OUTPUT
		EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyId','Company','a132.','N',null,'UsrGroupId',@wClause OUTPUT
	END
	ELSE IF @PermKeydesc = 'Agent'
	BEGIN
		SELECT @sClause = 'SELECT PermId' + convert(varchar,@TableId) + '=a132.AgentId, PermId' + convert(varchar,@TableId) + 'Text=a132.AgentName, a132.Active'
		SELECT @fClause = 'FROM ROCmon.dbo.Agent a132'
		SELECT @oClause = 'ORDER BY a132.AgentName'
		IF @bAll = 'Y' SELECT @wClause = 'WHERE (a132.Active = ''Y'' OR ' ELSE SELECT @wClause = 'WHERE ('
		IF @keyId is not null SELECT @wClause = @wClause + 'a132.AgentId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
		EXEC RODesign.dbo.GetPermFilter @ScreenId,null,@RowAuthoritys,@Agents,'AgentId','Agent','a132.','Y','N',null,'N','AgentId',@wClause OUTPUT
	END
	ELSE IF @PermKeydesc = 'Broker'
	BEGIN
		SELECT @sClause = 'SELECT PermId' + convert(varchar,@TableId) + '=a132.BrokerId, PermId' + convert(varchar,@TableId) + 'Text=a132.BrokerName, a132.Active'
		SELECT @fClause = 'FROM ROCmon.dbo.Broker a132'
		SELECT @oClause = 'ORDER BY a132.BrokerName'
		IF @bAll = 'Y' SELECT @wClause = 'WHERE (a132.Active = ''Y'' OR ' ELSE SELECT @wClause = 'WHERE ('
		IF @keyId is not null SELECT @wClause = @wClause + 'a132.BrokerId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
		EXEC RODesign.dbo.GetPermFilter @ScreenId,null,@RowAuthoritys,@Brokers,'BrokerId','Broker','a132.','Y','N',null,'N','BrokerId',@wClause OUTPUT
	END
	ELSE IF @PermKeydesc = 'Customer'
	BEGIN
		SELECT @sClause = 'SELECT PermId' + convert(varchar,@TableId) + '=a132.CustomerId, PermId' + convert(varchar,@TableId) + 'Text=a132.CustomerName, a132.Active'
		SELECT @fClause = 'FROM ROCmon.dbo.Customer a132'
		SELECT @oClause = 'ORDER BY a132.CustomerName'
		IF @bAll = 'Y' SELECT @wClause = 'WHERE (a132.Active = ''Y'' OR ' ELSE SELECT @wClause = 'WHERE ('
		IF @keyId is not null SELECT @wClause = @wClause + 'a132.CustomerId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
		EXEC RODesign.dbo.GetPermFilter @ScreenId,null,@RowAuthoritys,@Customers,'CustomerId','Customer','a132.','Y','N',null,'N','CustomerId',@wClause OUTPUT
	END
	ELSE IF @PermKeydesc = 'Investor'
	BEGIN
		SELECT @sClause = 'SELECT PermId' + convert(varchar,@TableId) + '=a132.InvestorId, PermId' + convert(varchar,@TableId) + 'Text=a132.InvestorName, a132.Active'
		SELECT @fClause = 'FROM ROCmon.dbo.Investor a132'
		SELECT @oClause = 'ORDER BY a132.InvestorName'
		IF @bAll = 'Y' SELECT @wClause = 'WHERE (a132.Active = ''Y'' OR ' ELSE SELECT @wClause = 'WHERE ('
		IF @keyId is not null SELECT @wClause = @wClause + 'a132.InvestorId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
		EXEC RODesign.dbo.GetPermFilter @ScreenId,null,@RowAuthoritys,@Investors,'InvestorId','Investor','a132.','Y','N',null,'N','InvestorId',@wClause OUTPUT
	END
	ELSE IF @PermKeydesc = 'Member'
	BEGIN
		SELECT @sClause = 'SELECT PermId' + convert(varchar,@TableId) + '=a132.MemberId, PermId' + convert(varchar,@TableId) + 'Text=a132.MemberName, a132.Active'
		SELECT @fClause = 'FROM ROCmon.dbo.Member a132'
		SELECT @oClause = 'ORDER BY a132.MemberName'
		IF @bAll = 'Y' SELECT @wClause = 'WHERE (a132.Active = ''Y'' OR ' ELSE SELECT @wClause = 'WHERE ('
		IF @keyId is not null SELECT @wClause = @wClause + 'a132.MemberId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
		EXEC RODesign.dbo.GetPermFilter @ScreenId,null,@RowAuthoritys,@Members,'MemberId','Member','a132.','Y','N',null,'N','MemberId',@wClause OUTPUT
	END
	ELSE IF @PermKeydesc = 'Vendor'
	BEGIN
		SELECT @sClause = 'SELECT PermId' + convert(varchar,@TableId) + '=a132.VendorId, PermId' + convert(varchar,@TableId) + 'Text=a132.VendorName, a132.Active'
		SELECT @fClause = 'FROM ROCmon.dbo.Vendor a132'
		SELECT @oClause = 'ORDER BY a132.VendorName'
		IF @bAll = 'Y' SELECT @wClause = 'WHERE (a132.Active = ''Y'' OR ' ELSE SELECT @wClause = 'WHERE ('
		IF @keyId is not null SELECT @wClause = @wClause + 'a132.VendorId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
		EXEC RODesign.dbo.GetPermFilter @ScreenId,null,@RowAuthoritys,@Vendors,'VendorId','Vendor','a132.','Y','N',null,'N','VendorId',@wClause OUTPUT
	END
	ELSE IF @PermKeydesc = 'Company'
	BEGIN
		SELECT @sClause = 'SELECT PermId' + convert(varchar,@TableId) + '=a132.CompanyId, PermId' + convert(varchar,@TableId) + 'Text=a132.CompanyDesc, a132.Active'
		SELECT @fClause = 'FROM ROCmon.dbo.Company a132'
		SELECT @oClause = 'ORDER BY a132.CompanyDesc'
		IF @bAll = 'Y' SELECT @wClause = 'WHERE (a132.Active = ''Y'' OR ' ELSE SELECT @wClause = 'WHERE ('
		IF @keyId is not null SELECT @wClause = @wClause + 'a132.CompanyId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
		EXEC RODesign.dbo.GetPermFilter @ScreenId,null,@RowAuthoritys,@Companys,'CompanyId','Company','a132.','Y','N',null,'N','CompanyId',@wClause OUTPUT
		EXEC RODesign.dbo.GetCurrFilter @currCompanyId,'CompanyId','Company','a132.','N',null,'CompanyId',@wClause OUTPUT
	END
	ELSE IF @PermKeydesc = 'Project'
	BEGIN
		SELECT @sClause = 'SELECT PermId' + convert(varchar,@TableId) + '=a132.ProjectId, PermId' + convert(varchar,@TableId) + 'Text=a132.ProjectDesc, a132.Active'
		SELECT @fClause = 'FROM ROCmon.dbo.Project a132'
		SELECT @oClause = 'ORDER BY a132.ProjectDesc'
		IF @bAll = 'Y' SELECT @wClause = 'WHERE (a132.Active = ''Y'' OR ' ELSE SELECT @wClause = 'WHERE ('
		IF @keyId is not null SELECT @wClause = @wClause + 'a132.ProjectId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
		EXEC RODesign.dbo.GetPermFilter @ScreenId,null,@RowAuthoritys,@Projects,'ProjectId','Project','a132.','Y','N',null,'N','ProjectId',@wClause OUTPUT
		EXEC RODesign.dbo.GetCurrFilter @currProjectId,'ProjectId','Project','a132.','N',null,'ProjectId',@wClause OUTPUT
	END
	ELSE -- 'Culture'
	BEGIN
		SELECT @sClause = 'SELECT PermId' + convert(varchar,@TableId) + '=a132.CultureId, PermId' + convert(varchar,@TableId) + 'Text=a132.CultureTypeDesc, Active=''Y'''
		SELECT @fClause = 'FROM RODesign.dbo.VwCulture a132'
		SELECT @oClause = 'ORDER BY a132.CultureTypeDesc'
		IF @bAll = 'Y' SELECT @wClause = 'WHERE (1=1 OR ' ELSE SELECT @wClause = 'WHERE ('
		IF @keyId is not null SELECT @wClause = @wClause + 'a132.CultureId = ' + convert(varchar,@keyId) + ')' ELSE SELECT @wClause = @wClause + '1<>1)'
		EXEC RODesign.dbo.GetPermFilter @ScreenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','a132.','Y','N',null,'N','CultureId',@wClause OUTPUT
	END
END
ELSE
	SELECT @sClause = 'SELECT PermId' + convert(varchar,@TableId) + '=null, PermId' + convert(varchar,@TableId) + 'Text=null, Active=null WHERE 1<>1'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0



 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetLabel') AND type='P')
DROP PROCEDURE dbo.WrGetLabel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetLabel]
 @CultureId	smallint
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId	smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT a.LabelId, a.LabelText
	FROM dbo.Label a WHERE a.CultureId = @DefCultureId
	AND NOT EXISTS (SELECT 1 FROM dbo.Label WHERE LabelCat = a.LabelCat AND LabelKey = a.LabelKey AND CultureId = @CultureId)
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetMasterTable') AND type='P')
DROP PROCEDURE dbo.WrGetMasterTable
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetMasterTable]
 @ScreenId		int
,@ColumnId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @ScreenTypeName	char(2)
		,@MasterTableId		int
		,@DetailTableId		int
		,@TableId			int
IF @ColumnId is not NULL
BEGIN
	SELECT @ScreenTypeName = b.ScreenTypeName, @MasterTableId = a.MasterTableId, @DetailTableId = a.DetailTableId
		FROM dbo.Screen a INNER JOIN RODesign.dbo.CtScreenType b ON a.ScreenTypeId = b.ScreenTypeId WHERE a.ScreenId = @ScreenId
	SELECT @TableId = TableId FROM dbo.DbColumn WHERE ColumnId = @ColumnId
	IF @ScreenTypeName = 'I2'
	BEGIN
		IF @TableId = @MasterTableId SELECT 'Y'
		ELSE IF @TableId = @DetailTableId SELECT 'N'
		ELSE SELECT ''
	END
	ELSE IF @TableId = @MasterTableId SELECT 'Y'
	ELSE SELECT ''
END
ELSE SELECT ''
RETURN 0 
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetMaxCustLabelNbr') AND type='P')
DROP PROCEDURE dbo.WrGetMaxCustLabelNbr
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[WrGetMaxCustLabelNbr]
 @ScreenId	int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@ParamXML			nvarchar(max) = null /* this is actually the parameters in XML string format */
/* WITH ENCRYPTION */
AS
/* this SP is called via RunWrRule
 * all the parameter has to be passed via @ParamXML as XML string
 * in this case "<Params><LabelCat>LabelCat</LabelCat></Params>"
 */
SET NOCOUNT ON

declare @Param xml
SELECT @Param = CONVERT(xml,@ParamXML)

DECLARE @LabelCat varchar(100), @MaxKeyNumber int

select
@LabelCat= yy.value('(LabelCat/text())[1]', 'varchar(100)')

from 
@Param.nodes('/Params') as  xx(yy)

SELECT @MaxKeyNumber = MAX(CONVERT(int,LabelKey))
FROM dbo.Label
WHERE LabelCat = @LabelCat
AND ISNUMERIC(LabelKey) = 1  

SELECT MaxKeyNumber = ISNULL(@MaxKeyNumber,0)
RETURN 0
 
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetMemTranslate') AND type='P')
DROP PROCEDURE dbo.WrGetMemTranslate
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[WrGetMemTranslate]
 @InStr		nvarchar(2000)
,@CultureId	smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
SELECT OutStr FROM dbo.MemTrans WHERE Instr = @InStr AND CultureTypeId = @CultureId
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetMenuHlp') AND type='P')
DROP PROCEDURE dbo.WrGetMenuHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetMenuHlp]
 @CultureId	smallint
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId	smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT a.MenuHlpId, a.MenuText
	FROM dbo.MenuHlp a WHERE a.CultureId = @DefCultureId
	AND NOT EXISTS (SELECT 1 FROM dbo.MenuHlp WHERE MenuId = a.MenuId AND CultureId = @CultureId)
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetMsgCenter') AND type='P')
DROP PROCEDURE dbo.WrGetMsgCenter
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetMsgCenter]
 @CultureId	smallint
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId	smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT a.MsgCenterId, a.Msg
	FROM dbo.MsgCenter a WHERE a.CultureId = @DefCultureId
	AND NOT EXISTS (SELECT 1 FROM dbo.MsgCenter WHERE MsgId = a.MsgId AND CultureId = @CultureId)
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetReportApp') AND type='P')
DROP PROCEDURE dbo.WrGetReportApp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetReportApp]
 @DbId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
SELECT dbProvider = dbAppProvider, dbServer = dbAppServer, dbDatabase = dbAppDatabase, dbUserId = dbAppUserId
	FROM RODesign.dbo.Systems
	WHERE SystemId = @DbId
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetReportCriHlp') AND type='P')
DROP PROCEDURE dbo.WrGetReportCriHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetReportCriHlp]
 @CultureId	smallint
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId	smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT a.ReportCriHlpId, a.ColumnHeader
	FROM dbo.ReportCriHlp a WHERE a.CultureId = @DefCultureId
	AND NOT EXISTS (SELECT 1 FROM dbo.ReportCriHlp WHERE ReportCriId = a.ReportCriId AND CultureId = @CultureId)
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetReportHlp') AND type='P')
DROP PROCEDURE dbo.WrGetReportHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetReportHlp]
 @CultureId	smallint
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId	smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT a.ReportHlpId, a.DefaultHlpMsg, a.ReportTitle
	FROM dbo.ReportHlp a WHERE a.CultureId = @DefCultureId
	AND NOT EXISTS (SELECT 1 FROM dbo.ReportHlp WHERE ReportId = a.ReportId AND CultureId = @CultureId)
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetRptProc') AND type='P')
DROP PROCEDURE dbo.WrGetRptProc
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetRptProc]
 @ProcName	varchar(50)
,@DbId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @dbAppDatabase	varchar(50)
SET NOCOUNT ON
SELECT @dbAppDatabase = dbAppDatabase FROM RODesign.dbo.Systems WHERE SystemId = @DbId
/* sp_helptext do not accept 'dbo.' */
EXEC (@dbAppDatabase + '.dbo.MkStoredProcedure ''sp_helptext ' + @ProcName + '''')
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetScreenCriHlp') AND type='P')
DROP PROCEDURE dbo.WrGetScreenCriHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetScreenCriHlp]
 @CultureId	smallint
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId	smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT a.ScreenCriHlpId, a.ColumnHeader
	FROM dbo.ScreenCriHlp a WHERE a.CultureId = @DefCultureId
	AND NOT EXISTS (SELECT 1 FROM dbo.ScreenCriHlp WHERE ScreenCriId = a.ScreenCriId AND CultureId = @CultureId)
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetScreenFilterHlp') AND type='P')
DROP PROCEDURE dbo.WrGetScreenFilterHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetScreenFilterHlp]
 @CultureId	smallint
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId	smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT a.ScreenFilterHlpId, a.FilterName
	FROM dbo.ScreenFilterHlp a WHERE a.CultureId = @DefCultureId
	AND NOT EXISTS (SELECT 1 FROM dbo.ScreenFilterHlp WHERE ScreenFilterId = a.ScreenFilterId AND CultureId = @CultureId)
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetScreenHlp') AND type='P')
DROP PROCEDURE dbo.WrGetScreenHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetScreenHlp]
 @CultureId	smallint
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId	smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT a.ScreenHlpId, a.DefaultHlpMsg, a.FootNote, a.ScreenTitle, a.AddMsg, a.UpdMsg, a.DelMsg
	FROM dbo.ScreenHlp a WHERE a.CultureId = @DefCultureId
	AND NOT EXISTS (SELECT 1 FROM dbo.ScreenHlp WHERE ScreenId = a.ScreenId AND CultureId = @CultureId)
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetScreenId') AND type='P')
DROP PROCEDURE dbo.WrGetScreenId
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[WrGetScreenId]
 @ProgramName	varchar(20)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
SELECT ScreenId FROM dbo.Screen WHERE ProgramName = @ProgramName
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetScreenObj') AND type='P')
DROP PROCEDURE dbo.WrGetScreenObj
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[WrGetScreenObj]
 @ScreenId		int
,@CultureId		smallint
,@ScreenObjId   int=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @DefCultureId	smallint
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT a.ScreenTabId, ah.TabFolderName, a.TabFolderOrder, c.GridGrpCd, c.ColumnHeight , c.ScreenObjId, c.MasterTable, c.NewGroupRow, t.ScreenTypeName
	, c.ColumnName, c.TabIndex, c.RequiredValid, c.DefaultValue, c.ColumnId, c.DefAlways, c.SystemValue
	, gc.ColCssClass, gr.RowCssClass
	, ColumnHeader=ISNULL(b.ColumnHeader,'('+c.ColumnName+')')
	, s.ProgramName
	, DisplayMode = dt.TypeDesc
	,e.TableId
	,e.TableName
	,PrimaryKey = f.ColumnName
	,DdlAdnColumnName=x1.ColumnName
	,DdlFtrColumnName=x2.ColumnName
	,c.DdlFtrColumnId,DdlFtrTableId=x2.TableId
	,DdlAdnDataType = ISNULL(d1.DataTypeSqlName,'VarChar')
	,DdlFtrDataType = ISNULL(d2.DataTypeSqlName,'VarChar')
	,DataTypeSByteOle = ISNULL(d3.DataTypeSByteOle,'VarChar')
	,DataTypeDByteOle = ISNULL(d3.DataTypeDByteOle,'VarWChar')
	,d.ColumnLength
	,e.SystemId
FROM dbo.ScreenTab a
INNER JOIN dbo.ScreenTabHlp ah ON a.ScreenTabId = ah.ScreenTabId 
AND (ah.CultureId = @CultureId
	OR (ah.CultureId = @DefCultureId AND not EXISTS (SELECT 1 FROM ScreenTabHlp ah1 WHERE ah1.ScreenTabId = a.ScreenTabId AND ah1.CultureId = @CultureId))
	)
INNER JOIN dbo.Screen s ON a.ScreenId = s.ScreenId
INNER JOIN RODesign.dbo.CtScreenType t ON s.ScreenTypeId = t.ScreenTypeId 
LEFT OUTER JOIN dbo.ScreenObj c ON a.ScreenTabId = c.TabFolderId
LEFT OUTER JOIN dbo.DbColumn d ON c.ColumnId = d.ColumnId
LEFT OUTER JOIN dbo.DbTable e ON d.TableId = e.TableId
LEFT OUTER JOIN (SELECT TableId,ColumnName FROM DbColumn WHERE PrimaryKey = 'Y') f ON e.TableId = f.TableId
LEFT OUTER JOIN dbo.ScreenObjHlp b ON c.ScreenObjId = b.ScreenObjId 
	AND (b.CultureId = @CultureId
	OR (b.CultureId = @DefCultureId AND not EXISTS (SELECT 1 FROM ScreenObjHlp b2 WHERE b2.ScreenObjId = b.ScreenObjId AND b2.CultureId = @CultureId))
	)
LEFT OUTER JOIN RODesign.dbo.GroupCol gc ON c.GroupColId = gc.GroupColId
LEFT OUTER JOIN RODesign.dbo.GroupRow gr ON c.GroupRowId = gr.GroupRowId
LEFT OUTER JOIN RODesign.dbo.CtDisplayType dt ON c.DisplayModeId = dt.TypeId
LEFT OUTER JOIN dbo.DbColumn x1 ON c.DdlAdnColumnId = x1.ColumnId
LEFT OUTER JOIN dbo.DbColumn x2 ON c.DdlFtrColumnId = x2.ColumnId
LEFT OUTER JOIN RODesign.dbo.CtDataType d1 ON x1.DataType = d1.DataTypeId
LEFT OUTER JOIN RODesign.dbo.CtDataType d2 ON x2.DataType = d2.DataTypeId
LEFT OUTER JOIN RODesign.dbo.CtDataType d3 ON d.DataType = d3.DataTypeId
WHERE  (a.ScreenId = @ScreenId OR @ScreenId IS NULL) AND (@ScreenObjId = c.ScreenObjId OR @ScreenObjId IS NULL)
ORDER BY a.TabFolderOrder, c.MasterTable DESC, c.TabIndex
RETURN 0  
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetScreenObjById') AND type='P')
DROP PROCEDURE dbo.WrGetScreenObjById
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[WrGetScreenObjById]
 @screenId		int
,@keyId		nvarchar(1000)
,@Usrs		varchar(1000)
,@RowAuthoritys		varchar(1000)
,@Customers		varchar(1000)
,@Vendors		varchar(1000)
,@Members		varchar(1000)
,@Investors		varchar(1000)
,@Agents		varchar(1000)
,@Brokers		varchar(1000)
,@UsrGroups		varchar(1000)
,@Companys		varchar(1000)
,@Projects		varchar(1000)
,@Cultures		varchar(1000)
,@Borrowers		varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders		varchar(1000)
,@screenFilterId	int
,@currCompanyId		int
,@currProjectId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @sClause		nvarchar(max)
	,@fClause		nvarchar(max)
	,@wClause		nvarchar(max)
	,@oClause		nvarchar(max)
	,@tClause		nvarchar(max)
	,@filterClause		nvarchar(2000)
	,@cc		varchar(max)
	,@rr		varchar(1000)
	,@pp		varchar(1000)
	,@SelUsr		char(1)
	,@SelUsrGroup		char(1)
	,@SelCulture		char(1)
	,@SelCompany		char(1)
	,@SelAgent		char(1)
	,@SelBroker		char(1)
	,@SelCustomer		char(1)
	,@SelInvestor		char(1)
	,@SelMember		char(1)
	,@SelVendor		char(1)
	,@SelProject		char(1)
	,@RowAuthorityId	smallint
	,@CultureId		SmallInt
SELECT @fClause = 'FROM dbo.ScreenObjHlp b21 INNER JOIN dbo.ScreenObj b14 ON b21.ScreenObjId = b14.ScreenObjId'
SELECT @sClause = 'SELECT ScreenObjHlpId21=b21.ScreenObjHlpId, ColumnHeader21=ISNULL(b21.ColumnHeader,''(''+b14.ColumnName+'')'')'
SELECT @oClause = ''
SELECT @wClause = 'WHERE b21.ScreenObjId' + case when @KeyId is null then ' is null' else '=' + convert(varchar,@KeyId) end
SELECT @filterClause=rtrim(FilterClause) FROM RODesign.dbo.ScreenFilter WHERE ScreenFilterId=@screenFilterId AND ApplyToMst<>'Y'
IF @@ROWCOUNT <> 0 SELECT @wClause=@wClause + ' AND ' + @filterClause
EXEC RODesign.dbo.GetPermFilter @screenId,null,@RowAuthoritys,@Cultures,'CultureId','Culture','b21.','Y','N',null,'N','ScreenObjHlpId',@wClause OUTPUT,@Usrs
SELECT @tClause = ''
IF @tClause <> '' SELECT @wClause = @wClause + ' AND (' + right(@tClause,len(@tClause)-4) + ')'
EXEC (@sClause + ' ' + @fClause + ' ' + @wClause + ' ' + @oClause)
RETURN 0

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetScreenObjHlp') AND type='P')
DROP PROCEDURE dbo.WrGetScreenObjHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetScreenObjHlp]
 @CultureId	smallint
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId	smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT a.ScreenObjHlpId, b.DisplayModeId, a.ColumnHeader, a.TbHint, a.ToolTip, a.ErrMessage
	FROM dbo.ScreenObjHlp a INNER JOIN dbo.ScreenObj b ON a.ScreenObjId = b.ScreenObjId
	WHERE a.CultureId = @DefCultureId
	AND NOT EXISTS (SELECT 1 FROM dbo.ScreenObjHlp WHERE ScreenObjId = a.ScreenObjId AND CultureId = @CultureId)
RETURN 0
 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetScreenTabHlp') AND type='P')
DROP PROCEDURE dbo.WrGetScreenTabHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetScreenTabHlp]
 @CultureId	smallint
/* WITH ENCRYPTION */
AS
DECLARE	 @DefCultureId	smallint
SET NOCOUNT ON
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT a.ScreenTabHlpId, a.TabFolderName
	FROM dbo.ScreenTabHlp a WHERE a.CultureId = @DefCultureId
	AND NOT EXISTS (SELECT 1 FROM dbo.ScreenTabHlp WHERE ScreenTabId = a.ScreenTabId AND CultureId = @CultureId)
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetSvrRule') AND type='P')
DROP PROCEDURE dbo.WrGetSvrRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[WrGetSvrRule]
 @ServerRuleId	int
,@DbId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @ProcedureName	varchar(50)
		,@dbAppDatabase	varchar(50)
SET NOCOUNT ON
SELECT @ProcedureName = ProcedureName FROM dbo.ServerRule WHERE ServerRuleId = @ServerRuleId
SELECT @dbAppDatabase = dbAppDatabase FROM RODesign.dbo.Systems WHERE SystemId = @DbId
UPDATE dbo.ServerRule SET LastGenDt = getdate() WHERE ServerRuleId = @ServerRuleId
EXEC (@dbAppDatabase + '.dbo.MkStoredProcedure '' sp_helptext ' + @ProcedureName + '''')
RETURN 0 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetSvrRuleSys') AND type='P')
DROP PROCEDURE dbo.WrGetSvrRuleSys
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetSvrRuleSys]
 @ScreenId	int
,@DbId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @MultiDesignDb	char(1)
SET NOCOUNT ON
SELECT @MultiDesignDb = b.MultiDesignDb FROM dbo.Screen a INNER JOIN dbo.DbTable b on a.MasterTableId = b.TableId WHERE a.ScreenId = @ScreenId
IF @MultiDesignDb = 'Y'
	SELECT dbProvider = dbAppProvider, dbServer = dbAppServer, dbDatabase = dbDesDatabase, dbUserId = dbAppUserId
	FROM RODesign.dbo.Systems
ELSE
	SELECT dbProvider = dbAppProvider, dbServer = dbAppServer, dbDatabase = dbAppDatabase, dbUserId = dbAppUserId
	FROM RODesign.dbo.Systems WHERE SystemId = @DbId
RETURN 0 
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetUageCalender') AND type='P')
DROP PROCEDURE dbo.WrGetUageCalender
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE [dbo].[WrGetUageCalender]
@screenId		int
,@bAll		char(1)
,@keyId		Int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers		varchar(4000)
,@Vendors		varchar(4000)
,@Members		varchar(4000)
,@Investors		varchar(4000)
,@Agents		varchar(4000)
,@Brokers		varchar(4000)
,@UsrGroups		varchar(4000)
,@Companys		varchar(4000)
,@Projects		varchar(4000)
,@Cultures		varchar(4000)
,@Borrowers		varchar(1000)
,@Guarantors	varchar(1000)
,@Lenders		varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@FilterTxt		nvarchar(1000) = null
,@TopN		smallint=null
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE @day1 DATETIME
SELECT @day1 = CONVERT(VARCHAR,DATEPART(YY,GETUTCDATE())) + '.' + CONVERT(VARCHAR,DATEPART(MM,GETUTCDATE())) + '.01'
/* Must return yyyy/mm/dd format (111) */
SELECT UsageDt = CONVERT(varchar,UsageDt,111), Cnt=COUNT(1), Color = CASE WHEN COUNT(1) > 50 THEN 'B' WHEN COUNT(1) < 20 THEN 'R' ELSE 'G' END
	FROM dbo.Usage
	WHERE UsrId = @keyId AND UsageDt >= dateadd(mm,-3,@day1) AND UsageDt < DATEADD(MM,1,@day1)
	GROUP BY CONVERT(varchar,UsageDt,111)
	ORDER BY CONVERT(varchar,UsageDt,111)
RETURN 0



 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetVirtualTbl') AND type='P')
DROP PROCEDURE dbo.WrGetVirtualTbl
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrGetVirtualTbl]
 @TableId	int
,@DbId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @FunctionName	varchar(500)
		,@dbAppDatabase	varchar(50)
		,@dbDesDatabase varchar(50)
		,@FunctionInvoke varchar(100)
		
SET NOCOUNT ON

SELECT @FunctionName = TableName FROM dbo.DbTable WHERE TableId = @TableId
/* handle table name of the form of function(@p1,@p2) 2015.8.27 gary */
DECLARE @OpenBracket int
SELECT @OpenBracket = CHARINDEX('(',@FunctionName)
IF @OpenBracket > 0 SELECT @FunctionName = SUBSTRING(@FunctionName, 1, @OpenBracket - 1)
SELECT @dbAppDatabase = dbAppDatabase FROM RODesign.dbo.Systems WHERE SystemId = @DbId
EXEC (@dbAppDatabase + '.dbo.MkStoredProcedure '' sp_helptext ' + @FunctionName + '''')
RETURN 0 
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrGetWebRule') AND type='P')
DROP PROCEDURE dbo.WrGetWebRule
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[WrGetWebRule]
 @ScreenId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON

SELECT WebRuleId, ReactEventId, ReactRuleProg, ReduxEventId, ReduxRuleProg, ServiceEventId, ServiceRuleProg, AsmxEventId, AsmxRuleProg
FROM dbo.WebRule WHERE ScreenId = @ScreenId
RETURN 0  
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrInsButtonHlp') AND type='P')
DROP PROCEDURE dbo.WrInsButtonHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[WrInsButtonHlp]
 @ButtonHlpId	int
,@CultureId		smallint
,@ButtonName	nvarchar(50)
,@ButtonLongNm	nvarchar(100)
,@ButtonToolTip	nvarchar(200)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
INSERT INTO dbo.ButtonHlp (ScreenId, ReportId, WizardId, CultureId, ButtonTypeId, ButtonName, ButtonLongNm, ButtonToolTip, ButtonVisible, TopVisible, RowVisible, BotVisible)
	SELECT ScreenId, ReportId, WizardId, @CultureId, ButtonTypeId, @ButtonName, @ButtonLongNm, @ButtonToolTip, ButtonVisible, TopVisible, RowVisible, BotVisible
	FROM dbo.ButtonHlp WHERE ButtonHlpId = @ButtonHlpId
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrInsCtButtonHlp') AND type='P')
DROP PROCEDURE dbo.WrInsCtButtonHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[WrInsCtButtonHlp]
 @ButtonHlpId	int
,@CultureId		smallint
,@ButtonName	nvarchar(50)
,@ButtonLongNm	nvarchar(100)
,@ButtonToolTip	nvarchar(200)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
INSERT INTO dbo.CtButtonHlp (ButtonTypeId, CultureId, ButtonName, ButtonLongNm, ButtonToolTip)
	SELECT ButtonTypeId, @CultureId, @ButtonName, @ButtonLongNm, @ButtonToolTip
	FROM dbo.CtButtonHlp WHERE ButtonHlpId = @ButtonHlpId
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrInsCultureLbl') AND type='P')
DROP PROCEDURE dbo.WrInsCultureLbl
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




-- ??Design.only:
CREATE PROCEDURE [dbo].[WrInsCultureLbl]
 @CultureLblId	int
,@CultureId		smallint
,@Label			nvarchar(50)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
INSERT INTO RODesign.dbo.CtCultureLbl (CultureTypeId, CultureId, CultureTypeLabel)
	SELECT CultureTypeId, @CultureId, @Label FROM RODesign.dbo.CtCultureLbl WHERE CultureLblId = @CultureLblId
RETURN 0



 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrInsLabel') AND type='P')
DROP PROCEDURE dbo.WrInsLabel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[WrInsLabel]
 @LabelId		int
,@CultureId		smallint
,@LabelText		nvarchar(max)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
INSERT INTO dbo.Label (CultureId, LabelCat, LabelKey, LabelText, CompanyId, SortOrder)
	SELECT @CultureId, LabelCat, LabelKey, @LabelText, CompanyId, SortOrder
	FROM dbo.Label WHERE LabelId = @LabelId
EXEC dbo.Ir_InitLabel @@IDENTITY
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrInsMenuHlp') AND type='P')
DROP PROCEDURE dbo.WrInsMenuHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[WrInsMenuHlp]
 @MenuHlpId	int
,@CultureId	smallint
,@MenuText	nvarchar(30)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
INSERT INTO dbo.MenuHlp (MenuId, CultureId, MenuText) SELECT MenuId, @CultureId, @MenuText FROM dbo.MenuHlp WHERE MenuHlpId = @MenuHlpId
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrInsMsgCenter') AND type='P')
DROP PROCEDURE dbo.WrInsMsgCenter
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[WrInsMsgCenter]
 @MsgCenterId	int
,@CultureId		smallint
,@Msg			nvarchar(800)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
INSERT INTO dbo.MsgCenter (MsgId, CultureId, Msg) SELECT MsgId, @CultureId, @Msg FROM dbo.MsgCenter WHERE MsgCenterId = @MsgCenterId
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrInsReportCriHlp') AND type='P')
DROP PROCEDURE dbo.WrInsReportCriHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[WrInsReportCriHlp]
 @ReportCriHlpId	int
,@CultureId			smallint
,@ColumnHeader		nvarchar(50)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
INSERT INTO dbo.ReportCriHlp (ReportCriId, CultureId, ColumnHeader)
	SELECT ReportCriId, @CultureId, @ColumnHeader
	FROM dbo.ReportCriHlp WHERE ReportCriHlpId = @ReportCriHlpId
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrInsReportHlp') AND type='P')
DROP PROCEDURE dbo.WrInsReportHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[WrInsReportHlp]
 @ReportHlpId	int
,@CultureId		smallint
,@DefaultHlpMsg	nvarchar(400)
,@ReportTitle	nvarchar(50)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
INSERT INTO dbo.ReportHlp (ReportId, CultureId, DefaultHlpMsg, ReportTitle)
	SELECT ReportId, @CultureId, @DefaultHlpMsg, @ReportTitle
	FROM dbo.ReportHlp WHERE ReportHlpId = @ReportHlpId
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrInsScreenCriHlp') AND type='P')
DROP PROCEDURE dbo.WrInsScreenCriHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[WrInsScreenCriHlp]
 @ScreenCriHlpId	int
,@CultureId			smallint
,@ColumnHeader		nvarchar(50)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
INSERT INTO dbo.ScreenCriHlp (ScreenCriId, CultureId, ColumnHeader)
	SELECT ScreenCriId, @CultureId, @ColumnHeader
	FROM dbo.ScreenCriHlp WHERE ScreenCriHlpId = @ScreenCriHlpId
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrInsScreenFilterHlp') AND type='P')
DROP PROCEDURE dbo.WrInsScreenFilterHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[WrInsScreenFilterHlp]
 @ScreenFilterHlpId	int
,@CultureId			smallint
,@FilterName		nvarchar(50)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
INSERT INTO dbo.ScreenFilterHlp (ScreenFilterId, CultureId, FilterName)
	SELECT ScreenFilterId, @CultureId, @FilterName
	FROM dbo.ScreenFilterHlp WHERE ScreenFilterHlpId = @ScreenFilterHlpId
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrInsScreenHlp') AND type='P')
DROP PROCEDURE dbo.WrInsScreenHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[WrInsScreenHlp]
 @ScreenHlpId	int
,@CultureId		smallint
,@DefaultHlpMsg	nvarchar(400)
,@FootNote	nvarchar(400)
,@ScreenTitle	nvarchar(50)
,@AddMsg	nvarchar(100)
,@UpdMsg	nvarchar(100)
,@DelMsg	nvarchar(100)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
INSERT INTO dbo.ScreenHlp (ScreenId, CultureId, DefaultHlpMsg, FootNote, ScreenTitle, AddMsg, UpdMsg, DelMsg)
	SELECT ScreenId, @CultureId, @DefaultHlpMsg, @FootNote, @ScreenTitle, @AddMsg, @UpdMsg, @DelMsg
	FROM dbo.ScreenHlp WHERE ScreenHlpId = @ScreenHlpId
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrInsScreenObjHlp') AND type='P')
DROP PROCEDURE dbo.WrInsScreenObjHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[WrInsScreenObjHlp]
 @ScreenObjHlpId	int
,@CultureId			smallint
,@ColumnHeader		nvarchar(max)
,@TbHint			nvarchar(1000)
,@ToolTip			nvarchar(1000)
,@ErrMessage		nvarchar(1000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
INSERT INTO dbo.ScreenObjHlp (ScreenObjId, ScreenObjHlpDesc, CultureId, ColumnHeader, TbHint, ToolTip, ErrMessage)
	SELECT ScreenObjId, ScreenObjHlpDesc, @CultureId, @ColumnHeader, @TbHint, @ToolTip, @ErrMessage
	FROM dbo.ScreenObjHlp WHERE ScreenObjHlpId = @ScreenObjHlpId
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrInsScreenTabHlp') AND type='P')
DROP PROCEDURE dbo.WrInsScreenTabHlp
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[WrInsScreenTabHlp]
 @ScreenTabHlpId	int
,@CultureId			smallint
,@TabFolderName		nvarchar(30)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
INSERT INTO dbo.ScreenTabHlp (ScreenTabId, CultureId, TabFolderName)
	SELECT ScreenTabId, @CultureId, @TabFolderName
	FROM dbo.ScreenTabHlp WHERE ScreenTabHlpId = @ScreenTabHlpId
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrRptConvSql') AND type='P')
DROP PROCEDURE dbo.WrRptConvSql
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





-- Assuming all report criteria and columns are filled and the _R and _V s.procs are constructed (must run before Ir_InitReportObj):
CREATE PROCEDURE [dbo].[WrRptConvSql]
 @ReportId		int
/* WITH ENCRYPTION */
AS
DECLARE	 @ProgramName	varchar(50)
		,@CopyReportId	int
		,@ReportTypeCd	char(1)
		,@OrientationCd	char(1)
		,@UnitCd		char(2)
		,@LeftMargin	decimal(8,2)
		,@RightMargin	decimal(8,2)
		,@TopMargin		decimal(8,2)
		,@BottomMargin	decimal(8,2)
		,@RptElmId		int
		,@RptStyleId	int
		,@RptWidth		decimal(8,2)
		,@RptHeight		decimal(8,2)
		,@PRptCtrId		int
		,@HdRptTblId	int
		,@DtRptTblId	int
		,@FtRptTblId	int
		,@RptTblId		int
		,@RptCelId		int
		,@GrpWidth		decimal(8,2)
		,@ii			smallint
		,@ColumnName	varchar(50)
		,@DataTypeId	tinyint
SET NOCOUNT ON
IF (SELECT COUNT(1) FROM dbo.RptStyle) <= 0 EXEC dbo.MkRptStyle
SELECT @ProgramName = ProgramName, @CopyReportId = CopyReportId, @ReportTypeCd = ReportTypeCd, @OrientationCd = OrientationCd, @UnitCd = UnitCd
	, @LeftMargin = LeftMargin, @RightMargin = RightMargin, @TopMargin = TopMargin, @BottomMargin = BottomMargin
	FROM dbo.Report WHERE ReportId = @ReportId
IF @ReportTypeCd = 'C'	-- Crystal Report.
BEGIN
	/* Remove obsolete contents */
	DELETE FROM dbo.RptElm WHERE ReportId = @ReportId
	DELETE FROM dbo.RptCtr WHERE ReportId = @ReportId
	DELETE FROM dbo.RptCel WHERE EXISTS (SELECT 1 FROM dbo.RptTbl
		WHERE dbo.RptTbl.RptTblId = dbo.RptCel.RptTblId AND dbo.RptTbl.ReportId = @ReportId)
	DELETE FROM dbo.RptTbl WHERE ReportId = @ReportId
END
ELSE IF @ReportTypeCd = 'S' AND NOT EXISTS (SELECT 1 FROM dbo.RptCtr WHERE ReportId = @ReportId) AND @CopyReportId IS NULL	-- SQL Report and first time.
BEGIN
	SELECT @RptWidth = case when @OrientationCd = 'P'
			then (case when @UnitCd = 'in' then 8.5 when @UnitCd = 'cm' then 21.59 else 215.9 end)
			else (case when @UnitCd = 'in' then 11.0 when @UnitCd = 'cm' then 27.94 else 279.4 end)
			end - @LeftMargin - @RightMargin
			, @RptHeight = case when @OrientationCd = 'P'
			then (case when @UnitCd = 'in' then 9.5 when @UnitCd = 'cm' then 24.13 else 241.3 end)
			else (case when @UnitCd = 'in' then 7.0 when @UnitCd = 'cm' then 17.78 else 177.8 end)
			end - @TopMargin - @BottomMargin
	/* Fill SQL report footer */
	SELECT @RptElmId = RptElmId FROM dbo.RptElm WHERE ReportId = @ReportId AND RptElmTypeCd = 'F'	-- should be empty but needed here to get around an issue.
	IF @RptElmId is NULL
	BEGIN
		INSERT dbo.RptElm (RptElmDesc, ReportId, RptElmTypeCd, ElmHeight, ElmPrintFirst, ElmPrintLast) SELECT @ProgramName + ' [PageFooter]', @ReportId, 'F', case when @UnitCd = 'in' then 0.7 when @UnitCd = 'cm' then 1.78 else 17.78 end, 'Y', 'Y'
		SELECT @RptElmId = @@IDENTITY
	END
	SELECT @RptStyleId = RptStyleId FROM dbo.RptStyle WHERE DefaultCd = 'PL'
	INSERT dbo.RptCtr (RptElmId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrTop, CtrLeft
		, CtrHeight, CtrWidth, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
		SELECT @RptElmId, @ReportId, 'X', 'PUsrName', @RptStyleId
		, case when @UnitCd = 'in' then 0.3 when @UnitCd = 'cm' then 0.76 else 7.62 end
		, 0.0
		, case when @UnitCd = 'in' then 0.2 when @UnitCd = 'cm' then 0.51 else 5.08 end
		, case when @UnitCd = 'in' then 2.0 when @UnitCd = 'cm' then 5.08 else 50.8 end
		, 'N', 'N', '="By: " &amp; Parameters!UsrName.Value', 'N', 'N', 'N'
	EXEC dbo.Ir_UpdRptCtr @@IDENTITY
	SELECT @RptStyleId = RptStyleId FROM dbo.RptStyle WHERE DefaultCd = 'PR'
	INSERT dbo.RptCtr (RptElmId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrTop, CtrLeft
		, CtrHeight, CtrWidth, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
		SELECT @RptElmId, @ReportId, 'X', 'GPageNumber', @RptStyleId
		, case when @UnitCd = 'in' then 0.3 when @UnitCd = 'cm' then 0.76 else 7.62 end
		, case when @UnitCd = 'in' then @RptWidth - 1.5 when @UnitCd = 'cm' then @RptWidth - 3.81 else @RptWidth - 38.1 end
		, case when @UnitCd = 'in' then 0.2 when @UnitCd = 'cm' then 0.51 else 5.08 end
		, case when @UnitCd = 'in' then 1.5 when @UnitCd = 'cm' then 3.81 else 38.1 end
		, 'N', 'N', '="Page " &amp; Globals!PageNumber &amp; " of " &amp; Globals!TotalPages', 'N', 'N', 'N'
	EXEC dbo.Ir_UpdRptCtr @@IDENTITY
	/* Fill SQL report body */
	SELECT @RptElmId = RptElmId FROM dbo.RptElm WHERE ReportId = @ReportId AND RptElmTypeCd = 'B'	-- should be empty but needed here to get around an issue.
	IF @RptElmId is NULL
	BEGIN
		INSERT dbo.RptElm (RptElmDesc, ReportId, RptElmTypeCd, ElmHeight, ElmPrintFirst, ElmPrintLast) SELECT @ProgramName + ' [Body]', @ReportId, 'B', @RptHeight, 'N', 'N'
		SELECT @RptElmId = @@IDENTITY
	END

	/* Make Parent control */
	INSERT dbo.RptCtr (RptElmId, ReportId, RptCtrTypeCd, RptCtrName, CtrTop, CtrLeft, CtrHeight, CtrWidth, CtrPgBrStart, CtrPgBrEnd, CtrCanGrow, CtrCanShrink, CtrTogether)
		SELECT @RptElmId, @ReportId, 'T', 'TTbl', 0.00, 0.00, @RptHeight, @RptWidth, 'N', 'N', 'N', 'N', 'N'
	SELECT @PRptCtrId = @@IDENTITY EXEC dbo.Ir_UpdRptCtr @PRptCtrId
	/* Define table header */
	INSERT dbo.RptTbl (RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder) SELECT @PRptCtrId, @ReportId, 'H', 'Y', 10
	SELECT @HdRptTblId = @@IDENTITY EXEC dbo.Ir_UpdRptTbl @HdRptTblId
	/* Define table detail */
	INSERT dbo.RptTbl (RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder) SELECT @PRptCtrId, @ReportId, 'D', 'N', 20
	SELECT @DtRptTblId = @@IDENTITY EXEC dbo.Ir_UpdRptTbl @DtRptTblId
	/* Define table footer */
	INSERT dbo.RptTbl (RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder) SELECT @PRptCtrId, @ReportId, 'F', 'N', 30
	SELECT @FtRptTblId = @@IDENTITY EXEC dbo.Ir_UpdRptTbl @FtRptTblId
	SELECT @ii = 200, @GrpWidth = case when @UnitCd = 'in' then 1 when @UnitCd = 'cm' then 2.54 else 25.40 end
	DECLARE cur2 CURSOR FAST_FORWARD FOR
		SELECT ColumnName, DataTypeId FROM dbo.ReportObj WHERE ReportId = @ReportId AND RptObjTypeCd = 'F' FOR READ ONLY
	OPEN cur2 FETCH NEXT FROM cur2 INTO @ColumnName, @DataTypeId
	WHILE @@FETCH_STATUS = 0
	BEGIN
		/* Table column */
		INSERT dbo.RptTbl (RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder, ColWidth) SELECT @PRptCtrId, @ReportId, 'C', 'N', @ii, @GrpWidth
		SELECT @RptTblId = @@IDENTITY
		EXEC dbo.Ir_UpdRptTbl @RptTblId
		/* Define table header cell */
		INSERT dbo.RptCel (RptTblId, RowNum, RowHeight, CelNum) SELECT @HdRptTblId, 1, case when @UnitCd = 'in' then 0.25 when @UnitCd = 'cm' then 0.64 else 6.35 end, @RptTblId
		SELECT @RptCelId = @@IDENTITY EXEC dbo.Ir_UpdRptCel @RptCelId
		/* Define table header control */
		SELECT @RptStyleId = RptStyleId FROM dbo.RptStyle WHERE DefaultCd = 'CH'
		INSERT dbo.RptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrVisibility, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @RptCelId, @ReportId, 'X', 'Hd' + right('00' + convert(varchar,@ii),3), @RptStyleId, 'N', 'N', 'N', '=Parameters!L_' + @ColumnName + '.Value', 'N', 'N', 'N'
		EXEC dbo.Ir_UpdRptCtr @@IDENTITY
		/* Define table detail cell */
		INSERT dbo.RptCel (RptTblId, RowNum, RowHeight, CelNum) SELECT @DtRptTblId, 1, case when @UnitCd = 'in' then 0.2 when @UnitCd = 'cm' then 0.51 else 5.08 end, @RptTblId
		SELECT @RptCelId = @@IDENTITY EXEC dbo.Ir_UpdRptCel @RptCelId
		/* Define table detail control */
		SELECT @RptStyleId = RptStyleId FROM dbo.RptStyle WHERE DefaultCd = case when @DataTypeId in (12,16,21) then 'CD' when @DataTypeId = 7 then 'CM' when @DataTypeId in (1,2,3,4,5,6,18) then 'CN' else 'CS' end
		INSERT dbo.RptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrVisibility, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @RptCelId, @ReportId, 'X', 'Dt' + right('00' + convert(varchar,@ii),3), @RptStyleId, 'N', 'N', 'N', '=Fields!' + @ColumnName + '.Value', 'N', 'N', 'N'
		EXEC dbo.Ir_UpdRptCtr @@IDENTITY
		/* Define first table footer */
		SELECT @RptStyleId = RptStyleId FROM dbo.RptStyle WHERE DefaultCd = case when @DataTypeId in (12,16,21) then 'GD' when @DataTypeId = 7 then 'GM' when @DataTypeId in (1,2,3,4,5,6,18) then 'GN' else 'GS' end
		INSERT dbo.RptCel (RptTblId, RowNum, RowHeight, CelNum) SELECT @FtRptTblId, 1, case when @UnitCd = 'in' then 0.35 when @UnitCd = 'cm' then 0.89 else 8.89 end, @RptTblId
		SELECT @RptCelId = @@IDENTITY EXEC dbo.Ir_UpdRptCel @RptCelId
		INSERT dbo.RptCtr (RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
		SELECT @RptCelId, @ReportId, 'X', 'Ft' + right('00' + convert(varchar,@ii),3), @RptStyleId, 'N', 'N', null, 'N', 'N', 'N'
		EXEC dbo.Ir_UpdRptCtr @@IDENTITY
		SELECT @ii = @ii + 10
		FETCH NEXT FROM cur2 INTO @ColumnName, @DataTypeId
	END
	CLOSE cur2 DEALLOCATE cur2

	/* Fill SQL report header: Needs PIndent */
	SELECT @RptElmId = RptElmId FROM dbo.RptElm WHERE ReportId = @ReportId AND RptElmTypeCd = 'H'	-- should be empty but needed here to get around an issue.
	IF @RptElmId is NULL
	BEGIN
		INSERT dbo.RptElm (RptElmDesc, ReportId, RptElmTypeCd, ElmHeight, ElmPrintFirst, ElmPrintLast) SELECT @ProgramName + ' [PageHeader]', @ReportId, 'H', case when @UnitCd = 'in' then 0.8 when @UnitCd = 'cm' then 2.03 else 20.32 end, 'Y', 'Y'
		SELECT @RptElmId = @@IDENTITY
	END
	SELECT @RptStyleId = RptStyleId FROM dbo.RptStyle WHERE DefaultCd = 'TT'
	INSERT dbo.RptCtr (RptElmId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrTop, CtrLeft
		, CtrHeight, CtrWidth, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
		SELECT @RptElmId, @ReportId, 'X', 'PReportTitle', @RptStyleId
		, case when @UnitCd = 'in' then 0.25 when @UnitCd = 'cm' then 0.64 else 6.35 end
		, 0.0
		, case when @UnitCd = 'in' then 0.3 when @UnitCd = 'cm' then 0.76 else 7.62 end
		, @RptWidth
		, 'N', 'N', '=Parameters!ReportTitle.Value', 'N', 'N', 'N'
	EXEC dbo.Ir_UpdRptCtr @@IDENTITY
	SELECT @RptStyleId = RptStyleId FROM dbo.RptStyle WHERE DefaultCd = 'PR'
	INSERT dbo.RptCtr (RptElmId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrTop, CtrLeft
		, CtrHeight, CtrWidth, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
		SELECT @RptElmId, @ReportId, 'X', 'GExecutionTime', @RptStyleId
		, 0.0
		, case when @UnitCd = 'in' then @RptWidth - 1.5 when @UnitCd = 'cm' then @RptWidth - 3.81 else @RptWidth - 38.1 end
		, case when @UnitCd = 'in' then 0.2 when @UnitCd = 'cm' then 0.51 else 5.08 end
		, case when @UnitCd = 'in' then 1.5 when @UnitCd = 'cm' then 3.81 else 38.1 end
		, 'N', 'N', '=Globals!ExecutionTime', 'N', 'N', 'N'
	EXEC dbo.Ir_UpdRptCtr @@IDENTITY
END
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrRptRmSql') AND type='P')
DROP PROCEDURE dbo.WrRptRmSql
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrRptRmSql]
 @ReportId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
/* Remove obsolete contents */
DELETE FROM dbo.RptElm WHERE ReportId = @ReportId
DELETE FROM dbo.RptCtr WHERE ReportId = @ReportId
DELETE FROM dbo.RptCel WHERE EXISTS (SELECT 1 FROM dbo.RptTbl
	WHERE dbo.RptTbl.RptTblId = dbo.RptCel.RptTblId AND dbo.RptTbl.ReportId = @ReportId)
DELETE FROM dbo.RptTbl WHERE ReportId = @ReportId
RETURN 0
 


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrRptwizDel') AND type='P')
DROP PROCEDURE dbo.WrRptwizDel
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrRptwizDel]
 @ReportId	int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
INSERT INTO dbo.UtReportDel (ReportId, ProgramName) SELECT ReportId, ProgramName FROM dbo.UtReport WHERE ReportId = @ReportId
DELETE FROM dbo.UtReportHlp WHERE ReportId = @ReportId
DELETE FROM dbo.UtReportCriHlp WHERE EXISTS (SELECT 1 FROM dbo.UtReportCri
	WHERE dbo.UtReportCri.ReportCriId = dbo.UtReportCriHlp.ReportCriId AND dbo.UtReportCri.ReportId = @ReportId)
DELETE FROM dbo.UtReportCri WHERE ReportId = @ReportId
DELETE FROM dbo.UtReportObjHlp WHERE EXISTS (SELECT 1 FROM dbo.UtReportObj
	WHERE dbo.UtReportObj.ReportObjId = dbo.UtReportObjHlp.ReportObjId AND dbo.UtReportObj.ReportId = @ReportId)
DELETE FROM dbo.UtReportObj WHERE ReportId = @ReportId
DELETE FROM dbo.UtRptElm WHERE ReportId = @ReportId
DELETE FROM dbo.UtRptCtr WHERE ReportId = @ReportId
DELETE FROM dbo.UtRptCel WHERE EXISTS (SELECT 1 FROM dbo.UtRptTbl
	WHERE dbo.UtRptTbl.RptTblId = dbo.UtRptCel.RptTblId AND dbo.UtRptTbl.ReportId = @ReportId)
DELETE FROM dbo.UtRptTbl WHERE ReportId = @ReportId
DELETE FROM dbo.UtRptCha WHERE ReportId = @ReportId
DELETE FROM dbo.UtRptMemCriDtl WHERE EXISTS (SELECT 1 FROM dbo.UtRptMemCri
	WHERE dbo.UtRptMemCri.RptMemCriId = dbo.UtRptMemCriDtl.RptMemCriId AND dbo.UtRptMemCri.ReportId = @ReportId)
DELETE FROM dbo.UtRptMemCri WHERE ReportId = @ReportId
DELETE FROM dbo.UtReportLstCri WHERE ReportId = @ReportId
DELETE FROM dbo.UtReport WHERE ReportId = @ReportId
RETURN 0

 

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrRptwizGen') AND type='P')
DROP PROCEDURE dbo.WrRptwizGen
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[WrRptwizGen]
 @RptwizId		int
,@AppDatabase	varchar(50)
,@SystemId		tinyint
/* WITH ENCRYPTION */
AS
DECLARE	 @ReportId		int
		,@ReportObjId	int
		,@ReportCriId	int
		,@RptwizTypeCd	char(1)
		,@RptwizCatId	smallint
		,@RptwizName	nvarchar(50)
		,@ColumnId		int
		,@ColumnName	varchar(50)
		,@ColumnHeader	nvarchar(50)
		,@CriSelect		smallint
		,@CriParams		varchar(4000)
		,@Today			datetime
		,@DefCultureId	smallint
		,@DataTypeId	tinyint
		,@DataTypeSize	smallint
		,@DisplayModeId	tinyint
		,@ColumnSize	smallint
		,@RowSize		smallint
		,@DdlKeyColNm	varchar(50)
		,@DdlRefColNm	varchar(50)
		,@RegClause		varchar(400)
		,@StoredProc	varchar(max)
		,@ColSelect		smallint
		,@RptElmId		int
		,@RptStyleId	int
		,@RptWidth		decimal(8,2)
		,@TotWidth		decimal(8,2)
		,@CtrWidth		decimal(8,2)
		,@PrevCtrWidth	decimal(8,2)
		,@PRptCtrId		int
		,@DefaultCd		char(2)
		,@RegCode		varchar(8000)
		,@ValCode		varchar(8000)
		,@TopMargin		decimal(8,2)
		,@BottomMargin	decimal(8,2)
		,@LeftMargin	decimal(8,2)
		,@RightMargin	decimal(8,2)
		,@UnitCd		char(2)
		,@OrientationCd	char(1)
		,@RptChaTypeCd	char(2)
		,@UsrId			int
		,@UsrName		nvarchar(50)
		,@PIndent		decimal(8,2)
		,@ProgramName	varchar(50)
		,@TemplateName	varchar(50)
		,@UsrGroupId	int
		,@UsrGroupLs	varchar(1000)
		,@RptMemFldId	int
		,@RptMemCriId	int
		,@CompanyLs		varchar(1000)
		,@AccessCd		char(1)
SET NOCOUNT ON
SELECT @Today = getdate(), @PIndent = 0.0
SELECT @ProgramName = 'S' + right('0' + convert(varchar,@SystemId),2) + 'Rptwiz' + convert(varchar,@RptwizId)
SELECT @DefCultureId = CultureId FROM RODesign.dbo.VwCulture WHERE CultureDefault = 'Y'
SELECT @ReportId = ReportId, @RptwizTypeCd = RptwizTypeCd
	, @RptwizName = RptwizName, @TemplateName = TemplateName
	, @UnitCd = UnitCd
	, @OrientationCd = OrientationCd
	, @UsrId = UsrId, @AccessCd = AccessCd
	, @TopMargin = TopMargin
	, @BottomMargin = BottomMargin
	, @LeftMargin = LeftMargin
	, @RightMargin = RightMargin
	, @RptWidth = case when OrientationCd = 'P' then (case when @UnitCd = 'in' then 8.5 when @UnitCd = 'cm' then 21.59 else 215.9 end)
		else (case when @UnitCd = 'in' then 11.0 when @UnitCd = 'cm' then 27.94 else 279.4 end) end - @LeftMargin - @RightMargin
	, @RptChaTypeCd = RptChaTypeCd
	, @RptwizCatId = RptwizCatId
	FROM dbo.Rptwiz WHERE RptwizId = @RptwizId
SELECT @CompanyLs = CompanyLs, @UsrName = UsrName FROM RODesign.dbo.Usr WHERE UsrId = @UsrId
If @RptwizTypeCd not in ('B','C','L','T','D') BEGIN RAISERROR('{33}',18,2) WITH SETERROR RETURN 1 END
/* Initialize Style */
IF (SELECT COUNT(1) FROM dbo.RptStyle) <= 0 EXEC dbo.MkRptStyle
/* Prepare criteria parameters */
SELECT @CriParams = ''
DECLARE cur1 CURSOR FAST_FORWARD FOR
	SELECT b.ColumnName, a.CriSelect
	FROM dbo.RptwizDtl a INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
	WHERE a.RptwizId = @RptwizId AND a.CriSelect is not null ORDER BY a.CriSelect
	FOR READ ONLY
OPEN cur1 FETCH NEXT FROM cur1 INTO @ColumnName, @CriSelect
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @CriParams = @CriParams + ', @' + @ColumnName + convert(varchar,@CriSelect)
	FETCH NEXT FROM cur1 INTO @ColumnName, @CriSelect
END
CLOSE cur1 DEALLOCATE cur1
EXEC dbo.MkReportReg @RptwizId, @ProgramName, @AppDatabase, @RegCode OUTPUT
EXEC dbo.MkReportVal @RptwizId, @ProgramName, @AppDatabase, @ValCode OUTPUT
IF @ReportId is not null
BEGIN
	DELETE FROM dbo.UtReportHlp WHERE ReportId = @ReportId
	DELETE FROM dbo.UtReportCriHlp WHERE EXISTS (SELECT 1 FROM dbo.UtReportCri
		WHERE dbo.UtReportCri.ReportCriId = dbo.UtReportCriHlp.ReportCriId AND dbo.UtReportCri.ReportId = @ReportId)
	DELETE FROM dbo.UtReportCri WHERE ReportId = @ReportId
	DELETE FROM dbo.UtReportLstCri WHERE ReportId = @ReportId
		AND NOT EXISTS (SELECT 1 FROM dbo.UtReportCri a WHERE a.ReportCriId = dbo.UtReportLstCri.ReportCriId)
	DELETE FROM dbo.UtReportObjHlp WHERE EXISTS (SELECT 1 FROM dbo.UtReportObj
		WHERE dbo.UtReportObj.ReportObjId = dbo.UtReportObjHlp.ReportObjId AND dbo.UtReportObj.ReportId = @ReportId)
	DELETE FROM dbo.UtReportObj WHERE ReportId = @ReportId
	DELETE FROM dbo.UtRptElm WHERE ReportId = @ReportId
	DELETE FROM dbo.UtRptCtr WHERE ReportId = @ReportId
	DELETE FROM dbo.UtRptCel WHERE EXISTS (SELECT 1 FROM dbo.UtRptTbl
		WHERE dbo.UtRptTbl.RptTblId = dbo.UtRptCel.RptTblId AND dbo.UtRptTbl.ReportId = @ReportId)
	DELETE FROM dbo.UtRptTbl WHERE ReportId = @ReportId
	DELETE FROM dbo.UtRptCha WHERE ReportId = @ReportId
	/* Update report definition template */
	UPDATE dbo.UtReport SET ReportDesc = @RptwizName
		, TemplateName = @TemplateName
		, OrientationCd = @OrientationCd
		, ReportTypeCd = case when @RptwizTypeCd in ('C','L','T') then 'S' when charindex('.rtf',@TemplateName) > 0 then 'R' when charindex('.txt',@TemplateName) > 0 then 'T' else 'B' end
--		, TopMargin = @TopMargin
--		, BottomMargin = @BottomMargin
--		, LeftMargin = @LeftMargin
--		, RightMargin = @RightMargin
		, PageHeight = case when @OrientationCd = 'P' then (case when @UnitCd = 'in' then 11.0 when @UnitCd = 'cm' then 27.94 else 279.4 end) else (case when @UnitCd = 'in' then 8.5 when @UnitCd = 'cm' then 21.59 else 215.9 end) end
		, PageWidth = case when @OrientationCd = 'P' then (case when @UnitCd = 'in' then 8.5 when @UnitCd = 'cm' then 21.59 else 215.9 end) else (case when @UnitCd = 'in' then 11.0 when @UnitCd = 'cm' then 27.94 else 279.4 end) end
--		, UnitCd = @UnitCd
		, RegClause = 'EXEC dbo._Get' + @ProgramName + 'R @wClause' + @CriParams
		, RegCode = @RegCode
		, ValClause = 'EXEC dbo._Get' + @ProgramName + 'V @wClause' + @CriParams
		, ValCode = @ValCode
		, ModifiedBy = @UsrId, ModifiedOn = @Today, LastGenDt = @Today, CompanyLs = @CompanyLs
	WHERE ReportId = @ReportId
END
ELSE
BEGIN
	/* Fill report definition template */
	INSERT dbo.UtReport (ProgramName, ReportDesc, OrientationCd, ReportTypeCd
		, TemplateName, TopMargin, BottomMargin, LeftMargin, RightMargin, PageHeight, PageWidth, UnitCd
		, RegClause, RegCode, ValClause, ValCode, AllowSelect, GenerateRp, ModifiedBy, ModifiedOn, LastGenDt, CompanyLs)
	SELECT @ProgramName, @RptwizName, @OrientationCd
		, case when @RptwizTypeCd in ('C','L','T') then 'S' when charindex('.rtf',@TemplateName) > 0 then 'R' when charindex('.txt',@TemplateName) > 0 then 'T' else 'B' end
		, @TemplateName, @TopMargin, @BottomMargin, @LeftMargin, @RightMargin
		, case when @OrientationCd = 'P' then (case when @UnitCd = 'in' then 11.0 when @UnitCd = 'cm' then 27.94 else 279.4 end) else (case when @UnitCd = 'in' then 8.5 when @UnitCd = 'cm' then 21.59 else 215.9 end) end
		, case when @OrientationCd = 'P' then (case when @UnitCd = 'in' then 8.5 when @UnitCd = 'cm' then 21.59 else 215.9 end) else (case when @UnitCd = 'in' then 11.0 when @UnitCd = 'cm' then 27.94 else 279.4 end) end
		, @UnitCd
		, 'EXEC dbo._Get' + @ProgramName + 'R @wClause' + @CriParams, @RegCode
		, 'EXEC dbo._Get' + @ProgramName + 'V @wClause' + @CriParams, @ValCode
		, case when charindex('.rtf',@TemplateName) > 0 OR charindex('.txt',@TemplateName) > 0 then 'Y' else '' end
		, 'Y', @UsrId, @Today, @Today, @CompanyLs
	SELECT @ReportId = @@IDENTITY
	UPDATE dbo.Rptwiz SET ReportId = @ReportId WHERE RptwizId = @RptwizId
END
INSERT dbo.UtReportHlp (ReportId, ReportTitle, CultureId, DefaultHlpMsg)
SELECT @ReportId, @RptwizName, @DefCultureId, 'Please select the desired criteria and click one of the action buttons to inspect the ' + @RptwizName + '.'
/* Fill report criteria template */
DECLARE cur2 CURSOR FAST_FORWARD FOR
	SELECT a.ColumnId, b.ColumnName, a.CriHeader, a.CriSelect, b.DataType, b.ColumnLength
	FROM dbo.RptwizDtl a INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
	WHERE a.RptwizId = @RptwizId AND a.CriSelect is not null ORDER BY a.CriSelect
FOR READ ONLY
OPEN cur2 FETCH NEXT FROM cur2 INTO @ColumnId, @ColumnName, @ColumnHeader, @CriSelect, @DataTypeId, @DataTypeSize
WHILE @@FETCH_STATUS = 0
BEGIN
	SELECT @DisplayModeId = null, @DdlKeyColNm = null, @DdlRefColNm = null, @ColumnSize = null, @RowSize = null, @RegClause = null, @StoredProc = null
	SELECT @DisplayModeId = DisplayModeId, @DdlKeyColNm = DdlKeyColNm, @DdlRefColNm = DdlRefColNm, @ColumnSize = ColumnSize, @RowSize = RowSize, @RegClause = RegClause, @StoredProc = StoredProc
		FROM dbo.RptWizCatDtl WHERE RptwizCatId = @RptwizCatId AND ColumnId = @ColumnId
	IF @StoredProc is not null
	BEGIN
		SELECT @StoredProc = replace(@StoredProc,'''','''''')
		EXEC (@AppDatabase + '.dbo.MkStoredProcedure ''' + @StoredProc + '''')
	END
	IF @DisplayModeId is null
	BEGIN
		IF @DataTypeId in (12,16,21) SELECT @DisplayModeId = 33 ELSE SELECT @DisplayModeId = 1
	END
	IF @ColumnSize is null
	BEGIN
		IF @DataTypeId in (12,16,21) SELECT @ColumnSize = 180 ELSE SELECT @ColumnSize = 200
	END
	INSERT dbo.UtReportCri (ReportId, ReportCriDesc, ReportGrpId, ColumnName, TabIndex, DataTypeId
		, DataTypeSize, DisplayModeId, ColumnSize, RowSize, DdlKeyColumnName, DdlRefColumnName, RequiredValid, RegClause)
	SELECT @ReportId, @ProgramName + right(space(6) + convert(varchar,@CriSelect),6) + ': ' + @ColumnName + convert(varchar,@CriSelect)
		, 1, @ColumnName + convert(varchar,@CriSelect), @CriSelect, @DataTypeId, @DataTypeSize, @DisplayModeId
		, @ColumnSize, @RowSize, @DdlKeyColNm, @DdlRefColNm, 'N', @RegClause
	SELECT @ReportCriId = @@IDENTITY
	IF NOT EXISTS (SELECT 1 FROM dbo.UtReportCriHlp WHERE ReportCriId = @ReportCriId AND CultureId = @DefCultureId)
		INSERT dbo.UtReportCriHlp (ReportCriId, CultureId, ColumnHeader)
		SELECT @ReportCriId, @DefCultureId, isnull(@ColumnHeader,@ColumnName)
	FETCH NEXT FROM cur2 INTO @ColumnId, @ColumnName, @ColumnHeader, @CriSelect, @DataTypeId, @DataTypeSize
END
CLOSE cur2 DEALLOCATE cur2
/* Initialize last criteria */
INSERT dbo.UtReportLstCri (UsrId, ReportId, ReportCriId)
	SELECT u.UsrId, a.ReportId, a.ReportCriId
	FROM dbo.UtReportCri a INNER JOIN RODesign.dbo.Usr u ON a.ReportId = @ReportId AND u.Active = 'Y'
	WHERE NOT EXISTS (SELECT 1 FROM dbo.UtReportLstCri b WHERE b.UsrId = u.UsrId AND b.ReportId = @ReportId AND a.ReportCriId = b.ReportCriId)
/* Fill report column template */
INSERT dbo.UtReportObj (ReportId, RptObjTypeCd, ColumnName, TabIndex, DataTypeId, ColumnDesc)
	SELECT @ReportId, 'P', 'ReportName', 1, 11,  @ProgramName + '     1: ReportName'
SELECT @ReportObjId = @@IDENTITY
INSERT dbo.UtReportObjHlp (ReportObjId, CultureId, ColumnHeader) SELECT @ReportObjId, @DefCultureId, 'Report Name'
DECLARE cur3 CURSOR FAST_FORWARD FOR
	SELECT a.ColumnId, b.ColumnName, a.ColHeader, a.ColSelect, b.DataType
	FROM dbo.RptwizDtl a INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
	WHERE a.RptwizId = @RptwizId AND a.ColSelect is not null ORDER BY a.ColSelect
FOR READ ONLY
OPEN cur3 FETCH NEXT FROM cur3 INTO @ColumnId, @ColumnName, @ColumnHeader, @ColSelect, @DataTypeId
WHILE @@FETCH_STATUS = 0
BEGIN
	INSERT dbo.UtReportObj (ReportId, RptObjTypeCd, ColumnName, TabIndex, DataTypeId, ColumnDesc)
	SELECT @ReportId, 'F', @ColumnName, @ColSelect, @DataTypeId
		,  @ProgramName + right(space(6) + convert(varchar,@ColSelect),6) + ': ' + @ColumnName
	SELECT @ReportObjId = @@IDENTITY
	IF NOT EXISTS (SELECT 1 FROM dbo.UtReportObjHlp WHERE ReportObjId = @ReportObjId AND CultureId = @DefCultureId)
		INSERT dbo.UtReportObjHlp (ReportObjId, CultureId, ColumnHeader)
		SELECT @ReportObjId, @DefCultureId, isnull(@ColumnHeader,@ColumnName)
	FETCH NEXT FROM cur3 INTO @ColumnId, @ColumnName, @ColumnHeader, @ColSelect, @DataTypeId
END
CLOSE cur3 DEALLOCATE cur3
if @RptwizTypeCd in ('C','L','T')
BEGIN
	If @RptwizTypeCd in ('L','T')
	BEGIN
		/* Fill SQL report footer */
		INSERT dbo.UtRptElm (RptElmDesc, ReportId, RptElmTypeCd, ElmHeight, ElmPrintFirst, ElmPrintLast)
			SELECT @RptwizName + ' [PageFooter]', @ReportId, 'F', case when @UnitCd = 'in' then 0.7 when @UnitCd = 'cm' then 1.78 else 17.78 end, 'Y', 'Y'
		SELECT @RptElmId = @@IDENTITY
		SELECT @RptStyleId = RptStyleId FROM dbo.RptStyle WHERE DefaultCd = 'PL'
		INSERT dbo.UtRptCtr (RptElmId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrTop, CtrLeft
			, CtrHeight, CtrWidth, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @RptElmId, @ReportId, 'X', 'PUsrName', @RptStyleId
			, case when @UnitCd = 'in' then 0.3 when @UnitCd = 'cm' then 0.76 else 7.62 end
			, 0.0
			, case when @UnitCd = 'in' then 0.2 when @UnitCd = 'cm' then 0.51 else 5.08 end
			, case when @UnitCd = 'in' then 2.0 when @UnitCd = 'cm' then 5.08 else 50.8 end
			, 'N', 'N', '="By: " &amp; Parameters!UsrName.Value', 'N', 'N', 'N'
		EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
		SELECT @RptStyleId = RptStyleId FROM dbo.RptStyle WHERE DefaultCd = 'PR'
		INSERT dbo.UtRptCtr (RptElmId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrTop, CtrLeft
			, CtrHeight, CtrWidth, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @RptElmId, @ReportId, 'X', 'GPageNumber', @RptStyleId
			, case when @UnitCd = 'in' then 0.3 when @UnitCd = 'cm' then 0.76 else 7.62 end
			, case when @UnitCd = 'in' then @RptWidth - 1.5 when @UnitCd = 'cm' then @RptWidth - 3.81 else @RptWidth - 38.1 end
			, case when @UnitCd = 'in' then 0.2 when @UnitCd = 'cm' then 0.51 else 5.08 end
			, case when @UnitCd = 'in' then 1.5 when @UnitCd = 'cm' then 3.81 else 38.1 end
			, 'N', 'N', '="Page " &amp; Globals!PageNumber &amp; " of " &amp; Globals!TotalPages', 'N', 'N', 'N'
		EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
	END
	/* Fill SQL report body */
	INSERT dbo.UtRptElm (RptElmDesc, ReportId, RptElmTypeCd, ElmHeight, ElmPrintFirst, ElmPrintLast)
		SELECT @RptwizName + ' [Body]', @ReportId, 'B'
		, case when @OrientationCd = 'P' then
			(case when @UnitCd = 'in' then 9.5 when @UnitCd = 'cm' then 24.13 else 241.3 end)
				else (case when @UnitCd = 'in' then 7.0 when @UnitCd = 'cm' then 17.78 else 177.8 end)
				end - @TopMargin - @BottomMargin
		, 'N', 'N'
	SELECT @RptElmId = @@IDENTITY
	If @RptwizTypeCd = 'L'	-- List:
	BEGIN
		SELECT @PRptCtrId = null
		EXEC dbo.MkReportLis 1, @RptwizId, @RptElmId, @PRptCtrId OUTPUT, @PIndent OUTPUT
		EXEC dbo.MkReportLis 2, @RptwizId, @RptElmId, @PRptCtrId OUTPUT, @PIndent OUTPUT
		EXEC dbo.MkReportLis 3, @RptwizId, @RptElmId, @PRptCtrId OUTPUT, @PIndent OUTPUT
		EXEC dbo.MkReportLis null, @RptwizId, @RptElmId, @PRptCtrId OUTPUT, @PIndent OUTPUT
	END
	ELSE If @RptwizTypeCd = 'T'	EXEC dbo.MkReportTbl @RptwizId, @RptElmId	-- Table:
	If @RptwizTypeCd in ('C','L','T') AND @RptChaTypeCd is not null EXEC dbo.MkReportCha @RptwizTypeCd, @RptwizId, @RptElmId
	If @RptwizTypeCd in ('L','T')
	BEGIN
		/* Fill SQL report header: Needs PIndent */
		INSERT dbo.UtRptElm (RptElmDesc, ReportId, RptElmTypeCd, ElmHeight, ElmPrintFirst, ElmPrintLast)
			SELECT @RptwizName + ' [PageHeader]', @ReportId, 'H', case when @UnitCd = 'in' then 0.8 when @UnitCd = 'cm' then 2.03 else 20.32 end, 'Y', 'Y'
		SELECT @RptElmId = @@IDENTITY
		SELECT @RptStyleId = RptStyleId FROM dbo.RptStyle WHERE DefaultCd = 'TT'
		INSERT dbo.UtRptCtr (RptElmId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrTop, CtrLeft
			, CtrHeight, CtrWidth, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @RptElmId, @ReportId, 'X', 'PReportTitle', @RptStyleId
			, case when @UnitCd = 'in' then 0.25 when @UnitCd = 'cm' then 0.64 else 6.35 end
			, 0.0
			, case when @UnitCd = 'in' then 0.3 when @UnitCd = 'cm' then 0.76 else 7.62 end
			, @RptWidth
			, 'N', 'N', '=Parameters!ReportTitle.Value', 'N', 'N', 'N'
		EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
		SELECT @RptStyleId = RptStyleId FROM dbo.RptStyle WHERE DefaultCd = 'PR'
		INSERT dbo.UtRptCtr (RptElmId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrTop, CtrLeft
			, CtrHeight, CtrWidth, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
			SELECT @RptElmId, @ReportId, 'X', 'GExecutionTime', @RptStyleId
			, 0.0
			, case when @UnitCd = 'in' then @RptWidth - 1.5 when @UnitCd = 'cm' then @RptWidth - 3.81 else @RptWidth - 38.1 end
			, case when @UnitCd = 'in' then 0.2 when @UnitCd = 'cm' then 0.51 else 5.08 end
			, case when @UnitCd = 'in' then 1.5 when @UnitCd = 'cm' then 3.81 else 38.1 end
			, 'N', 'N', '=Globals!ExecutionTime', 'N', 'N', 'N'
		EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
	END
	If @RptwizTypeCd = 'L'	-- List:
	BEGIN
		/* Get the total column width ahead of time */
		SELECT @TotWidth = sum(case when a.ColGroup is null then isnull(c.ColWidth,case when @UnitCd = 'in' then 1.0 when @UnitCd = 'cm' then 2.54 else 25.4 end) else case when @UnitCd = 'in' then 0.2 when @UnitCd = 'cm' then 0.51 else 5.08 end end)
		FROM dbo.RptwizDtl a
		INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
		LEFT OUTER JOIN (SELECT x.ColumnId
			, ColWidth = round(avg(case when @UnitCd = 'in' then x.ColumnSize/150.0 when @UnitCd = 'cm' then x.ColumnSize/150.0*2.54 else x.ColumnSize/150.0*25.4 end),2)
			FROM dbo.ScreenObj x GROUP BY x.ColumnId) c ON b.ColumnId = c.ColumnId
		WHERE a.RptwizId = @RptwizId AND a.ColSelect is not null
		SELECT @RptStyleId = RptStyleId FROM dbo.RptStyle WHERE DefaultCd = 'CH'
		SELECT @PrevCtrWidth = @PIndent
		DECLARE cur4 CURSOR FAST_FORWARD FOR
			SELECT a.ColumnId, b.ColumnName
				, CtrWidth = isnull(c.ColWidth,case when @UnitCd = 'in' then 1.0 when @UnitCd = 'cm' then 2.54 else 25.4 end)
			FROM dbo.RptwizDtl a
			INNER JOIN dbo.DbColumn b ON a.ColumnId = b.ColumnId
			LEFT OUTER JOIN (SELECT x.ColumnId
				, ColWidth = round(avg(case when @UnitCd = 'in' then x.ColumnSize/150.0 when @UnitCd = 'cm' then x.ColumnSize/150.0*2.54 else x.ColumnSize/150.0*25.4 end),2)
				FROM dbo.ScreenObj x GROUP BY x.ColumnId) c ON b.ColumnId = c.ColumnId
			WHERE a.RptwizId = @RptwizId AND a.ColSelect is not null AND ColGroup is null ORDER BY a.ColSelect
		FOR READ ONLY
		OPEN cur4 FETCH NEXT FROM cur4 INTO @ColumnId, @ColumnName, @CtrWidth
		WHILE @@FETCH_STATUS = 0
		BEGIN
			INSERT dbo.UtRptCtr (RptElmId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrTop, CtrLeft
				, CtrHeight, CtrWidth, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
				SELECT @RptElmId, @ReportId, 'X', 'P' + @ColumnName, @RptStyleId
				, case when @UnitCd = 'in' then 0.6 when @UnitCd = 'cm' then 1.52 else 15.24 end
				, @PrevCtrWidth
				, case when @UnitCd = 'in' then 0.2 when @UnitCd = 'cm' then 0.51 else 5.08 end
				, round(@CtrWidth/@TotWidth*@RptWidth,2)
				, 'N', 'N', '=Parameters!L_' + @ColumnName + '.Value', 'N', 'N', 'Y'
			EXEC dbo.Ir_UpdUtRptCtr @@IDENTITY
			SELECT @PrevCtrWidth = @PrevCtrWidth + round(@CtrWidth/@TotWidth*@RptWidth,2)
			FETCH NEXT FROM cur4 INTO @ColumnId, @ColumnName, @CtrWidth
		END
		CLOSE cur4 DEALLOCATE cur4
	END
END
/* Take care of table RptMemCri */
IF not exists (SELECT 1 FROM dbo.UtRptMemCri WHERE ReportId = @ReportId)
BEGIN
	/* My reports */
	SET ROWCOUNT 1
	SELECT @RptMemFldId = RptMemFldId FROM dbo.UtRptMemFld WHERE InputBy = @UsrId
	SET ROWCOUNT 0
	IF @RptMemFldId is null
	BEGIN
		INSERT dbo.UtRptMemFld (RptMemFldName, UsrId, InputBy, CompanyLs, AccessCd)
			SELECT @UsrName + ' Reports', CASE WHEN @AccessCd = 'P' THEN NULL ELSE @UsrId END, @UsrId, @CompanyLs, @AccessCd
		SELECT @RptMemFldId = @@IDENTITY
	END
	INSERT dbo.UtRptMemCri (RptMemFldId, RptMemCriName, ReportId, UsrId, InputBy, InputOn, CompanyLs)
		SELECT @RptMemFldId, @RptwizName, @ReportId, CASE WHEN @AccessCd = 'P' THEN NULL ELSE @UsrId END, @UsrId, getdate(), @CompanyLs
	SELECT @RptMemCriId = @@IDENTITY
	UPDATE dbo.UtRptMemCri SET RptMemCriLink = 'SqlReport.aspx?gen=Y&csy=' + convert(varchar,@SystemId) + '&typ=N&rpt=' + convert(varchar,@ReportId) + '&key=' + convert(varchar,@RptMemCriId)
		WHERE RptMemCriId = @RptMemCriId
END
ELSE
	UPDATE dbo.UtRptMemCri SET UsrId = CASE WHEN @AccessCd = 'P' THEN NULL ELSE @UsrId END, CompanyLs = @CompanyLs WHERE ReportId = @ReportId
SELECT @ReportId
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrSyncByDb') AND type='P')
DROP PROCEDURE dbo.WrSyncByDb
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrSyncByDb]
 @UsrId		int
,@SystemId	tinyint
,@DbId		tinyint
,@TableId	int
,@TableName	varchar(500)
,@TableDesc	nvarchar(100)
,@MultiDesignDb	char(1)
/* WITH ENCRYPTION */
AS
DECLARE	 @AppDb		varchar(50)
	,@DesDb		varchar(50)
	,@Oid		varchar(50)
	,@dClause	nvarchar(4000)
	,@sClause	nvarchar(4000)
SET NOCOUNT ON
SELECT @AppDb = dbAppDatabase FROM RODesign.dbo.Systems WHERE SystemId = @SystemId
SELECT @DesDb = dbDesDatabase FROM RODesign.dbo.Systems WHERE SystemId = @DbId
SELECT @Oid = convert(varchar(50),object_id(@AppDb + '.dbo.' + @TableName))
IF @AppDb is null OR @DesDb is null OR @Oid is null
BEGIN
	RAISERROR('Taregt database not found, please rectify and try again.',18,2) WITH SETERROR
	RETURN 1
END
SELECT @dClause = 'DECLARE @ColumnName varchar(50), @Tid int, @PkName varchar(50), @Indid int, @PkCol varchar(50)'
+ ' SELECT @PkName = name FROM dbo.sysobjects where parent_obj = ' + @Oid + ' and xtype = ''''PK'''''
+ ' SELECT @Indid = indid FROM dbo.sysindexes where id = ' + @Oid + ' and name = @PkName'
+ ' SELECT @PkCol = isnull(index_col(''''' + @TableName + ''''', @Indid, 1),'''''''')'
+ ' IF object_id(''''tempdb.dbo.#sync'''') is not null DROP TABLE dbo.#sync'
+ ' CREATE TABLE #sync (ColumnName varchar(50) not null, DataType tinyint not null, ColumnLength smallint not null, ColumnScale tinyint null'
+ ' ,AllowNulls char(1) not null, ColumnIdentity char(1) not null, PrimaryKey char(1) not null, ColumnIndex smallint null, DefaultValue nvarchar(50) null'
+ ' ,CONSTRAINT PK_#sync PRIMARY KEY CLUSTERED (ColumnName))'
+ ' INSERT dbo.#sync SELECT sc.Name, dt.DataTypeId'
+ ',CASE WHEN dt.DataTypeSqlName = ''''Decimal'''' THEN ColumnProperty(' + @Oid + ',sc.Name,''''Precision'''')'
+ ' WHEN dt.DoubleByte = ''''Y'''' THEN sc.length/2 ELSE (case when sc.length < 0 then 0 else sc.length end) END'
+ ',CASE WHEN dt.DataTypeSqlName = ''''Decimal'''' THEN ColumnProperty(' + @Oid + ',sc.Name,''''Scale'''') ELSE NULL END'
+ ',CASE WHEN ColumnProperty(' + @Oid + ',sc.Name,''''AllowsNull'''') = 1 THEN ''''Y'''' ELSE ''''N'''' END'
+ ',CASE WHEN ColumnProperty(' + @Oid + ',sc.Name,''''IsIdentity'''') = 1 THEN ''''Y'''' ELSE ''''N'''' END'
+ ',CASE WHEN sc.name = @PkCol THEN ''''Y'''' ELSE ''''N'''' END'
+ ',sc.colid * 10, REPLACE(REPLACE(cm.text,''''('''',''''''''),'''')'''','''''''')'
+ ' FROM dbo.syscolumns sc'
+ ' INNER JOIN dbo.systypes st ON sc.xtype = st.xtype '
+ ' INNER JOIN RODesign.dbo.CtDataType dt on dt.DataTypeSqlName = st.name'
+ ' LEFT OUTER JOIN syscomments cm on sc.cDefault = cm.id'
+ ' WHERE sc.id = ' + @Oid + ' AND dt.DataTypeId <> 21 ORDER BY sc.colid'
IF @TableId is null
	SELECT @sClause = ' INSERT ' + @DesDb + '.dbo.DbTable (SystemId, TableName, TableDesc, MultiDesignDb, ModifiedBy, ModifiedOn)'
	+ ' SELECT ' + convert(varchar,@SystemId) + ',''''' + @TableName + ''''',''''' + @TableDesc + ''''''
	+ ',''''' + @MultiDesignDb + ''''',' + convert(varchar,@UsrId) + ',getdate() SELECT @Tid = @@IDENTITY'
ELSE SELECT @sClause = ' SELECT @Tid = ' + convert(varchar,@TableId)
/* Cannot return 1 from MkStoredProcedure. */
SELECT @sClause = @sClause + ' IF EXISTS (SELECT 1 FROM #sync WHERE len(ColumnName) > 50)'
+ ' RAISERROR(''''Column name cannot be more than 50 characters, please check physical database and try again.'''',18,2) WITH SETERROR'
+ ' ELSE BEGIN'
+ ' SELECT @ColumnName = ColumnName FROM ' + @DesDb + '.dbo.DbColumn'
+ ' WHERE TableId = @Tid AND (ExternalTable is null OR ExternalTable = '''''''')'
+ ' AND NOT EXISTS (SELECT 1 FROM #sync WHERE ColumnName = ' + @DesDb + '.dbo.DbColumn.ColumnName)'
+ ' IF @ColumnName is not null'
+ ' RAISERROR(''''Column "%s" not found in the physical database, please rectify and try again.'''',18,2,@ColumnName) WITH SETERROR'
+ ' ELSE BEGIN'
+ ' UPDATE ' + @DesDb + '.dbo.DbColumn SET DataType = (case when a.DataType = 21 AND b.DataType = 12 THEN a.DataType ELSE b.DataType END), ColumnLength = b.ColumnLength, ColumnScale = b.ColumnScale, AllowNulls = b.AllowNulls'
+ ' , ColumnIdentity = b.ColumnIdentity, PrimaryKey = b.PrimaryKey, ColumnIndex = b.ColumnIndex, DefaultValue = b.DefaultValue'
+ ' FROM ' + @DesDb + '.dbo.DbColumn a INNER JOIN #sync b ON a.ColumnName = b.ColumnName'
+ ' WHERE TableId = @Tid AND (ExternalTable is null OR ExternalTable = '''''''')'
+ ' INSERT ' + @DesDb + '.dbo.DbColumn (TableId, ColumnDesc'
+ ' , ColumnName, DataType, ColumnLength, ColumnScale, AllowNulls, ColumnIdentity, PrimaryKey, ColumnIndex, DefaultValue)'
+ ' SELECT @Tid,''''' + @tableName + ' - '''' + ColumnName'
+ ' , ColumnName, DataType, ColumnLength, ColumnScale, AllowNulls, ColumnIdentity, PrimaryKey, ColumnIndex, DefaultValue FROM #sync'
+ ' WHERE NOT EXISTS (SELECT 1 FROM ' + @DesDb + '.dbo.DbColumn'
+ ' WHERE TableId = @Tid AND (ExternalTable is null OR ExternalTable = '''''''')'
+ ' AND ColumnName = #sync.ColumnName)'
+ ' END END DROP TABLE dbo.#sync SELECT @Tid'
+ ' UPDATE ' + @DesDb + '.dbo.DbTable SET LastSyncDt = getdate() WHERE TableId = @Tid'
EXEC (@AppDb + '.dbo.MkStoredProcedure ''' + @dClause + ''', ''' + @sClause + '''')
RETURN 0 
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrSyncToDb') AND type='P')
DROP PROCEDURE dbo.WrSyncToDb
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrSyncToDb]
 @SystemId	tinyint
,@TableId	int
,@TableName	varchar(500)
,@MultiDesignDb	char(1)
/* WITH ENCRYPTION */
AS
DECLARE	 @a1		varchar(max)
		,@a2		varchar(max)
		,@a3		varchar(max)
		,@a4		varchar(max)
		,@a5		varchar(max)
		,@uClause	varchar(max)
		,@AppDb		varchar(50)
		,@DesDb		varchar(50)
		,@Oid		varchar(50)
SET NOCOUNT ON
IF charindex('Microsoft',@@VERSION) <= 0
BEGIN
	RAISERROR('This function is only available on Microsoft SQL for now, please try again later.',18,2) WITH SETERROR
	RETURN 1
END
-- SystemId and DbId are the same:
SELECT @AppDb = dbAppDatabase, @DesDb = dbDesDatabase FROM RODesign.dbo.Systems WHERE SystemId = @SystemId
SELECT @Oid = convert(varchar(500),object_id(@AppDb + '.dbo.' + @TableName))
IF @AppDb is null OR @DesDb is null
BEGIN
	RAISERROR('Taregt database not found, please rectify and try again.',18,2) WITH SETERROR
	RETURN 1
END
SELECT @a1 = 'DECLARE @des varchar(50), @c1Clause nvarchar(max), @s1Clause nvarchar(max), @i1Clause nvarchar(max), @d1Clause nvarchar(max)'
+ ' ,@c2Clause nvarchar(max), @s2Clause nvarchar(max), @i2Clause nvarchar(max), @d2Clause nvarchar(max)'
+ ' ,@pks nvarchar(4000), @def nvarchar(4000), @DbLine nvarchar(4000), @ColumnName varchar(50), @PrevColName varchar(50)'
+ ' ,@DataType varchar(50), @NumericData char(1), @ColumnLength smallint, @ColumnScale tinyint, @AllowNulls char(1), @ColumnIdentity char(1)'
+ ' ,@PrimaryKey char(1), @IsIndexU char(1), @IsIndex char(1), @ColumnIndex smallint, @FirstCreate char(1), @FirstInsert char(1), @DefaultValue nvarchar(50), @HasIdentity char(1)'
+ ' ,@AppInfoId int, @AppInfoDesc varchar(50), @ItemOrder smallint, @AppItemId int, @crIndx varchar(4000), @crIndu varchar(4000), @crIndy varchar(4000)'
+ ' ,@indexId int, @indexName varchar(50), @uniq varchar(50), @clus varchar(50), @indexCol varchar(50), @ii int'
+ ' ,@drFkey varchar(4000) ,@crFkey varchar(4000), @FKeyName varchar(50), @FKeyTbl varchar(50), @FKeyCol varchar(50)'
+ ' ,@FRefTbl varchar(50), @FRefCol varchar(50), @cColumnName varchar(100), @cPrevColName varchar(100)'
+ ' CREATE TABLE #sync (ColumnName varchar(50) not null, DataType varchar(50) not null, NumericData char(1) not null, ColumnLength smallint not null, AllowNulls char(1) not null)'
-- New table (@Oid is null): First rename physical table to Tmp_:
IF @Oid is not null SELECT @a1 = @a1 + ' INSERT dbo.#sync SELECT sc.NAME, st.name, dt.NumericData'
+ ' ,CASE WHEN dt.DataTypeSqlName = ''''Decimal'''' THEN ColumnProperty(' + @Oid + ',sc.Name,''''Precision'''') WHEN sc.length < 0 THEN 0 WHEN dt.DoubleByte = ''''Y'''' THEN sc.length/2 ELSE sc.length END'
+ ' ,CASE WHEN ColumnProperty(' + @Oid + ',sc.Name,''''AllowsNull'''') = 1 THEN ''''Y'''' ELSE ''''N'''' END'
+ ' FROM dbo.syscolumns sc'
+ ' INNER JOIN dbo.systypes st ON sc.xtype = st.xtype'
+ ' INNER JOIN RODesign.dbo.CtDataType dt on dt.DataTypeSqlName = st.name'
+ ' WHERE sc.id = ' + @Oid + ' AND dt.DataTypeId <> 21 ORDER BY sc.colid'
+ ' DECLARE cur1 CURSOR FAST_FORWARD FOR SELECT ColumnName, DataType, NumericData, ColumnLength, AllowNulls FROM dbo.#sync FOR READ ONLY'
+ ' OPEN cur1 FETCH NEXT FROM cur1 INTO @ColumnName, @DataType, @NumericData, @ColumnLength, @AllowNulls'
+ ' SELECT @c1Clause = '''' CREATE TABLE dbo.Tmp_' + @TableName + ' ('''', @i1Clause = '''' INSERT INTO dbo.Tmp_' + @TableName + ' ('''', @s1Clause = '''' SELECT '''''
+ ' SELECT @FirstCreate = ''''Y'''''
+ ' WHILE @@FETCH_STATUS = 0 BEGIN'
+ ' SELECT @ColumnScale = ColumnProperty(' + @Oid + ',@ColumnName,''''Scale'''')'
+ ' IF @DataType = ''''Decimal'''' SELECT @DataType = @DataType + ''''('''' + CONVERT(varchar,@ColumnLength) + '''','''' + CONVERT(varchar,@ColumnScale) + '''')'''''
+ ' ELSE IF (charindex(''''varchar'''',@DataType) > 0 OR charindex(''''varbinary'''',@DataType) > 0) AND @ColumnLength = 0 SELECT @DataType = @DataType + ''''(max)'''''
+ ' ELSE IF charindex(''''char'''',@DataType) > 0 OR charindex(''''binary'''',@DataType) > 0 SELECT @DataType = @DataType + ''''('''' + CONVERT(varchar,@ColumnLength) + '''')'''''
+ ' SELECT @DbLine = @ColumnName + '''' '''' + @DataType'
+ ' IF @AllowNulls = ''''Y'''' SELECT @DbLine = @DbLine + '''' NULL'''' ELSE  SELECT @DbLine = @DbLine + '''' NULL'''''
+ ' IF @FirstCreate = ''''Y'''' SELECT @FirstCreate = ''''N'''' ELSE SELECT @c1Clause = @c1Clause + '''', '''', @i1Clause = @i1Clause + '''', '''', @s1Clause = @s1Clause + '''', '''''
+ ' SELECT @c1Clause = @c1Clause + @DbLine, @i1Clause = @i1Clause + @ColumnName'
+ ' IF @NumericData = ''''Y'''' SELECT @s1Clause = @s1Clause + ''''convert('''' + @DataType + '''','''' + @ColumnName + '''')'''' ELSE SELECT @s1Clause = @s1Clause + @ColumnName'
+ ' FETCH NEXT FROM cur1 INTO @ColumnName, @DataType, @NumericData, @ColumnLength, @AllowNulls'
+ ' END CLOSE cur1 DEALLOCATE cur1'
+ ' SELECT @c1Clause = @c1Clause + '''')'''', @i1Clause = @i1Clause + '''')'''', @s1Clause = @s1Clause + '''' FROM dbo.' + @TableName + ''''''
+ ' SELECT @d1Clause = '''' IF (SELECT COUNT(1) FROM dbo.Tmp_' + @TableName + ') > 0 OR (SELECT COUNT(1) FROM dbo.' + @TableName + ') = 0 DROP TABLE dbo.' + @TableName + ''''''

-- Then recreate the table with contents (Skip new nullable columns):
-- Default value is needed if new column is not null and existing column is nullable:
SELECT @a2 = 'DECLARE cur2 CURSOR FAST_FORWARD FOR'
+ ' SELECT b.ColumnName, b.PrevColName, c.DataTypeSqlName, b.Columnlength, replace(b.DefaultValue,'''''''''''''''',''''''''''''''''''''''''), isnull(b.ColumnScale,0)'
+ ' , b.AllowNulls, b.ColumnIdentity, b.PrimaryKey, b.IsIndexU, b.IsIndex, b.ColumnIndex'
+ ' , CASE WHEN d.DataType is null OR d.DataType = c.DataTypeSqlName OR charindex(''''text'''',d.DataType) > 0 THEN b.ColumnName ELSE ''''CONVERT('''' + c.DataTypeSqlName + '
+ ' CASE WHEN charindex(''''char'''',d.DataType) > 0 OR charindex(''''binary'''',d.DataType) > 0 THEN ''''('''' + CONVERT(varchar,b.ColumnLength) + '''')'''' ELSE '''''''' END + '''','''' + b.ColumnName + '''')'''' END'
+ ' , CASE WHEN b.PrevColName is null OR d.DataType is null OR d.DataType = c.DataTypeSqlName OR charindex(''''text'''',d.DataType) > 0 THEN b.PrevColName ELSE ''''CONVERT('''' + c.DataTypeSqlName + '
+ ' CASE WHEN charindex(''''char'''',d.DataType) > 0 OR charindex(''''binary'''',d.DataType) > 0 THEN ''''('''' + CONVERT(varchar,b.ColumnLength) + '''')'''' ELSE '''''''' END + '''','''' + b.PrevColName + '''')'''' END'
+ ' FROM ' + @DesDb + '.dbo.DbColumn b'
+ ' INNER JOIN RODesign.dbo.CtDataType c ON b.DataType = c.DataTypeId'
+ ' LEFT OUTER JOIN #Sync d ON d.ColumnName = b.ColumnName'
+ ' WHERE b.TableId = ' + convert(varchar,@TableId) + ' AND (b.ExternalTable is null OR b.ExternalTable = '''''''') ORDER BY b.ColumnIndex FOR READ ONLY OPEN cur2'
+ ' FETCH NEXT FROM cur2 INTO @ColumnName, @PrevColName, @DataType, @ColumnLength, @DefaultValue, @ColumnScale, @AllowNulls, @ColumnIdentity, @PrimaryKey, @IsIndexU, @IsIndex, @ColumnIndex, @cColumnName, @cPrevColName'
+ ' SELECT @c2Clause = '''' IF NOT EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(''''''''''''''''dbo.' + @TableName + ''''''''''''''''')) CREATE TABLE dbo.' + @TableName + ' ('''', @i2Clause = '''' INSERT INTO dbo.' + @TableName + ' ('''', @s2Clause = '''' SELECT '''''
+ ' SELECT @crIndu = '''''''', @crIndy = '''''''', @pks = '''''''', @def = '''''''', @FirstCreate = ''''Y'''', @FirstInsert = ''''Y'''', @HasIdentity = ''''N'''''
+ ' WHILE @@FETCH_STATUS = 0'
+ ' BEGIN'
	+ ' IF @IsIndexU = ''''Y'''' BEGIN IF @crIndu <> '''''''' SELECT @crIndu = @crIndu + '''','''' SELECT @crIndu = @crIndu + @ColumnName END'
	+ ' IF @IsIndex = ''''Y'''' BEGIN IF @crIndy <> '''''''' SELECT @crIndy = @crIndy + '''','''' SELECT @crIndy = @crIndy + @ColumnName END'
	+ ' IF @ColumnIndex is null RAISERROR(''''Column %s requires column order, please specify and try again.'''',18,2,@ColumnName) WITH SETERROR'
	+ ' IF @DataType = ''''Decimal'''' SELECT @DbLine = @ColumnName + '''' '''' + @DataType + ''''('''' + CONVERT(varchar,@ColumnLength) + '''','''' + CONVERT(varchar,@ColumnScale) + '''')'''''
	+ ' ELSE IF (charindex(''''varchar'''',@DataType) > 0 OR charindex(''''varbinary'''',@DataType) > 0) AND @ColumnLength = 0 SELECT @DbLine = @ColumnName + '''' '''' + @DataType + ''''(max)'''''
	+ ' ELSE IF charindex(''''char'''',@DataType) > 0 OR charindex(''''binary'''',@DataType) > 0 SELECT @DbLine = @ColumnName + '''' '''' + @DataType + ''''('''' + CONVERT(varchar,@ColumnLength) + '''')'''''
	+ ' ELSE SELECT @DbLine = @ColumnName + '''' '''' + @DataType'
	+ ' IF @ColumnIdentity = ''''Y'''' SELECT @DbLine = @DbLine + '''' IDENTITY'''', @HasIdentity = ''''Y'''''
	+ ' IF @AllowNulls = ''''Y'''' SELECT @DbLine = @DbLine + '''' NULL'''' ELSE  SELECT @DbLine = @DbLine + '''' NOT NULL'''''
	+ ' IF @FirstCreate = ''''Y'''' SELECT @c2Clause = @c2Clause + @DbLine, @FirstCreate = ''''N'''' ELSE SELECT @c2Clause = @c2Clause + '''', '''' + @DbLine'
	+ ' IF NOT (@AllowNulls = ''''Y'''' AND @PrevColName is null AND NOT EXISTS (SELECT 1 FROM #sync WHERE ColumnName = @ColumnName))'
	+ ' BEGIN'
		+ ' IF @FirstInsert = ''''Y'''' SELECT @i2Clause = @i2Clause + @ColumnName ELSE SELECT @i2Clause = @i2Clause + '''', '''' + @ColumnName'
		IF @Oid is not null SELECT @a2 = @a2 + ' IF @DefaultValue is null AND @ColumnIdentity = ''''N'''' AND @AllowNulls = ''''N'''''
		+ ' AND ((@PrevColName is null AND NOT EXISTS (SELECT 1 FROM #sync WHERE ColumnName = @ColumnName))'
		+ ' OR (@PrevColName is null AND EXISTS (SELECT 1 FROM #sync WHERE ColumnName = @ColumnName AND AllowNulls = ''''Y''''))'
		+ ' OR (@PrevColName is not null AND NOT EXISTS (SELECT 1 FROM #sync WHERE ColumnName = @PrevColName))'
		+ ' OR (@PrevColName is not null AND EXISTS (SELECT 1 FROM #sync WHERE ColumnName = @PrevColName AND AllowNulls = ''''Y'''')))'
		+ ' RAISERROR(''''Column %s requires default value, please specify and try again.'''',18,2,@ColumnName) WITH SETERROR'
		SELECT @a2 = @a2 + ' IF @FirstInsert <> ''''Y'''' SELECT @s2Clause = @s2Clause + '''', '''''
		+ ' IF @AllowNulls = ''''N'''' AND @DefaultValue is not null'
		+ ' BEGIN'
			+ ' IF @PrevColName is null'
				+ ' IF NOT EXISTS (SELECT 1 FROM #sync WHERE ColumnName = @ColumnName)'
				+ ' SELECT @s2Clause = @s2Clause + @DefaultValue'
				+ ' ELSE IF EXISTS (SELECT 1 FROM #sync WHERE ColumnName = @ColumnName AND AllowNulls = ''''Y'''')'
				+ ' SELECT @s2Clause = @s2Clause + ''''CASE WHEN '''' + @ColumnName + '''' is null THEN '''' + @DefaultValue + '''' ELSE '''' + @cColumnName + '''' END'''''
				+ ' ELSE SELECT @s2Clause = @s2Clause + @cColumnName'
			+ ' ELSE IF NOT EXISTS (SELECT 1 FROM #sync WHERE ColumnName = @PrevColName)'
				+ ' SELECT @s2Clause = @s2Clause + @DefaultValue'
				+ ' ELSE IF EXISTS (SELECT 1 FROM #sync WHERE ColumnName = @PrevColName AND AllowNulls = ''''Y'''')'
				+ ' SELECT @s2Clause = @s2Clause + ''''CASE WHEN '''' + @PrevColName + '''' is null THEN '''' + @DefaultValue + '''' ELSE '''' + @cPrevColName + '''' END'''''
				+ ' ELSE SELECT @s2Clause = @s2Clause + @cPrevColName'
		+ ' END'
		+ ' ELSE IF @PrevColName is null SELECT @s2Clause = @s2Clause + @cColumnName ELSE SELECT @s2Clause = @s2Clause + @cPrevColName'
		+ ' IF @PrimaryKey = ''''Y'''' OR @ColumnName = ''''CultureId'''''
		+ ' BEGIN'
			+ ' IF @pks = '''''''' SELECT @pks = @ColumnName ELSE SELECT @pks = @pks + '''', '''' + @ColumnName'
		+ ' END'
		+ ' IF @FirstInsert = ''''Y'''' SELECT @FirstInsert = ''''N'''''
	+ ' END'
	+ ' IF @DefaultValue is not null'
	+ ' SELECT @def = @def + '''' ALTER TABLE dbo.' + @TableName + ' ADD CONSTRAINT DF_' + @TableName + '_'''' + @ColumnName + '''' DEFAULT ('''' + @DefaultValue + '''') FOR '''' + @ColumnName'
	+ ' FETCH NEXT FROM cur2 INTO @ColumnName, @PrevColName, @DataType, @ColumnLength, @DefaultValue, @ColumnScale, @AllowNulls, @ColumnIdentity, @PrimaryKey, @IsIndexU, @IsIndex, @ColumnIndex, @cColumnName, @cPrevColName'
+ ' END'
+ ' CLOSE cur2 DEALLOCATE cur2'
+ ' IF @crIndu <> '''''''' SELECT @crIndu = '''' IF NOT EXISTS (SELECT 1 FROM dbo.sysindexes WHERE name = ''''''''''''''''IU_' + @TableName + ''''''''''''''''') CREATE UNIQUE NONCLUSTERED INDEX IU_' + @TableName + ' ON dbo.' + @TableName + '('''' + @crIndu + '''')'''''
+ ' IF @crIndy <> '''''''' SELECT @crIndy = '''' IF NOT EXISTS (SELECT 1 FROM dbo.sysindexes WHERE name = ''''''''''''''''IX_' + @TableName + ''''''''''''''''') CREATE NONCLUSTERED INDEX IX_' + @TableName + ' ON dbo.' + @TableName + '('''' + @crIndy + '''')'''''

-- Assign Primary Keys and Defaults, if any:
SELECT @a3 = ' IF @pks <> '''''''' SELECT @c2Clause = @c2Clause + '''', CONSTRAINT PK_' + @TableName + ' PRIMARY KEY CLUSTERED ('''' + @pks + '''')'''' '
+ ' SELECT @c2Clause = @c2Clause + '''')'''', @i2Clause = @i2Clause + '''')'''', @s2Clause = @s2Clause + '''' FROM dbo.Tmp_' + @TableName + ''''''
+ ' IF @HasIdentity = ''''Y'''' BEGIN'
+ ' SELECT @i2Clause = '''' SET IDENTITY_INSERT dbo.' + @TableName + ' ON'''' + @i2Clause'
+ ' SELECT @s2Clause = @s2Clause + '''' SET IDENTITY_INSERT dbo.' + @TableName + ' OFF'''' END'
+ ' SELECT @d2Clause = '''' IF (SELECT COUNT(1) FROM dbo.' + @TableName + ') > 0 OR (SELECT COUNT(1) FROM dbo.Tmp_' + @TableName + ') = 0 DROP TABLE dbo.Tmp_' + @TableName + ''''''

IF @Oid is not null
BEGIN
	-- Take care of foreign keys, if any:
	SELECT @a3 = @a3 + ' SELECT @crFkey = '''''''', @drFkey = '''''''''
	+ ' DECLARE cur4 CURSOR FAST_FORWARD FOR'
	+ ' SELECT so1.name, object_name(sr.fkeyid), col_name(sr.fkeyid,sr.fkey1), object_name(sr.rkeyid), col_name(sr.rkeyid,sr.rkey1)'
	+ ' FROM dbo.sysreferences sr'
	+ ' INNER JOIN dbo.sysobjects so1 ON sr.constid = so1.id'
	+ ' INNER JOIN dbo.sysobjects so2 ON sr.fkeyid = so2.id'
	+ ' WHERE sr.fkeyid = ' + @Oid + ' or sr.rkeyid = ' + @Oid + ' ORDER BY so1.name FOR READ ONLY'
	+ ' OPEN cur4 FETCH NEXT FROM cur4 INTO @FKeyName, @FKeyTbl, @FKeyCol, @FRefTbl, @FRefCol'
	+ ' WHILE @@FETCH_STATUS = 0 BEGIN'
		+ ' SELECT @drFkey = @drFkey + '''' IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE name='''''''''''''''''''' + @FKeyName + '''''''''''''''''''') ALTER TABLE dbo.'''' + @FKeyTbl + '''' DROP CONSTRAINT '''' + @FKeyName'
		+ ' SELECT @crFkey = @crFkey + '''' ALTER TABLE dbo.'''' + @FKeyTbl + '''' WITH NOCHECK ADD CONSTRAINT '''' + @FKeyName + '''''
		+ ' FOREIGN KEY ('''' + @FKeyCol + '''') REFERENCES dbo.'''' + @FRefTbl + '''' ('''' + @FRefCol + '''')'''''
		+ ' FETCH NEXT FROM cur4 INTO @FKeyName, @FKeyTbl, @FKeyCol, @FRefTbl, @FRefCol'
	+ ' END'
	+ ' CLOSE cur4'
	+ ' DEALLOCATE cur4'
	-- Take care of index, if any:
	SELECT @a3 = @a3 + ' SELECT @crIndx = '''''''''
	/* Obsolete after non-unique index can be configured on screen.
	+ ' DECLARE cur5 CURSOR FAST_FORWARD FOR SELECT indid, name'
	+ ', case when (status & 2) = 0 then '''''''' else '''' UNIQUE'''' end'
	+ ', case when (status & 16) = 0 then '''' NONCLUSTERED'''' else '''' CLUSTERED'''' end'
	+ ' FROM dbo.sysindexes'
	+ ' WHERE id = ' + @OId + ' AND indid IN (SELECT indid FROM dbo.sysindexkeys WHERE id = ' + @OId + ')'
	+ ' AND LEFT(name,3) = ''''IX_'''' FOR READ ONLY'
	+ ' OPEN cur5 FETCH NEXT FROM cur5 INTO @indexId, @indexName, @uniq, @clus'
	+ ' WHILE @@FETCH_STATUS = 0 BEGIN '
		+ ' SELECT @ii = 1, @indexCol = '''''''''
		+ ' SELECT @crIndx = @crIndx + '''' CREATE '''' + @uniq + @clus + '''' INDEX '''' + @indexName + '''' ON dbo.' + @TableName + ' ('''''
		+ ' WHILE (@indexCol IS NOT NULL) BEGIN '
			+ ' SELECT @indexCol = index_col(''''dbo.' + @TableName + ''''', @indexId, @ii)'
			+ ' IF @ii = 1 AND @indexCol IS NOT NULL SELECT @crIndx = @crIndx + @indexCol'
			+ ' ELSE IF @indexCol IS NOT NULL SELECT @crIndx = @crIndx + '''','''' + @indexCol'
			+ ' SELECT @ii = @ii + 1'
		+ ' END '
		+ ' SELECT @crIndx = @crIndx + '''')'''''
	+ '	FETCH NEXT FROM cur5 INTO @indexId, @indexName, @uniq, @clus'
	+ ' END'
	+ ' CLOSE cur5'
	+ ' DEALLOCATE cur5'
	*/
END
SELECT @a4 = ' IF ''''' + @MultiDesignDb + ''''' = ''''N'''' BEGIN'
IF @Oid is null
	SELECT @a4 = @a4 + ' EXEC (''''' + @AppDb + '.dbo.MkStoredProcedure '''''''''''' + @c2Clause + '''''''''''','''''''''''' + @def + '''''''''''','''''''''''' + @crIndu + '''''''''''','''''''''''' + @crIndy + '''''''''''''''') END'
ELSE
	SELECT @a4 = @a4 + ' EXEC (''''' + @AppDb + '.dbo.MkStoredProcedure '''''''''''' + @drFkey + '''''''''''','''''''''''' + @c1Clause + '''''''''''','''''''''''' + @i1Clause + '''''''''''','''''''''''' + @s1Clause + '''''''''''','''''''''''' + @d1Clause + '''''''''''''''')'
	+ ' EXEC (''''' + @AppDb + '.dbo.MkStoredProcedure '''''''''''' + @c2Clause + '''''''''''','''''''''''' + @def + '''''''''''','''''''''''' + @i2Clause + '''''''''''','''''''''''' + @s2Clause + '''''''''''','''''''''''' + @d2Clause + '''''''''''','''''''''''' + @crIndx + '''''''''''','''''''''''' + @crFkey + '''''''''''','''''''''''' + @crIndu + '''''''''''','''''''''''' + @crIndy + '''''''''''''''') END'
SELECT @a4 = @a4 + ' ELSE BEGIN DECLARE cur3 CURSOR FAST_FORWARD FOR SELECT dbDesDatabase FROM RODesign.dbo.Systems FOR READ ONLY'
+ ' OPEN cur3 FETCH NEXT FROM cur3 INTO @des'
+ ' WHILE @@FETCH_STATUS = 0 BEGIN'
IF @Oid is null
	SELECT @a4 = @a4 + ' EXEC (@des + ''''.dbo.MkStoredProcedure '''''''''''' + @c2Clause + '''''''''''','''''''''''' + @def + '''''''''''','''''''''''' + @crIndu + '''''''''''','''''''''''' + @crIndy + '''''''''''''''')'
ELSE
	SELECT @a4 = @a4 + ' EXEC (@des + ''''.dbo.MkStoredProcedure '''''''''''' + @drFkey + '''''''''''','''''''''''' + @c1Clause + '''''''''''','''''''''''' + @i1Clause + '''''''''''','''''''''''' + @s1Clause + '''''''''''','''''''''''' + @d1Clause + '''''''''''''''')'
	+ ' EXEC (@des + ''''.dbo.MkStoredProcedure '''''''''''' + @c2Clause + '''''''''''','''''''''''' + @def + '''''''''''','''''''''''' + @i2Clause + '''''''''''','''''''''''' + @s2Clause + '''''''''''','''''''''''' + @d2Clause + '''''''''''','''''''''''' + @crIndx + '''''''''''','''''''''''' + @crFkey + '''''''''''','''''''''''' + @crIndu + '''''''''''','''''''''''' + @crIndy + '''''''''''''''')'
SELECT @a4 = @a4 + ' FETCH NEXT FROM cur3 INTO @des END CLOSE cur3 DEALLOCATE cur3 END'
+ ' DROP TABLE #sync'
-- Keep a copy for deployment and reset table for future update:
SELECT @a5 = ' SELECT @AppInfoId = max(AppInfoId) FROM ' + @DesDb + '.dbo.AppInfo'
+ ' IF @AppInfoId is null RAISERROR(''''Table AppInfo should not be empty, please specify and try again.'''',18,2) WITH SETERROR'
+ ' ELSE BEGIN SELECT @AppInfoDesc = AppInfoDesc FROM ' + @DesDb + '.dbo.AppInfo WHERE AppInfoId = @AppInfoId'
+ ' SELECT @ItemOrder = isnull(max(ItemOrder),0) + 10 FROM ' + @DesDb + '.dbo.AppItem WHERE AppInfoId = @AppInfoId'
+ ' INSERT ' + @DesDb + '.dbo.AppItem (AppItemDesc, AppInfoId, ItemOrder, ObjectTypeCd, DbProviderCd, AppItemName, MultiDesignDb, AppItemCode, RemoveItem)'
+ ' SELECT @AppInfoDesc + '''':D:'''' + right(space(4)+convert(varchar,@ItemOrder),5) + '''':*:*:M: Change table ' + @TableName + ''''''
+ ' ,@AppInfoId, @ItemOrder, ''''D'''', ''''M'''', ''''Change table ' + @TableName + ''''', ''''' + @MultiDesignDb + ''''', '
IF @Oid is null
	SELECT @a5 = @a5 + ' '''' EXEC ('''''''''''' + @c2Clause + '''''''''''')'''' + '''' EXEC ('''''''''''' + @def + '''''''''''')'''' + '''' EXEC ('''''''''''' + @crIndu + '''''''''''')'''' + '''' EXEC ('''''''''''' + @crIndy + '''''''''''')'''', ''''N'''''
ELSE
	SELECT @a5 = @a5 + ' '''' EXEC ('''''''''''' + @drFkey + @c1Clause + '''''''''''')'''''
	+ ' + '''' EXEC ('''''''''''' + @i1Clause + @s1Clause + @d1Clause + '''''''''''')'''''
	+ ' + '''' EXEC ('''''''''''' + @c2Clause + '''''''''''')'''''
	+ ' + '''' EXEC ('''''''''''' + @def + @i2Clause + @s2Clause + @d2Clause + @crIndx + @crFkey + @crIndu + @crIndy + '''''''''''')'''', ''''N'''''
SELECT @a5 = @a5 + ' SELECT @AppItemId = @@IDENTITY'
+ ' UPDATE ' + @DesDb + '.dbo.AppItem SET AppItemLink = ''''SearchLink("AdmAppItem.aspx?id=213&key='''' + convert(varchar,@AppItemId)'
+ ' + ''''&typ=N&sys=' + convert(varchar,@SystemId) + '","","",""); return false;'''' WHERE AppItemId = @AppItemId'
+ ' UPDATE ' + @DesDb + '.dbo.DbColumn SET PrevColName = null WHERE TableId = ' + convert(varchar,@TableId) + ' END'
+ ' UPDATE ' + @DesDb + '.dbo.DbTable SET LastSyncDt = getdate() WHERE TableId = ' + convert(varchar,@TableId)
EXEC (@AppDb + '.dbo.MkStoredProcedure ''' + @a1 + ''', ''' + @a2 + ''', ''' + @a3 + ''', ''' + @a4 + ''', ''' + @a5 + '''')
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrUpdMemTranslate') AND type='P')
DROP PROCEDURE dbo.WrUpdMemTranslate
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





CREATE PROCEDURE [dbo].[WrUpdMemTranslate]
 @InStr		nvarchar(2000)
,@CultureId	smallint
,@OutStr	nvarchar(2000)
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
IF @InStr is not null AND RTRIM(@InStr) <> '' AND @CultureId is not null AND @OutStr is not null AND RTRIM(@OutStr) <> ''
BEGIN
	IF EXISTS (SELECT 1 FROM dbo.MemTrans WHERE Instr = @InStr AND CultureTypeId = @CultureId)
		UPDATE dbo.MemTrans SET OutStr = @OutStr WHERE Instr = @InStr AND CultureTypeId = @CultureId
	ELSE
		INSERT dbo.MemTrans (Instr, CultureTypeId, OutStr) SELECT @Instr, @CultureId, @OutStr
END
RETURN 0


 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrUpdMenu') AND type='P')
DROP PROCEDURE dbo.WrUpdMenu
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[WrUpdMenu]
 @MenuId		int
,@PMenuId		int
,@MenuText		nvarchar(30)
,@ParentId		int
,@CultureId		smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @MenuIndex		smallint
IF @PMenuId is NULL
	SELECT @MenuIndex = 0
ELSE
	SELECT @MenuIndex = MenuIndex + 1 FROM dbo.Menu WHERE MenuId = @PMenuId
UPDATE dbo.Menu SET MenuIndex = @MenuIndex, ParentId = @ParentId WHERE MenuId = @MenuId
EXEC dbo.Ir_UpdMenuIndex
EXEC dbo.Ir_InitMenuHlp @MenuId
IF EXISTS (SELECT 1 FROM dbo.MenuHlp WHERE MenuId = @MenuId AND CultureId = @CultureId)
	UPDATE dbo.MenuHlp SET MenuText = @MenuText WHERE MenuId = @MenuId AND CultureId = @CultureId
ELSE
	INSERT dbo.MenuHlp (MenuId, CultureId, MenuText) SELECT @MenuId, @CultureId, @MenuText
RETURN 0

 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrUpdScreenGridObjLayout') AND type='P')
DROP PROCEDURE dbo.WrUpdScreenGridObjLayout
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[WrUpdScreenGridObjLayout]
 @ScreenId			int
,@Usrs				varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers			varchar(4000)
,@Vendors			varchar(4000)
,@Members			varchar(4000)
,@Investors			varchar(4000)
,@Agents			varchar(4000)
,@Brokers			varchar(4000)
,@UsrGroups			varchar(4000)
,@Companys			varchar(4000)
,@Projects			varchar(4000)
,@Cultures			varchar(4000)
,@Borrowers			varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders			varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@ParamXML			nvarchar(max) = null /* this is actually the parameters in XML string format */
/* WITH ENCRYPTION */
AS
/* this SP is called via RunWrRule
 * all the parameter has to be passed via @ParamXML as XML string
 * in this case <Params><ScreenObjId></ScreenObjId><PriorScreenObjId></PriorScreenObjId><GridGrpCd></GridGrpCd><NextScreenObjId></NextScreenObjId><NextGridGrpCd></NextGridGrpCd></Params>
 */
SET NOCOUNT ON

declare @Param xml, @ScreenObjId int, @PriorScreenObjId int, @GridGrpCd CHAR(1), @NextScreenObjId int, @NextGridGrpCd char(1),@OldNextScreenObjId int, @PromoGridGrpCd char(1), @TargetScreenId int, @MasterTable char(1)
SELECT @Param = CONVERT(xml,@ParamXML)

DECLARE @ScreenObj table (rid int identity, ScreenObjId int, GridGrpCd char(1))

select
@ScreenObjId= yy.value('(ScreenObjId/text())[1]', 'varchar(50)')
,@GridGrpCd = yy.value('(GridGrpCd/text())[1]', 'varchar(50)')
,@PriorScreenObjId = yy.value('(PriorScreenObjId/text())[1]', 'varchar(50)')
,@NextScreenObjId = yy.value('(NextScreenObjId/text())[1]', 'varchar(50)')
,@NextGridGrpCd = yy.value('(NextGridGrpCd/text())[1]', 'varchar(50)')
from 
@Param.nodes('/Params') as  xx(yy)

SELECT @TargetScreenId = ScreenId, @MasterTable = MasterTable
FROM ScreenObj o
WHERE o.ScreenObjId = @ScreenObjId

/* find the original immediate item following the moved item(which was a ring leader) */
select TOP 1 @OldNextScreenObjId = o2.ScreenObjId, @PromoGridGrpCd = o.GridGrpCd
FROM ScreenObj o
INNER JOIN ScreenObj o2 ON o.ScreenId = o2.ScreenId AND o2.TabIndex > o.TabIndex AND o.ScreenObjId <> o2.ScreenObjId AND o.MasterTable = o2.MasterTable
WHERE o.ScreenObjId = @ScreenObjId
AND o.GridGrpCd IN ('N','Y') -- if moved one is on its own(N) or under previous(Y)
ORDER BY o2.TabIndex

/* first all obj before the target one */
INSERT INTO @ScreenObj (ScreenObjId, GridGrpCd)
SELECT o2.ScreenObjId, 
		CASE 
		WHEN @OldNextScreenObjId = o2.ScreenObjId AND o2.GridGrpCd IN ('Y','I') THEN @PromoGridGrpCd -- original immediate follower which is not on its own becomes ring leader as we move the ring leader away 
		ELSE o2.GridGrpCd END
FROM 
ScreenObj o
INNER JOIN ScreenObj o2 on o2.ScreenId = o.ScreenId AND o2.MasterTable = o.MasterTable AND o.TabIndex >= o2.TabIndex AND o2.ScreenObjId <> @ScreenObjId
WHERE o.ScreenObjId = @PriorScreenObjId
ORDER BY o2.TabIndex

/* then the target one */
INSERT INTO @ScreenObj (ScreenObjId, GridGrpCd)
SELECT @ScreenObjId, @GridGrpCd

/* then everything after the target one */
INSERT INTO @ScreenObj (ScreenObjId, GridGrpCd)
SELECT o2.ScreenObjId, 
CASE 
WHEN @NextScreenObjId = o2.ScreenObjId THEN @NextGridGrpCd -- one right next may have been changed
WHEN @OldNextScreenObjId = o2.ScreenObjId  AND o2.GridGrpCd IN ('Y','I') THEN @PromoGridGrpCd -- original immediate follower which is not on its own becomes ring leader as we move the ring leader away 
ELSE o2.GridGrpCd END 
FROM 
ScreenObj o
INNER JOIN ScreenObj o2 on o2.ScreenId = o.ScreenId AND o2.MasterTable = o.MasterTable AND (o.TabIndex < o2.TabIndex OR @PriorScreenObjId IS NULL) AND o2.ScreenObjId <> @ScreenObjId
WHERE 
o.ScreenObjId = @PriorScreenObjId OR 
(@PriorScreenObjId IS NULL AND o.ScreenId = @TargetScreenId AND o.MasterTable = @MasterTable AND NOT EXISTS (SELECT 1 FROM ScreenObj o3 WHERE o3.ScreenId = @TargetScreenId AND o3.MasterTable = @MasterTable AND o3.TabIndex < o.TabIndex))
ORDER BY o2.TabIndex

DECLARE @BaseTabIndex int
SELECT @BaseTabIndex = MAX(o2.TabIndex)
FROM ScreenObj o
INNER JOIN ScreenObj o2 on o.ScreenId = o2.ScreenId AND o.MasterTable <> o2.MasterTable
WHERE o.ScreenObjId = @ScreenObjId

UPDATE o2
SET TabIndex = ISNULL(@BaseTabIndex,0) + o.rid * 10, GridGrpCd = o.GridGrpCd
FROM 
@ScreenObj o
INNER JOIN ScreenObj o2 on o.ScreenObjId = o2.ScreenObjId

UPDATE s
set NeedRegen = 'Y'
FROM ScreenObj o
INNER JOIN Screen s on s.ScreenId = o.Screenid
INNER JOIN @ScreenObj o2 on o2.ScreenObjId = o.ScreenObjId

--RAISERROR('stopped.',18,2) WITH SETERROR
--RETURN 1
	
RETURN 0
 
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrUpdScreenGridObjSize') AND type='P')
DROP PROCEDURE dbo.WrUpdScreenGridObjSize
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[WrUpdScreenGridObjSize]
 @ScreenId	int
,@Usrs		varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers			varchar(4000)
,@Vendors			varchar(4000)
,@Members			varchar(4000)
,@Investors			varchar(4000)
,@Agents			varchar(4000)
,@Brokers			varchar(4000)
,@UsrGroups			varchar(4000)
,@Companys			varchar(4000)
,@Projects			varchar(4000)
,@Cultures			varchar(4000)
,@Borrowers			varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders			varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@ParamXML		nvarchar(max) = null /* this is actually the parameters in XML string format */
/* WITH ENCRYPTION */
AS
/* this SP is called via RunWrRule
 * all the parameter has to be passed via @ParamXML as XML string
 * in this case <Params><ScreenObjId></ScreenObjId><ColumnWidth></ColumnWidth><ColumnHeight></ColumnHeight></Params>
 */
SET NOCOUNT ON

declare @Param xml, @ScreenObjId int, @ColumnWidth int, @ColumnHeight int
SELECT @Param = CONVERT(xml,@ParamXML)

select
@ScreenObjId= yy.value('(ScreenObjId/text())[1]', 'varchar(50)')
,@ColumnWidth = yy.value('(ColumnWidth/text())[1]', 'varchar(50)')
,@ColumnHeight = yy.value('(ColumnHeight/text())[1]', 'varchar(50)')
from 
@Param.nodes('/Params') as  xx(yy)

UPDATE O
SET ColumnSize = @ColumnWidth, ColumnHeight = @ColumnHeight
FROM ScreenObj o
WHERE ScreenObjId = @ScreenObjId

UPDATE s
set NeedRegen = 'Y'
FROM ScreenObj o
INNER JOIN Screen s on o.ScreenId = s.ScreenId
WHERE ScreenObjId = @ScreenObjId

RETURN 0
 
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrUpdScreenObj') AND type='P')
DROP PROCEDURE dbo.WrUpdScreenObj
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO




CREATE PROCEDURE [dbo].[WrUpdScreenObj]
 @ScreenObjId		int
,@PScreenObjId		int
,@ColumnHeader		nvarchar(max)
,@TabFolderId		int
,@CultureId			smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @ScreenObjHlpId	int
		,@ScreenId			int
		,@TabIndex			smallint
IF @PScreenObjId is NULL
	SELECT @TabIndex = 0
ELSE
	SELECT @TabIndex = TabIndex + 1 FROM dbo.ScreenObj WHERE ScreenObjId = @PScreenObjId
SELECT @ScreenId = ScreenId FROM dbo.ScreenObj WHERE ScreenObjId = @ScreenObjId
UPDATE dbo.ScreenObj SET TabIndex = @TabIndex, TabFolderId = @TabFolderId WHERE ScreenObjId = @ScreenObjId
EXEC dbo.Ir_UpdScreenObjInd @ScreenId
EXEC dbo.Ir_InitScreenObjHlp @ScreenObjId
IF EXISTS (SELECT 1 FROM dbo.ScreenObjHlp WHERE ScreenObjId = @ScreenObjId AND CultureId = @CultureId)
	UPDATE dbo.ScreenObjHlp SET ColumnHeader = ISNULL (@ColumnHeader, ColumnHeader) WHERE ScreenObjId = @ScreenObjId AND CultureId = @CultureId
ELSE
BEGIN
	INSERT dbo.ScreenObjHlp (ScreenObjId, CultureId, ColumnHeader) SELECT @ScreenObjId, @CultureId, @ColumnHeader
	SELECT @ScreenObjHlpId = @@IDENTITY
	EXEC dbo.Ir_UpdScreenObjHlp @ScreenObjHlpId
END
UPDATE dbo.Screen SET NeedRegen = 'Y' WHERE ScreenId = @ScreenId
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrUpdScreenObjLayoutAndSize') AND type='P')
DROP PROCEDURE dbo.WrUpdScreenObjLayoutAndSize
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[WrUpdScreenObjLayoutAndSize]
 @ScreenId			int
,@Usrs				varchar(4000)
,@RowAuthoritys		varchar(4000)
,@Customers			varchar(4000)
,@Vendors			varchar(4000)
,@Members			varchar(4000)
,@Investors			varchar(4000)
,@Agents			varchar(4000)
,@Brokers			varchar(4000)
,@UsrGroups			varchar(4000)
,@Companys			varchar(4000)
,@Projects			varchar(4000)
,@Cultures			varchar(4000)
,@Borrowers			varchar(1000)
,@Guarantors		varchar(1000)
,@Lenders			varchar(1000)
,@currCompanyId		int
,@currProjectId		int
,@ParamXML		nvarchar(max) = null /* this is actually the @ScreenObjLocationList */
/* WITH ENCRYPTION */
AS
/* this SP is called via RunWrRule
 * all the parameter has to be passed via @ParamXML as XML string
 * in this case
 * <ScreenObjs><ScreenObj><id>1</id><r>rr</r><c>cc</c></ScreenObj><ScreenObj><id>2</id><tabId>3</tabId><r>rr2</r><c>cc2</c><h>100</h><g>Y</g></ScreenObj></ScreenObjs>
 * the TabIndex is in natural order of the <ScreenObj> occurence
 */
SET NOCOUNT ON

declare @ScreenObjLocations xml, @inCount int, @soCount int, @updCount int, @ScreenObjLocationList varchar(MAX)

SELECT @ScreenObjLocationList = @ParamXML
SELECT @ScreenObjLocations = CONVERT(xml,@ScreenObjLocationList)

DECLARE @ScreenObj table (id int, tabFolderId int, r varchar(50), c varchar(50), g varchar(50), h int, TabIndex int)

INSERT INTO
@ScreenObj
select
id= yy.value('(id/text())[1]', 'varchar(50)')
,tabFolderId = yy.value('(tabId/text())[1]', 'varchar(50)')
,r = yy.value('(r/text())[1]', 'varchar(50)')
,c = yy.value('(c/text())[1]', 'varchar(50)')
,g = yy.value('(g/text())[1]', 'varchar(50)')
,h = yy.value('(h/text())[1]', 'varchar(50)')
,TabIndex = ROW_NUMBER() OVER (ORDER BY xx.yy)
from 
@ScreenObjLocations.nodes('/ScreenObjs/ScreenObj') as  xx(yy)

SELECT @inCount = @@ROWCOUNT 

SELECT 
@ScreenId = ScreenId
FROM
@ScreenObj o 
INNER JOIN ScreenObj so on o.id = so.ScreenObjId
GROUP BY ScreenId

SELECT @soCount = COUNT(*)
FROM 
ScreenObj 
WHERE ScreenId = @ScreenId AND MasterTable = 'Y'

--SELECT 
UPDATE so SET
TabIndex = o.TabIndex * 10
,TabFolderId = o.tabFolderId
,GroupRowId = ISNULL(gr.GroupRowId,so.GroupRowId)
,GroupColId = ISNULL(gc.GroupColId,so.GroupColId)
,NewGroupRow = o.g
--,ColumnHeight = o.h
--,gr.GroupRowName,gc.GroupColName,so.ColumnDesc, so.ScreenId
FROM
@ScreenObj o 
INNER JOIN dbo.ScreenObj so on o.id = so.ScreenObjId
INNER JOIN RODesign.dbo.GroupRow gr on gr.RowCssClass = o.r
INNER JOIN RODesign.dbo.GroupCol gc on gc.ColCssClass = o.c

SELECT @updCount = @@ROWCOUNT 

IF @inCount <> @updCount /* # of objects in the IDE <> # of object updated, something is wrong */
BEGIN
	RAISERROR('# of Screen Object to be updated(%d) does not match passed in definition(%d), please refresh ',18,2, @updCount, @inCount) WITH SETERROR
	RETURN 1
END

IF @soCount <> @updCount /* # of objects in the IDE <> current # of object in the table for the screen, something is wrong */
BEGIN
	RAISERROR('# of Screen Object to be updated(%d) does not match current definition(%d), please refresh ',18,2, @updCount, @soCount) WITH SETERROR
	RETURN 1
END
update dbo.Screen set NeedRegen = 'Y' where ScreenId =  @ScreenId
SELECT @updCount
RETURN 0

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrUpdScreenReactGen') AND type='P')
DROP PROCEDURE dbo.WrUpdScreenReactGen
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[WrUpdScreenReactGen]
 @ScreenId		int
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
UPDATE dbo.Screen SET ReactGenerated = 'Y' WHERE ScreenId = @ScreenId
RETURN 0
 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrUpdScreenTab') AND type='P')
DROP PROCEDURE dbo.WrUpdScreenTab
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO






CREATE PROCEDURE [dbo].[WrUpdScreenTab]
 @ScreenTabId		int
,@TabFolderOrder	tinyint
,@TabFolderName		nvarchar(50)
,@CultureId			smallint
/* WITH ENCRYPTION */
AS
SET NOCOUNT ON
DECLARE	 @ScreenId		int
UPDATE dbo.ScreenTab SET TabFolderOrder = @TabFolderOrder, TabFolderName = LEFT(REPLACE(@TabFolderName,' ',space(0)),30) WHERE ScreenTabId = @ScreenTabId
SELECT @ScreenId = ScreenId FROM dbo.ScreenTab WHERE ScreenTabId = @ScreenTabId
EXEC dbo.Ir_UpdScreenObjInd @ScreenId
EXEC dbo.Ir_UpdScreenTab @ScreenTabId
IF EXISTS (SELECT 1 FROM dbo.ScreenTabHlp WHERE ScreenTabId = @ScreenTabId AND CultureId = @CultureId)
	UPDATE dbo.ScreenTabHlp SET TabFolderName = @TabFolderName WHERE ScreenTabId = @ScreenTabId AND CultureId = @CultureId
ELSE
	INSERT dbo.ScreenTabHlp (ScreenTabId, CultureId, TabFolderName) SELECT @ScreenTabId, @CultureId, @TabFolderName
	
UPDATE S
set NeedRegen = 'Y'
FROM ScreenTab t
INNER JOIN Screen s on t.ScreenId = s.ScreenId
WHERE t.ScreenTabId = @ScreenTabId
	
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'dbo.WrXferRpt') AND type='P')
DROP PROCEDURE dbo.WrXferRpt
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO





/* Migrate a report from Report Generator to Advanced Report for further customization. Original should be deleted after this is called. */
CREATE PROCEDURE [dbo].[WrXferRpt]
 @ReportId	int
/* WITH ENCRYPTION */
AS
DECLARE	 @NReportId		int
		,@ReportCriId	int
		,@NReportCriId	int
		,@ReportObjId	int
		,@NReportObjId	int
		,@RptElmId		int
		,@NRptElmId		int
		,@RptTblId		int
		,@NRptTblId		int
		,@RptCelId		int
		,@NRptCelId		int
		,@RptCtrId		int
		,@NRptCtrId		int
		,@RptChaId		int
		,@ProgramName	varchar(100)
SET NOCOUNT ON
IF (SELECT COUNT(1) FROM dbo.RptStyle) <= 0 EXEC dbo.MkRptStyle
SELECT @ProgramName = ProgramName FROM dbo.UtReport WHERE ReportId = @ReportId
IF EXISTS (SELECT 1 FROM dbo.Report WHERE ProgramName = @ProgramName)
BEGIN
	RAISERROR('This report has already been transferred. Please verify before trying again.',18,2) WITH SETERROR
	RETURN 1
END
BEGIN TRANSACTION
INSERT dbo.Report (ProgramName, ReportDesc, OrientationCd, ReportTypeCd, TemplateName, RptTemplate
, CopyReportId, TopMargin, BottomMargin, LeftMargin, RightMargin, PageHeight, PageWidth, UnitCd, WhereClause, RegClause
, RegCode, ValClause, ValCode, UpdClause, UpdCode, XlsClause, XlsCode, GenerateRp, AllowSelect, ModifiedBy, ModifiedOn
, LastGenDt, CompanyLs, NeedRegen) 
SELECT ProgramName, ReportDesc, OrientationCd, ReportTypeCd, TemplateName, RptTemplate
, CopyReportId, TopMargin, BottomMargin, LeftMargin, RightMargin, PageHeight, PageWidth, UnitCd, WhereClause, RegClause
, RegCode, ValClause, ValCode, UpdClause, UpdCode, XlsClause, XlsCode, GenerateRp, AllowSelect, ModifiedBy, ModifiedOn
, LastGenDt, CompanyLs, 'Y' FROM dbo.UtReport WHERE ReportId = @ReportId
SELECT @NReportId = @@IDENTITY
IF @@ERROR <> 0 ROLLBACK TRANSACTION
INSERT dbo.ReportHlp (ReportId, CultureId, DefaultHlpMsg, ReportTitle)
SELECT @NReportId, CultureId, DefaultHlpMsg, ReportTitle FROM dbo.UtReportHlp WHERE ReportId = @ReportId
IF @@ERROR <> 0 ROLLBACK TRANSACTION

DECLARE cur1 CURSOR FAST_FORWARD FOR SELECT ReportCriId FROM dbo.UtReportCri WHERE ReportId = @ReportId FOR READ ONLY
OPEN cur1 FETCH NEXT FROM cur1 INTO @ReportCriId
WHILE @@FETCH_STATUS = 0
BEGIN
	INSERT dbo.ReportCri (ReportId, ReportCriDesc, ReportGrpId, LabelCss, ContentCss, TableId, TableAbbr, ColumnName
	, TabIndex, DataTypeId, DataTypeSize, DisplayModeId, ColumnSize, RowSize, DdlKeyColumnName, DdlRefColumnName
	, DdlSrtColumnName, RequiredValid, WhereClause, RegClause)
	SELECT @NReportId, ReportCriDesc, ReportGrpId, LabelCss, ContentCss, TableId, TableAbbr, ColumnName
	, TabIndex, DataTypeId, DataTypeSize, DisplayModeId, ColumnSize, RowSize, DdlKeyColumnName, DdlRefColumnName
	, DdlSrtColumnName, RequiredValid, WhereClause, RegClause FROM dbo.UtReportCri WHERE ReportCriId = @ReportCriId
	SELECT @NReportCriId = @@IDENTITY
	IF @@ERROR <> 0 BEGIN CLOSE cur1 DEALLOCATE cur1 ROLLBACK TRANSACTION END
	INSERT dbo.ReportCriHlp (ReportCriHlpDesc, ReportCriId, CultureId, ColumnHeader)
	SELECT ReportCriHlpDesc, @NReportCriId, CultureId, ColumnHeader FROM dbo.UtReportCriHlp WHERE ReportCriId = @ReportCriId
	IF @@ERROR <> 0 BEGIN CLOSE cur1 DEALLOCATE cur1 ROLLBACK TRANSACTION END
	FETCH NEXT FROM cur1 INTO @ReportCriId
END
CLOSE cur1 DEALLOCATE cur1

IF object_id('tempdb.dbo.#obj') is not null DROP TABLE dbo.#obj
IF object_id('tempdb.dbo.#elm') is not null DROP TABLE dbo.#elm
IF object_id('tempdb.dbo.#tbl') is not null DROP TABLE dbo.#tbl
IF object_id('tempdb.dbo.#cel') is not null DROP TABLE dbo.#cel
IF object_id('tempdb.dbo.#ctr') is not null DROP TABLE dbo.#ctr
CREATE TABLE #obj (ReportObjId int, NReportObjId int)
CREATE TABLE #elm (RptElmId int, NRptElmId int)
CREATE TABLE #tbl (RptTblId int, NRptTblId int)
CREATE TABLE #cel (RptCelId int, NRptCelId int)
CREATE TABLE #ctr (RptCtrId int, NRptCtrId int)

DECLARE cur2 CURSOR FAST_FORWARD FOR SELECT ReportObjId FROM dbo.UtReportObj WHERE ReportId = @ReportId FOR READ ONLY
OPEN cur2 FETCH NEXT FROM cur2 INTO @ReportObjId
WHILE @@FETCH_STATUS = 0
BEGIN
	INSERT dbo.ReportObj (ReportId, RptObjTypeCd, ColumnName, ColumnDesc, TabIndex, ColumnFormat, PaddSize, PaddChar, DataTypeId, OperatorId, ReportCriId)
	SELECT @NReportId, RptObjTypeCd, ColumnName, ColumnDesc, TabIndex, ColumnFormat, PaddSize, PaddChar, DataTypeId, OperatorId, ReportCriId
		FROM dbo.UtReportObj WHERE ReportObjId = @ReportObjId
	SELECT @NReportObjId = @@IDENTITY
	IF @@ERROR <> 0 BEGIN CLOSE cur2 DEALLOCATE cur2 ROLLBACK TRANSACTION END
	INSERT dbo.ReportObjHlp (ReportObjHlpDesc, ReportObjId, CultureId, ColumnHeader, HeaderWidth)
	SELECT ReportObjHlpDesc, @NReportObjId, CultureId, ColumnHeader, HeaderWidth FROM dbo.UtReportObjHlp WHERE ReportObjId = @ReportObjId
	IF @@ERROR <> 0 BEGIN CLOSE cur2 DEALLOCATE cur2 ROLLBACK TRANSACTION END
	INSERT #obj (ReportObjId, NReportObjId) SELECT @ReportObjId, @NReportObjId
	FETCH NEXT FROM cur2 INTO @ReportObjId
END
CLOSE cur2 DEALLOCATE cur2

DECLARE cur3 CURSOR FAST_FORWARD FOR SELECT RptElmId FROM dbo.UtRptElm WHERE ReportId = @ReportId FOR READ ONLY
OPEN cur3 FETCH NEXT FROM cur3 INTO @RptElmId
WHILE @@FETCH_STATUS = 0
BEGIN
	INSERT dbo.RptElm (RptElmDesc, ReportId, RptElmTypeCd, RptStyleId, ElmHeight, ElmColumns, ElmColSpacing, ElmPrintFirst, ElmPrintLast)
	SELECT RptElmDesc, @NReportId, RptElmTypeCd, RptStyleId, ElmHeight, ElmColumns, ElmColSpacing, ElmPrintFirst, ElmPrintLast
		FROM dbo.UtRptElm WHERE RptElmId = @RptElmId
	SELECT @NRptElmId = @@IDENTITY
	IF @@ERROR <> 0 BEGIN CLOSE cur3 DEALLOCATE cur3 ROLLBACK TRANSACTION END
	INSERT #elm (RptElmId, NRptElmId) SELECT @RptElmId, @NRptElmId
	FETCH NEXT FROM cur3 INTO @RptElmId
END
CLOSE cur3 DEALLOCATE cur3

DECLARE cur4 CURSOR FAST_FORWARD FOR SELECT RptTblId FROM dbo.UtRptTbl WHERE ReportId = @ReportId FOR READ ONLY
OPEN cur4 FETCH NEXT FROM cur4 INTO @RptTblId
WHILE @@FETCH_STATUS = 0
BEGIN
	INSERT dbo.RptTbl (RptTblDesc, ParentId, RptCtrId, ReportId, RptTblTypeCd, TblRepeatNew, TblOrder, ColWidth, TblGrouping, TblVisibility, TblToggle)
	SELECT RptTblDesc, ParentId, RptCtrId, @NReportId, RptTblTypeCd, TblRepeatNew, TblOrder, ColWidth, TblGrouping, TblVisibility, TblToggle
		FROM dbo.UtRptTbl WHERE RptTblId = @RptTblId
	SELECT @NRptTblId = @@IDENTITY
	IF @@ERROR <> 0 BEGIN CLOSE cur4 DEALLOCATE cur4 ROLLBACK TRANSACTION END
	INSERT #tbl (RptTblId, NRptTblId) SELECT @RptTblId, @NRptTblId
	DECLARE cur5 CURSOR FAST_FORWARD FOR SELECT RptCelId FROM dbo.UtRptCel WHERE RptTblId = @RptTblId FOR READ ONLY
	OPEN cur5 FETCH NEXT FROM cur5 INTO @RptCelId
	WHILE @@FETCH_STATUS = 0
	BEGIN
		INSERT dbo.RptCel (RptCelDesc, RptTblId, RowNum, RowHeight, RowVisibility, CelNum, CelColSpan)
		SELECT RptCelDesc, @NRptTblId, RowNum, RowHeight, RowVisibility, CelNum, CelColSpan
			FROM dbo.UtRptCel WHERE RptCelId = @RptCelId
		SELECT @NRptCelId = @@IDENTITY
		IF @@ERROR <> 0 BEGIN CLOSE cur5 DEALLOCATE cur5 ROLLBACK TRANSACTION END
		INSERT #cel (RptCelId, NRptCelId) SELECT @RptCelId, @NRptCelId
		FETCH NEXT FROM cur5 INTO @RptCelId
	END
	CLOSE cur5 DEALLOCATE cur5
	FETCH NEXT FROM cur4 INTO @RptTblId
END
CLOSE cur4 DEALLOCATE cur4
UPDATE dbo.RptCel SET CelNum = c.NRptTblId
	FROM dbo.RptCel a
	INNER JOIN dbo.RptTbl b ON a.RptTblId = b.RptTblId
	INNER JOIN #tbl c ON a.CelNum = c.RptTblId
	WHERE b.ReportId = @NReportId

DECLARE cur6 CURSOR FAST_FORWARD FOR SELECT RptCtrId FROM dbo.UtRptCtr WHERE ReportId = @ReportId FOR READ ONLY
OPEN cur6 FETCH NEXT FROM cur6 INTO @RptCtrId
WHILE @@FETCH_STATUS = 0
BEGIN
	INSERT dbo.RptCtr (RptCtrDesc, PRptCtrId, RptElmId, RptCelId, ReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrTop
		, CtrLeft, CtrHeight, CtrWidth, CtrZIndex, CtrAction, CtrGrouping, CtrVisibility, CtrToggle, CtrToolTip
		, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether)
	SELECT RptCtrDesc, PRptCtrId, RptElmId, RptCelId, @NReportId, RptCtrTypeCd, RptCtrName, RptStyleId, CtrTop
		, CtrLeft, CtrHeight, CtrWidth, CtrZIndex, CtrAction, CtrGrouping, CtrVisibility, CtrToggle, CtrToolTip
		, CtrPgBrStart, CtrPgBrEnd, CtrValue, CtrCanGrow, CtrCanShrink, CtrTogether
		FROM dbo.UtRptCtr WHERE RptCtrId = @RptCtrId
	SELECT @NRptCtrId = @@IDENTITY
	IF @@ERROR <> 0 BEGIN CLOSE cur6 DEALLOCATE cur6 ROLLBACK TRANSACTION END
	INSERT #ctr (RptCtrId, NRptCtrId) SELECT @RptCtrId, @NRptCtrId
	FETCH NEXT FROM cur6 INTO @RptCtrId
END
CLOSE cur6 DEALLOCATE cur6

DECLARE cur7 CURSOR FAST_FORWARD FOR SELECT RptChaId FROM dbo.UtRptCha WHERE ReportId = @ReportId FOR READ ONLY
OPEN cur7 FETCH NEXT FROM cur7 INTO @RptChaId
WHILE @@FETCH_STATUS = 0
BEGIN
	INSERT dbo.RptCha (RptChaDesc, RptCtrId, ReportId, RptChaTypeCd, ThreeD, CategoryGrp, ChartData, SeriesGrp)
	SELECT RptChaDesc, RptCtrId, @NReportId, RptChaTypeCd, ThreeD, CategoryGrp, ChartData, SeriesGrp
		FROM dbo.UtRptCha WHERE RptChaId = @RptChaId
	IF @@ERROR <> 0 BEGIN CLOSE cur7 DEALLOCATE cur7 ROLLBACK TRANSACTION END
	FETCH NEXT FROM cur7 INTO @RptChaId
END
CLOSE cur7 DEALLOCATE cur7

UPDATE dbo.RptTbl SET ParentId = b.NRptTblId FROM dbo.RptTbl a INNER JOIN #tbl b ON a.ParentId = b.RptTblId WHERE ReportId = @NReportId
UPDATE dbo.RptTbl SET RptCtrId = b.NRptCtrId FROM dbo.RptTbl a INNER JOIN #ctr b ON a.RptCtrId = b.RptCtrId WHERE ReportId = @NReportId
UPDATE dbo.RptTbl SET TblGrouping = b.NReportObjId FROM dbo.RptTbl a INNER JOIN #obj b ON a.TblGrouping = b.ReportObjId WHERE ReportId = @NReportId
UPDATE dbo.RptCtr SET PRptCtrId = b.NRptCtrId FROM dbo.RptCtr a INNER JOIN #ctr b ON a.PRptCtrId = b.RptCtrId WHERE ReportId = @NReportId
UPDATE dbo.RptCtr SET RptElmId = b.NRptElmId FROM dbo.RptCtr a INNER JOIN #elm b ON a.RptElmId = b.RptElmId WHERE ReportId = @NReportId
UPDATE dbo.RptCtr SET RptCelId = b.NRptCelId FROM dbo.RptCtr a INNER JOIN #cel b ON a.RptCelId = b.RptCelId WHERE ReportId = @NReportId
UPDATE dbo.RptCha SET RptCtrId = b.NRptCtrId FROM dbo.RptCha a INNER JOIN #ctr b ON a.RptCtrId = b.RptCtrId WHERE ReportId = @NReportId
UPDATE dbo.RptCha SET CategoryGrp = b.NReportObjId FROM dbo.RptCha a INNER JOIN #obj b ON a.CategoryGrp = b.ReportObjId WHERE ReportId = @NReportId
UPDATE dbo.RptCha SET SeriesGrp = b.NReportObjId FROM dbo.RptCha a INNER JOIN #obj b ON a.SeriesGrp = b.ReportObjId WHERE ReportId = @NReportId

/* Update descriptions */
DECLARE ElmCur CURSOR FOR SELECT RptElmId FROM dbo.RptElm WHERE ReportId = @NReportId FOR READ ONLY
OPEN ElmCur
FETCH NEXT FROM ElmCur INTO @RptElmId
WHILE @@FETCH_STATUS = 0
BEGIN
	EXEC Ir_UpdRptElm @RptElmId
	FETCH NEXT FROM ElmCur INTO @RptElmId
END
CLOSE ElmCur
DEALLOCATE ElmCur
DECLARE CtrCur CURSOR FOR SELECT RptCtrId FROM dbo.RptCtr WHERE ReportId = @NReportId FOR READ ONLY
OPEN CtrCur
FETCH NEXT FROM CtrCur INTO @RptCtrId
WHILE @@FETCH_STATUS = 0
BEGIN
	EXEC Ir_UpdRptCtr @RptCtrId
	FETCH NEXT FROM CtrCur INTO @RptCtrId
END
CLOSE CtrCur
DEALLOCATE CtrCur
DECLARE TblCur CURSOR FOR SELECT RptTblId FROM dbo.RptTbl WHERE ReportId = @NReportId FOR READ ONLY
OPEN TblCur
FETCH NEXT FROM TblCur INTO @RptTblId
WHILE @@FETCH_STATUS = 0
BEGIN
	EXEC Ir_UpdRptTbl @RptTblId
	FETCH NEXT FROM TblCur INTO @RptTblId
END
CLOSE TblCur
DEALLOCATE TblCur
DECLARE ChaCur CURSOR FOR SELECT RptChaId FROM dbo.RptCha WHERE ReportId = @NReportId FOR READ ONLY
OPEN ChaCur
FETCH NEXT FROM ChaCur INTO @RptChaId
WHILE @@FETCH_STATUS = 0
BEGIN
	EXEC Ir_UpdRptCha @RptChaId
	FETCH NEXT FROM ChaCur INTO @RptChaId
END
CLOSE ChaCur
DEALLOCATE ChaCur

DROP TABLE #obj
DROP TABLE #elm
DROP TABLE #tbl
DROP TABLE #cel
DROP TABLE #ctr
COMMIT TRANSACTION
RETURN 0
 

 
GO
SET QUOTED_IDENTIFIER OFF
GO
